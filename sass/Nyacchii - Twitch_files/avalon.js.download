/*! For license information please see avalon.ca872fd40c39efc7ab70.js.LICENSE */
!function(e){function webpackJsonpCallback(t){for(var n,s,r=t[0],a=t[1],l=0,c=[];l<r.length;l++)s=r[l],Object.prototype.hasOwnProperty.call(i,s)&&i[s]&&c.push(i[s][0]),i[s]=0;for(n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n]);for(o&&o(t);c.length;)c.shift()()}var t={},i={0:0};function __webpack_require__(i){if(t[i])return t[i].exports;var n=t[i]={i:i,l:!1,exports:{}};return e[i].call(n.exports,n,n.exports,__webpack_require__),n.l=!0,n.exports}__webpack_require__.e=function requireEnsure(e){var t=[],n=i[e];if(0!==n)if(n)t.push(n[2]);else{var s=new Promise((function(t,s){n=i[e]=[t,s]}));t.push(n[2]=s);var r,o=document.createElement("script");o.charset="utf-8",o.timeout=120,__webpack_require__.nc&&o.setAttribute("nonce",__webpack_require__.nc),o.src=function jsonpScriptSrc(e){return __webpack_require__.p+""+({2:"chat",3:"featured-follow",4:"host-options",5:"i18n-0",6:"i18n-1",7:"i18n-10",8:"i18n-100",9:"i18n-101",10:"i18n-102",11:"i18n-103",12:"i18n-104",13:"i18n-105",14:"i18n-106",15:"i18n-107",16:"i18n-108",17:"i18n-109",18:"i18n-11",19:"i18n-110",20:"i18n-111",21:"i18n-112",22:"i18n-113",23:"i18n-114",24:"i18n-115",25:"i18n-116",26:"i18n-117",27:"i18n-118",28:"i18n-119",29:"i18n-12",30:"i18n-120",31:"i18n-121",32:"i18n-122",33:"i18n-123",34:"i18n-124",35:"i18n-125",36:"i18n-126",37:"i18n-127",38:"i18n-128",39:"i18n-13",40:"i18n-14",41:"i18n-15",42:"i18n-16",43:"i18n-17",44:"i18n-18",45:"i18n-19",46:"i18n-2",47:"i18n-20",48:"i18n-21",49:"i18n-22",50:"i18n-23",51:"i18n-24",52:"i18n-25",53:"i18n-26",54:"i18n-27",55:"i18n-28",56:"i18n-29",57:"i18n-3",58:"i18n-30",59:"i18n-31",60:"i18n-32",61:"i18n-33",62:"i18n-34",63:"i18n-35",64:"i18n-36",65:"i18n-37",66:"i18n-38",67:"i18n-39",68:"i18n-4",69:"i18n-40",70:"i18n-41",71:"i18n-42",72:"i18n-43",73:"i18n-44",74:"i18n-45",75:"i18n-46",76:"i18n-47",77:"i18n-48",78:"i18n-49",79:"i18n-5",80:"i18n-50",81:"i18n-51",82:"i18n-52",83:"i18n-53",84:"i18n-54",85:"i18n-55",86:"i18n-56",87:"i18n-57",88:"i18n-58",89:"i18n-59",90:"i18n-6",91:"i18n-60",92:"i18n-61",93:"i18n-62",94:"i18n-63",95:"i18n-64",96:"i18n-65",97:"i18n-66",98:"i18n-67",99:"i18n-68",100:"i18n-69",101:"i18n-7",102:"i18n-70",103:"i18n-71",104:"i18n-72",105:"i18n-73",106:"i18n-74",107:"i18n-75",108:"i18n-76",109:"i18n-77",110:"i18n-78",111:"i18n-79",112:"i18n-8",113:"i18n-80",114:"i18n-81",115:"i18n-82",116:"i18n-83",117:"i18n-84",118:"i18n-85",119:"i18n-86",120:"i18n-87",121:"i18n-88",122:"i18n-89",123:"i18n-9",124:"i18n-90",125:"i18n-91",126:"i18n-92",127:"i18n-93",128:"i18n-94",129:"i18n-95",130:"i18n-96",131:"i18n-97",132:"i18n-98",133:"i18n-99",134:"main-menu",135:"menu-md0",136:"menu-md1",137:"menu-md4",138:"menu-md5",139:"queries",140:"site-css-tweaks",141:"translation-ui",142:"vue",143:"vue-chat"}[e]||e)+"."+{2:"6837d78968384362e717",3:"b59568e3c80e7d2629a0",4:"b79b9b7ab40819cda6b6",5:"3f369ed35c5f23db780f",6:"454d677f9ad6abcff009",7:"7c47842bf7f9207f9335",8:"d0cf688a4cf6781c8941",9:"5b5444340d861792ecf9",10:"62b6e696a8c299c53efa",11:"15d976fe11c6f27bcfe0",12:"f388636dd5e85a5e953c",13:"523e0ddff83daf7019cd",14:"cd43af1072b07631f972",15:"3a9259164886f816c7f4",16:"10e29f1ce9990e5fe7fc",17:"908f6e6473e03966a436",18:"519bf10e48f77c578247",19:"0eb3493b9092e1c49f98",20:"5a5aa5245a9fe04956d2",21:"785a23ae9aa2cdbe8227",22:"7dcdafa443de74bc8056",23:"51a7cd8ba29f21f022c9",24:"9b50156aab42a7e9e50f",25:"83c720d98f971ef0883c",26:"e2366fd8daa531582db6",27:"99fd492e7455f9c17544",28:"3d84d5c4387b3e6df2b9",29:"907e0aba6537bc409f44",30:"ff22ce01ecfb2618d82a",31:"6f5cb421c294a497657a",32:"d5bb361a3f73b70cb875",33:"c4efbd3a494e0bb8b99a",34:"992ded6121642e7d8472",35:"8d7e500cf708065ad1b7",36:"96f75e1cce808662da62",37:"5d146d67b7a3a4ee7d81",38:"af46756b6c1065e2c90d",39:"e8f6be97fa7e724139ea",40:"1cea78a32c06a1618b38",41:"9edbee4627ae072ebf6f",42:"ea1f09bdc08aa93115d3",43:"44c948d228c58637adf4",44:"d1a4f0ac5f59a48b2433",45:"7fdf18b3f99486fabd57",46:"28ceac93820cf6eeebe4",47:"63f23608d842a96a2b2f",48:"85fa8468d351bff38186",49:"9848621c4f4f6e89cc06",50:"db6a165ffbab2f28b3f1",51:"d4294726cd1470a8fcf2",52:"01fcccb96f515ff672a0",53:"967f4f941ec2c3436ab6",54:"a989807dd06df9deffef",55:"23dbeb8191690eb0fe58",56:"ffc335b86fce83d5076b",57:"cd8c17bcdca86f658ec0",58:"d68130b80321b45c4887",59:"03d45023accc28c136ce",60:"a86db4046eb2fb446efb",61:"330cfea58dbfa73c59a7",62:"17cc8099321592b0a1cf",63:"a64fa63757a19ae5f7ac",64:"41d7f07dac3f85e96f0c",65:"d89d0e0986caeb461704",66:"64bc28262aad9fbb2138",67:"44c408bd60ed4ea716ba",68:"54eb36482ff0820b88d2",69:"557edddac1457e4bc40a",70:"c32d7a239adbb6498756",71:"95ba60df0eb106d8cd8d",72:"e2c1580bb3f61873fd00",73:"f850577ef1197b8be6b5",74:"a4a1c24f98670ebfee62",75:"d5137211ccd31f1f4e7c",76:"b8759e6529e7fc8e51bb",77:"3b0093e92337ff29e426",78:"3f6b195939321b47695c",79:"ef4422f3185d21c0dbbf",80:"49fe942db1e59ef42bbb",81:"5ab2c0305dc4c648bbed",82:"f09a17d4572cf8852da5",83:"7b99a318ce44d5bcf48d",84:"2cb89324f60789ce9b03",85:"c3db9efba6bb2a1da2e0",86:"0f8e568852cf75f1ad41",87:"35c438a208920cff8517",88:"966fece77f5c83e408f2",89:"58b82fcaab6abba32327",90:"df0b05ff0414b2dca2ec",91:"e5b2b123dcdc2c1a198b",92:"8aa6fce8eaa45d3f8f79",93:"137df7f8c02f1d3b507d",94:"9158517b52d1609ca35d",95:"ddc40cd86b5c2d788d5e",96:"40550087ad7c30056f36",97:"e14428193a1bdc8de75e",98:"8d4563b2d6d5f6b8d15b",99:"bb510f2bf4f642e6d252",100:"723f6d38c90ef8428619",101:"c3533586b9b0321863f5",102:"97e47b79768a8c576a1f",103:"0d94b1471e92969035ed",104:"0961e143aae9177b4455",105:"8c026ed4ca265f32fefc",106:"f7d80c6cc089417e8f24",107:"b3b9bfb54c83883adfef",108:"c7745fa79b5518c78919",109:"a78cf322dd9c9c10061f",110:"02ba83328d531d101242",111:"80f947ea923fd087df92",112:"9b44623f7669733c1197",113:"848a4068c2f35ccc9772",114:"9751347edc78eb84e644",115:"dfd9fef43d8a2f14eb0a",116:"b8f4e255225f81509deb",117:"8ad304081a56b7c6a218",118:"146da3372d6029a4a82c",119:"df3f22f7ad754bed57f6",120:"c85725d1f61e56eaac70",121:"8d460cf142d87aab0ee4",122:"eeeb65ba22685a8bf542",123:"5fdef4ef17d6cfeab583",124:"16611a3cd5531d8fd506",125:"1923c8df4da357fbe342",126:"c63a6720b165b4341279",127:"66e1589adc7155d521a1",128:"476c4543c24969dd912a",129:"02c46ca54d33ed0acb8d",130:"4b84f81f01edc5dea125",131:"3e04492b530366fb6d0c",132:"87d7e4093d605892ed88",133:"f3acb262cef67d22727b",134:"b1f255aae6e95d283c29",135:"cc06ab09400fbedaa753",136:"942b24645b6efdc9264b",137:"6ce89b02a4158f25e1ba",138:"ff702ab2ded87862d593",139:"39f7b91c24aa9ede1607",140:"a4b9730d381b403bee53",141:"1e3bb5ad5b692fc22b34",142:"8d256c60a920af29f388",143:"09ee3f5d9ebef5023fe8"}[e]+".js"}(e),0!==o.src.indexOf(window.location.origin+"/")&&(o.crossOrigin="anonymous");var a=new Error;r=function(t){o.onerror=o.onload=null,clearTimeout(l);var n=i[e];if(0!==n){if(n){var s=t&&("load"===t.type?"missing":t.type),r=t&&t.target&&t.target.src;a.message="Loading chunk "+e+" failed.\n("+s+": "+r+")",a.name="ChunkLoadError",a.type=s,a.request=r,n[1](a)}i[e]=void 0}};var l=setTimeout((function(){r({type:"timeout",target:o})}),12e4);o.onerror=o.onload=r,document.head.appendChild(o)}return Promise.all(t)},__webpack_require__.m=e,__webpack_require__.c=t,__webpack_require__.d=function(e,t,i){__webpack_require__.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},__webpack_require__.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},__webpack_require__.t=function(e,t){if(1&t&&(e=__webpack_require__(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(__webpack_require__.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)__webpack_require__.d(i,n,function(t){return e[t]}.bind(null,n));return i},__webpack_require__.n=function(e){var t=e&&e.__esModule?function getDefault(){return e.default}:function getModuleExports(){return e};return __webpack_require__.d(t,"a",t),t},__webpack_require__.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},__webpack_require__.p="//cdn.frankerfacez.com/static/",__webpack_require__.oe=function(e){throw console.error(e),e},__webpack_require__.h="ca872fd40c39efc7ab70",__webpack_require__.cn="avalon";var n=window.ffzWebpackJsonp=window.ffzWebpackJsonp||[],s=n.push.bind(n);n.push=webpackJsonpCallback,n=n.slice();for(var r=0;r<n.length;r++)webpackJsonpCallback(n[r]);var o=s;__webpack_require__(__webpack_require__.s=142)}([function(e,t,i){"use strict";i.r(t),i.d(t,"generateUUID",(function(){return generateUUID})),i.d(t,"has",(function(){return has})),i.d(t,"sleep",(function(){return sleep})),i.d(t,"make_enum",(function(){return make_enum})),i.d(t,"timeout",(function(){return timeout})),i.d(t,"debounce",(function(){return debounce})),i.d(t,"once",(function(){return once})),i.d(t,"array_equals",(function(){return array_equals})),i.d(t,"deep_equals",(function(){return deep_equals})),i.d(t,"shallow_object_equals",(function(){return shallow_object_equals})),i.d(t,"map_equals",(function(){return map_equals})),i.d(t,"set_equals",(function(){return set_equals})),i.d(t,"filter_match",(function(){return filter_match})),i.d(t,"substr_count",(function(){return substr_count})),i.d(t,"get",(function(){return get})),i.d(t,"shallow_copy",(function(){return shallow_copy})),i.d(t,"deep_copy",(function(){return deep_copy})),i.d(t,"maybe_call",(function(){return maybe_call})),i.d(t,"split_chars",(function(){return split_chars})),i.d(t,"pick_random",(function(){return pick_random})),i.d(t,"escape_regex",(function(){return r})),i.d(t,"glob_to_regex",(function(){return glob_to_regex})),i.d(t,"SourcedSet",(function(){return SourcedSet}));const n=Object.prototype.hasOwnProperty;function generateUUID(e){return e?(e^16*Math.random()>>e/4).toString(16):([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,generateUUID)}function has(e,t){return!!e&&n.call(e,t)}function sleep(e){return new Promise(t=>setTimeout(t,e))}function make_enum(...e){const t={};for(let i=0;i<e.length;i++){const n=e[i];t[n]=i,t[i]=n}return t}function timeout(e,t){return new Promise((i,n)=>{let s=!1;const r=setTimeout(()=>{s||(s=!0,n(new Error("timeout")))},t);e.then(e=>{s||(s=!0,clearTimeout(r),i(e))}).catch(e=>{s||(s=!0,clearTimeout(r),n(e))})})}function debounce(e,t,i){let n;if(i){const later=()=>n=null;return 2===i?function(...i){n?(clearTimeout(n),n=setTimeout(()=>{n=null,e.apply(this,i)},t)):(e.apply(this,i),n=setTimeout(later,t))}:function(...i){n?clearTimeout(n):e.apply(this,i),n=setTimeout(later,t)}}return function(...i){n&&clearTimeout(n),n=setTimeout(e.bind(this,...i),t)}}function once(e){let t;return function(...i){return new Promise(async(n,s)=>{if(t)return t.push([n,s]);let r;t=[[n,s]];try{r=await e.call(this,...i)}catch(e){for(const i of t)i[1](e);return void(t=null)}for(const e of t)e[0](r);t=null})}}function array_equals(e,t){if(!Array.isArray(e)||!Array.isArray(t)||e.length!==t.length)return!1;let i=e.length;for(;i--;)if(e[i]!==t[i])return!1;return!0}function deep_equals(e,t,i=!1,n,s){if(e===t)return!0;if(typeof e!=typeof t)return!1;if("object"!=typeof e)return!1;if(null===e!=(null===t))return!1;if(n||(n=new Set),s||(s=new Set),n.has(e)||s.has(t))throw new Error("recursive structure detected");n.add(e),s.add(t);const r=Object.keys(e),o=Object.keys(t);if(!i&&!array_equals(r,o))return!1;for(const o of r)if(!deep_equals(e[o],t[o],i,new Set(n),new Set(s)))return!1;if(i)for(const a of o)if(!r.includes(a)&&!deep_equals(e[a],t[a],i,new Set(n),new Set(s)))return!1;return!0}function shallow_object_equals(e,t){if("object"!=typeof e||"object"!=typeof t||!array_equals(Object.keys(e),Object.keys(t)))return!1;for(const i in e)if(e[i]!==t[i])return!1;return!0}function map_equals(e,t){if(!(e instanceof Map&&t instanceof Map&&e.size===t.size))return!1;for(const[i,n]of e)if(!t.has(i)||t.get(i)!==n)return!1;return!0}function set_equals(e,t){if(!(e instanceof Set&&t instanceof Set&&e.size===t.size))return!1;for(const i of e)if(!t.has(i))return!1;return!0}function filter_match(e,t){for(const i in e)if(n.call(e,i)){const n=e[i],s=t[i],r=typeof n;if("function"===r){if(!n(s))return!1}else if(Array.isArray(n)){if(Array.isArray(s)){for(const e of n)if(!s.includes(e))return!1}else if(!n.include(s))return!1}else{if(typeof s!==r)return!1;if("object"===r){if(!filter_match(n,s))return!1}else if(n!==s)return!1}}return!0}function substr_count(e,t){let i=0,n=0;for(;n<e.length;){const s=e.indexOf(t,n);if(-1===s)break;i++,n=s+1}return i}function get(e,t){if(n.call(t,e))return t[e];"string"==typeof e&&(e=e.split("."));for(let i=0,s=e.length;i<s;i++){const s=e[i];if("@each"===s){const s=e.slice(i+1);if(s.length)if(Array.isArray)t=t.map(e=>get(s,e));else{const e={};for(const i in t)n.call(t,i)&&(e[i]=get(s,t[i]));t=e}break}if(!(t="@last"===s?t[t.length-1]:t[e[i]]))break}return t}function shallow_copy(e,t=2,i=null){if(null==e)return e;if(e instanceof Promise||"function"==typeof e)return null;if("object"!=typeof e)return e;if(0===t)return null;if(i||(i=new Set),i.add(e),Array.isArray(e)){const n=[];for(const s of e)i.has(s)||n.push(shallow_copy(s,t-1,new Set(i)));return n}const n={};for(const[s,r]of Object.entries(e))i.has(r)||(n[s]=shallow_copy(r,t-1,new Set(i)));return n}function deep_copy(e,t){if(null===e)return null;if(void 0===e)return;if(e instanceof Promise)return new Promise((t,i)=>e.then(t).catch(i));if("function"==typeof e)return function(...t){return e.apply(this,t)};if("object"!=typeof e)return e;if(t||(t=new Set),t.has(e))throw new Error("recursive structure detected");if(t.add(e),Array.isArray(e))return e.map(e=>deep_copy(e,new Set(t)));const i={};for(const s in e)if(n.call(e,s)){const n=e[s];i[s]="object"==typeof n?deep_copy(n,new Set(t)):n}return i}function maybe_call(e,t,...i){return"function"==typeof e?t?e.call(t,...i):e(...i):e}const s=/[^\uD800-\uDFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDFFF]/g;function split_chars(e){return""===e?[]:e.match(s)}function pick_random(e){return e?Array.isArray(e)?e[Math.floor(Math.random()*e.length)]:e[pick_random(Object.keys(e))]:null}const r=RegExp.escape||function escape_regex(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")},o="/$^+.()=!|";function glob_to_regex(e){if("string"!=typeof e)throw new TypeError("input must be a string");let t="",i=0;for(let n=0,s=e.length;n<s;n++){const s=e[n];if(o.includes(s))t+=`\\${s}`;else if("?"===s)t+=".";else if("["===s||"]"===s)t+=s;else if("{"===s)t+="(?:",i++;else if("}"===s)i>0&&(t+=")",i--);else if(","===s&&i>0)t+="|";else if("*"===s){let i=1;for(;"*"===e[n+1];)i++,n++;t+=i>1?".*?":"[^ ]*?"}else t+=s}for(;i>0;)t+=")",i--;return t}class SourcedSet{constructor(){this._cache=[]}_rebuild(){if(this._sources){this._cache=[];for(const e of this._sources.values())for(const t of e)this._cache.includes(t)||this._cache.push(t)}}get(e){return this._sources&&this._sources.get(e)}has(e){return!!this._sources&&this._sources.has(e)}sourceIncludes(e,t){const i=this._sources&&this._sources.get(e);return i&&i.includes(t)}includes(e){return this._cache.includes(e)}delete(e){this._sources&&this._sources.has(e)&&(this._sources.delete(e),this._rebuild())}extend(e,...t){this._sources||(this._sources=new Map);const i=this.has(e);if(this._sources.set(e,[!1,t]),i)this._rebuild();else for(const e of t)this._cache.includes(e)||this._cache.push(e)}set(e,t){this._sources||(this._sources=new Map);const i=this.has(e);this._sources.set(e,[t]),i?this._rebuild():this._cache.includes(t)||this._cache.push(t)}push(e,t){if(!this._sources)return this.set(e,t);const i=this._sources.get(e);if(void 0===i)return this.set(e,t);i.includes(t)||(i.push(t),this._cache.includes(t)||this._cache.push(t))}remove(e,t){if(!this.has(e))return;const i=this._sources.get(e),n=i.indexOf(t);-1!==n&&(i.splice(n,1),this._rebuild())}}},function(e,t,i){"use strict";i.r(t),i.d(t,"on",(function(){return on})),i.d(t,"off",(function(){return off})),i.d(t,"findReactFragment",(function(){return findReactFragment})),i.d(t,"createElement",(function(){return createElement})),i.d(t,"setChildren",(function(){return setChildren})),i.d(t,"findSharedParent",(function(){return findSharedParent})),i.d(t,"openFile",(function(){return openFile})),i.d(t,"readFile",(function(){return readFile})),i.d(t,"sanitize",(function(){return sanitize})),i.d(t,"ManagedStyle",(function(){return ManagedStyle})),i.d(t,"ClickOutside",(function(){return ClickOutside}));var n=i(0);const s=["accept","accept-charset","accesskey","action","align","alt","async","autocomplete","autofocus","autoplay","bgcolor","border","buffered","challenge","charset","checked","cite","class","code","codebase","color","cols","colspan","content","contenteditable","contextmenu","controls","coords","crossorigin","data","data-*","datetime","default","defer","dir","dirname","download","draggable","dropzone","enctype","for","form","formaction","headers","height","hidden","high","href","hreflang","http-equiv","icon","id","integrity","ismap","itemprop","keytype","kind","label","lang","language","list","loop","low","manifest","max","maxlength","minlength","media","method","min","multiple","muted","name","novalidate","open","optimum","pattern","ping","placeholder","poster","preload","radiogroup","readonly","rel","required","reversed","rows","rowspan","sandbox","scope","scoped","seamless","selected","shape","size","sizes","slot","span","spellcheck","src","srcdoc","srclang","srcset","start","step","style","summary","tabindex","target","title","type","usemap","value","width","wrap"],r=document.createRange();function camelCase(e){return e.replace(/[-_]\w/g,e=>e[1].toUpperCase())}function on(e,...t){return e.addEventListener(...t)}function off(e,...t){return e.removeEventListener(...t)}function findReactFragment(e,t,i=25,n=0,s=null){if(s){if(s.has(e))return null}else s=new Set;if(t(e))return e;if(n>=i)return null;if(s.add(e),e&&e.props&&Array.isArray(e.props.children))for(const r of e.props.children)if(r)if(Array.isArray(r))for(const e of r){const r=findReactFragment(e,t,i,n+1,s);if(r)return r}else{const e=findReactFragment(r,t,i,n+1,s);if(e)return e}return null}function createElement(e,t,...i){const r=document.createElement(e);if(1===i.length&&(i=i[0]),"string"==typeof t)r.className=t;else if(t)for(const e in t)if(Object(n.has)(t,e)){const i=e.toLowerCase(),o=t[e];if("style"===i)if("string"==typeof o)r.style.cssText=o;else for(const e in o)Object(n.has)(o,e)&&(r.style[e]=o[e]);else if("dataset"===i)for(const e in o)Object(n.has)(o,e)&&(r.dataset[camelCase(e)]=o[e]);else"dangerouslySetInnerHTML"===e?o&&o.__html&&(r.innerHTML=o.__html):i.startsWith("on")?r.addEventListener(i.slice(2),o):i.startsWith("data-")?r.dataset[camelCase(i.slice(5))]=o:i.startsWith("aria-")||s.includes(i)?r.setAttribute(e,o):r[e]=t[e]}return i&&setChildren(r,i),r}function setChildren(e,t,i,n){if("string"==typeof t)n?e.appendChild(i?r.createContextualFragment(t):document.createTextNode(t)):i?e.innerHTML=t:e.textContent=t;else if(Array.isArray(t)){n||(e.innerHTML="");for(const n of t)"string"==typeof n?e.appendChild(i?r.createContextualFragment(n):document.createTextNode(n)):Array.isArray(n)?setChildren(e,n,i,!0):n&&e.appendChild(n)}else t&&(n||(e.innerHTML=""),e.appendChild(t))}function findSharedParent(e,t,i){for(;e;){if(e.contains(t))return!0;e=e.parentElement,i&&(e=e&&e.closest(i))}return!1}function openFile(e,t){return new Promise(i=>{const n=document.createElement("input");n.type="file",n.accept=e,n.multiple=t,n.onchange=()=>{const e=Array.from(n.files);i(t?e:e[0])},n.click()})}function readFile(e,t="utf-8"){return new Promise((i,n)=>{const s=new FileReader;s.readAsText(e,t),s.onload=()=>i(s.result),s.onerror=e=>n(e)})}const o=createElement("span");function sanitize(e){return o.textContent=e,o.innerHTML}let a=0;class ManagedStyle{constructor(e){this.id=e||a++,this._blocks={},this._style=createElement("style",{type:"text/css",id:`ffz--managed-style--${this.id}`}),document.head.appendChild(this._style)}destroy(){this._style.remove(),this._blocks=null,this._style=null}set(e,t,i){const n=this._blocks[e];if(n){if(!i&&n.textContent===t)return;n.textContent=t}else this._style.appendChild(this._blocks[e]=document.createTextNode(t))}delete(e){const t=this._blocks[e];t&&(this._style.contains(t)&&this._style.removeChild(t),this._blocks[e]=null)}}class ClickOutside{constructor(e,t){this.el=e,this.cb=t,this._fn=this.handleClick.bind(this),document.documentElement.addEventListener("click",this._fn)}destroy(){this._fn&&document.documentElement.removeEventListener("click",this._fn),this.cb=this.el=this._fn=null}handleClick(e){this.el&&!this.el.contains(e.target)&&this.cb(e)}}},function(e,t,i){"use strict";i.r(t),i.d(t,"DEBUG",(function(){return s})),i.d(t,"SERVER",(function(){return r})),i.d(t,"CLIENT_ID",(function(){return o})),i.d(t,"API_SERVER",(function(){return a})),i.d(t,"NEW_API",(function(){return l})),i.d(t,"SENTRY_ID",(function(){return c})),i.d(t,"LV_SERVER",(function(){return u})),i.d(t,"LV_SOCKET_SERVER",(function(){return h})),i.d(t,"KEYS",(function(){return d})),i.d(t,"TWITCH_EMOTE_BASE",(function(){return f})),i.d(t,"KNOWN_CODES",(function(){return p})),i.d(t,"REPLACEMENT_BASE",(function(){return g})),i.d(t,"REPLACEMENTS",(function(){return m})),i.d(t,"WS_CLUSTERS",(function(){return _})),i.d(t,"IS_OSX",(function(){return b})),i.d(t,"IS_WIN",(function(){return v})),i.d(t,"IS_WEBKIT",(function(){return y})),i.d(t,"IS_FIREFOX",(function(){return w})),i.d(t,"WEBKIT_CSS",(function(){return k})),i.d(t,"TWITCH_GLOBAL_SETS",(function(){return C})),i.d(t,"TWITCH_POINTS_SETS",(function(){return x})),i.d(t,"TWITCH_PRIME_SETS",(function(){return S})),i.d(t,"EmoteTypes",(function(){return E}));var n=i(0);const s="true"===localStorage.ffzDebugMode&&document.body.classList.contains("ffz-dev"),r=s?"//localhost:8000":"https://cdn.frankerfacez.com",o="a3bc9znoz6vi8ozsoca0inlcr4fcvkl",a="//api.frankerfacez.com",l="//api-test.frankerfacez.com",c="https://07ded545d3224ca59825daee02dc7745@catbag.frankerfacez.com:444/2",u="https://cbenni.com/api",h="wss://cbenni.com/socket.io/",d={Space:32,Enter:13,Escape:27},f="//static-cdn.jtvnw.net/emoticons/v1/",p={"#-?[\\\\/]":"#-/",":-?(?:7|L)":":-7","\\&lt\\;\\]":"<]","\\:-?(S|s)":":-S","\\:-?\\\\":":-\\","\\:\\&gt\\;":":>","B-?\\)":"B-)","\\:-?[z|Z|\\|]":":-Z","\\:-?\\)":":-)","\\:-?\\(":":-(","\\:-?(p|P)":":-P","\\;-?(p|P)":";-P","\\&lt\\;3":"<3","\\:-?[\\\\/]":":-/","\\;-?\\)":";-)","R-?\\)":"R-)","[oO](_|\\.)[oO]":"O.o","[o|O](_|\\.)[o|O]":"O.o","\\:-?D":":-D","\\:-?(o|O)":":-O","\\&gt\\;\\(":">(","Gr(a|e)yFace":"GrayFace"},g="//cdn.frankerfacez.com/script/replacements/",m={15:"15-JKanStyle.png",16:"16-OptimizePrime.png",17:"17-StoneLightning.png",18:"18-TheRinger.png",22:"22-RedCoat.png",26:"26-JonCarnage.png",30:"30-BCWarrior.png",33:"33-DansGame.png",36:"36-PJSalt.png"},_={Production:[["wss://catbag.frankerfacez.com/",.25],["wss://andknuckles.frankerfacez.com/",.8],["wss://tuturu.frankerfacez.com/",1],["wss://lilz.frankerfacez.com/",1],["wss://yoohoo.frankerfacez.com/",1],["wss://pog.frankerfacez.com/",1]],Development:[["wss://127.0.0.1:8003/",1]]},b=navigator.platform?-1!==navigator.platform.indexOf("Mac"):/OS X/.test(navigator.userAgent),v=navigator.platform?-1!==navigator.platform.indexOf("Win"):/Windows/.test(navigator.userAgent),y=-1!==navigator.userAgent.indexOf("AppleWebKit/")&&-1===navigator.userAgent.indexOf("Edge/"),w=-1!==navigator.userAgent.indexOf("Firefox/"),k=y?"-webkit-":"",C=[0,33,42],x=[300238151],S=[457,793,19151,19194],E=Object(n.make_enum)("Unknown","Prime","Turbo","LimitedTime","ChannelPoints","Unavailable","Subscription","BitsTier","Global")},function(e,t,i){"use strict";i.r(t),i.d(t,"State",(function(){return r})),i.d(t,"Module",(function(){return Module})),i.d(t,"SiteModule",(function(){return SiteModule})),i.d(t,"ModuleError",(function(){return ModuleError})),i.d(t,"CyclicDependencyError",(function(){return CyclicDependencyError}));var n=i(5),s=i(0);const r={UNLOADED:0,LOADING:1,LOADED:2,UNLOADING:3,DISABLED:0,ENABLING:1,ENABLED:2,DISABLING:3};class Module extends n.default{constructor(e,t){!t&&e instanceof Module&&(t=e,e=null),super(e,t),this.__modules=t?t.__modules:{},this.children={},t&&!t.children[this.name]&&(t.children[this.name]=this),this.root===this&&(this.__modules[this.__path||""]=this),this.__load_state=this.onLoad?r.UNLOADED:r.LOADED,this.__state=this.onLoad||this.onEnable?r.DISABLED:r.ENABLED,this.emit(":registered")}get state(){return this.__state}get load_state(){return this.__load_state}get loaded(){return this.__load_state===r.LOADED}get loading(){return this.__load_state===r.LOADING}get enabled(){return this.__state===r.ENABLED}get enabling(){return this.__state===r.ENABLING}get log(){return this.__log||(this.__log=this.parent&&this.parent.log.get(this.name)),this.__log}set log(e){this.__log=e}load(...e){return this.__load(e,this.__path,[])}unload(...e){return this.__unload(e,this.__path,[])}enable(...e){return this.__enable(e,this.__path,[])}disable(...e){return this.__disable(e,this.__path,[])}__load(e,t,i){const n=this.__path||this.name,s=this.__load_state;return s===r.LOADING?this.__load_promise:s===r.LOADED?Promise.resolve():s===r.UNLOADING?Promise.reject(new ModuleError(`attempted to load module ${n} while module is being unloaded`)):i.includes(this)?Promise.reject(new CyclicDependencyError(`cyclic load requirements when loading ${t}`,i)):(i.push(this),this.__load_state=r.LOADING,this.__load_promise=(async()=>{if(this.load_requires){const e=[];for(const s of this.load_requires){const r=this.resolve(s);if(!(r&&r instanceof Module))throw new ModuleError(`cannot find required module ${s} when loading ${n}`);e.push(r.__enable([],t,Array.from(i)))}await Promise.all(e)}if(this.onLoad)return this.onLoad(...e)})().then(e=>(this.__load_state=r.LOADED,this.__load_promise=null,this.emit(":loaded",this),e)).catch(e=>{throw this.__load_state=r.UNLOADED,this.__load_promise=null,e}))}__unload(e,t,i){const n=this.__path||this.name,s=this.__load_state;return s===r.UNLOADING?this.__load_promise:s===r.UNLOADED?Promise.resolve():this.onUnload?s===r.LOADING?Promise.reject(new ModuleError(`attempted to unload module ${n} while module is being loaded`)):i.includes(this)?Promise.reject(new CyclicDependencyError(`cyclic load requirements when unloading ${t}`,i)):(i.push(this),this.__load_state=r.UNLOADING,this.__load_promise=(async()=>{if(this.__state!==r.DISABLED&&await this.disable(),this.load_dependents){const e=[];for(const s of this.load_dependents){const r=this.resolve(s);if(!r)throw new ModuleError(`cannot find depending module ${s} when unloading ${n}`);e.push(r.__unload([],t,Array.from(i)))}await Promise.all(e)}return this.onUnload(...e)})().then(e=>(this.__load_state=r.UNLOADED,this.__load_promise=null,this.emit(":unloaded",this),e)).catch(e=>{throw this.__load_state=r.LOADED,this.__load_promise=null,e})):Promise.reject(new ModuleError(`attempted to unload module ${n} but module cannot be unloaded`))}__enable(e,t,i){const n=this.__path||this.name,s=this.__state;return s===r.ENABLING?this.__state_promise:s===r.ENABLED?Promise.resolve():s===r.DISABLING?Promise.reject(new ModuleError(`attempted to enable module ${n} while module is being disabled`)):i.includes(this)?Promise.reject(new CyclicDependencyError(`cyclic requirements when enabling ${t}`,i)):(i.push(this),this.__state=r.ENABLING,this.__state_promise=(async()=>{const s=[],o=this.requires,a=this.__load_state;if(a===r.UNLOADING)throw new ModuleError(`attempted to load module ${n} while module is being unloaded`);if(a!==r.LOADING&&a!==r.UNLOADED||s.push(this.load()),o)for(const e of o){const r=this.resolve(e);if(!(r&&r instanceof Module))throw new ModuleError(`cannot find required module ${e} when enabling ${n}`);s.push(r.__enable([],t,Array.from(i)))}if(await Promise.all(s),this.onEnable)return this.onEnable(...e)})().then(e=>(this.__state=r.ENABLED,this.__state_promise=null,this.emit(":enabled",this),e)).catch(e=>{throw this.__state=r.DISABLED,this.__state_promise=null,e}))}__disable(e,t,i){const n=this.__path||this.name,s=this.__state;return s===r.DISABLING?this.__state_promise:s===r.DISABLED?Promise.resolve():this.onDisable?s===r.ENABLING?Promise.reject(new ModuleError(`attempted to disable module ${n} but module is being enabled`)):i.includes(this)?Promise.reject(new CyclicDependencyError(`cyclic requirements when disabling ${t}`,i)):(i.push(this),this.__state=r.DISABLING,this.__state_promise=(async()=>{if(this.__load_state!==r.LOADED)throw new ModuleError(`attempted to disable module ${n} but module is unloaded -- weird state`);if(this.dependents){const e=[];for(const s of this.dependents){const r=this.resolve(s);if(!r)throw new ModuleError(`cannot find depending module ${s} when disabling ${n}`);e.push(r.__disable([],t,Array.from(i)))}await Promise.all(e)}return this.onDisable(...e)})().then(e=>(this.__state=r.DISABLED,this.__state_promise=null,this.emit(":disabled",this),e)).catch(e=>{throw this.__state=r.ENABLED,this.__state_promise=null,e})):Promise.reject(new ModuleError(`attempted to disable module ${n} but module cannot be disabled`))}on(e,t,i){return super.on(e,t,void 0===i?this:i)}prependOn(e,t,i){return super.prependOn(e,t,void 0===i?this:i)}many(e,t,i,n){return super.many(e,t,i,void 0===n?this:n)}prependMany(e,t,i,n){return super.prependMany(e,t,i,void 0===n?this:n)}once(e,t,i){return super.once(e,t,void 0===i?this:i)}prependOnce(e,t,i){return super.prependOnce(e,t,void 0===i?this:i)}off(e,t,i){return super.off(e,t,void 0===i?this:i)}loadModules(...e){return Promise.all(e.map(e=>this.resolve(e).load()))}unloadModules(...e){return Promise.all(e.map(e=>this.resolve(e).unload()))}enableModules(...e){return Promise.all(e.map(e=>this.resolve(e).enable()))}disableModules(...e){return Promise.all(e.map(e=>this.resolve(e).disable()))}resolve(e){return e instanceof Module?e:this.__modules[this.abs_path(e)]}hasModule(e){return this.__modules[this.abs_path(e)]instanceof Module}__get_requires(){return Object(s.has)(this,"requires")?this.requires:Object(s.has)(this.constructor,"requires")?this.constructor.requires:void 0}__get_load_requires(){return Object(s.has)(this,"load_requires")?this.load_requires:Object(s.has)(this.constructor,"load_requires")?this.constructor.load_requires:void 0}inject(e,t,i=!0){(e instanceof Module||e.prototype instanceof Module)&&(i=null==t||t,t=e,e=null);const n=this.requires=this.__get_requires()||[];if(t instanceof Module)e||(e=t.constructor.name.toSnakeCase());else if(t&&t.prototype instanceof Module)e||(e=t.name.toSnakeCase()),t=this.register(e,t);else{if(!e)throw new TypeError("must provide a valid module name or class");{const i=e;if(e=e.replace(/^(?:[^.]*\.)+/,""),!((t=this.resolve(i))&&t instanceof Module))return t?t[2].push([this.__path,e]):this.__modules[this.abs_path(i)]=[[],[],[[this.__path,e]]],n.push(this.abs_path(i)),this[e]=null}}if(!t)throw new Error(`cannot find module ${e} or no module provided`);return i&&n.push(t.abs_path(".")),this.enabled&&!t.enabled&&t.enable(),this[e]=t}injectAs(e,t,i,n=!0){(t instanceof Module||t.prototype instanceof Module)&&(n=null==i||i,i=t,t=null);const s=this.requires=this.__get_requires()||[];if(i instanceof Module)t||(t=i.constructor.name.toSnakeCase());else if(i&&i.prototype instanceof Module)t||(t=i.name.toSnakeCase()),i=this.register(t,i);else{if(!t)throw new TypeError("must provide a valid module name or class");{const n=t;if(t=t.replace(/^(?:[^.]*\.)+/,""),!((i=this.resolve(n))&&i instanceof Module))return i?i[2].push([this.__path,e]):this.__modules[this.abs_path(n)]=[[],[],[[this.__path,e]]],s.push(this.abs_path(n)),this[e]=null}}if(!i)throw new Error(`cannot find module ${t} or no module provided`);return n&&s.push(i.abs_path(".")),this.enabled&&!i.enabled&&i.enable(),this[e]=i}register(e,t,i){e.prototype instanceof Module&&(i=t,e=(t=e).name.toSnakeCase());const n=this.abs_path(`.${e}`),s=t.prototype,r=this.__modules[n];if(!(s instanceof Module))throw new TypeError(`Module ${e} is not subclass of Module.`);if(r instanceof Module)throw new ModuleError(`Name Collision for Module ${n}`);const o=r||[[],[],[]],a=this.__modules[n]=new t(e,this),l=a.requires=a.__get_requires()||[],c=a.load_requires=a.__get_load_requires()||[];a.dependents=o[0],a.load_dependents=o[1],a instanceof SiteModule&&!l.includes("site")&&l.push("site");for(const e of l){const t=a.abs_path(e),i=this.__modules[t];i?Array.isArray(i)?i[0].push(n):i.dependents.push(n):this.__modules[t]=[[n],[],[]]}for(const e of c){const t=a.abs_path(e),i=this.__modules[t];i?Array.isArray(i)?i[1].push(n):i.load_dependents.push(n):this.__modules[t]=[[],[n],[]]}for(const[e,t]of o[2]){const i=this.resolve(e);i?i[t]=a:this.log.warn(`Unable to find module "${e}" that wanted "${t}".`)}return i&&(this[e]=a),a}populate(e,t){t=t||this.log;const i={};for(const n of e.keys()){const s=e(n),r=s.module||s.default,o=n.lastIndexOf("."),a=o>2?n.slice(2,o):n,l=a.endsWith("/index")?a.slice(0,-6):a;try{i[l]=this.register(l,r)}catch(e){t&&t.capture(e,{extra:{module:l,path:n}}),t&&t.warn(e,`Skipping ${n}`)}}return i}}Module.State=r,Module.prototype.State=r;class SiteModule extends Module{constructor(e,t){super(e,t),this.site=this.resolve("site")}}t.default=Module;class ModuleError extends Error{}class CyclicDependencyError extends ModuleError{constructor(e,t){super(e),this.modules=t}}},function(e,t,i){"use strict";i.d(t,"a",(function(){return Twilight}));var n=i(103),s=i(117),r=i(118),o=i(119),a=i(120),l=i(121),c=i(122),u=i(1),h=i(0),d=i(123),f=i.n(d);class Twilight extends n.a{constructor(...e){super(...e),this.inject(s.a),this.inject(r.a),this.inject("router",o.a),this.inject(a.a,!1),this.inject(l.a),this.inject(c.a),this._dom_updates=[]}onLoad(){this.populateModules(),this.web_munch.known(Twilight.KNOWN_MODULES),this.router.route(Twilight.ROUTES),this.router.routeName(Twilight.ROUTE_NAMES),this.router.route(Twilight.DASH_ROUTES,"dashboard.twitch.tv")}onEnable(){const e=this.fine.searchTree(null,e=>e.props&&e.props.store),t=this.store=e&&e.props&&e.props.store;if(!t)return new Promise(e=>setTimeout(e,50)).then(()=>this.onEnable());this.on(":dom-update",(...e)=>{this._dom_updates.push(e),this._dom_frame||(this._dom_frame=requestAnimationFrame(()=>{const e=this._dom_updates,t=this.resolve("core");this._dom_updates=[],this._dom_frame=null;for(const[i,n]of e){const e=this.fine.getChildNode(n);t.emit("core:dom-update",i,e,n)}}))});const update_size=()=>this.settings.updateContext({size:{height:window.innerHeight,width:window.innerWidth}});window.addEventListener("resize",update_size),update_size(),t.subscribe(()=>this.updateContext()),this.updateContext(),this.router.on(":route",(e,t)=>{this.log.info("Navigation",e&&e.name,t&&t[0]),this.fine.route(e&&e.name),this.settings.updateContext({route:e,route_data:t})});const i=this.router.current;this.fine.route(i&&i.name),this.settings.updateContext({route:i,route_data:this.router.match}),document.head.appendChild(Object(u.createElement)("link",{href:f.a,rel:"stylesheet",type:"text/css",crossOrigin:"anonymous"}));const n=new URL(window.location).searchParams;if(n){if(n.has("ffz-settings")){const e=this.resolve("main_menu");e.dialog.exclusive=!0,e.enable()}if(n.has("ffz-translate")){const e=this.resolve("translation_ui");e.dialog.exclusive=!0,e.enable()}}}updateContext(){try{const e=this.store.getState(),t=this.router&&this.router.history;this.settings.updateContext({location:t&&t.location,ui:e&&e.ui,session:e&&e.session,chat:e&&e.chat})}catch(e){this.log.error("Error updating context.",e)}}getSession(){const e=this.store&&this.store.getState();return e&&e.session}getUser(){if(this._user)return this._user;const e=this.getSession();return this._user=e&&e.user}getCore(){if(this._core)return this._core;let e=this.web_munch.getModule("core-1");return e?this._core=e.o:(e=this.web_munch.getModule("core-2"),e?this._core=e.p:(e=this.web_munch.getModule("core-3"),e?this._core=e.q:void 0))}}Twilight.KNOWN_MODULES={simplebar:e=>e.globalObserver&&e.initDOMLoadedElements,react:e=>e.Component&&e.createElement,"core-1":e=>e.o&&e.o.experiments,"core-2":e=>e.p&&e.p.experiments,"core-3":e=>e.q&&e.q.experiments,cookie:e=>e&&e.set&&e.get&&e.getJSON&&e.withConverter,"extension-service":e=>e.extensionService,"chat-types":e=>e.b&&Object(h.has)(e.b,"Message")&&Object(h.has)(e.b,"RoomMods"),"gql-printer":e=>e!==window&&e.print,mousetrap:e=>e.bindGlobal&&e.unbind&&e.handleKey,"algolia-search":e=>e.a&&e.a.prototype&&e.a.prototype.queryTopResults&&e.a.prototype.queryForType},Twilight.CHAT_ROUTES=["collection","popout","dash-chat","video","user-video","user-clip","user-videos","user-clips","user-events","user-followers","user-following","user","dash","embed-chat","squad","command-center","dash-stream-manager"],Twilight.ROUTE_NAMES={dir:"Browse","dir-following":"Following","dir-all":"Browse Live Channels",dash:"Dashboard",popout:"Popout Chat","dash-chat":"Dashboard Popout Chat","user-video":"Channel Video"},Twilight.SUNLIGHT_ROUTES=["dash-stream-manager","dash-channel-analytics","dash-stream-summary","dash-achievements","dash-roles","dash-activity","dash-channel-points","dash-video-producer","dash-edit-video","dash-collections","dash-edit-collection","dash-clips","dash-settings-moderation","dash-settings-channel","dash-settings-revenue","dash-extensions","dash-streaming-tools"],Twilight.DASH_ROUTES={"dash-stream-manager":"/u/:userName/stream-manager","dash-channel-analytics":"/u/:userName/channel-analytics","dash-stream-summary":"/u/:userName/stream-summary","dash-achievements":"/u/:userName/achievements","dash-roles":"/u/:userName/community/roles","dash-activity":"/u/:userName/community/activity","dash-channel-points":"/u/:userName/community/channel-points","dash-video-producer":"/u/:userName/content/video-producer","dash-edit-video":"/u/:userName/content/video-producer/edit/:videoID","dash-collections":"/u/:userName/content/collections","dash-edit-collection":"/u/:userName/content/collections/:collectionID","dash-clips":"/u/:userName/content/clips","dash-settings-moderation":"/u/:userName/settings/moderation","dash-settings-channel":"/u/:userName/settings/channel","dash-settings-revenue":"/u/:userName/settings/revenue","dash-extensions":"/u/:userName/extensions","dash-streaming-tools":"/u/:userName/broadcast"},Twilight.ROUTES={"front-page":"/",collection:"/collections/:collectionID",dir:"/directory","dir-following":"/directory/following/:category?","dir-game-index":"/directory/game/:gameName","dir-game-clips":"/directory/game/:gameName/clips","dir-game-videos":"/directory/game/:gameName/videos/:filter","dir-all":"/directory/all/:filter?",dash:"/:userName/dashboard/:live?",event:"/event/:eventName",popout:"/popout/:userName/chat","dash-chat":"/popout/:userName/dashboard/live/chat",video:"/videos/:videoID","user-video":"/:userName/video/:videoID","user-videos":"/:userName/videos/:filter?","user-clips":"/:userName/clips","user-clip":"/:userName/clip/:clipID","user-collections":"/:userName/collections","user-events":"/:userName/events","user-followers":"/:userName/followers","user-following":"/:userName/following",product:"/products/:productName",prime:"/prime",turbo:"/turbo",user:"/:userName",squad:"/:userName/squad","command-center":"/:userName/commandcenter","embed-chat":"/embed/:userName/chat"},Twilight.DIALOG_EXCLUSIVE=".sunlight-root,.twilight-main,.twilight-minimal-root>div,#root>div>.tw-full-height,.clips-root",Twilight.DIALOG_MAXIMIZED=".sunlight-page,.twilight-main,.twilight-minimal-root,#root .dashboard-side-nav+.tw-full-height,.clips-root>.tw-full-height .scrollable-area",Twilight.DIALOG_SELECTOR=".sunlight-root,#root>div,.twilight-minimal-root>.tw-full-height,.clips-root>.tw-full-height .scrollable-area"},function(e,t,i){"use strict";i.r(t),i.d(t,"EventEmitter",(function(){return EventEmitter})),i.d(t,"FFZEvent",(function(){return FFZEvent})),i.d(t,"HierarchicalEventEmitter",(function(){return HierarchicalEventEmitter}));var n=i(0);const s=Symbol("Detach"),r=Symbol("StopPropagation"),o=/([a-z])([A-Z])/g,a=/[ \t\W]/g,l=/^_+|_+$/g;String.prototype.toSnakeCase=function(){return this.replace(o,"$1_$2").replace(a,"_").replace(l,"").toLowerCase()};class EventEmitter{constructor(){this.__listeners={},this.__running=new Set,this.__dead_events=0}__cleanListeners(){if(!this.__dead_events)return;const e={},t=this.__listeners;for(const i in t)if(Object(n.has)(t,i)){const n=t[i];n&&(e[i]=n)}this.__listeners=e,this.__dead_events=0}on(e,t,i){if("function"!=typeof t)throw new TypeError("fn must be a function");(this.__listeners[e]=this.__listeners[e]||[]).push([t,i,!1])}prependOn(e,t,i){if("function"!=typeof t)throw new TypeError("fn must be a function");(this.__listeners[e]=this.__listeners[e]||[]).unshift([t,i,!1])}once(e,t,i){return this.many(e,1,t,i)}prependOnce(e,t,i){return this.prependMany(e,1,t,i)}many(e,t,i,n){if("function"!=typeof i)throw new TypeError("fn must be a function");if("number"!=typeof t||isNaN(t)||!isFinite(t)||t<1)throw new TypeError("ttl must be a positive, finite number");(this.__listeners[e]=this.__listeners[e]||[]).push([i,n,t])}prependMany(e,t,i,n){if("function"!=typeof i)throw new TypeError("fn must be a function");if("number"!=typeof t||isNaN(t)||!isFinite(t)||t<1)throw new TypeError("ttl must be a positive, finite number");(this.__listeners[e]=this.__listeners[e]||[]).unshift([i,n,t])}waitFor(e){return new Promise(t=>{(this.__listeners[e]=this.__listeners[e]||[]).push([t,null,1])})}off(e,t,i){if(this.__running.has(e))throw new Error("concurrent modification: tried removing event listener while event is running");let n=this.__listeners[e];n&&(t?(n=n.filter(([e,n])=>!(e===t&&(!i||i===n))),n.length||(n=null)):n=null,this.__listeners[e]=n,n||this.__dead_events++)}events(){return this.__cleanListeners(),Object.keys(this.__listeners)}listeners(e){const t=this.__listeners[e];return t?Array.from(t):[]}emitUnsafe(e,...t){let i=this.__listeners[e];if(!i)return;if(this.__running.has(e))throw new Error("concurrent access: tried to emit event while event is running");const n=new Set;this.__listeners[e]=null,this.__running.add(e);for(const e of i){const[i,o,a]=e,l=i.apply(o,t);if(l===s?n.add(e):!1!==a&&(a<=1?n.add(e):e[2]=a-1),t[0]instanceof FFZEvent&&t[0].propagationStopped||l===r)break}if(n.size)for(const e of n){const t=i.indexOf(e);-1!==t&&i.splice(t,1)}this.__listeners[e]&&(i=i.concat(this.__listeners[e])),i.length?this.__listeners[e]=i:(this.__listeners[e]=null,this.__dead_events++),this.__running.delete(e)}emit(e,...t){let i=this.__listeners[e];if(!i)return;if(this.__running.has(e))throw new Error("concurrent access: tried to emit event while event is running");const n=new Set;this.__listeners[e]=null,this.__running.add(e);for(const o of i){const[i,a,l]=o;let c;try{c=i.apply(a,t)}catch(i){this.log&&this.log.capture(i,{tags:{event:e},extra:{args:t}})}if(c===s?n.add(o):!1!==l&&(l<=1?n.add(o):o[2]=l-1),t[0]instanceof FFZEvent&&t[0].propagationStopped||c===r)break}if(n.size)for(const e of n){const t=i.indexOf(e);-1!==t&&i.splice(t,1)}this.__listeners[e]&&(i=i.concat(this.__listeners[e])),i.length?this.__listeners[e]=i:(this.__listeners[e]=null,this.__dead_events++),this.__running.delete(e)}async emitAsync(e,...t){let i=this.__listeners[e];if(!i)return[];if(this.__running.has(e))throw new Error("concurrent access: tried to emit event while event is running");const n=new Set,r=[];this.__listeners[e]=null,this.__running.add(e);for(const o of i){const[i,a]=o;let l;try{l=i.apply(a,t)}catch(i){this.log&&this.log.capture(i,{tags:{event:e},extra:{args:t}})}l instanceof Promise||(l=Promise.resolve(l)),r.push(l.then(e=>{const t=o[2];if(e===s?n.add(o):!1!==t&&(t<=1?n.add(o):o[2]=t-1),l!==s)return l}).catch(i=>(this.log&&this.log.capture(i,{event:e,args:t}),null)))}const o=await Promise.all(r);if(n.size)for(const e of n){const t=i.indexOf(e);-1!==t&&i.splice(t,1)}return this.__listeners[e]&&(i=i.concat(this.__listeners[e])),i.length?this.__listeners[e]=i:(this.__listeners[e]=null,this.__dead_events++),this.__running.delete(e),o}}EventEmitter.Detach=s,EventEmitter.StopPropagation=r;class FFZEvent{constructor(e){this.defaultPrevented=!1,this.propagationStopped=!1,Object.assign(this,e)}stopPropagation(){this.propagationStopped=!0}preventDefault(){this.defaultPrevented=!0}}class HierarchicalEventEmitter extends EventEmitter{constructor(e,t){super(),this.name=e||(this.constructor.name||"").toSnakeCase(),this.parent=t,t?(this.root=t.root,this.__listeners=t.__listeners,this.__path=e&&t.__path?`${t.__path}.${e}`:e):(this.root=this,this.__path=void 0),this.__path_parts=this.__path?this.__path.split("."):[]}get path(){return this.__path}abs_path(e){if("string"!=typeof e||!e.length)throw new TypeError("path must be a non-empty string");let t,i=0;const n=this.__path_parts,s=n.length;do{if(t=e.charAt(i),"."!==e.charAt(i))break;if(i>s)throw new Error("invalid path: reached top of stack")}while(++i<e.length);const r=":"===t;if(0===i)return r&&this.__path?`${this.__path}${e}`:e;const o=n.slice(0,s-(i-1)).join("."),a=e.slice(i);return o.length?a.length?r?o+a:`${o}.${a}`:o:a}on(e,t,i){return super.on(this.abs_path(e),t,i)}prependOn(e,t,i){return super.prependOn(this.abs_path(e),t,i)}once(e,t,i){return super.once(this.abs_path(e),t,i)}prependOnce(e,t,i){return super.prependOnce(this.abs_path(e),t,i)}many(e,t,i,n){return super.many(this.abs_path(e),t,i,n)}prependMany(e,t,i,n){return super.prependMany(this.abs_path(e),t,i,n)}waitFor(e){return super.waitFor(this.abs_path(e))}off(e,t,i){return super.off(this.abs_path(e),t,i)}listeners(e){return super.listeners(this.abs_path(e))}emit(e,...t){return super.emit(this.abs_path(e),...t)}emitUnsafe(e,...t){return super.emitUnsafe(this.abs_path(e),...t)}emitAsync(e,...t){return super.emitAsync(this.abs_path(e),...t)}events(e){this.__cleanListeners();const t=Object.keys(this.__listeners),i=this.__path||"",n=i.length;return t.filter(t=>{const s=t.charAt(n);return t.startsWith(i)&&(""===s||e&&"."===s||":"===s)})}}t.default=HierarchicalEventEmitter},function(e,t,i){"use strict";function getBuster(e=5){const t=Math.floor(Date.now()/1e3);return t-t%e}function duration_to_string(e,t,i,n,s){const r=e%60;let o=Math.floor(e/60),a=Math.floor(o/60),l="";if(o%=60,t){if(l=Math.floor(a/24),a%=24,i&&l>0)return`${l} days`;l=l>0?`${l} days, `:""}const c=!n||l||a;return`${l}${c?`${l&&a<10?"0":""}${a}:`:""}${c&&o<10?"0":""}${o}${s?"":`:${r<10?"0":""}${r}`}`}function print_duration(e){let t=Math.floor(e/60);const i=Math.floor(t/60);return t%=60,`${i>0?`${i}:${t<10?"0":""}`:""}${t}:${(e%=60)<10?"0":""}${e}`}function durationForURL(e){const t=e%60;let i=Math.floor(e/60);const n=Math.floor(i/60);return i%=60,`${n>0?`${n}h`:""}${i>0?`${i}m`:""}${t>0?`${t}s`:""}`}i.r(t),i.d(t,"getBuster",(function(){return getBuster})),i.d(t,"duration_to_string",(function(){return duration_to_string})),i.d(t,"print_duration",(function(){return print_duration})),i.d(t,"durationForURL",(function(){return durationForURL}))},function(e,t,i){"use strict";function createTester(e,t,i=!1,n=!1){if(!Array.isArray(e)||!t)return i?()=>!1:()=>!0;const s=[],r=[];let o=0;for(const i of e){if(!i||!i.type)continue;const e=t[i.type];e&&(o++,s.push(e.createTest(i.data,t)),r.push(`f${o}`))}return s.length?1===s.length?i?e=>!s[0](e):s[0]:new Function(...r,"ctx",`return ${i?"!(":""}${r.map(e=>`${e}(ctx)`).join(n?" || ":" && ")}${i?")":""};`).bind(null,...s):i?()=>!1:()=>!0}i.d(t,"a",(function(){return createTester}))},function(e,t,i){e.exports=function(){"use strict";var e="millisecond",t="second",i="minute",n="hour",s="day",r="week",o="month",a="quarter",l="year",u=/^(\d{4})-?(\d{1,2})-?(\d{0,2})[^0-9]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?.?(\d{1,3})?$/,h=/\[([^\]]+)]|Y{2,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,c=function(e,t,i){var n=String(e);return!n||n.length>=t?e:""+Array(t+1-n.length).join(i)+e},d={s:c,z:function(e){var t=-e.utcOffset(),i=Math.abs(t),n=Math.floor(i/60),s=i%60;return(t<=0?"+":"-")+c(n,2,"0")+":"+c(s,2,"0")},m:function(e,t){var i=12*(t.year()-e.year())+(t.month()-e.month()),n=e.clone().add(i,o),s=t-n<0,r=e.clone().add(i+(s?-1:1),o);return Number(-(i+(t-n)/(s?n-r:r-n))||0)},a:function(e){return e<0?Math.ceil(e)||0:Math.floor(e)},p:function(c){return{M:o,y:l,w:r,d:s,h:n,m:i,s:t,ms:e,Q:a}[c]||String(c||"").toLowerCase().replace(/s$/,"")},u:function(e){return void 0===e}},f={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_")},p="en",m={};m[p]=f;var y=function(e){return e instanceof b},M=function(e,t,i){var n;if(!e)return p;if("string"==typeof e)m[e]&&(n=e),t&&(m[e]=t,n=e);else{var s=e.name;m[s]=e,n=s}return i||(p=n),n},g=function(e,t,i){if(y(e))return e.clone();var n=t?"string"==typeof t?{format:t,pl:i}:t:{};return n.date=e,new b(n)},_=d;_.l=M,_.i=y,_.w=function(e,t){return g(e,{locale:t.$L,utc:t.$u,$offset:t.$offset})};var b=function(){function c(e){this.$L=this.$L||M(e.locale,null,!0),this.parse(e)}var d=c.prototype;return d.parse=function(e){this.$d=function(e){var t=e.date,i=e.utc;if(null===t)return new Date(NaN);if(_.u(t))return new Date;if(t instanceof Date)return new Date(t);if("string"==typeof t&&!/Z$/i.test(t)){var n=t.match(u);if(n)return i?new Date(Date.UTC(n[1],n[2]-1,n[3]||1,n[4]||0,n[5]||0,n[6]||0,n[7]||0)):new Date(n[1],n[2]-1,n[3]||1,n[4]||0,n[5]||0,n[6]||0,n[7]||0)}return new Date(t)}(e),this.init()},d.init=function(){var e=this.$d;this.$y=e.getFullYear(),this.$M=e.getMonth(),this.$D=e.getDate(),this.$W=e.getDay(),this.$H=e.getHours(),this.$m=e.getMinutes(),this.$s=e.getSeconds(),this.$ms=e.getMilliseconds()},d.$utils=function(){return _},d.isValid=function(){return!("Invalid Date"===this.$d.toString())},d.isSame=function(e,t){var i=g(e);return this.startOf(t)<=i&&i<=this.endOf(t)},d.isAfter=function(e,t){return g(e)<this.startOf(t)},d.isBefore=function(e,t){return this.endOf(t)<g(e)},d.$g=function(e,t,i){return _.u(e)?this[t]:this.set(i,e)},d.year=function(e){return this.$g(e,"$y",l)},d.month=function(e){return this.$g(e,"$M",o)},d.day=function(e){return this.$g(e,"$W",s)},d.date=function(e){return this.$g(e,"$D","date")},d.hour=function(e){return this.$g(e,"$H",n)},d.minute=function(e){return this.$g(e,"$m",i)},d.second=function(e){return this.$g(e,"$s",t)},d.millisecond=function(t){return this.$g(t,"$ms",e)},d.unix=function(){return Math.floor(this.valueOf()/1e3)},d.valueOf=function(){return this.$d.getTime()},d.startOf=function(e,a){var c=this,u=!!_.u(a)||a,h=_.p(e),d=function(e,t){var i=_.w(c.$u?Date.UTC(c.$y,t,e):new Date(c.$y,t,e),c);return u?i:i.endOf(s)},$=function(e,t){return _.w(c.toDate()[e].apply(c.toDate(),(u?[0,0,0,0]:[23,59,59,999]).slice(t)),c)},f=this.$W,p=this.$M,g=this.$D,m="set"+(this.$u?"UTC":"");switch(h){case l:return u?d(1,0):d(31,11);case o:return u?d(1,p):d(0,p+1);case r:var b=this.$locale().weekStart||0,v=(f<b?f+7:f)-b;return d(u?g-v:g+(6-v),p);case s:case"date":return $(m+"Hours",0);case n:return $(m+"Minutes",1);case i:return $(m+"Seconds",2);case t:return $(m+"Milliseconds",3);default:return this.clone()}},d.endOf=function(e){return this.startOf(e,!1)},d.$set=function(r,a){var c,u=_.p(r),h="set"+(this.$u?"UTC":""),d=(c={},c[s]=h+"Date",c.date=h+"Date",c[o]=h+"Month",c[l]=h+"FullYear",c[n]=h+"Hours",c[i]=h+"Minutes",c[t]=h+"Seconds",c[e]=h+"Milliseconds",c)[u],f=u===s?this.$D+(a-this.$W):a;if(u===o||u===l){var p=this.clone().set("date",1);p.$d[d](f),p.init(),this.$d=p.set("date",Math.min(this.$D,p.daysInMonth())).toDate()}else d&&this.$d[d](f);return this.init(),this},d.set=function(e,t){return this.clone().$set(e,t)},d.get=function(e){return this[_.p(e)]()},d.add=function(e,a){var c,u=this;e=Number(e);var h=_.p(a),d=function(t){var i=g(u);return _.w(i.date(i.date()+Math.round(t*e)),u)};if(h===o)return this.set(o,this.$M+e);if(h===l)return this.set(l,this.$y+e);if(h===s)return d(1);if(h===r)return d(7);var f=(c={},c[i]=6e4,c[n]=36e5,c[t]=1e3,c)[h]||1,p=this.$d.getTime()+e*f;return _.w(p,this)},d.subtract=function(e,t){return this.add(-1*e,t)},d.format=function(e){var t=this;if(!this.isValid())return"Invalid Date";var i=e||"YYYY-MM-DDTHH:mm:ssZ",n=_.z(this),s=this.$locale(),r=this.$H,o=this.$m,a=this.$M,l=s.weekdays,u=s.months,c=function(e,n,s,r){return e&&(e[n]||e(t,i))||s[n].substr(0,r)},d=function(e){return _.s(r%12||12,e,"0")},f=s.meridiem||function(e,t,i){var n=e<12?"AM":"PM";return i?n.toLowerCase():n},p={YY:String(this.$y).slice(-2),YYYY:this.$y,M:a+1,MM:_.s(a+1,2,"0"),MMM:c(s.monthsShort,a,u,3),MMMM:u[a]||u(this,i),D:this.$D,DD:_.s(this.$D,2,"0"),d:String(this.$W),dd:c(s.weekdaysMin,this.$W,l,2),ddd:c(s.weekdaysShort,this.$W,l,3),dddd:l[this.$W],H:String(r),HH:_.s(r,2,"0"),h:d(1),hh:d(2),a:f(r,o,!0),A:f(r,o,!1),m:String(o),mm:_.s(o,2,"0"),s:String(this.$s),ss:_.s(this.$s,2,"0"),SSS:_.s(this.$ms,3,"0"),Z:n};return i.replace(h,(function(e,t){return t||p[e]||n.replace(":","")}))},d.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},d.diff=function(e,c,u){var h,d=_.p(c),f=g(e),p=6e4*(f.utcOffset()-this.utcOffset()),m=this-f,b=_.m(this,f);return b=(h={},h[l]=b/12,h[o]=b,h[a]=b/3,h[r]=(m-p)/6048e5,h[s]=(m-p)/864e5,h[n]=m/36e5,h[i]=m/6e4,h[t]=m/1e3,h)[d]||m,u?b:_.a(b)},d.daysInMonth=function(){return this.endOf(o).$D},d.$locale=function(){return m[this.$L]},d.locale=function(e,t){if(!e)return this.$L;var i=this.clone(),n=M(e,t,!0);return n&&(i.$L=n),i},d.clone=function(){return _.w(this.$d,this)},d.toDate=function(){return new Date(this.valueOf())},d.toJSON=function(){return this.isValid()?this.toISOString():null},d.toISOString=function(){return this.$d.toISOString()},d.toString=function(){return this.$d.toUTCString()},c}();return g.prototype=b.prototype,g.extend=function(e,t){return e(t,b,g),g},g.locale=M,g.isDayjs=y,g.unix=function(e){return g(1e3*e)},g.en=m[p],g.Ls=m,g}()},function(e,t,i){"use strict";function hue2rgb(e,t,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?e+6*(t-e)*i:i<.5?t:i<2/3?e+(t-e)*(2/3-i)*6:e}function bit2linear(e){return e<=.04045?e/12.92:Math.pow((e+.055)/1.055,2.4)}function linear2bit(e){return e<=.0031308?12.92*e:Math.pow(1.055*e,1/2.4)-.055}i.r(t),i.d(t,"hue2rgb",(function(){return hue2rgb})),i.d(t,"bit2linear",(function(){return bit2linear})),i.d(t,"linear2bit",(function(){return linear2bit})),i.d(t,"Color",(function(){return n})),i.d(t,"ColorAdjuster",(function(){return ColorAdjuster}));const n={_canvas:null,_context:null,CVDMatrix:{protanope:[0,2.02344,-2.52581,0,1,0,0,0,1],deuteranope:[1,0,0,.494207,0,1.24827,0,0,1],tritanope:[1,0,0,0,1,0,-.395913,.801109,0]}},s=n.RGBA=function(e,t,i,n){this.r=e||0,this.g=t||0,this.b=i||0,this.a=n||0},r=n.HSVA=function(e,t,i,n){this.h=e||0,this.s=t||0,this.v=i||0,this.a=n||0},o=n.HSLA=function(e,t,i,n){this.h=e||0,this.s=t||0,this.l=i||0,this.a=n||0},a=n.XYZA=function(e,t,i,n){this.x=e||0,this.y=t||0,this.z=i||0,this.a=n||0},l=n.LUVA=function(e,t,i,n){this.l=e||0,this.u=t||0,this.v=i||0,this.a=n||0};s.prototype.eq=function(e){return e.r===this.r&&e.g===this.g&&e.b===this.b&&e.a===this.a},s.fromName=function(e){let t=n._context;if(!t){const e=n._canvas=document.createElement("canvas");t=n._context=e.getContext("2d")}t.clearRect(0,0,1,1),t.fillStyle=e,t.fillRect(0,0,1,1);const i=t.getImageData(0,0,1,1);return i&&i.data&&4===i.data.length?new s(i.data[0],i.data[1],i.data[2],i.data[3]/255):null},s.fromCSS=function(e){if(!e)return null;if("#"===(e=e.trim()).charAt(0))return s.fromHex(e);const t=/rgba?\( *(\d+%?) *, *(\d+%?) *, *(\d+%?) *(?:, *([\d.]+))?\)/i.exec(e);if(t){let e=t[1],i=t[2],n=t[3],r=t[4];return e="%"===e.charAt(e.length-1)?parseInt(e,10)/100*255:parseInt(e,10),i="%"===i.charAt(i.length-1)?parseInt(i,10)/100*255:parseInt(i,10),n="%"===n.charAt(n.length-1)?parseInt(n,10)/100*255:parseInt(n,10),r=r?"%"===r.charAt(r.length-1)?parseInt(r,10)/100:parseFloat(r):1,new s(Math.min(Math.max(0,e),255),Math.min(Math.max(0,i),255),Math.min(Math.max(0,n),255),Math.min(Math.max(0,r),1))}return s.fromName(e)},s.fromHex=function(e,t=1){if("#"===e.charAt(0)&&(e=e.slice(1)),3===e.length?e=`${e[0]}${e[0]}${e[1]}${e[1]}${e[2]}${e[2]}`:4===e.length&&(e=`${e[0]}${e[0]}${e[1]}${e[1]}${e[2]}${e[2]}${e[3]}${e[3]}`),8===e.length)t=parseInt(e.slice(6),16)/255,e=e.slice(0,6);else if(6!==e.length)throw new Error("invalid hex code");const i=parseInt(e,16);return new s(i>>16,i>>8&255,255&i,t)},s.fromHSVA=function(e,t,i,n){let r,o,a;const l=Math.floor(6*e),c=6*e-l,u=i*(1-t),h=i*(1-c*t),d=i*(1-(1-c)*t);switch(l%6){case 0:r=i,o=d,a=u;break;case 1:r=h,o=i,a=u;break;case 2:r=u,o=i,a=d;break;case 3:r=u,o=h,a=i;break;case 4:r=d,o=u,a=i;break;case 5:r=i,o=u,a=h}return new s(Math.round(Math.min(Math.max(0,255*r),255)),Math.round(Math.min(Math.max(0,255*o),255)),Math.round(Math.min(Math.max(0,255*a),255)),void 0===n?1:n)},s.fromXYZA=function(e,t,i,n){const r=3.240479*e-1.53715*t-.498535*i,o=-.969256*e+1.875992*t+.041556*i,a=.055648*e-.204043*t+1.057311*i;return new s(Math.max(0,Math.min(255,255*linear2bit(r))),Math.max(0,Math.min(255,255*linear2bit(o))),Math.max(0,Math.min(255,255*linear2bit(a))),void 0===n?1:n)},s.fromHSLA=function(e,t,i,n){if(0===t){const e=Math.round(Math.min(Math.max(0,255*i),255));return new s(e,e,e,void 0===n?1:n)}const r=i<.5?i*(1+t):i+t-i*t,o=2*i-r;return new s(Math.round(Math.min(Math.max(0,255*hue2rgb(o,r,e+1/3)),255)),Math.round(Math.min(Math.max(0,255*hue2rgb(o,r,e)),255)),Math.round(Math.min(Math.max(0,255*hue2rgb(o,r,e-1/3)),255)),void 0===n?1:n)},s.prototype.toHSVA=function(){return r.fromRGBA(this.r,this.g,this.b,this.a)},s.prototype.toHSLA=function(){return o.fromRGBA(this.r,this.g,this.b,this.a)},s.prototype.toCSS=function(){return`rgb${1!==this.a?"a":""}(${Math.round(this.r)},${Math.round(this.g)},${Math.round(this.b)}${1!==this.a?`,${this.a}`:""})`},s.prototype.toXYZA=function(){return a.fromRGBA(this.r,this.g,this.b,this.a)},s.prototype.toLUVA=function(){return this.toXYZA().toLUVA()},s.prototype.toHex=function(){return`#${(16777216+(this.b|this.g<<8|this.r<<16)).toString(16).slice(1)}`},s.prototype.get_Y=function(){return(.299*this.r+.587*this.g+.114*this.b)/255},s.prototype.luminance=function(){return.2126*bit2linear(this.r/255)+.7152*bit2linear(this.g/255)+.0722*bit2linear(this.b/255)},s.prototype.brighten=function(e){return e="number"==typeof e?e:1,e=Math.round(e/100*255),new s(Math.max(0,Math.min(255,this.r+e)),Math.max(0,Math.min(255,this.g+e)),Math.max(0,Math.min(255,this.b+e)),this.a)},s.prototype.daltonize=function(e){let t;if("string"==typeof e){if(!n.CVDMatrix.hasOwnProperty(e))throw new Error("Invalid CVD matrix");t=n.CVDMatrix[e]}else t=e;const i=t[0],r=t[1],o=t[2],a=t[3],l=t[4],c=t[5],u=t[6],h=t[7],d=t[8],f=17.8824*this.r+43.5161*this.g+4.11935*this.b,p=3.45565*this.r+27.1554*this.g+3.86714*this.b,g=.0299566*this.r+.184309*this.g+1.46709*this.b,m=i*f+r*p+o*g,_=a*f+l*p+c*g,b=u*f+h*p+d*g;let v=.0809444479*m+-.130504409*_+.116721066*b,y=-.0102485335*m+.0540193266*_+-.113614708*b,w=-.000365296938*m+-.00412161469*_+.693511405*b;v=this.r-v,y=this.g-y,w=this.b-w;const k=0*v+0*y+0*w,C=.7*v+1*y+0*w,x=.7*v+0*y+1*w;return v=Math.min(Math.max(0,k+this.r),255),y=Math.min(Math.max(0,C+this.g),255),w=Math.min(Math.max(0,x+this.b),255),new s(v,y,w,this.a)},s.prototype._r=function(e){return new s(e,this.g,this.b,this.a)},s.prototype._g=function(e){return new s(this.r,e,this.b,this.a)},s.prototype._b=function(e){return new s(this.r,this.g,e,this.a)},s.prototype._a=function(e){return new s(this.r,this.g,this.b,e)},o.prototype.eq=function(e){return e.h===this.h&&e.s===this.s&&e.l===this.l&&e.a===this.a},o.fromRGBA=function(e,t,i,n){e/=255,t/=255,i/=255;const s=Math.max(e,t,i),r=Math.min(e,t,i),a=Math.min(Math.max(0,(s+r)/2),1),l=Math.min(Math.max(0,s-r),1);let c,u;if(0===l)c=u=0;else{switch(u=a>.5?l/(2-s-r):l/(s+r),s){case e:c=(t-i)/l+(t<i?6:0);break;case t:c=(i-e)/l+2;break;case i:c=(e-t)/l+4}c/=6}return new o(c,u,a,void 0===n?1:n)},o.prototype.targetLuminance=function(e){let t=this.s,i=0,n=1;t*=Math.pow(this.l>.5?-this.l:this.l-1,7)+1;let r=(n-i)/2,a=i+r;for(;r>1/65536;r/=2,a=i+r){s.fromHSLA(this.h,t,a,1).luminance()>e?n=a:i=a}return new o(this.h,t,a,this.a)},o.prototype.toRGBA=function(){return s.fromHSLA(this.h,this.s,this.l,this.a)},o.prototype.toCSS=function(){return`hsl${1!==this.a?"a":""}(${Math.round(360*this.h)},${Math.round(100*this.s)}%,${Math.round(100*this.l)}%${1!==this.a?`,${this.a}`:""})`},o.prototype.toHSVA=function(){return this.toRGBA().toHSVA()},o.prototype.toXYZA=function(){return this.toRGBA().toXYZA()},o.prototype.toLUVA=function(){return this.toRGBA().toLUVA()},o.prototype._h=function(e){return new o(e,this.s,this.l,this.a)},o.prototype._s=function(e){return new o(this.h,e,this.l,this.a)},o.prototype._l=function(e){return new o(this.h,this.s,e,this.a)},o.prototype._a=function(e){return new o(this.h,this.s,this.l,e)},r.prototype.eq=function(e){return e.h===this.h&&e.s===this.s&&e.v===this.v&&e.a===this.a},r.fromRGBA=function(e,t,i,n){e/=255,t/=255,i/=255;const s=Math.max(e,t,i),o=Math.min(e,t,i),a=Math.min(Math.max(0,s-o),1),l=0===s?0:a/s,c=s;let u;if(0===a)u=0;else{switch(s){case e:u=(t-i)/a+(t<i?6:0);break;case t:u=(i-e)/a+2;break;case i:u=(e-t)/a+4}u/=6}return new r(u,l,c,void 0===n?1:n)},r.prototype.toRGBA=function(){return s.fromHSVA(this.h,this.s,this.v,this.a)},r.prototype.toHSLA=function(){return this.toRGBA().toHSLA()},r.prototype.toXYZA=function(){return this.toRGBA().toXYZA()},r.prototype.toLUVA=function(){return this.toRGBA().toLUVA()},r.prototype._h=function(e){return new r(e,this.s,this.v,this.a)},r.prototype._s=function(e){return new r(this.h,e,this.v,this.a)},r.prototype._v=function(e){return new r(this.h,this.s,e,this.a)},r.prototype._a=function(e){return new r(this.h,this.s,this.v,e)},a.prototype.eq=function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z},a.fromRGBA=function(e,t,i,n){const s=bit2linear(e/255),r=bit2linear(t/255),o=bit2linear(i/255);return new a(.412453*s+.35758*r+.180423*o,.212671*s+.71516*r+.072169*o,.019334*s+.119193*r+.950227*o,void 0===n?1:n)},a.fromLUVA=function(e,t,i,n){const s=1/(a.WHITE.x+15*a.WHITE.y+3*a.WHITE.z),r=4*a.WHITE.x*s,o=9*a.WHITE.y*s,l=e>8?Math.pow((e+16)/116,3):e/a.KAPPA,c=1/3*(52*e/(t+13*e*r)-1),u=-5*l,h=(l*(39*e/(i+13*e*o)-5)-u)/(c- -1/3);return new a(h,l,h*c+u,void 0===n?1:n)},a.prototype.toRGBA=function(){return s.fromXYZA(this.x,this.y,this.z,this.a)},a.prototype.toLUVA=function(){return l.fromXYZA(this.x,this.y,this.z,this.a)},a.prototype.toHSLA=function(){return this.toRGBA().toHSLA()},a.prototype.toHSVA=function(){return this.toRGBA().toHSVA()},a.prototype._x=function(e){return new a(e,this.y,this.z,this.a)},a.prototype._y=function(e){return new a(this.x,e,this.z,this.a)},a.prototype._z=function(e){return new a(this.x,this.y,e,this.a)},a.prototype._a=function(e){return new a(this.x,this.y,this.z,e)},a.EPSILON=Math.pow(6/29,3),a.KAPPA=Math.pow(29/3,3),a.WHITE=new s(255,255,255,1).toXYZA(),l.prototype.eq=function(e){return e.l===this.l&&e.u===this.u&&e.v===this.v},l.fromXYZA=function(e,t,i,n){const s=1/(a.WHITE.x+15*a.WHITE.y+3*a.WHITE.z),r=4*a.WHITE.x*s,o=9*a.WHITE.y*s,c=t/a.WHITE.y;let u=e+15*t+3*i;0===u&&(u=1);const h=1/u,d=4*e*h,f=9*t*h,p=c>a.EPSILON?116*Math.pow(c,1/3)-16:a.KAPPA*c;return new l(p,13*p*(d-r),13*p*(f-o),void 0===n?1:n)},l.prototype.toXYZA=function(){return a.fromLUVA(this.l,this.u,this.v,this.a)},l.prototype.toRGBA=function(){return this.toXYZA().toRGBA()},l.prototype.toHSLA=function(){return this.toXYZA().toHSLA()},l.prototype.toHSVA=function(){return this.toXYZA().toHSVA()},l.prototype._l=function(e){return new l(e,this.u,this.v,this.a)},l.prototype._u=function(e){return new l(this.l,e,this.v,this.a)},l.prototype._v=function(e){return new l(this.l,this.u,e,this.a)},l.prototype._a=function(e){return new l(this.l,this.u,this.v,e)};class ColorAdjuster{constructor(e="#232323",t=0,i=4.5){this._contrast=i,this._base=e,this._mode=t,this.rebuildContrast()}get contrast(){return this._contrast}set contrast(e){this._contrast=e,this.rebuildContrast()}get base(){return this._base}set base(e){this._base=e,this.rebuildContrast()}get dark(){return this._dark}get mode(){return this._mode}set mode(e){this._mode=e,this.rebuildContrast()}rebuildContrast(){this._cache=new Map;const e=s.fromCSS(this._base),t=e.luminance();(this._dark=t<.5)?(this._luv=new a(0,this._contrast*(e.toXYZA().y+.05)-.05,0,1).toLUVA().l,this._luma=this._contrast*(e.luminance()+.05)-.05):(this._luv=new a(0,(e.toXYZA().y+.05)/this._contrast-.05,0,1).toLUVA().l,this._luma=(e.luminance()+.05)/this._contrast-.05)}process(e,t=!1){if(-1===this._mode)return"";if(0===this._mode)return e;if(e instanceof s&&(e=e.toCSS()),!e)return null;if(this._cache.has(e))return this._cache.get(e);let i;try{i=s.fromCSS(e)}catch(e){if(t)throw e;return null}if(1===this._mode){const e=i.luminance();(this._dark?e<this._luma:e>this._luma)&&(i=i.toHSLA().targetLuminance(this._luma).toRGBA())}else if(2===this._mode){const e=i.toLUVA();(this._dark?e.l<this._luv:e.l>this._luv)&&(i=e._l(this._luv).toRGBA())}else if(3===this._mode)if(this._dark)for(;i.get_Y()<.5;){const e=i.toHSLA();i=e._l(Math.min(Math.max(0,.1+.9*e.l),1)).toRGBA()}else for(;i.get_Y()>=.5;){const e=i.toHSLA();i=e._l(Math.min(Math.max(0,.9*e.l),1)).toRGBA()}else if(4===this._mode){let e=0;if(this._dark)for(;i.luminance()<.15&&e++<127;)i=i.brighten();else for(;i.luminance()>.3&&e++<127;)i=i.brighten(-1)}const n=i.toCSS();return this._cache.set(e,n),n}}},function(e,t,i){"use strict";i.d(t,"a",(function(){return SettingsProfile}));var n=i(5),s=i(0),r=i(7);const fetchJSON=(e,t)=>fetch(e,t).then(e=>e.ok?e.json():null).catch(()=>null);class SettingsProfile extends n.EventEmitter{constructor(e,t){super(),this.manager=e,this.provider=e.provider,this.data=t,this.prefix=`p:${this.id}:`,this.enabled_key=`${this.prefix}:enabled`}get data(){return{id:this.id,parent:this.parent,name:this.name,i18n_key:this.i18n_key,description:this.description,desc_i18n_key:this.desc_i18n_key,url:this.url,show_toggle:this.show_toggle,context:this.context}}set data(e){if("object"!=typeof e)throw new TypeError("data must be an object");this.matcher=null;for(const t in e)Object(s.has)(e,t)&&(this[t]=e[t])}matches(e){return this.matcher||(this.matcher=Object(r.a)(this.context,i(29))),this.matcher(e)}save(){this.manager.saveProfile(this.id)}getBackup(){const e={version:2,type:"profile",profile:this.data,toggled:this.toggled,values:{}};for(const[t,i]of this.entries())e.values[t]=i;return e}async checkUpdate(){if(!this.url)return!1;const e=await fetchJSON(this.url);if(!e||"profile"===!e.type||!e.profile||!e.values)return!1;delete e.profile.id,this.data=e.profile;const t=new Set(this.keys());for(const[i,n]of Object.entries(e.values))t.delete(i),this.set(i,n);for(const e of t)this.delete(e);return!0}get toggled(){return this.provider.get(this.enabled_key,!0)}set toggled(e){e!==this.toggleState&&(this.provider.set(this.enabled_key,e),this.emit("toggled",this,e))}updateContext(e){if(0===this.id)throw new Error("cannot set context of default profile");this.context=Object.assign(this.context||{},e),this.matcher=null,this.manager._saveProfiles()}setContext(e){if(0===this.id)throw new Error("cannot set context of default profile");this.context=e,this.matcher=null,this.manager._saveProfiles()}get(e,t){return this.provider.get(this.prefix+e,t)}set(e,t){this.provider.set(this.prefix+e,t),this.emit("changed",e,t)}delete(e){this.provider.delete(this.prefix+e),this.emit("changed",e,void 0,!0)}has(e){return this.provider.has(this.prefix+e)}keys(){const e=[],t=this.prefix,i=t.length;for(const n of this.provider.keys())n.startsWith(t)&&n!==this.enabled_key&&e.push(n.slice(i));return e}clear(){const e=this.prefix,t=e.length;for(const i of this.provider.keys())i.startsWith(e)&&i!==this.enabled_key&&(this.provider.delete(i),this.emit("changed",i.slice(t),void 0,!0))}*entries(){const e=this.prefix,t=e.length;for(const i of this.provider.keys())i.startsWith(e)&&i!==this.enabled_key&&(yield[i.slice(t),this.provider.get(i)])}get size(){const e=this.prefix;let t=0;for(const i of this.provider.keys())i.startsWith(e)&&i!==this.enabled_key&&t++;return t}}SettingsProfile.Default={id:0,name:"Default Profile",i18n_key:"setting.profiles.default",description:"Settings that apply everywhere on Twitch."},SettingsProfile.Moderation={id:1,name:"Moderation",i18n_key:"setting.profiles.moderation",description:"Settings that apply when you are a moderator of the current channel.",context:[{type:"Moderator",data:!0}]}},function(e,t){var i;i=function(){return this}();try{i=i||new Function("return this")()}catch(e){"object"==typeof window&&(i=window)}e.exports=i},function(e,t,i){"use strict";i.r(t),i.d(t,"DefaultOptions",(function(){return a})),i.d(t,"Tooltip",(function(){return Tooltip})),i.d(t,"makeReference",(function(){return makeReference}));var n=i(1),s=i(0),r=i(27);let o=0;const a={html:!1,delayShow:0,delayHide:0,live:!0,tooltipClass:"ffz__tooltip",innerClass:"ffz__tooltip--inner",arrowClass:"ffz__tooltip--arrow"};class Tooltip{constructor(e,t,i){if("string"==typeof e&&(e=document.querySelector(e)),!(e instanceof Node))throw new TypeError("invalid parent");if(this.options=Object.assign({},a,i),this.live=this.options.live,this.parent=e,this.cls=t,this.live)this.cls=t,this.elements=new Set;else{if("string"==typeof t)this.elements=e.querySelectorAll(t);else if(Array.isArray(t))this.elements=t;else{if(!(t instanceof Node))throw new TypeError("invalid elements");this.elements=[t]}this.elements=new Set(this.elements)}if(this._accessor=`_ffz_tooltip$${o++}`,this._onMouseOut=e=>this._exit(e.target),this.options.manual);else if(this.live)this._onMouseOver=e=>{const t=e.target;t&&t.classList&&t.classList.contains(this.cls)&&this._enter(t)},e.addEventListener("mouseover",this._onMouseOver),e.addEventListener("mouseout",this._onMouseOut);else if(this._onMouseOver=e=>{const t=e.target;this.elements.has(t)&&this._enter(e.target)},this.elements.size<=5)for(const e of this.elements)e.addEventListener("mouseenter",this._onMouseOver),e.addEventListener("mouseleave",this._onMouseOut);else e.addEventListener("mouseover",this._onMouseOver),e.addEventListener("mouseout",this._onMouseOut)}destroy(){if(this.options.manual);else if(this.live||this.elements.size>5)parent.removeEventListener("mouseover",this._onMouseOver),parent.removeEventListener("mouseout",this._onMouseOut);else for(const e of this.elements)e.removeEventListener("mouseenter",this._onMouseOver),e.removeEventListener("mouseleave",this._onMouseOut);for(const e of this.elements){const t=e[this._accessor];t&&t.visible&&this.hide(t),e[this._accessor]=null}this.elements=null,this._onMouseOut=this._onMouseOver=null,this.parent=null}cleanup(){for(const e of this.elements){const t=e[this._accessor];document.body.contains(e)||t&&t.visible&&this.hide(t)}}_enter(e){let t=e[this._accessor];if(t||(t=e[this._accessor]={target:e}),t.state=!0,t._show_timer&&(clearTimeout(t._show_timer),t._show_timer=null),t.visible)return;const i=Object(s.maybe_call)(this.options.delayShow,null,e,t);0===i?this.show(t):t._show_timer=setTimeout(()=>{t._show_timer=null,t.state&&this.show(t)},i)}_exit(e){const t=e[this._accessor];if(!t)return;if(t.state=!1,t._show_timer&&(clearTimeout(t._show_timer),t._show_timer=null),!t.visible)return;const i=Object(s.maybe_call)(this.options.delayHide,null,e,t);0===i?this.hide(t):t._show_timer=setTimeout(()=>{t._show_timer=null,t.state||this.hide(t)},i)}show(e){const t=this.options,i=e.target;this.elements.add(i),e._promises=[],e.waitForDom=()=>e.element?Promise.resolve():new Promise(t=>{e._promises.push(t)}),e.update=()=>e._update(),e.show=()=>this.show(e),e.hide=()=>this.hide(e),e.rerender=()=>{e.visible&&(this.hide(e),this.show(e))};let o=Object(s.maybe_call)(t.content,null,i,e);if(void 0===o&&(o=e.target.title),e.visible||!o&&!t.onShow)return;const a=Object(n.createElement)("div",t.arrowClass),l=e.element=Object(n.createElement)("div",t.innerClass),c=e.outer=Object(n.createElement)("div",{className:t.tooltipClass},[l,a]);a.setAttribute("x-arrow",!0),t.arrowInner&&a.appendChild(Object(n.createElement)("div",t.arrowInner)),e.add_class&&(l.classList.add(e.add_class),e.add_class=void 0);const u=Object(s.maybe_call)(t.interactive,null,i,e),h=Object(s.maybe_call)(t.hover_events,null,i,e);c.classList.toggle("interactive",u||!1),(!t.manual||h&&(t.onHover||t.onLeave||t.onMove))&&(h&&t.onMove&&c.addEventListener("mousemove",c._ffz_move_handler=n=>{t.onMove(i,e,n)}),c.addEventListener("mouseover",c._ffz_over_handler=n=>{t.no_auto_remove||document.contains(i)||this.hide(e),h&&t.onHover&&t.onHover(i,e,n),t.manual||(Object(s.maybe_call)(t.interactive,null,i,e)?this._enter(i):this._exit(i))}),c.addEventListener("mouseout",c._ffz_out_handler=n=>{h&&t.onLeave&&t.onLeave(i,e,n),t.manual||this._exit(i)}));const d=Object(s.maybe_call)(t.html,null,i,e),f=d?"innerHTML":"textContent",p=Object.assign({modifiers:{flip:{behavior:["top","bottom","left","right"]}},arrowElement:a},t.popper);p.onUpdate=e._on_update=Object(s.debounce)(()=>{t.no_auto_remove||document.contains(e.target)||this.hide(e)},250);let g=i;t.no_update&&(g=makeReference(i)),e._update=()=>{e.popper&&(e.popper.destroy(),e.popper=new r.default(g,c,p))};for(const t of e._promises)t();e._promises=null,o instanceof Promise||o.then&&"[object Promise]"===o.toString()?(l.innerHTML='<div class="ffz-i-zreknarf loader"></div>',o.then(i=>{if(!i)return this.hide(e);d&&(i instanceof Node||Array.isArray(i))?(l.innerHTML="",Object(n.setChildren)(l,i,t.sanitizeChildren)):l[f]=i,e._update()}).catch(t=>{this.options.logger&&this.options.logger.error("Error rendering tooltip content.",t),this.options.i18n?l.textContent=this.options.i18n.t("tooltip.render-error","There was an error rendering this tooltip.\n{err}",{err:t}):l.textContent=`There was an error rendering this tooltip.\n${t}`,e._update()})):o&&(d&&(o instanceof Node||Array.isArray(o))?Object(n.setChildren)(l,o,t.sanitizeChildren):l[f]=o),e.popper=new r.default(g,c,p),this.parent.appendChild(c),e.visible=!0,t.onShow&&t.onShow(i,e)}hide(e){const t=this.options;if(t.onHide&&t.onHide(e.target,e),e.popper&&(e.popper.destroy(),e.popper=null),e.outer){const t=e.outer;t._ffz_over_handler&&t.removeEventListener("mouseover",t._ffz_over_handler),t._ffz_out_handler&&t.removeEventListener("mouseout",t._ffz_out_handler),t._ffz_move_handler&&t.removeEventListener("mousemove",t._ffz_move_handler),t.remove(),e.outer=t._ffz_out_handler=t._ffz_over_handler=null}this.live&&this.elements&&this.elements.delete(e.target),e._update=e.rerender=e.update=noop,e.element=null,e.visible=!1}}function makeReference(e,t,i=0,n=0){if(e instanceof Node){const s=e.getBoundingClientRect();e=s.x,t=s.y,i=s.height,n=s.width}return{getBoundingClientRect:()=>({top:t,bottom:t+i,y:t,left:e,right:e+n,x:e,height:i,width:n}),clientWidth:n,clientHeight:i}}function noop(){}t.default=Tooltip},,function(e,t,i){"use strict";var n=i(61),s=n.parse.bind(n);n.parse=function(e,t){return s(""+e,t)},n.setOptions({captureLocations:!1}),e.exports=n},function(e,t,i){"use strict";e.exports={EPSILON:"",EPSILON_CLOSURE:"*"}},function(e,t,i){"use strict";i.r(t),i.d(t,"Logger",(function(){return Logger}));const n={1:"debug",2:"info",4:"warn",8:"error"};class Logger{constructor(e,t,i,n){this.root=e?e.root:this,this.parent=e,this.name=t,this.root==this&&(this.captured_init=[]),this.init=!1,this.enabled=!0,this.level=i||e&&e.level||Logger.DEFAULT_LEVEL,this.raven=n||e&&e.raven,this.children={}}get(e,t){return this.children[e]||(this.children[e]=new Logger(this,this.name?`${this.name}.${e}`:e,t)),this.children[e]}debug(...e){return this.invoke(Logger.DEBUG,e)}info(...e){return this.invoke(Logger.INFO,e)}warn(...e){return this.invoke(Logger.WARN,e)}warning(...e){return this.invoke(Logger.WARN,e)}error(...e){return this.invoke(Logger.ERROR,e)}crumb(...e){if(this.raven)return this.raven.captureBreadcrumb(...e)}capture(e,t,...i){if(this.raven&&((t=t||{}).logger||(t.logger=this.name),this.raven.captureException(e,t)),i.length)return this.error(...i)}invoke(e,t){if(!this.enabled||e<this.level)return;const i=Array.prototype.slice.call(t);this.root.init&&this.root.captured_init.push({time:Date.now(),category:this.name,message:i.join(" "),level:n[e]||e}),this.crumb({message:i.join(" "),category:this.name,level:n[e]||e}),this.name?i.unshift(`%cFFZ [%c${this.name}%c]:%c`,"color:#755000; font-weight:bold","","color:#755000; font-weight:bold",""):i.unshift("%cFFZ:%c","color:#755000; font-weight:bold",""),e===Logger.DEBUG?console.info(...i):e===Logger.INFO?console.info(...i):e===Logger.WARN?console.warn(...i):e===Logger.ERROR?console.error(...i):console.log(...i)}}Logger.DEFAULT_LEVEL=2,Logger.DEBUG=1,Logger.INFO=2,Logger.WARN=4,Logger.WARNING=4,Logger.ERROR=8,Logger.OFF=99,t.default=Logger},function(e,t,i){var n,s;!function(r){if(void 0===(s="function"==typeof(n=r)?n.call(t,i,t,e):n)||(e.exports=s),!0,e.exports=r(),!!0){var o=window.Cookies,a=window.Cookies=r();a.noConflict=function(){return window.Cookies=o,a}}}((function(){function extend(){for(var e=0,t={};e<arguments.length;e++){var i=arguments[e];for(var n in i)t[n]=i[n]}return t}function decode(e){return e.replace(/(%[0-9A-Z]{2})+/g,decodeURIComponent)}return function init(e){function api(){}function set(t,i,n){if("undefined"!=typeof document){"number"==typeof(n=extend({path:"/"},api.defaults,n)).expires&&(n.expires=new Date(1*new Date+864e5*n.expires)),n.expires=n.expires?n.expires.toUTCString():"";try{var s=JSON.stringify(i);/^[\{\[]/.test(s)&&(i=s)}catch(e){}i=e.write?e.write(i,t):encodeURIComponent(String(i)).replace(/%(23|24|26|2B|3A|3C|3E|3D|2F|3F|40|5B|5D|5E|60|7B|7D|7C)/g,decodeURIComponent),t=encodeURIComponent(String(t)).replace(/%(23|24|26|2B|5E|60|7C)/g,decodeURIComponent).replace(/[\(\)]/g,escape);var r="";for(var o in n)n[o]&&(r+="; "+o,!0!==n[o]&&(r+="="+n[o].split(";")[0]));return document.cookie=t+"="+i+r}}function get(t,i){if("undefined"!=typeof document){for(var n={},s=document.cookie?document.cookie.split("; "):[],r=0;r<s.length;r++){var o=s[r].split("="),a=o.slice(1).join("=");i||'"'!==a.charAt(0)||(a=a.slice(1,-1));try{var l=decode(o[0]);if(a=(e.read||e)(a,l)||decode(a),i)try{a=JSON.parse(a)}catch(e){}if(n[l]=a,t===l)break}catch(e){}}return t?n[t]:n}}return api.set=set,api.get=function(e){return get(e,!1)},api.getJSON=function(e){return get(e,!0)},api.remove=function(e,t){set(e,"",extend(t,{expires:-1}))},api.defaults={},api.withConverter=init,api}((function(){}))}))},function(e,t,i){(function(t){var n=i(30),s="undefined"!=typeof window?window:void 0!==t?t:"undefined"!=typeof self?self:{};function isUndefined(e){return void 0===e}function isPlainObject(e){return"[object Object]"===Object.prototype.toString.call(e)}function isString(e){return"[object String]"===Object.prototype.toString.call(e)}function isArray(e){return"[object Array]"===Object.prototype.toString.call(e)}function supportsFetch(){if(!("fetch"in s))return!1;try{return new Headers,new Request(""),new Response,!0}catch(e){return!1}}function each(e,t){var i,n;if(isUndefined(e.length))for(i in e)hasKey(e,i)&&t.call(null,i,e[i]);else if(n=e.length)for(i=0;i<n;i++)t.call(null,i,e[i])}function truncate(e,t){if("number"!=typeof t)throw new Error("2nd argument to `truncate` function should be a number");return"string"!=typeof e||0===t?e:e.length<=t?e:e.substr(0,t)+""}function hasKey(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function joinRegExp(e){for(var t,i=[],n=0,s=e.length;n<s;n++)isString(t=e[n])?i.push(t.replace(/([.*+?^=!:${}()|\[\]\/\\])/g,"\\$1")):t&&t.source&&i.push(t.source);return new RegExp(i.join("|"),"i")}function htmlElementAsString(e){var t,i,n,s,r,o=[];if(!e||!e.tagName)return"";if(o.push(e.tagName.toLowerCase()),e.id&&o.push("#"+e.id),(t=e.className)&&isString(t))for(i=t.split(/\s+/),r=0;r<i.length;r++)o.push("."+i[r]);var a=["type","name","title","alt"];for(r=0;r<a.length;r++)n=a[r],(s=e.getAttribute(n))&&o.push("["+n+'="'+s+'"]');return o.join("")}function isOnlyOneTruthy(e,t){return!!(!!e^!!t)}function isSameStacktrace(e,t){if(isOnlyOneTruthy(e,t))return!1;var i,n,s=e.frames,r=t.frames;if(void 0===s||void 0===r)return!1;if(s.length!==r.length)return!1;for(var o=0;o<s.length;o++)if(i=s[o],n=r[o],i.filename!==n.filename||i.lineno!==n.lineno||i.colno!==n.colno||i.function!==n.function)return!1;return!0}var r=3,o=51200,a=40;function jsonSize(e){return function utf8Length(e){return~-encodeURI(e).split(/%..|./).length}(JSON.stringify(e))}function serializeValue(e){if("string"==typeof e){return truncate(e,40)}if("number"==typeof e||"boolean"==typeof e||void 0===e)return e;var t=Object.prototype.toString.call(e);return"[object Object]"===t?"[Object]":"[object Array]"===t?"[Array]":"[object Function]"===t?e.name?"[Function: "+e.name+"]":"[Function]":e}e.exports={isObject:function isObject(e){return"object"==typeof e&&null!==e},isError:function isError(e){switch(Object.prototype.toString.call(e)){case"[object Error]":case"[object Exception]":case"[object DOMException]":return!0;default:return e instanceof Error}},isErrorEvent:function isErrorEvent(e){return"[object ErrorEvent]"===Object.prototype.toString.call(e)},isDOMError:function isDOMError(e){return"[object DOMError]"===Object.prototype.toString.call(e)},isDOMException:function isDOMException(e){return"[object DOMException]"===Object.prototype.toString.call(e)},isUndefined:isUndefined,isFunction:function isFunction(e){return"function"==typeof e},isPlainObject:isPlainObject,isString:isString,isArray:isArray,isEmptyObject:function isEmptyObject(e){if(!isPlainObject(e))return!1;for(var t in e)if(e.hasOwnProperty(t))return!1;return!0},supportsErrorEvent:function supportsErrorEvent(){try{return new ErrorEvent(""),!0}catch(e){return!1}},supportsDOMError:function supportsDOMError(){try{return new DOMError(""),!0}catch(e){return!1}},supportsDOMException:function supportsDOMException(){try{return new DOMException(""),!0}catch(e){return!1}},supportsFetch:supportsFetch,supportsReferrerPolicy:function supportsReferrerPolicy(){if(!supportsFetch())return!1;try{return new Request("pickleRick",{referrerPolicy:"origin"}),!0}catch(e){return!1}},supportsPromiseRejectionEvent:function supportsPromiseRejectionEvent(){return"function"==typeof PromiseRejectionEvent},wrappedCallback:function wrappedCallback(e){return function dataCallback(t,i){var n=e(t)||t;return i&&i(n)||n}},each:each,objectMerge:function objectMerge(e,t){return t?(each(t,(function(t,i){e[t]=i})),e):e},truncate:truncate,objectFrozen:function objectFrozen(e){return!!Object.isFrozen&&Object.isFrozen(e)},hasKey:hasKey,joinRegExp:joinRegExp,urlencode:function urlencode(e){var t=[];return each(e,(function(e,i){t.push(encodeURIComponent(e)+"="+encodeURIComponent(i))})),t.join("&")},uuid4:function uuid4(){var e=s.crypto||s.msCrypto;if(!isUndefined(e)&&e.getRandomValues){var t=new Uint16Array(8);e.getRandomValues(t),t[3]=4095&t[3]|16384,t[4]=16383&t[4]|32768;var pad=function(e){for(var t=e.toString(16);t.length<4;)t="0"+t;return t};return pad(t[0])+pad(t[1])+pad(t[2])+pad(t[3])+pad(t[4])+pad(t[5])+pad(t[6])+pad(t[7])}return"xxxxxxxxxxxx4xxxyxxxxxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}))},htmlTreeAsString:function htmlTreeAsString(e){for(var t,i=[],n=0,s=0,r=" > ".length;e&&n++<5&&!("html"===(t=htmlElementAsString(e))||n>1&&s+i.length*r+t.length>=80);)i.push(t),s+=t.length,e=e.parentNode;return i.reverse().join(" > ")},htmlElementAsString:htmlElementAsString,isSameException:function isSameException(e,t){return!isOnlyOneTruthy(e,t)&&(e=e.values[0],t=t.values[0],e.type===t.type&&e.value===t.value&&(!function isBothUndefined(e,t){return isUndefined(e)&&isUndefined(t)}(e.stacktrace,t.stacktrace)&&isSameStacktrace(e.stacktrace,t.stacktrace)))},isSameStacktrace:isSameStacktrace,parseUrl:function parseUrl(e){if("string"!=typeof e)return{};var t=e.match(/^(([^:\/?#]+):)?(\/\/([^\/?#]*))?([^?#]*)(\?([^#]*))?(#(.*))?$/),i=t[6]||"",n=t[8]||"";return{protocol:t[2],host:t[4],path:t[5],relative:t[5]+i+n}},fill:function fill(e,t,i,n){if(null!=e){var s=e[t];e[t]=i(s),e[t].__raven__=!0,e[t].__orig__=s,n&&n.push([e,t,s])}},safeJoin:function safeJoin(e,t){if(!isArray(e))return"";for(var i=[],n=0;n<e.length;n++)try{i.push(String(e[n]))}catch(e){i.push("[value cannot be serialized]")}return i.join(t)},serializeException:function serializeException(e,t,i){if(!isPlainObject(e))return e;i="number"!=typeof(t="number"!=typeof t?r:t)?o:i;var s=function serializeObject(e,t){return 0===t?serializeValue(e):isPlainObject(e)?Object.keys(e).reduce((function(i,n){return i[n]=serializeObject(e[n],t-1),i}),{}):Array.isArray(e)?e.map((function(e){return serializeObject(e,t-1)})):serializeValue(e)}(e,t);return jsonSize(n(s))>i?serializeException(e,t-1):s},serializeKeysForMessage:function serializeKeysForMessage(e,t){if("number"==typeof e||"string"==typeof e)return e.toString();if(!Array.isArray(e))return"";if(0===(e=e.filter((function(e){return"string"==typeof e}))).length)return"[object has no keys]";if(t="number"!=typeof t?a:t,e[0].length>=t)return e[0];for(var i=e.length;i>0;i--){var n=e.slice(0,i).join(", ");if(!(n.length>t))return i===e.length?n:n+""}return""},sanitize:function sanitize(e,t){if(!isArray(t)||isArray(t)&&0===t.length)return e;var i,s=joinRegExp(t),r="********";try{i=JSON.parse(n(e))}catch(t){return e}return function sanitizeWorker(e){return isArray(e)?e.map((function(e){return sanitizeWorker(e)})):isPlainObject(e)?Object.keys(e).reduce((function(t,i){return s.test(i)?t[i]=r:t[i]=sanitizeWorker(e[i]),t}),{}):e}(i)}}}).call(this,i(11))},function(e,t,i){"use strict";var n=function(){function defineProperties(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,i){return t&&defineProperties(e.prototype,t),i&&defineProperties(e,i),e}}();var s=i(32),r=i(14),o=i(33),a=function(){function TransformResult(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;!function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,TransformResult),this._ast=e,this._source=null,this._string=null,this._regexp=null,this._extra=t}return n(TransformResult,[{key:"getAST",value:function getAST(){return this._ast}},{key:"setExtra",value:function setExtra(e){this._extra=e}},{key:"getExtra",value:function getExtra(){return this._extra}},{key:"toRegExp",value:function toRegExp(){return this._regexp||(this._regexp=new RegExp(this.getSource(),this._ast.flags)),this._regexp}},{key:"getSource",value:function getSource(){return this._source||(this._source=s.generate(this._ast.body)),this._source}},{key:"getFlags",value:function getFlags(){return this._ast.flags}},{key:"toString",value:function toString(){return this._string||(this._string=s.generate(this._ast)),this._string}}]),TransformResult}();e.exports={TransformResult:a,transform:function transform(e,t){var i=e;return e instanceof RegExp&&(e=""+e),"string"==typeof e&&(i=r.parse(e,{captureLocations:!0})),o.traverse(i,t),new a(i)}}},function(e,t,i){"use strict";var n=function(){function defineProperties(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,i){return t&&defineProperties(e.prototype,t),i&&defineProperties(e,i),e}}();var s=function(){function NodePath(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;!function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,NodePath),this.node=e,this.parentPath=t,this.parent=t?t.node:null,this.property=i,this.index=n}return n(NodePath,[{key:"_enforceProp",value:function _enforceProp(e){if(!this.node.hasOwnProperty(e))throw new Error("Node of type "+this.node.type+" doesn't have \""+e+'" collection.')}},{key:"setChild",value:function setChild(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=void 0;return null!=t?(i||(i="expressions"),this._enforceProp(i),this.node[i][t]=e,n=NodePath.getForNode(e,this,i,t)):(i||(i="expression"),this._enforceProp(i),this.node[i]=e,n=NodePath.getForNode(e,this,i,null)),n}},{key:"appendChild",value:function appendChild(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;t||(t="expressions"),this._enforceProp(t);var i=this.node[t].length;return this.setChild(e,i,t)}},{key:"insertChildAt",value:function insertChildAt(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"expressions";this._enforceProp(i),this.node[i].splice(t,0,e),t<=NodePath.getTraversingIndex()&&NodePath.updateTraversingIndex(1),this._rebuildIndex(this.node,i)}},{key:"remove",value:function remove(){if(!this.isRemoved()&&(NodePath.registry.delete(this.node),this.node=null,this.parent)){if(null!==this.index)return this.parent[this.property].splice(this.index,1),this.index<=NodePath.getTraversingIndex()&&NodePath.updateTraversingIndex(-1),this._rebuildIndex(this.parent,this.property),this.index=null,void(this.property=null);delete this.parent[this.property],this.property=null}}},{key:"_rebuildIndex",value:function _rebuildIndex(e,t){for(var i=NodePath.getForNode(e),n=0;n<e[t].length;n++){NodePath.getForNode(e[t][n],i,t,n).index=n}}},{key:"isRemoved",value:function isRemoved(){return null===this.node}},{key:"replace",value:function replace(e){return NodePath.registry.delete(this.node),this.node=e,this.parent?(null!==this.index?this.parent[this.property][this.index]=e:this.parent[this.property]=e,NodePath.getForNode(e,this.parentPath,this.property,this.index)):null}},{key:"update",value:function update(e){Object.assign(this.node,e)}},{key:"getParent",value:function getParent(){return this.parentPath}},{key:"getChild",value:function getChild(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this.node.expressions?NodePath.getForNode(this.node.expressions[e],this,"expressions",e):this.node.expression&&0==e?NodePath.getForNode(this.node.expression,this,"expression"):null}},{key:"hasEqualSource",value:function hasEqualSource(e){return JSON.stringify(this.node,jsonSkipLoc)===JSON.stringify(e.node,jsonSkipLoc)}},{key:"jsonEncode",value:function jsonEncode(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.format,i=e.useLoc;return JSON.stringify(this.node,i?null:jsonSkipLoc,t)}},{key:"getPreviousSibling",value:function getPreviousSibling(){return this.parent&&null!=this.index?NodePath.getForNode(this.parent[this.property][this.index-1],NodePath.getForNode(this.parent),this.property,this.index-1):null}},{key:"getNextSibling",value:function getNextSibling(){return this.parent&&null!=this.index?NodePath.getForNode(this.parent[this.property][this.index+1],NodePath.getForNode(this.parent),this.property,this.index+1):null}}],[{key:"getForNode",value:function getForNode(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:-1;if(!e)return null;NodePath.registry.has(e)||NodePath.registry.set(e,new NodePath(e,t,i,-1==n?null:n));var s=NodePath.registry.get(e);return null!==t&&(s.parentPath=t,s.parent=s.parentPath.node),null!==i&&(s.property=i),n>=0&&(s.index=n),s}},{key:"initRegistry",value:function initRegistry(){NodePath.registry||(NodePath.registry=new Map),NodePath.registry.clear()}},{key:"updateTraversingIndex",value:function updateTraversingIndex(e){return NodePath.traversingIndexStack[NodePath.traversingIndexStack.length-1]+=e}},{key:"getTraversingIndex",value:function getTraversingIndex(){return NodePath.traversingIndexStack[NodePath.traversingIndexStack.length-1]}}]),NodePath}();function jsonSkipLoc(e,t){if("loc"!==e)return t}s.initRegistry(),s.traversingIndexStack=[],e.exports=s},function(e,t,i){"use strict";e.exports={disjunctionToList:function disjunctionToList(e){if("Disjunction"!==e.type)throw new TypeError('Expected "Disjunction" node, got "'+e.type+'"');var t=[];return e.left&&"Disjunction"===e.left.type?t.push.apply(t,function _toConsumableArray(e){if(Array.isArray(e)){for(var t=0,i=Array(e.length);t<e.length;t++)i[t]=e[t];return i}return Array.from(e)}(disjunctionToList(e.left)).concat([e.right])):t.push(e.left,e.right),t},listToDisjunction:function listToDisjunction(e){return e.reduce((function(e,t){return{type:"Disjunction",left:e,right:t}}))},increaseQuantifierByOne:function increaseQuantifierByOne(e){"*"===e.kind?e.kind="+":"+"===e.kind?(e.kind="Range",e.from=2,delete e.to):"?"===e.kind?(e.kind="Range",e.from=1,e.to=2):"Range"===e.kind&&(e.from+=1,e.to&&(e.to+=1))}}},function(e,t,i){"use strict";i.d(t,"a",(function(){return SettingsManager})),i.d(t,"b",(function(){return parse_path}));var n=i(3),s=i(0),r=i(24),o=i(10),a=i(37),l=i(38);class SettingsManager extends n.default{constructor(...e){super(...e),this.__contexts=[],this.__profiles=[],this.__profile_ids={},this.ui_structures=new Map,this.definitions=new Map;const t=this.provider=this._createProvider();this.log.info(`Using Provider: ${t.constructor.name}`),t.on("changed",this._onProviderChange,this),this.migrations=new l.a(this),this.main_context=new a.a(this),this.main_context.on("changed",(e,t,i)=>{this.emit(`:changed:${e}`,t,i)}),this.main_context.on("uses_changed",(e,t,i)=>{this.emit(`:uses_changed:${e}`,t,i)}),this._start_time=performance.now(),this.enable()}generateLog(){const e=[];for(const[t,i]of this.main_context.__cache.entries())e.push(`${t}: ${JSON.stringify(i)}`);return e.join("\n")}async onEnable(){await this.provider.awaitReady(),this.on("site.router:updated-routes",this.updateRoutes,this),this.loadProfiles(!0);for(const e of this.__contexts)e.selectProfiles();const e=performance.now()-this._start_time;this.log.info(`Initialization complete after ${e.toFixed(5)}ms -- Values: ${this.provider.size} -- Profiles: ${this.__profiles.length}`),this.scheduleUpdates(),this.updateClock()}updateClock(){const e=i(29).Time.captured();if(!(null==e?void 0:e.length))return;this._time_timer&&clearTimeout(this._time_timer);const t=new Date,n=60*t.getHours()+t.getMinutes();let s=null!=this._time_next?this._time_next:null;for(const t of e)t<=n||(null==s||t<s)&&(s=t);null==s&&(s=e[0]+1440);const r=60*(s-n)*1e3-59750+(6e4-Date.now()%6e4);this._time_timer=setTimeout(()=>{for(const e of this.__contexts)e.selectProfiles();this.updateClock()},r)}async getFullBackup(){await this.provider.awaitReady();const e={version:2,type:"full",values:{}};for(const[t,i]of this.provider.entries())e.values[t]=i;return e}scheduleUpdates(){this._update_timer&&clearTimeout(this._update_timer),this._update_timer=setTimeout(()=>this.checkUpdates(),5e3)}checkUpdates(){const e=[];for(const t of this.__profiles){if(!t||!t.url)continue;const i=t.checkUpdate();e.push(i instanceof Promise?i:Promise.resolve(i))}Promise.all(e).then(e=>{let t=0;for(const i of e)i&&t++;this.log.info(`Successfully refreshed ${t} of ${e.length} profiles from remote URLs.`)})}_createProvider(){return document.body.classList.contains("ffz-cloud-storage")?new r.a(this):new r.b(this)}_onProviderChange(e,t,i){if("profiles"===e)return this.loadProfiles();if(!e.startsWith("p:"))return;const n=(e=e.substr(2)).indexOf(":");if(-1===n)return;const s=this.__profile_ids[e.slice(0,n)],r=e.slice(n+1);s&&(":enabled"===r?s.emit("toggled",s,!!i||t):s.emit("changed",r,t,i))}updateRoutes(){for(const e of this.__profiles)e.matcher=null;for(const e of this.__contexts)e.selectProfiles();this.updateClock()}_onProfileToggled(e,t){for(const e of this.__contexts)e.selectProfiles();this.updateClock(),this.emit(":profile-toggled",e,t)}profile(e){return this.__profile_ids[e]||null}loadProfiles(e){const t=this.__profile_ids,i=this.__profiles,n=this.__profile_ids={},r=this.__profiles=[],a=new Set(i.map(e=>e.id)),l=new Set,c=new Set,u=this.provider.get("profiles",[o.a.Moderation,o.a.Default]);let h=!1,d=!1;for(const e of i)e.off("toggled",this._onProfileToggled,this);for(const e of u){const u=e.id,f=r.length,p=t[u],g=p?i.indexOf(p):-1;if(a.delete(u),g!==f&&(h=!0),e.context&&!Array.isArray(e.context)&&(e.context.moderator?e.context=o.a.Moderation.context:e.context=null),p&&Object(s.deep_equals)(p.data,e,!0)){g!==f&&(d=!0),r.push(n[u]=p);continue}const m=n[u]=new o.a(this,e);p?(m.__listeners=p.__listeners,p.__listeners={},c.add(u)):l.add(u),r.push(m),d=!0}for(const e of r)e.on("toggled",this._onProfileToggled,this);if((d||a.size)&&!e){for(const e of this.__contexts)e.selectProfiles();this.updateClock();for(const e of l)this.emit(":profile-created",n[e]);for(const e of c)this.emit(":profile-changed",n[e]);h&&this.emit(":profiles-reordered")}}createProfile(e){let t=0;for(;this.__profile_ids[t];)t++;(e=e||{}).id=t,e.name||(e.name=`Unnamed Profile ${t}`);const i=this.__profile_ids[t]=new o.a(this,e);return this.__profiles.unshift(i),i.on("toggled",this._onProfileToggled,this),this._saveProfiles(),this.emit(":profile-created",i),i}deleteProfile(e){"object"==typeof e&&e.id&&(e=e.id);const t=this.__profile_ids[e];if(!t)return;if(0===t.id)throw new Error("cannot delete default profile");t.off("toggled",this._onProfileToggled,this),t.clear(),this.__profile_ids[e]=null;const i=this.__profiles.indexOf(t);-1!==i&&this.__profiles.splice(i,1),this._saveProfiles(),this.emit(":profile-deleted",t)}moveProfile(e,t){"object"==typeof e&&e.id&&(e=e.id);const i=this.__profile_ids[e];if(!i)return;const n=this.__profiles,s=n.indexOf(i);s!==t&&(n.splice(t,0,...n.splice(s,1)),this._saveProfiles(),this.emit(":profiles-reordered"))}saveProfile(e){"object"==typeof e&&e.id&&(e=e.id);const t=this.__profile_ids[e];t&&(this._saveProfiles(),this.emit(":profile-changed",t))}_saveProfiles(){this.provider.set("profiles",this.__profiles.map(e=>e.data));for(const e of this.__contexts)e.selectProfiles();this.updateClock()}context(e){return this.main_context.context(e)}get(e){return this.main_context.get(e)}uses(e){return this.main_context.uses(e)}update(e){return this.main_context.update(e)}updateContext(e){return this.main_context.updateContext(e)}setContext(e){return this.main_context.setContext(e)}add(e,t){if("object"==typeof e){for(const t in e)Object(s.has)(e,t)&&this.add(t,e[t]);return}const i=this.definitions.get(e),n=i?Array.isArray(i)?i:i.required_by:[];t.required_by=n,t.requires=t.requires||[];for(const i of t.requires){const t=this.definitions.get(i);t?Array.isArray(t)?t.push(e):t.required_by.push(e):this.definitions.set(i,[e])}if(t.ui){const i=t.ui;if(i.path_tokens=i.path_tokens?format_path_tokens(i.path_tokens):i.path?parse_path(i.path):void 0,!i.key&&e&&(i.key=e),!i.key&&i.title&&(i.key=i.title.toSnakeCase()),("setting-select-box"===i.component||"setting-combo-box"===i.component)&&Array.isArray(i.data)){const t=`${i.i18n_key||`setting.entry.${e}`}.values`;for(const e of i.data)void 0===e.i18n_key&&void 0!==e.value&&(e.i18n_key=`${t}.${e.value}`)}}t.changed&&this.on(`:changed:${e}`,t.changed),this.definitions.set(e,t),this.emit(":added-definition",e,t)}addUI(e,t){if("object"==typeof e){for(const t in e)Object(s.has)(e,t)&&this.add(t,e[t]);return}t.ui||(t={ui:t});const i=t.ui;i.path_tokens=i.path_tokens?format_path_tokens(i.path_tokens):i.path?parse_path(i.path):void 0,!i.key&&i.title&&(i.key=i.title.toSnakeCase()),this.ui_structures.set(e,t),this.emit(":added-definition",e,t)}}const c=/(?:^|\s*([~>]+))\s*([^~>@]+)\s*(?:@([^~>]+))?/g;function parse_path(e){const t=[];let i;for(;i=c.exec(e);){const e=">>"===i[1],n="~>"===i[1],s=i[2].trim(),r=s.toSnakeCase(),o=i[3],a={key:r,title:s,page:e,tab:n};o&&Object.assign(a,JSON.parse(o)),t.push(a)}return t}function format_path_tokens(e){for(let t=0,i=e.length;t<i;t++){const i=e[t];"string"!=typeof i?i.key||(i.key=i.title.toSnakeCase()):e[t]={key:i.toSnakeCase(),title:i}}return e}},function(e,t,i){(function(t){var n=i(49),s="undefined"!=typeof window?window:void 0!==t?t:"undefined"!=typeof self?self:{},r=s.Raven,o=new n;o.noConflict=function(){return s.Raven=r,o},o.afterLoad(),e.exports=o,e.exports.Client=n}).call(this,i(11))},function(e,t,i){"use strict";i.d(t,"b",(function(){return LocalStorageProvider})),i.d(t,"a",(function(){return CloudStorageProvider}));var n=i(5),s=i(0);class SettingsProvider extends n.EventEmitter{constructor(e){super(),this.manager=e,this.disabled=!1}awaitReady(){return this.ready?Promise.resolve():Promise.reject(new Error("Not Implemented"))}get(e,t){throw new Error("Not Implemented")}set(e,t){throw new Error("Not Implemented")}delete(e){throw new Error("Not Implemented")}clear(){throw new Error("Not Implemented")}has(e){throw new Error("Not Implemented")}keys(){throw new Error("Not Implemented")}entries(){throw new Error("Not Implemented")}get size(){throw new Error("Not Implemented")}}class LocalStorageProvider extends SettingsProvider{constructor(e,t){super(e),this.prefix=t=null==t?"FFZ:setting:":t;const i=this._cached=new Map,n=t.length;for(const e in localStorage)if(Object(s.has)(localStorage,e)&&e.startsWith(t)){const t=localStorage.getItem(e);try{i.set(e.slice(n),JSON.parse(t))}catch(i){this.manager.log.warn(`unable to parse value for ${e}`,t)}}if(this.ready=!0,window.BroadcastChannel){(this._broadcaster=new BroadcastChannel("ffz-settings")).addEventListener("message",this._boundHandleMessage=this.handleMessage.bind(this))}else window.addEventListener("storage",this._boundHandleStorage=this.handleStorage.bind(this))}destroy(){this.disable(),this._cached.clear()}disable(){this.disabled=!0,this._broadcaster&&(this._broadcaster.removeEventListener("message",this._boundHandleMessage),this._broadcaster.close(),this._boundHandleMessage=this._broadcaster=null),this._boundHandleStorage&&(window.removeEventListener("storage",this._boundHandleStorage),this._boundHandleStorage=null)}broadcast(e){this._broadcaster&&this._broadcaster.postMessage(e)}handleMessage(e){if(this.disabled||!e.isTrusted||!e.data)return;this.manager.log.debug("storage broadcast event",e.data);const{type:t,key:i}=e.data;if("set"===t){const e=JSON.parse(localStorage.getItem(this.prefix+i));this._cached.set(i,e),this.emit("changed",i,e,!1)}else if("delete"===t)this._cached.delete(i),this.emit("changed",i,void 0,!0);else if("clear"===t){const e=Array.from(this._cached.keys());this._cached.clear();for(const t of e)this.emit("changed",t,void 0,!0)}}handleStorage(e){if(!this.disabled&&(this.manager.log.debug("storage event",e),e.storageArea===localStorage&&e.key.startsWith(this.prefix))){const t=e.key.slice(this.prefix.length);let i=e.newValue;null===i?(this._cached.delete(t),this.emit("changed",t,void 0,!0)):(i=JSON.parse(i),this._cached.set(t,i),this.emit("changed",t,i,!1))}}get(e,t){return this._cached.has(e)?this._cached.get(e):t}set(e,t){void 0!==t?(this._cached.set(e,t),localStorage.setItem(this.prefix+e,JSON.stringify(t)),this.broadcast({type:"set",key:e}),this.emit("set",e,t,!1)):this.has(e)&&this.delete(e)}delete(e){this._cached.delete(e),localStorage.removeItem(this.prefix+e),this.broadcast({type:"delete",key:e}),this.emit("set",e,void 0,!0)}has(e){return this._cached.has(e)}keys(){return this._cached.keys()}clear(){const e=this._cached;this._cached=new Map;for(const t of e.keys())localStorage.removeItem(this.prefix+t),this.emit("changed",t,void 0,!0);this.broadcast({type:"clear"})}entries(){return this._cached.entries()}get size(){return this._cached.size}}class CloudStorageProvider extends SettingsProvider{constructor(e){super(e),this._cached=new Map,this.ready=!1,this._ready_wait=null,this._boundHandleStorage=this.handleStorage.bind(this),window.addEventListener("message",this._boundHandleStorage),this._send("get_all")}destroy(){this.disable(),this._cached.clear()}disable(){this.disabled=!0,this._boundHandleStorage&&(window.removeEventListener("message",this._boundHandleStorage),this._boundHandleStorage=null)}awaitReady(){return this.ready?Promise.resolve():new Promise((e,t)=>{(this._ready_wait=this._ready_wait||[]).push([e,t])})}handleStorage(e){if(e.source!==window||!e.data||!e.data.ffz)return;const t=e.data.cmd,i=e.data.data;if("all_values"===t){const e=new Set(this._cached.keys());for(const t in i)if(Object(s.has)(i,t)){const n=i[t];e.delete(t),this._cached.set(t,n),this.ready&&this.emit("changed",t,n)}for(const t of e)this._cached.delete(t),this.ready&&this.emit("changed",t,void 0,!0);if(this.ready=!0,this._ready_wait){for(const e of this._ready_wait)e();this._ready_wait=null}}else"changed"===t?(this._cached.set(i.key,i.value),this.emit("changed",i.key,i.value)):"deleted"===t?(this._cached.delete(i),this.emit("changed",i,void 0,!0)):this.manager.log.info("unknown storage event",e)}_send(e,t){window.postMessage({ffz:!0,cmd:e,data:t},location.origin)}get(e,t){return this._cached.has(e)?this._cached.get(e):t}set(e,t){this._cached.set(e,t),this._send("set",{key:e,value:t})}delete(e){this._cached.delete(e),this._send("delete",e)}has(e){return this._cached.has(e)}keys(){return this._cached.keys()}clear(){this._cached.clear(),this._send("clear")}entries(){return this._cached.entries()}get size(){return this._cached.size}}},function(e,t,i){"use strict";i.r(t),i.d(t,"basic",(function(){return n})),i.d(t,"object_merge",(function(){return s})),i.d(t,"array_merge",(function(){return r}));const n={get(e,t){for(const i of t)if(i.has(e))return[i.get(e),[i.id]]}},s={get(e,t,i){const n=[],s=[];for(const r of t)if(r.has(e)){const t=r.get(e);if("object"!=typeof t){i.warn(`Profile #${r.id} has an invalid value for "${e}" of type ${typeof t}. Skipping.`);continue}s.push(r.id),n.unshift(t)}if(s.length)return[Object.assign({},...n),s]}},r={default(e){const t=[];for(const i of e)"inherit"!==i.t&&i.v&&t.push(i.v);return t},get(e,t,i,n){const s=[],r=[],o=[];let a=!1;for(const l of t)if(l.has(e)){const t=l.get(e);if(!Array.isArray(t)){n.warn(`Profile #${l.id} has an invalid value for "${e}" of type ${typeof t}. Skipping.`);continue}o.push(l.id);let c=!1;for(const e of t)a=!0,"inherit"===e.t?c=!0:c?r.unshift(e.v):s.push(e.v);if(!c&&!i.always_inherit)break}if(a)return[s.concat(r),o]}}},function(e,t,i){"use strict";i.r(t),i.d(t,"Dialog",(function(){return Dialog}));var n=i(5),s=i(4);class Dialog extends n.EventEmitter{constructor(e,t={}){super(),this.selectors={exclusive:Dialog.EXCLUSIVE,maximized:Dialog.MAXIMIZED,normal:Dialog.SELECTOR},t.selectors&&(this.selectors=Object.assign(this.selectors,t.selectors)),this._maximized=t.maximized||!1,this._exclusive=t.exclusive||!1,this._element=null,this._visible=!1,"function"==typeof e?this.factory=e:this.element=e}get maximized(){return this._exclusive||this._maximized}set maximized(e){(e=Boolean(e))!==this._maximized&&(this._visible?this.toggleSize():this._maximized=e)}get visible(){return this._visible}set visible(e){(e=Boolean(e))!==this._visible&&this.toggleVisible()}get exclusive(){return this._exclusive}set exclusive(e){if(this._visible)throw new Error("cannot set exclusive flag when dialog already visible");this._exclusive=e}get element(){return this._element}set element(e){if(this._visible)throw new Error("cannot change element when dialog already visible");if(!(e instanceof Node))throw new Error("element must be an instance of Node");this._element=e}show(){this.visible=!0}hide(){this.visible=!1}maximize(){this.maximized=!0}restore(){this.maximized=!1}getContainer(){return document.querySelector(this._exclusive?this.selectors.exclusive:this._maximized?this.selectors.maximized:this.selectors.normal)}toggleVisible(e){if(e&&0!==e.button)return;const t=this.maximized,i=this._visible=!this._visible,n=this.getContainer();if(t&&n&&n.classList.toggle("ffz-has-dialog",i),!i)return this._element&&this._element.remove(),this.emit("hide"),void(this.factory&&(this._element=null));if(n){if(this.factory){const e=this.factory();if(e instanceof Promise)return void e.then(e=>{this._element=e,n.appendChild(e),this.emit("show")}).catch(e=>{this.emit("error",e)});this._element=e}n.appendChild(this._element),this.emit("show")}}toggleSize(e){if(!this._visible||e&&0!==e.button||!this._element)return;this._maximized=!this._maximized;const t=this.maximized,i=this.getContainer(),n=this._element.parentElement;i!==n&&(t?i&&i.classList.add("ffz-has-dialog"):n&&n.classList.remove("ffz-has-dialog"),this._element.remove(),i&&i.appendChild(this._element),this.emit("resize"))}}Dialog.lastZ=99999999,Dialog.EXCLUSIVE=s.a.DIALOG_EXCLUSIVE,Dialog.MAXIMIZED=s.a.DIALOG_MAXIMIZED,Dialog.SELECTOR=s.a.DIALOG_SELECTOR,t.default=Dialog},function(e,t,i){"use strict";i.r(t),function(e){for(var i="undefined"!=typeof window&&"undefined"!=typeof document,n=["Edge","Trident","Firefox"],s=0,r=0;r<n.length;r+=1)if(i&&navigator.userAgent.indexOf(n[r])>=0){s=1;break}var o=i&&window.Promise?function microtaskDebounce(e){var t=!1;return function(){t||(t=!0,window.Promise.resolve().then((function(){t=!1,e()})))}}:function taskDebounce(e){var t=!1;return function(){t||(t=!0,setTimeout((function(){t=!1,e()}),s))}};function isFunction(e){return e&&"[object Function]"==={}.toString.call(e)}function getStyleComputedProperty(e,t){if(1!==e.nodeType)return[];var i=e.ownerDocument.defaultView.getComputedStyle(e,null);return t?i[t]:i}function getParentNode(e){return"HTML"===e.nodeName?e:e.parentNode||e.host}function getScrollParent(e){if(!e)return document.body;switch(e.nodeName){case"HTML":case"BODY":return e.ownerDocument.body;case"#document":return e.body}var t=getStyleComputedProperty(e),i=t.overflow,n=t.overflowX,s=t.overflowY;return/(auto|scroll|overlay)/.test(i+s+n)?e:getScrollParent(getParentNode(e))}var a=i&&!(!window.MSInputMethodContext||!document.documentMode),l=i&&/MSIE 10/.test(navigator.userAgent);function isIE(e){return 11===e?a:10===e?l:a||l}function getOffsetParent(e){if(!e)return document.documentElement;for(var t=isIE(10)?document.body:null,i=e.offsetParent||null;i===t&&e.nextElementSibling;)i=(e=e.nextElementSibling).offsetParent;var n=i&&i.nodeName;return n&&"BODY"!==n&&"HTML"!==n?-1!==["TH","TD","TABLE"].indexOf(i.nodeName)&&"static"===getStyleComputedProperty(i,"position")?getOffsetParent(i):i:e?e.ownerDocument.documentElement:document.documentElement}function getRoot(e){return null!==e.parentNode?getRoot(e.parentNode):e}function findCommonOffsetParent(e,t){if(!(e&&e.nodeType&&t&&t.nodeType))return document.documentElement;var i=e.compareDocumentPosition(t)&Node.DOCUMENT_POSITION_FOLLOWING,n=i?e:t,s=i?t:e,r=document.createRange();r.setStart(n,0),r.setEnd(s,0);var o=r.commonAncestorContainer;if(e!==o&&t!==o||n.contains(s))return function isOffsetContainer(e){var t=e.nodeName;return"BODY"!==t&&("HTML"===t||getOffsetParent(e.firstElementChild)===e)}(o)?o:getOffsetParent(o);var a=getRoot(e);return a.host?findCommonOffsetParent(a.host,t):findCommonOffsetParent(e,getRoot(t).host)}function getScroll(e){var t="top"===(arguments.length>1&&void 0!==arguments[1]?arguments[1]:"top")?"scrollTop":"scrollLeft",i=e.nodeName;if("BODY"===i||"HTML"===i){var n=e.ownerDocument.documentElement;return(e.ownerDocument.scrollingElement||n)[t]}return e[t]}function getBordersSize(e,t){var i="x"===t?"Left":"Top",n="Left"===i?"Right":"Bottom";return parseFloat(e["border"+i+"Width"],10)+parseFloat(e["border"+n+"Width"],10)}function getSize(e,t,i,n){return Math.max(t["offset"+e],t["scroll"+e],i["client"+e],i["offset"+e],i["scroll"+e],isIE(10)?parseInt(i["offset"+e])+parseInt(n["margin"+("Height"===e?"Top":"Left")])+parseInt(n["margin"+("Height"===e?"Bottom":"Right")]):0)}function getWindowSizes(e){var t=e.body,i=e.documentElement,n=isIE(10)&&getComputedStyle(i);return{height:getSize("Height",t,i,n),width:getSize("Width",t,i,n)}}var classCallCheck=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},c=function(){function defineProperties(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,i){return t&&defineProperties(e.prototype,t),i&&defineProperties(e,i),e}}(),defineProperty=function(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e},u=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}return e};function getClientRect(e){return u({},e,{right:e.left+e.width,bottom:e.top+e.height})}function getBoundingClientRect(e){var t={};try{if(isIE(10)){t=e.getBoundingClientRect();var i=getScroll(e,"top"),n=getScroll(e,"left");t.top+=i,t.left+=n,t.bottom+=i,t.right+=n}else t=e.getBoundingClientRect()}catch(e){}var s={left:t.left,top:t.top,width:t.right-t.left,height:t.bottom-t.top},r="HTML"===e.nodeName?getWindowSizes(e.ownerDocument):{},o=r.width||e.clientWidth||s.right-s.left,a=r.height||e.clientHeight||s.bottom-s.top,l=e.offsetWidth-o,c=e.offsetHeight-a;if(l||c){var u=getStyleComputedProperty(e);l-=getBordersSize(u,"x"),c-=getBordersSize(u,"y"),s.width-=l,s.height-=c}return getClientRect(s)}function getOffsetRectRelativeToArbitraryNode(e,t){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=isIE(10),s="HTML"===t.nodeName,r=getBoundingClientRect(e),o=getBoundingClientRect(t),a=getScrollParent(e),l=getStyleComputedProperty(t),c=parseFloat(l.borderTopWidth,10),u=parseFloat(l.borderLeftWidth,10);i&&s&&(o.top=Math.max(o.top,0),o.left=Math.max(o.left,0));var h=getClientRect({top:r.top-o.top-c,left:r.left-o.left-u,width:r.width,height:r.height});if(h.marginTop=0,h.marginLeft=0,!n&&s){var d=parseFloat(l.marginTop,10),f=parseFloat(l.marginLeft,10);h.top-=c-d,h.bottom-=c-d,h.left-=u-f,h.right-=u-f,h.marginTop=d,h.marginLeft=f}return(n&&!i?t.contains(a):t===a&&"BODY"!==a.nodeName)&&(h=function includeScroll(e,t){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=getScroll(t,"top"),s=getScroll(t,"left"),r=i?-1:1;return e.top+=n*r,e.bottom+=n*r,e.left+=s*r,e.right+=s*r,e}(h,t)),h}function getFixedPositionOffsetParent(e){if(!e||!e.parentElement||isIE())return document.documentElement;for(var t=e.parentElement;t&&"none"===getStyleComputedProperty(t,"transform");)t=t.parentElement;return t||document.documentElement}function getBoundaries(e,t,i,n){var s=arguments.length>4&&void 0!==arguments[4]&&arguments[4],r={top:0,left:0},o=s?getFixedPositionOffsetParent(e):findCommonOffsetParent(e,t);if("viewport"===n)r=function getViewportOffsetRectRelativeToArtbitraryNode(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=e.ownerDocument.documentElement,n=getOffsetRectRelativeToArbitraryNode(e,i),s=Math.max(i.clientWidth,window.innerWidth||0),r=Math.max(i.clientHeight,window.innerHeight||0),o=t?0:getScroll(i),a=t?0:getScroll(i,"left");return getClientRect({top:o-n.top+n.marginTop,left:a-n.left+n.marginLeft,width:s,height:r})}(o,s);else{var a=void 0;"scrollParent"===n?"BODY"===(a=getScrollParent(getParentNode(t))).nodeName&&(a=e.ownerDocument.documentElement):a="window"===n?e.ownerDocument.documentElement:n;var l=getOffsetRectRelativeToArbitraryNode(a,o,s);if("HTML"!==a.nodeName||function isFixed(e){var t=e.nodeName;if("BODY"===t||"HTML"===t)return!1;if("fixed"===getStyleComputedProperty(e,"position"))return!0;var i=getParentNode(e);return!!i&&isFixed(i)}(o))r=l;else{var c=getWindowSizes(e.ownerDocument),u=c.height,h=c.width;r.top+=l.top-l.marginTop,r.bottom=u+l.top,r.left+=l.left-l.marginLeft,r.right=h+l.left}}var d="number"==typeof(i=i||0);return r.left+=d?i:i.left||0,r.top+=d?i:i.top||0,r.right-=d?i:i.right||0,r.bottom-=d?i:i.bottom||0,r}function computeAutoPlacement(e,t,i,n,s){var r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;if(-1===e.indexOf("auto"))return e;var o=getBoundaries(i,n,r,s),a={top:{width:o.width,height:t.top-o.top},right:{width:o.right-t.right,height:o.height},bottom:{width:o.width,height:o.bottom-t.bottom},left:{width:t.left-o.left,height:o.height}},l=Object.keys(a).map((function(e){return u({key:e},a[e],{area:(t=a[e],t.width*t.height)});var t})).sort((function(e,t){return t.area-e.area})),c=l.filter((function(e){var t=e.width,n=e.height;return t>=i.clientWidth&&n>=i.clientHeight})),h=c.length>0?c[0].key:l[0].key,d=e.split("-")[1];return h+(d?"-"+d:"")}function getReferenceOffsets(e,t,i){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;return getOffsetRectRelativeToArbitraryNode(i,n?getFixedPositionOffsetParent(t):findCommonOffsetParent(t,i),n)}function getOuterSizes(e){var t=e.ownerDocument.defaultView.getComputedStyle(e),i=parseFloat(t.marginTop||0)+parseFloat(t.marginBottom||0),n=parseFloat(t.marginLeft||0)+parseFloat(t.marginRight||0);return{width:e.offsetWidth+n,height:e.offsetHeight+i}}function getOppositePlacement(e){var t={left:"right",right:"left",bottom:"top",top:"bottom"};return e.replace(/left|right|bottom|top/g,(function(e){return t[e]}))}function getPopperOffsets(e,t,i){i=i.split("-")[0];var n=getOuterSizes(e),s={width:n.width,height:n.height},r=-1!==["right","left"].indexOf(i),o=r?"top":"left",a=r?"left":"top",l=r?"height":"width",c=r?"width":"height";return s[o]=t[o]+t[l]/2-n[l]/2,s[a]=i===a?t[a]-n[c]:t[getOppositePlacement(a)],s}function find(e,t){return Array.prototype.find?e.find(t):e.filter(t)[0]}function runModifiers(e,t,i){return(void 0===i?e:e.slice(0,function findIndex(e,t,i){if(Array.prototype.findIndex)return e.findIndex((function(e){return e[t]===i}));var n=find(e,(function(e){return e[t]===i}));return e.indexOf(n)}(e,"name",i))).forEach((function(e){e.function&&console.warn("`modifier.function` is deprecated, use `modifier.fn`!");var i=e.function||e.fn;e.enabled&&isFunction(i)&&(t.offsets.popper=getClientRect(t.offsets.popper),t.offsets.reference=getClientRect(t.offsets.reference),t=i(t,e))})),t}function update(){if(!this.state.isDestroyed){var e={instance:this,styles:{},arrowStyles:{},attributes:{},flipped:!1,offsets:{}};e.offsets.reference=getReferenceOffsets(this.state,this.popper,this.reference,this.options.positionFixed),e.placement=computeAutoPlacement(this.options.placement,e.offsets.reference,this.popper,this.reference,this.options.modifiers.flip.boundariesElement,this.options.modifiers.flip.padding),e.originalPlacement=e.placement,e.positionFixed=this.options.positionFixed,e.offsets.popper=getPopperOffsets(this.popper,e.offsets.reference,e.placement),e.offsets.popper.position=this.options.positionFixed?"fixed":"absolute",e=runModifiers(this.modifiers,e),this.state.isCreated?this.options.onUpdate(e):(this.state.isCreated=!0,this.options.onCreate(e))}}function isModifierEnabled(e,t){return e.some((function(e){var i=e.name;return e.enabled&&i===t}))}function getSupportedPropertyName(e){for(var t=[!1,"ms","Webkit","Moz","O"],i=e.charAt(0).toUpperCase()+e.slice(1),n=0;n<t.length;n++){var s=t[n],r=s?""+s+i:e;if(void 0!==document.body.style[r])return r}return null}function destroy(){return this.state.isDestroyed=!0,isModifierEnabled(this.modifiers,"applyStyle")&&(this.popper.removeAttribute("x-placement"),this.popper.style.position="",this.popper.style.top="",this.popper.style.left="",this.popper.style.right="",this.popper.style.bottom="",this.popper.style.willChange="",this.popper.style[getSupportedPropertyName("transform")]=""),this.disableEventListeners(),this.options.removeOnDestroy&&this.popper.parentNode.removeChild(this.popper),this}function getWindow(e){var t=e.ownerDocument;return t?t.defaultView:window}function setupEventListeners(e,t,i,n){i.updateBound=n,getWindow(e).addEventListener("resize",i.updateBound,{passive:!0});var s=getScrollParent(e);return function attachToScrollParents(e,t,i,n){var s="BODY"===e.nodeName,r=s?e.ownerDocument.defaultView:e;r.addEventListener(t,i,{passive:!0}),s||attachToScrollParents(getScrollParent(r.parentNode),t,i,n),n.push(r)}(s,"scroll",i.updateBound,i.scrollParents),i.scrollElement=s,i.eventsEnabled=!0,i}function enableEventListeners(){this.state.eventsEnabled||(this.state=setupEventListeners(this.reference,this.options,this.state,this.scheduleUpdate))}function disableEventListeners(){this.state.eventsEnabled&&(cancelAnimationFrame(this.scheduleUpdate),this.state=function removeEventListeners(e,t){return getWindow(e).removeEventListener("resize",t.updateBound),t.scrollParents.forEach((function(e){e.removeEventListener("scroll",t.updateBound)})),t.updateBound=null,t.scrollParents=[],t.scrollElement=null,t.eventsEnabled=!1,t}(this.reference,this.state))}function isNumeric(e){return""!==e&&!isNaN(parseFloat(e))&&isFinite(e)}function setStyles(e,t){Object.keys(t).forEach((function(i){var n="";-1!==["width","height","top","right","bottom","left"].indexOf(i)&&isNumeric(t[i])&&(n="px"),e.style[i]=t[i]+n}))}var h=i&&/Firefox/i.test(navigator.userAgent);function isModifierRequired(e,t,i){var n=find(e,(function(e){return e.name===t})),s=!!n&&e.some((function(e){return e.name===i&&e.enabled&&e.order<n.order}));if(!s){var r="`"+t+"`",o="`"+i+"`";console.warn(o+" modifier is required by "+r+" modifier in order to work, be sure to include it before "+r+"!")}return s}var d=["auto-start","auto","auto-end","top-start","top","top-end","right-start","right","right-end","bottom-end","bottom","bottom-start","left-end","left","left-start"],f=d.slice(3);function clockwise(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=f.indexOf(e),n=f.slice(i+1).concat(f.slice(0,i));return t?n.reverse():n}var p={FLIP:"flip",CLOCKWISE:"clockwise",COUNTERCLOCKWISE:"counterclockwise"};function parseOffset(e,t,i,n){var s=[0,0],r=-1!==["right","left"].indexOf(n),o=e.split(/(\+|\-)/).map((function(e){return e.trim()})),a=o.indexOf(find(o,(function(e){return-1!==e.search(/,|\s/)})));o[a]&&-1===o[a].indexOf(",")&&console.warn("Offsets separated by white space(s) are deprecated, use a comma (,) instead.");var l=/\s*,\s*|\s+/,c=-1!==a?[o.slice(0,a).concat([o[a].split(l)[0]]),[o[a].split(l)[1]].concat(o.slice(a+1))]:[o];return(c=c.map((function(e,n){var s=(1===n?!r:r)?"height":"width",o=!1;return e.reduce((function(e,t){return""===e[e.length-1]&&-1!==["+","-"].indexOf(t)?(e[e.length-1]=t,o=!0,e):o?(e[e.length-1]+=t,o=!1,e):e.concat(t)}),[]).map((function(e){return function toValue(e,t,i,n){var s=e.match(/((?:\-|\+)?\d*\.?\d*)(.*)/),r=+s[1],o=s[2];if(!r)return e;if(0===o.indexOf("%")){var a=void 0;switch(o){case"%p":a=i;break;case"%":case"%r":default:a=n}return getClientRect(a)[t]/100*r}if("vh"===o||"vw"===o){return("vh"===o?Math.max(document.documentElement.clientHeight,window.innerHeight||0):Math.max(document.documentElement.clientWidth,window.innerWidth||0))/100*r}return r}(e,s,t,i)}))}))).forEach((function(e,t){e.forEach((function(i,n){isNumeric(i)&&(s[t]+=i*("-"===e[n-1]?-1:1))}))})),s}var g={placement:"bottom",positionFixed:!1,eventsEnabled:!0,removeOnDestroy:!1,onCreate:function onCreate(){},onUpdate:function onUpdate(){},modifiers:{shift:{order:100,enabled:!0,fn:function shift(e){var t=e.placement,i=t.split("-")[0],n=t.split("-")[1];if(n){var s=e.offsets,r=s.reference,o=s.popper,a=-1!==["bottom","top"].indexOf(i),l=a?"left":"top",c=a?"width":"height",h={start:defineProperty({},l,r[l]),end:defineProperty({},l,r[l]+r[c]-o[c])};e.offsets.popper=u({},o,h[n])}return e}},offset:{order:200,enabled:!0,fn:function offset(e,t){var i=t.offset,n=e.placement,s=e.offsets,r=s.popper,o=s.reference,a=n.split("-")[0],l=void 0;return l=isNumeric(+i)?[+i,0]:parseOffset(i,r,o,a),"left"===a?(r.top+=l[0],r.left-=l[1]):"right"===a?(r.top+=l[0],r.left+=l[1]):"top"===a?(r.left+=l[0],r.top-=l[1]):"bottom"===a&&(r.left+=l[0],r.top+=l[1]),e.popper=r,e},offset:0},preventOverflow:{order:300,enabled:!0,fn:function preventOverflow(e,t){var i=t.boundariesElement||getOffsetParent(e.instance.popper);e.instance.reference===i&&(i=getOffsetParent(i));var n=getSupportedPropertyName("transform"),s=e.instance.popper.style,r=s.top,o=s.left,a=s[n];s.top="",s.left="",s[n]="";var l=getBoundaries(e.instance.popper,e.instance.reference,t.padding,i,e.positionFixed);s.top=r,s.left=o,s[n]=a,t.boundaries=l;var c=t.priority,h=e.offsets.popper,d={primary:function primary(e){var i=h[e];return h[e]<l[e]&&!t.escapeWithReference&&(i=Math.max(h[e],l[e])),defineProperty({},e,i)},secondary:function secondary(e){var i="right"===e?"left":"top",n=h[i];return h[e]>l[e]&&!t.escapeWithReference&&(n=Math.min(h[i],l[e]-("right"===e?h.width:h.height))),defineProperty({},i,n)}};return c.forEach((function(e){var t=-1!==["left","top"].indexOf(e)?"primary":"secondary";h=u({},h,d[t](e))})),e.offsets.popper=h,e},priority:["left","right","top","bottom"],padding:5,boundariesElement:"scrollParent"},keepTogether:{order:400,enabled:!0,fn:function keepTogether(e){var t=e.offsets,i=t.popper,n=t.reference,s=e.placement.split("-")[0],r=Math.floor,o=-1!==["top","bottom"].indexOf(s),a=o?"right":"bottom",l=o?"left":"top",c=o?"width":"height";return i[a]<r(n[l])&&(e.offsets.popper[l]=r(n[l])-i[c]),i[l]>r(n[a])&&(e.offsets.popper[l]=r(n[a])),e}},arrow:{order:500,enabled:!0,fn:function arrow(e,t){var i;if(!isModifierRequired(e.instance.modifiers,"arrow","keepTogether"))return e;var n=t.element;if("string"==typeof n){if(!(n=e.instance.popper.querySelector(n)))return e}else if(!e.instance.popper.contains(n))return console.warn("WARNING: `arrow.element` must be child of its popper element!"),e;var s=e.placement.split("-")[0],r=e.offsets,o=r.popper,a=r.reference,l=-1!==["left","right"].indexOf(s),c=l?"height":"width",u=l?"Top":"Left",h=u.toLowerCase(),d=l?"left":"top",f=l?"bottom":"right",p=getOuterSizes(n)[c];a[f]-p<o[h]&&(e.offsets.popper[h]-=o[h]-(a[f]-p)),a[h]+p>o[f]&&(e.offsets.popper[h]+=a[h]+p-o[f]),e.offsets.popper=getClientRect(e.offsets.popper);var g=a[h]+a[c]/2-p/2,m=getStyleComputedProperty(e.instance.popper),_=parseFloat(m["margin"+u],10),b=parseFloat(m["border"+u+"Width"],10),v=g-e.offsets.popper[h]-_-b;return v=Math.max(Math.min(o[c]-p,v),0),e.arrowElement=n,e.offsets.arrow=(defineProperty(i={},h,Math.round(v)),defineProperty(i,d,""),i),e},element:"[x-arrow]"},flip:{order:600,enabled:!0,fn:function flip(e,t){if(isModifierEnabled(e.instance.modifiers,"inner"))return e;if(e.flipped&&e.placement===e.originalPlacement)return e;var i=getBoundaries(e.instance.popper,e.instance.reference,t.padding,t.boundariesElement,e.positionFixed),n=e.placement.split("-")[0],s=getOppositePlacement(n),r=e.placement.split("-")[1]||"",o=[];switch(t.behavior){case p.FLIP:o=[n,s];break;case p.CLOCKWISE:o=clockwise(n);break;case p.COUNTERCLOCKWISE:o=clockwise(n,!0);break;default:o=t.behavior}return o.forEach((function(a,l){if(n!==a||o.length===l+1)return e;n=e.placement.split("-")[0],s=getOppositePlacement(n);var c=e.offsets.popper,h=e.offsets.reference,d=Math.floor,f="left"===n&&d(c.right)>d(h.left)||"right"===n&&d(c.left)<d(h.right)||"top"===n&&d(c.bottom)>d(h.top)||"bottom"===n&&d(c.top)<d(h.bottom),p=d(c.left)<d(i.left),g=d(c.right)>d(i.right),m=d(c.top)<d(i.top),_=d(c.bottom)>d(i.bottom),b="left"===n&&p||"right"===n&&g||"top"===n&&m||"bottom"===n&&_,v=-1!==["top","bottom"].indexOf(n),y=!!t.flipVariations&&(v&&"start"===r&&p||v&&"end"===r&&g||!v&&"start"===r&&m||!v&&"end"===r&&_),w=!!t.flipVariationsByContent&&(v&&"start"===r&&g||v&&"end"===r&&p||!v&&"start"===r&&_||!v&&"end"===r&&m),k=y||w;(f||b||k)&&(e.flipped=!0,(f||b)&&(n=o[l+1]),k&&(r=function getOppositeVariation(e){return"end"===e?"start":"start"===e?"end":e}(r)),e.placement=n+(r?"-"+r:""),e.offsets.popper=u({},e.offsets.popper,getPopperOffsets(e.instance.popper,e.offsets.reference,e.placement)),e=runModifiers(e.instance.modifiers,e,"flip"))})),e},behavior:"flip",padding:5,boundariesElement:"viewport",flipVariations:!1,flipVariationsByContent:!1},inner:{order:700,enabled:!1,fn:function inner(e){var t=e.placement,i=t.split("-")[0],n=e.offsets,s=n.popper,r=n.reference,o=-1!==["left","right"].indexOf(i),a=-1===["top","left"].indexOf(i);return s[o?"left":"top"]=r[i]-(a?s[o?"width":"height"]:0),e.placement=getOppositePlacement(t),e.offsets.popper=getClientRect(s),e}},hide:{order:800,enabled:!0,fn:function hide(e){if(!isModifierRequired(e.instance.modifiers,"hide","preventOverflow"))return e;var t=e.offsets.reference,i=find(e.instance.modifiers,(function(e){return"preventOverflow"===e.name})).boundaries;if(t.bottom<i.top||t.left>i.right||t.top>i.bottom||t.right<i.left){if(!0===e.hide)return e;e.hide=!0,e.attributes["x-out-of-boundaries"]=""}else{if(!1===e.hide)return e;e.hide=!1,e.attributes["x-out-of-boundaries"]=!1}return e}},computeStyle:{order:850,enabled:!0,fn:function computeStyle(e,t){var i=t.x,n=t.y,s=e.offsets.popper,r=find(e.instance.modifiers,(function(e){return"applyStyle"===e.name})).gpuAcceleration;void 0!==r&&console.warn("WARNING: `gpuAcceleration` option moved to `computeStyle` modifier and will not be supported in future versions of Popper.js!");var o=void 0!==r?r:t.gpuAcceleration,a=getOffsetParent(e.instance.popper),l=getBoundingClientRect(a),c={position:s.position},d=function getRoundedOffsets(e,t){var i=e.offsets,n=i.popper,s=i.reference,r=Math.round,o=Math.floor,a=function noRound(e){return e},l=r(s.width),c=r(n.width),u=-1!==["left","right"].indexOf(e.placement),h=-1!==e.placement.indexOf("-"),d=t?u||h||l%2==c%2?r:o:a,f=t?r:a;return{left:d(l%2==1&&c%2==1&&!h&&t?n.left-1:n.left),top:f(n.top),bottom:f(n.bottom),right:d(n.right)}}(e,window.devicePixelRatio<2||!h),f="bottom"===i?"top":"bottom",p="right"===n?"left":"right",g=getSupportedPropertyName("transform"),m=void 0,_=void 0;if(_="bottom"===f?"HTML"===a.nodeName?-a.clientHeight+d.bottom:-l.height+d.bottom:d.top,m="right"===p?"HTML"===a.nodeName?-a.clientWidth+d.right:-l.width+d.right:d.left,o&&g)c[g]="translate3d("+m+"px, "+_+"px, 0)",c[f]=0,c[p]=0,c.willChange="transform";else{var b="bottom"===f?-1:1,v="right"===p?-1:1;c[f]=_*b,c[p]=m*v,c.willChange=f+", "+p}var y={"x-placement":e.placement};return e.attributes=u({},y,e.attributes),e.styles=u({},c,e.styles),e.arrowStyles=u({},e.offsets.arrow,e.arrowStyles),e},gpuAcceleration:!0,x:"bottom",y:"right"},applyStyle:{order:900,enabled:!0,fn:function applyStyle(e){return setStyles(e.instance.popper,e.styles),function setAttributes(e,t){Object.keys(t).forEach((function(i){!1!==t[i]?e.setAttribute(i,t[i]):e.removeAttribute(i)}))}(e.instance.popper,e.attributes),e.arrowElement&&Object.keys(e.arrowStyles).length&&setStyles(e.arrowElement,e.arrowStyles),e},onLoad:function applyStyleOnLoad(e,t,i,n,s){var r=getReferenceOffsets(s,t,e,i.positionFixed),o=computeAutoPlacement(i.placement,r,t,e,i.modifiers.flip.boundariesElement,i.modifiers.flip.padding);return t.setAttribute("x-placement",o),setStyles(t,{position:i.positionFixed?"fixed":"absolute"}),i},gpuAcceleration:void 0}}},m=function(){function Popper(e,t){var i=this,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};classCallCheck(this,Popper),this.scheduleUpdate=function(){return requestAnimationFrame(i.update)},this.update=o(this.update.bind(this)),this.options=u({},Popper.Defaults,n),this.state={isDestroyed:!1,isCreated:!1,scrollParents:[]},this.reference=e&&e.jquery?e[0]:e,this.popper=t&&t.jquery?t[0]:t,this.options.modifiers={},Object.keys(u({},Popper.Defaults.modifiers,n.modifiers)).forEach((function(e){i.options.modifiers[e]=u({},Popper.Defaults.modifiers[e]||{},n.modifiers?n.modifiers[e]:{})})),this.modifiers=Object.keys(this.options.modifiers).map((function(e){return u({name:e},i.options.modifiers[e])})).sort((function(e,t){return e.order-t.order})),this.modifiers.forEach((function(e){e.enabled&&isFunction(e.onLoad)&&e.onLoad(i.reference,i.popper,i.options,e,i.state)})),this.update();var s=this.options.eventsEnabled;s&&this.enableEventListeners(),this.state.eventsEnabled=s}return c(Popper,[{key:"update",value:function update$$1(){return update.call(this)}},{key:"destroy",value:function destroy$$1(){return destroy.call(this)}},{key:"enableEventListeners",value:function enableEventListeners$$1(){return enableEventListeners.call(this)}},{key:"disableEventListeners",value:function disableEventListeners$$1(){return disableEventListeners.call(this)}}]),Popper}();m.Utils=("undefined"!=typeof window?window:e).PopperUtils,m.placements=d,m.Defaults=g,t.default=m}.call(this,i(11))},function(e,t){e.exports=pathToRegexp,e.exports.parse=parse,e.exports.compile=function compile(e,t){return tokensToFunction(parse(e,t))},e.exports.tokensToFunction=tokensToFunction,e.exports.tokensToRegExp=tokensToRegExp;var i="/",n=new RegExp(["(\\\\.)","(?:\\:(\\w+)(?:\\(((?:\\\\.|[^\\\\()])+)\\))?|\\(((?:\\\\.|[^\\\\()])+)\\))([+*?])?"].join("|"),"g");function parse(e,t){for(var s,r=[],o=0,a=0,l="",c=t&&t.delimiter||i,u=t&&t.whitelist||void 0,h=!1;null!==(s=n.exec(e));){var d=s[0],f=s[1],p=s.index;if(l+=e.slice(a,p),a=p+d.length,f)l+=f[1],h=!0;else{var g="",m=s[2],_=s[3],b=s[4],v=s[5];if(!h&&l.length){var y=l.length-1,w=l[y];(!u||u.indexOf(w)>-1)&&(g=w,l=l.slice(0,y))}l&&(r.push(l),l="",h=!1);var k="+"===v||"*"===v,C="?"===v||"*"===v,x=_||b,S=g||c;r.push({name:m||o++,prefix:g,delimiter:S,optional:C,repeat:k,pattern:x?escapeGroup(x):"[^"+escapeString(S===c?S:S+c)+"]+?"})}}return(l||a<e.length)&&r.push(l+e.substr(a)),r}function tokensToFunction(e){for(var t=new Array(e.length),i=0;i<e.length;i++)"object"==typeof e[i]&&(t[i]=new RegExp("^(?:"+e[i].pattern+")$"));return function(i,n){for(var s="",r=n&&n.encode||encodeURIComponent,o=0;o<e.length;o++){var a=e[o];if("string"!=typeof a){var l,c=i?i[a.name]:void 0;if(Array.isArray(c)){if(!a.repeat)throw new TypeError('Expected "'+a.name+'" to not repeat, but got array');if(0===c.length){if(a.optional)continue;throw new TypeError('Expected "'+a.name+'" to not be empty')}for(var u=0;u<c.length;u++){if(l=r(c[u],a),!t[o].test(l))throw new TypeError('Expected all "'+a.name+'" to match "'+a.pattern+'"');s+=(0===u?a.prefix:a.delimiter)+l}}else if("string"!=typeof c&&"number"!=typeof c&&"boolean"!=typeof c){if(!a.optional)throw new TypeError('Expected "'+a.name+'" to be '+(a.repeat?"an array":"a string"))}else{if(l=r(String(c),a),!t[o].test(l))throw new TypeError('Expected "'+a.name+'" to match "'+a.pattern+'", but got "'+l+'"');s+=a.prefix+l}}else s+=a}return s}}function escapeString(e){return e.replace(/([.+*?=^!:${}()[\]|/\\])/g,"\\$1")}function escapeGroup(e){return e.replace(/([=!:$/()])/g,"\\$1")}function flags(e){return e&&e.sensitive?"":"i"}function tokensToRegExp(e,t,n){for(var s=(n=n||{}).strict,r=!1!==n.start,o=!1!==n.end,a=n.delimiter||i,l=[].concat(n.endsWith||[]).map(escapeString).concat("$").join("|"),c=r?"^":"",u=0;u<e.length;u++){var h=e[u];if("string"==typeof h)c+=escapeString(h);else{var d=h.repeat?"(?:"+h.pattern+")(?:"+escapeString(h.delimiter)+"(?:"+h.pattern+"))*":h.pattern;t&&t.push(h),h.optional?h.prefix?c+="(?:"+escapeString(h.prefix)+"("+d+"))?":c+="("+d+")?":c+=escapeString(h.prefix)+"("+d+")"}}if(o)s||(c+="(?:"+escapeString(a)+")?"),c+="$"===l?"$":"(?="+l+")";else{var f=e[e.length-1],p="string"==typeof f?f[f.length-1]===a:void 0===f;s||(c+="(?:"+escapeString(a)+"(?="+l+"))?"),p||(c+="(?="+escapeString(a)+"|"+l+")")}return new RegExp(c,flags(n))}function pathToRegexp(e,t,i){return e instanceof RegExp?function regexpToRegexp(e,t){if(!t)return e;var i=e.source.match(/\((?!\?)/g);if(i)for(var n=0;n<i.length;n++)t.push({name:n,prefix:null,delimiter:null,optional:!1,repeat:!1,pattern:null});return e}(e,t):Array.isArray(e)?function arrayToRegexp(e,t,i){for(var n=[],s=0;s<e.length;s++)n.push(pathToRegexp(e[s],t,i).source);return new RegExp("(?:"+n.join("|")+")",flags(i))}(e,t,i):function stringToRegexp(e,t,i){return tokensToRegExp(parse(e,i),t,i)}(e,t,i)}},function(e,t,i){"use strict";i.r(t),i.d(t,"Invert",(function(){return a})),i.d(t,"Or",(function(){return l})),i.d(t,"If",(function(){return c})),i.d(t,"Constant",(function(){return u})),i.d(t,"Time",(function(){return h})),i.d(t,"TheaterMode",(function(){return d})),i.d(t,"Moderator",(function(){return f})),i.d(t,"SquadMode",(function(){return p})),i.d(t,"NativeDarkTheme",(function(){return g})),i.d(t,"Page",(function(){return m})),i.d(t,"Channel",(function(){return _})),i.d(t,"Category",(function(){return b})),i.d(t,"Title",(function(){return v}));var n=i(31),s=i.n(n),r=i(0),o=i(7);const a={createTest:(e,t)=>Object(o.a)(e,t,!0),maxRules:1,childRules:!0,tall:!0,title:"Invert",i18n:"settings.filter.invert",default:()=>[],editor:()=>i.e(134).then(i.bind(null,48))},l={createTest:(e,t)=>Object(o.a)(e,t,!1,!0),childRules:!0,tall:!0,title:"Or",i18n:"settings.filter.or",default:()=>[],editor:()=>i.e(134).then(i.bind(null,48))},c={createTest(e,t){const i=Object(o.a)(e[0],t),n=Object(o.a)(e[1],t),s=Object(o.a)(e[2],t);return e=>i(e)?n(e):s(e)},childRules:!0,tall:!0,title:"If",i18n:"settings.filter.if",default:()=>[[],[],[]],editor:()=>i.e(134).then(i.bind(null,135))},u={createTest:e=>e?()=>!0:()=>!1,title:"True or False",i18n:"settings.filter.true_false",default:!0,editor:()=>i.e(134).then(i.bind(null,13))};function parseTime(e){if("string"!=typeof e||!e.length)return null;const t=e.indexOf(":");if(-1===t)return null;let i,n;try{i=parseInt(e.slice(0,t),10),n=parseInt(e.slice(t+1),10)}catch(e){return null}return 60*i+n}const h={_captured:new Set,createTest(e){const t=parseTime(e[0]),i=parseTime(e[1]);return null==t||null==i?()=>!1:t<=i?()=>{h._captured.add(t),h._captured.add(i+1);const e=new Date,n=60*e.getHours()+e.getMinutes();return n>=t&&n<=i}:()=>{h._captured.add(t+1),h._captured.add(i);const e=new Date,n=60*e.getHours()+e.getMinutes();return n>=t||n<=i}},captured:()=>{const e=Array.from(h._captured);return h._captured=new Set,e.sort((e,t)=>e-t),e},title:"Time of Day",i18n:"settings.filter.time",default:()=>["08:00","18:00"],editor:()=>i.e(134).then(i.bind(null,136))},d={createTest:e=>t=>t.ui&&t.ui.theatreModeEnabled===e,title:"Theater Mode",i18n:"settings.filter.theater",default:!0,editor:()=>i.e(134).then(i.bind(null,13))},f={createTest:e=>t=>t.moderator===e,title:"Is Moderator",i18n:"settings.filter.moderator",default:!0,editor:()=>i.e(134).then(i.bind(null,13))},p={createTest:e=>t=>t.ui&&t.ui.squadModeEnabled===e,title:"Squad Mode",i18n:"settings.filter.squad",default:!0,editor:()=>i.e(134).then(i.bind(null,13))},g={createTest(e){const t=e?1:0;return e=>e.ui&&e.ui.theme===t},title:"Dark Theme",i18n:"settings.filter.native-dark",default:!0,editor:()=>i.e(134).then(i.bind(null,13))},m={createTest(e={}){const t=e.route,i=[];if(Object.keys(e.values).length){var n;const s=null===(n=window.FrankerFaceZ)||void 0===n?void 0:n.get(),r=s&&s.resolve("site.router");if(!r)return()=>!1;{const n=r.getRoute(t);if(!n||!n.parts)return()=>!1;let s=1;for(const t of n.parts)if("object"==typeof t){const n=e.values[t.name];n&&n.length&&i.push([s,n]),s++}}}return e=>{if(!e.route||!e.route_data||e.route.name!==t)return!1;for(const[t,n]of i)if(e.route_data[t]!==n)return!1;return!0}},tall:!0,title:"Current Page",i18n:"settings.filter.page",default:()=>({route:"front-page",values:{}}),editor:()=>i.e(134).then(i.bind(null,137))},_={createTest(e={}){const t=e.login,i=e.id;return e=>e.channelID===i||null==e.channelID&&e.channelLogin===t},title:"Current Channel",i18n:"settings.filter.channel",default:()=>({login:null,id:null}),editor:()=>i.e(134).then(i.bind(null,138))},b={createTest(e={}){const t=e.name,i=e.id;return i&&t?e=>e.categoryID===i||null==e.categoryID&&e.category===t:()=>!1},title:"Current Category",i18n:"settings.filter.category",default:()=>({name:null,id:null}),editor:()=>i.e(134).then(i.bind(null,139))},v={createTest(e={}){const t=e.mode;let i,n=e.title;if(!n||!t)return()=>!1;if("text"===t)n=Object(r.escape_regex)(n);else if("glob"===t)n=Object(r.glob_to_regex)(n);else if("raw"!==t)return()=>!1;if(!s()(n))return()=>!1;try{i=new RegExp(n,`g${e.sensitive?"":"i"}`)}catch(e){return()=>!1}return e=>(i.lastIndex=0,e.title&&i.test(e.title))},title:"Current Title",i18n:"settings.filter.title",default:()=>({title:"",mode:"text",sensitive:!1}),editor:()=>i.e(134).then(i.bind(null,140))}},function(e,t){function indexOf(e,t){for(var i=0;i<e.length;++i)if(e[i]===t)return i;return-1}function serializer(e,t){var i=[],n=[];return null==t&&(t=function(e,t){return i[0]===t?"[Circular ~]":"[Circular ~."+n.slice(0,indexOf(i,t)).join(".")+"]"}),function(s,r){if(i.length>0){var o=indexOf(i,this);~o?i.splice(o+1):i.push(this),~o?n.splice(o,1/0,s):n.push(s),~indexOf(i,r)&&(r=t.call(this,s,r))}else i.push(r);return null==e?r instanceof Error?function stringifyError(e){var t={stack:e.stack,message:e.message,name:e.name};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}(r):r:e.call(this,s,r)}}(e.exports=function stringify(e,t,i,n){return JSON.stringify(e,serializer(t,n),i)}).getSerialize=serializer},function(e,t,i){const n=i(54);e.exports=function(e,t){t||(t={});const i=void 0===t.limit?25:t.limit;let s=null,r=null;try{s=e instanceof RegExp?e:"string"==typeof e?new RegExp(e):new RegExp(String(e)),r=n.parse(s)}catch(e){return!1}let o=0,a=0,l=0;return n.traverse(r,{Repetition:{pre({node:e}){l++,o++,a<o&&(a=o)},post({node:e}){o--}}}),a<=1&&l<=i}},function(e,t,i){"use strict";function gen(e){return e?n[e.type](e):""}var n={RegExp:function RegExp(e){return"/"+gen(e.body)+"/"+e.flags},Alternative:function Alternative(e){return(e.expressions||[]).map(gen).join("")},Disjunction:function Disjunction(e){return gen(e.left)+"|"+gen(e.right)},Group:function Group(e){var t=gen(e.expression);return e.capturing?e.name?"(?<"+e.name+">"+t+")":"("+t+")":"(?:"+t+")"},Backreference:function Backreference(e){switch(e.kind){case"number":return"\\"+e.reference;case"name":return"\\k<"+e.reference+">";default:throw new TypeError("Unknown Backreference kind: "+e.kind)}},Assertion:function Assertion(e){switch(e.kind){case"^":case"$":case"\\b":case"\\B":return e.kind;case"Lookahead":var t=gen(e.assertion);return e.negative?"(?!"+t+")":"(?="+t+")";case"Lookbehind":var i=gen(e.assertion);return e.negative?"(?<!"+i+")":"(?<="+i+")";default:throw new TypeError("Unknown Assertion kind: "+e.kind)}},CharacterClass:function CharacterClass(e){var t=e.expressions.map(gen).join("");return e.negative?"[^"+t+"]":"["+t+"]"},ClassRange:function ClassRange(e){return gen(e.from)+"-"+gen(e.to)},Repetition:function Repetition(e){return""+gen(e.expression)+gen(e.quantifier)},Quantifier:function Quantifier(e){var t=void 0,i=e.greedy?"":"?";switch(e.kind){case"+":case"?":case"*":t=e.kind;break;case"Range":t=e.from===e.to?"{"+e.from+"}":e.to?"{"+e.from+","+e.to+"}":"{"+e.from+",}";break;default:throw new TypeError("Unknown Quantifier kind: "+e.kind)}return""+t+i},Char:function Char(e){var t=e.value;switch(e.kind){case"simple":return e.escaped?"\\"+t:t;case"hex":case"unicode":case"oct":case"decimal":case"control":case"meta":return t;default:throw new TypeError("Unknown Char kind: "+e.kind)}},UnicodeProperty:function UnicodeProperty(e){return"\\"+(e.negative?"P":"p")+"{"+(e.shorthand||e.binary?"":e.name+"=")+e.value+"}"}};e.exports={generate:gen}},function(e,t,i){"use strict";var n=i(20);function astTraverse(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=t.pre,s=t.post,r=t.skipProperty;!function visit(e,t,o,a){if(e&&"string"==typeof e.type){var l=void 0;if(i&&(l=i(e,t,o,a)),!1!==l)for(var c in t&&t[o]&&(e=isNaN(a)?t[o]:t[o][a]),e)if(e.hasOwnProperty(c)){if(r?r(c,e):"$"===c[0])continue;var u=e[c];if(Array.isArray(u)){var h=0;for(n.traversingIndexStack.push(h);h<u.length;)visit(u[h],e,c,h),h=n.updateTraversingIndex(1);n.traversingIndexStack.pop()}else visit(u,e,c)}s&&s(e,t,o,a)}}(e,null)}e.exports={traverse:function traverse(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{asNodes:!1};function getPathFor(e,t,i,s){var r=n.getForNode(t);return n.getForNode(e,r,i,s)}Array.isArray(t)||(t=[t]),t=t.filter((function(t){return"function"!=typeof t.shouldRun||t.shouldRun(e)})),n.initRegistry(),t.forEach((function(t){"function"==typeof t.init&&t.init(e)})),astTraverse(e,{pre:function pre(e,n,s,r){var o=void 0;i.asNodes||(o=getPathFor(e,n,s,r));var a=!0,l=!1,c=void 0;try{for(var u,h=t[Symbol.iterator]();!(a=(u=h.next()).done);a=!0){var d=u.value;if("function"==typeof d["*"])if(o){if(!o.isRemoved())if(!1===d["*"](o))return!1}else d["*"](e,n,s,r);var f=void 0;if("function"==typeof d[e.type]?f=d[e.type]:"object"==typeof d[e.type]&&"function"==typeof d[e.type].pre&&(f=d[e.type].pre),f)if(o){if(!o.isRemoved())if(!1===f.call(d,o))return!1}else f.call(d,e,n,s,r)}}catch(e){l=!0,c=e}finally{try{!a&&h.return&&h.return()}finally{if(l)throw c}}},post:function post(e,n,s,r){if(e){var o=void 0;i.asNodes||(o=getPathFor(e,n,s,r));var a=!0,l=!1,c=void 0;try{for(var u,h=t[Symbol.iterator]();!(a=(u=h.next()).done);a=!0){var d=u.value,f=void 0;if("object"==typeof d[e.type]&&"function"==typeof d[e.type].post&&(f=d[e.type].post),f)if(o){if(!o.isRemoved())if(!1===f.call(d,o))return!1}else f.call(d,e,n,s,r)}}catch(e){l=!0,c=e}finally{try{!a&&h.return&&h.return()}finally{if(l)throw c}}}},skipProperty:function skipProperty(e){return"loc"===e}})}}},function(e,t,i){"use strict";var _slicedToArray=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function sliceIterator(e,t){var i=[],n=!0,s=!1,r=void 0;try{for(var o,a=e[Symbol.iterator]();!(n=(o=a.next()).done)&&(i.push(o.value),!t||i.length!==t);n=!0);}catch(e){s=!0,r=e}finally{try{!n&&a.return&&a.return()}finally{if(s)throw r}}return i}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")},n=function(){function defineProperties(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,i){return t&&defineProperties(e.prototype,t),i&&defineProperties(e,i),e}}();var s=i(15),r=s.EPSILON,o=s.EPSILON_CLOSURE,a=function(){function NFA(e,t){!function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,NFA),this.in=e,this.out=t}return n(NFA,[{key:"matches",value:function matches(e){return this.in.matches(e)}},{key:"getAlphabet",value:function getAlphabet(){if(!this._alphabet){this._alphabet=new Set;var e=this.getTransitionTable();for(var t in e){var i=e[t];for(var n in i)n!==o&&this._alphabet.add(n)}}return this._alphabet}},{key:"getAcceptingStates",value:function getAcceptingStates(){return this._acceptingStates||this.getTransitionTable(),this._acceptingStates}},{key:"getAcceptingStateNumbers",value:function getAcceptingStateNumbers(){if(!this._acceptingStateNumbers){this._acceptingStateNumbers=new Set;var e=!0,t=!1,i=void 0;try{for(var n,s=this.getAcceptingStates()[Symbol.iterator]();!(e=(n=s.next()).done);e=!0){var r=n.value;this._acceptingStateNumbers.add(r.number)}}catch(e){t=!0,i=e}finally{try{!e&&s.return&&s.return()}finally{if(t)throw i}}}return this._acceptingStateNumbers}},{key:"getTransitionTable",value:function getTransitionTable(){var e=this;if(!this._transitionTable){this._transitionTable={},this._acceptingStates=new Set;var t=new Set,i=new Set;!function visitState(n){if(!t.has(n)){t.add(n),n.number=t.size,e._transitionTable[n.number]={},n.accepting&&e._acceptingStates.add(n);var s=n.getTransitions(),r=!0,o=!1,a=void 0;try{for(var l,c=s[Symbol.iterator]();!(r=(l=c.next()).done);r=!0){var u=l.value,h=_slicedToArray(u,2),d=h[0],f=h[1],p=[];i.add(d);var g=!0,m=!1,_=void 0;try{for(var b,v=f[Symbol.iterator]();!(g=(b=v.next()).done);g=!0){var y=b.value;visitState(y),p.push(y.number)}}catch(e){m=!0,_=e}finally{try{!g&&v.return&&v.return()}finally{if(m)throw _}}e._transitionTable[n.number][d]=p}}catch(e){o=!0,a=e}finally{try{!r&&c.return&&c.return()}finally{if(o)throw a}}}}(this.in),t.forEach((function(t){delete e._transitionTable[t.number][r],e._transitionTable[t.number][o]=[].concat(function _toConsumableArray(e){if(Array.isArray(e)){for(var t=0,i=Array(e.length);t<e.length;t++)i[t]=e[t];return i}return Array.from(e)}(t.getEpsilonClosure())).map((function(e){return e.number}))}))}return this._transitionTable}}]),NFA}();e.exports=a},function(t,i,n){"use strict";var s=n(34),r=n(86),o=n(15).EPSILON;function char(e){var t=new r,i=new r({accepting:!0});return new s(t.addTransition(e,i),i)}function altPair(e,t){return e.out.accepting=!1,t.out.accepting=!0,e.out.addTransition(o,t.in),new s(e.in,t.out)}function orPair(e,t){var i=new r,n=new r;return i.addTransition(o,e.in),i.addTransition(o,t.in),n.accepting=!0,e.out.accepting=!1,t.out.accepting=!1,e.out.addTransition(o,n),t.out.addTransition(o,n),new s(i,n)}t.exports={alt:function alt(e){for(var t=arguments.length,i=Array(t>1?t-1:0),n=1;n<t;n++)i[n-1]=arguments[n];var s=!0,r=!1,o=void 0;try{for(var a,l=i[Symbol.iterator]();!(s=(a=l.next()).done);s=!0){e=altPair(e,a.value)}}catch(e){r=!0,o=e}finally{try{!s&&l.return&&l.return()}finally{if(r)throw o}}return e},char:char,e:function e(){return char(o)},or:function or(e){for(var t=arguments.length,i=Array(t>1?t-1:0),n=1;n<t;n++)i[n-1]=arguments[n];var s=!0,r=!1,o=void 0;try{for(var a,l=i[Symbol.iterator]();!(s=(a=l.next()).done);s=!0){e=orPair(e,a.value)}}catch(e){r=!0,o=e}finally{try{!s&&l.return&&l.return()}finally{if(r)throw o}}return e},rep:function rep(e){return e.in.addTransition(o,e.out),e.out.addTransition(o,e.in),e},repExplicit:function repExplicit(e){var t=new r,i=new r({accepting:!0});return t.addTransition(o,e.in),t.addTransition(o,i),e.out.accepting=!1,e.out.addTransition(o,i),i.addTransition(o,e.in),new s(t,i)},plusRep:function plusRep(e){return e.out.addTransition(o,e.in),e},questionRep:function questionRep(e){return e.in.addTransition(o,e.out),e}}},function(e,t,i){"use strict";i.d(t,"a",(function(){return RavenLogger}));var n=i(8),s=i.n(n),r=i(2),o=i(0),a=i(3),l=i(23),c=i.n(l);const u=/((?:\?|&)[^?&=]*?(?:oauth|token)[^?&=]*?=)[^?&]*?(&|$)/i,h=/\/(?:script|static)\/((?:babel\/)?avalon)(\.js)(\?|#|$)/,fix_url=e=>e.replace(h,`/static/$1.${i.h}$2$3`),d=["hls.ttvnw.net","trowel.twitch.tv","client-event-reporter.twitch.tv",".twitch.tv/gql","spade.twitch.tv"],f=["ChannelPage_SetSessionStatus"],p=[Error,TypeError,SyntaxError,ReferenceError],g=["the ducks are on fire","it's raining in shanghai","can we just not do this today?","cbenni likes butts","guys can you please not spam the errors my mom bought me this new error report server and it gets really hot when the errors are being spammed now my leg is starting to hurt because it is getting so hot"];class RavenLogger extends a.default{constructor(...e){super(...e),this.inject("settings"),this.once("settings:enabled",()=>{this.settings.add("reports.error.enable",{default:!0,ui:{path:"Data Management > Reporting >> Error Reports",title:"Automatically send reports when an error occurs.",component:"setting-check-box"}}),this.settings.add("reports.error.include-user",{default:!1,ui:{path:"Data Management > Reporting >> Error Reports",title:"Include user IDs in reports.",description:"Occasionally, it's useful to know which users are encountering issues so that we can check for specific badges, emote sets, or user flags that are causing issues.",component:"setting-check-box"}}),this.settings.add("reports.error.include-settings",{default:!0,ui:{path:"Data Management > Reporting >> Error Reports",title:"Include a settings snapshot in reports.",description:"Knowing exactly what settings are in effect when an error happens can be incredibly useful for recreating the issue.",component:"setting-check-box"}}),this.settings.addUI("reports.error.example",{path:"Data Management > Reporting >> Example Report",component:"async-text",watch:["reports.error.enable","reports.error.include-user","reports.error.include-settings"],data:()=>new Promise(e=>{this.__example_waiter=t=>{e(JSON.stringify(t,null,4))};const t=p[Math.floor(Math.random()*p.length)],i=g[Math.floor(Math.random()*g.length)];setTimeout(()=>this.log.capture(new t(i),{tags:{example:!0}}))})})}),this.twitch_logger=null,this.once("site:enabled",()=>{const e=this.resolve("site.web_munch");e&&e.getRequire().then(()=>{const e=this.resolve("site").getCore(),t=null==e?void 0:e.logger;t&&!t.rootLogger&&(this.twitch_logger=t,t.windowErrorListenerAdded&&(window.removeEventListener("error",t.onWindowError),window.addEventListener("error",t.onWindowError)))})}),this.raven=c.a;const t={autoBreadcrumbs:{console:!1},release:(window.FrankerFaceZ||window.FFZBridge).version_info.toString(),environment:r.DEBUG?"development":"production",captureUnhandledRejections:!1,ignoreErrors:["InvalidStateError","InvalidAccessError","out of memory","Access is denied.","Zugriff verweigert","freed script","ffzenhancing","dead object","Name Collision for Module","SourceBuffer","ChunkLoadError","SecurityError","QuotaExceededError","DataCloneError"],sanitizeKeys:[/Token$/],breadcrumbCallback(e){if("gql"===e.category)for(const t of f)if(e.message.includes(t))return!1;if("http"===e.type){const t=e.data.url;for(const e of d)if(t.includes(e))return!1}return!0},shouldSendCallback:e=>{var t;if(this.settings&&!this.settings.get("reports.error.enable"))return e.tags&&e.tags.example&&this.__example_waiter&&(this.__example_waiter(null),this.__example_waiter=null),!1;const i=e.exception&&e.exception.values[0];if(e.message&&e.message.includes("raven-js/")||i&&JSON.stringify(i).includes("raven-js/"))return!1;if(i&&i.type.startsWith("NS_"))return!1;if(!document.body||!document.body.querySelector)return!1;if(this.settings&&this.settings.get("reports.error.include-user")){var n;const t=null===(n=this.resolve("site"))||void 0===n?void 0:n.getUser();t&&(e.user={id:t.id,username:t.login})}return e.extra=Object.assign(this.buildExtra(),e.extra),e.tags=Object.assign(this.buildTags(),e.tags),e.exception&&Array.isArray(e.exception.values)&&(e.exception.values=this.rewriteStack(e.exception.values,e)),e.culprit&&(e.culprit=fix_url(e.culprit)),e.tags.example?(this.__example_waiter&&(this.__example_waiter(e),this.__example_waiter=null),!1):!r.DEBUG&&(null===(t=this.resolve("addons"))||void 0===t?!0:!t.has_dev)}};r.DEBUG||(t.whitelistUrls=[/api\.frankerfacez\.com/,/cdn\.frankerfacez\.com/]),c.a.config(r.SENTRY_ID,t).install()}generateLog(){return this.raven&&this.raven._breadcrumbs?this.raven._breadcrumbs.map(e=>{const t=s()(e.timestamp).locale("en").format("H:mm:ss");if("http"==e.type)return`[${t}] HTTP | ${e.category}: ${e.data.method} ${e.data.url} -> ${e.data.status_code}`;let i="LOG";return e.category&&e.category.includes("ui.")&&(i="UI"),`[${t}] ${i}${e.level?`:${e.level}`:""} | ${e.category}: ${e.message}${e.data?`\n    ${JSON.stringify(e.data)}`:""}`}).map(e=>("string"!=typeof e&&(e=`${e}`),e.replace(u,"$1REDACTED$2"))).join("\n"):"No breadcrumbs to log."}onEnable(){this.log.info("Installed error tracking.")}rewriteStack(e){for(const t of e)if(t&&t.stacktrace&&t.stacktrace.frames)for(const e of t.stacktrace.frames)e.filename=fix_url(e.filename);return e}buildExtra(){const e={},t={},i={},n={},s={experiments:i,twitch_experiments:n,modules:e,addons:t};for(const t in this.__modules)if(Object(o.has)(this.__modules,t)){const i=this.__modules[t];e[t]=`${i.loaded?"loaded":i.loading?"loading":"unloaded"} ${i.enabled?"enabled":i.enabling?"enabling":"disabled"}`}if(this.settings&&this.settings.get("reports.error.include-settings")){const e=this.settings.main_context,t=this.resolve("chat"),i=t&&t.context,n=s.settings={},r=s.chat_setting=i?{}:void 0;for(const[t,i]of e.__cache.entries())n[t]=i;if(i)for(const[e,t]of i.__cache.entries())r[e]=t}const r=this.resolve("addons");if(r&&Array.isArray(r.enabled_addons)&&r.addons)for(const e of r.enabled_addons){const i=r.addons[e];i&&(t[e]=`${i.version||"unknown"}${i.dev?"-dev":""}`)}const a=this.resolve("experiments");if(a){for(const[e,t]of Object.entries(a.getTwitchExperiments()))a.usingTwitchExperiment(e)&&(n[t.name]=a.getTwitchAssignment(e));for(const e of Object.keys(a.experiments))i[e]=a.getAssignment(e)}return s}buildTags(){var e,t,n;const s=null===(e=this.resolve("site"))||void 0===e?void 0:e.getCore(),r={};return r.flavor=null===(t=this.site)||void 0===t?void 0:t.constructor.name,r.build=i.h,r.git_commit="3cbe4ee2fc110a051c90aab08d4c3974b8003b53",window.BetterTTV&&(r.bttv_version=null===(n=window.BetterTTV)||void 0===n?void 0:n.version),s&&(r.twitch_build=s.config.buildID),r}addPlugin(...e){return this.raven.addPlugin(...e)}captureException(e,t){return this.raven.captureException(e,t)}captureMessage(e,t){return this.raven.captureMessage(e,t)}captureBreadcrumb(...e){return this.raven.captureBreadcrumb(...e)}}},function(e,t,i){"use strict";i.d(t,"a",(function(){return SettingsContext}));var n=i(5),s=i(0),r=i(25);function compare_requirements(e,t,i){if(!e||!Array.isArray(e.requires))return!1;for(const n of e.requires){const e=i.get(n),r=t.get(n);if(typeof e!=typeof r)return!0;if(Array.isArray(e)&&Array.isArray(r)){if(!Object(s.array_equals)(r,e))return!0}else if(r instanceof Set&&e instanceof Set){if(!Object(s.set_equals)(r,e))return!0}else if(r instanceof Map&&e instanceof Map){if(!Object(s.map_equals)(r,e))return!0}else if(r!==e)return!0}return!1}class SettingsContext extends n.EventEmitter{constructor(e,t){super(),e instanceof SettingsContext?(this.parent=e,this.manager=e.manager,this.parent.on("context_changed",this._rebuildContext,this)):(this.parent=null,this.manager=e),this.manager.__contexts.push(this),this._context=t||{},this.__cache=new Map,this.__meta=new Map,this.__profiles=[],this.order=[],this._rebuildContext()}destroy(){this.parent&&this.parent.off("context_changed",this._rebuildContext,this);for(const e of this.__profiles)e.off("changed",this._onChanged,this);const e=this.manager.__contexts,t=e.indexOf(this);-1!==t&&e.splice(t,1)}_rebuildContext(){this.__context=this.parent?Object.assign({},this.parent.__context||this.parent._context,this._context):this._context,this.selectProfiles()||this.rebuildCache(),this.emit("context_changed")}selectProfiles(){const e=[],t=this.order=[];for(const i of this.manager.__profiles)i.toggled&&i.matches(this.__context)&&(e.push(i),t.push(i.id));if(Object(s.array_equals)(this.__profiles,e))return!1;const i=new Set;for(const t of this.__profiles)e.includes(t)||(t.off("changed",this._onChanged,this),i.add(t.id));for(const t of e)this.__profiles.includes(t)||(t.on("changed",this._onChanged,this),i.add(t.id));return this.__profiles=e,this.emit("profiles_changed"),this.rebuildCache(i),!0}rebuildCache(){const e=this.__cache,t=this.__meta,i=this.__meta=new Map;this.__cache=new Map;for(const[n,r]of e){const o=this.get(n),a=i.get(n),l=t.get(n),c=a?a.uses:null,u=l?l.uses:null,h=this.manager.definitions.get(n);let d=!1;h&&h.equals?"requirements"===h.equals?d=compare_requirements(h,this.__cache,e):"function"==typeof h.equals&&(d=!h.equals(o,r,this.__cache,e)):Array.isArray(o)&&Array.isArray(r)?d=!Object(s.array_equals)(o,r):o instanceof Set&&r instanceof Set?d=!Object(s.set_equals)(o,r):o instanceof Map&&r instanceof Map?d=!Object(s.map_equals)(o,r):o!==r&&(d=!0),d&&(this.emit("changed",n,o,r),this.emit(`changed:${n}`,o,r)),Object(s.array_equals)(c,u)||(this.emit("uses_changed",n,c,u),this.emit(`uses_changed:${n}`,c,u))}}context(e){return new SettingsContext(this,e)}updateContext(e){let t=!1;for(const i in e)Object(s.has)(e,i)&&e[i]!==this._context[i]&&(this._context[i]=e[i],t=!0);t&&this._rebuildContext()}setContext(e){this._context_objects=new Set,this._context={},this.updateContext(e)}_onChanged(e){this._update(e,e,[])}_update(e,t,i){if(!this.__cache.has(e))return;if(i.includes(e))throw new Error(`cyclic dependent chain when updating setting "${t}"`);i.push(e);const n=this.__cache.get(e),r=this.__meta.get(e),o=this._get(e,e,[]),a=this.__meta.get(e),l=r?r.uses:null,c=a?a.uses:null;if(Object(s.array_equals)(c,l)||(this.emit("uses_changed",e,c,l),this.emit(`uses_changed:${e}`,c,l)),n===o)return;this.emit("changed",e,o,n),this.emit(`changed:${e}`,o,n);const u=this.manager.definitions.get(e);if(u&&u.required_by)for(const e of u.required_by)e.startsWith("context.")||this._update(e,t,Array.from(i))}_get(e,t,i){if(i.includes(e))throw new Error(`cyclic dependency when resolving setting "${t}"`);i.push(e);const n=this.manager.definitions.get(e),s=n&&n.type,o=s?r[s]:r.basic;if(!o)throw new Error(`non-existent setting type "${s}"`);const a=this._getRaw(e,o),l={uses:a?a[1]:null};let c=a?a[0]:void 0;if(n){if(Array.isArray(n))throw new Error(`non-existent setting "${e}" required when resolving setting "${t}"`);if(null===l.uses){const e=n.default;c="function"==typeof e?e(this):e,o.default&&(c=o.default(c,n,this.manager.log))}if(n.requires)for(const e of n.requires)e.startsWith("context.")||this.__cache.has(e)||this._get(e,t,Array.from(i));n.process&&(c=n.process(this,c,l))}return this.__cache.set(e,c),this.__meta.set(e,l),c}*profiles(){for(const e of this.__profiles)yield e}hasProfile(e){if("number"==typeof e)for(const t of this.__profiles)if(t.id===e)return!0;return this.__profiles.includes(e)}_getRaw(e,t){if(!t)throw new Error(`non-existent type for ${e}`);return t.get(e,this.profiles(),this.manager.definitions.get(e),this.manager.log)}update(e){this._update(e,e,[])}get(e){return e.startsWith("context.")?Object(s.get)(e.slice(8),this.__context):this.__cache.has(e)?this.__cache.get(e):this._get(e,e,[])}uses(e){return e.startsWith("context.")?null:(this.__meta.has(e)||this._get(e,e,[]),this.__meta.get(e).uses)}}},function(e,t,i){"use strict";i.d(t,"a",(function(){return MigrationManager}));class MigrationManager{constructor(e){this.manager=e,this.provider=e.provider}process(){throw new Error("Not Implemented")}}},function(e,t,i){"use strict";const n=/\s/,s=(e.exports=function Parser(e){if(!(this instanceof Parser))return new Parser(e);this.opts=Object.assign({OPEN:"{",CLOSE:"}",SEP:",",SUB_VAR:"#",ESCAPE:"'",OFFSET:"offset:",subnumeric_types:["plural","selectordinal"],submessage_types:["plural","selectordinal","select"]},e)}).prototype;function expected(e,t,i){return"object"==typeof t&&(i=t.i,t=t.msg[i]),new SyntaxError(`expected ${e} at position ${i} but found ${t||"eof"}`)}function unexpected(e,t){return new SyntaxError(`unexpected ${e} at position ${t}`)}function skipSpace(e){const t=e.msg,i=t.length;for(;e.i<i&&n.test(t[e.i]);)e.i++}s.parse=function(e){return this.parseAST({msg:String(e),i:0},null)},s.parseAST=function(e,t){const i=e.msg,n=this.opts,s=i.length,r=t&&n.subnumeric_types.includes(t.t),o=[];for(;e.i<s;){const s=e.i,a=i[s];if(a===n.CLOSE){if(!t)throw unexpected(a,e.i);break}if(a===n.OPEN||r&&a===n.SUB_VAR){const i=this.parseElement(e,t);i&&o.push(i)}else{const i=this.parseText(e,t);i&&o.push(i)}if(e.i===s)throw unexpected(a,e.i)}return o},s.parseText=function(e,t,i=!0,s=!0){const r=e.msg,o=this.opts,a=r.length,l=t&&o.subnumeric_types.includes(t.t);let c="";for(;e.i<a;){const t=r[e.i];if(t===o.OPEN||t===o.CLOSE||!i&&t===o.SEP||!s&&n.test(t)||l&&t===o.SUB_VAR)break;if(t===o.ESCAPE){let n=r[++e.i];if(n===o.ESCAPE)c+=n,e.i++;else if(n===o.OPEN||n===o.CLOSE||l&&n===o.SUB_VAR||!s||!i)for(c+=n;++e.i<a;)if(n=r[e.i],n===o.ESCAPE){if(n=r[e.i+1],n!==o.ESCAPE){e.i++;break}c+=n,e.i++}else c+=n;else c+=t}else e.i++,c+=t}return c},s.parseElement=function(e,t){const i=e.msg,n=this.opts,s=t&&n.subnumeric_types.includes(t.t);let r=i[e.i];if(s&&r===n.SUB_VAR)return e.i++,{v:t.v};if(r!==n.OPEN)throw expected(n.OPEN,r,e.i);e.i++,skipSpace(e);const o=this.parseText(e,null,!1,!1);if(!o)throw expected("placeholder id",r,e.i);const a={v:o};if(skipSpace(e),r=i[e.i],r===n.CLOSE)return e.i++,a;if(r!==n.SEP)throw expected(`${n.SEP} or ${n.CLOSE}`,r,e.i);e.i++,skipSpace(e);const l=this.parseText(e,null,!1,!1);if(!l)throw expected("type",e);if(a.t=l,skipSpace(e),r=i[e.i],r===n.CLOSE){if(n.submessage_types.includes(a.t))throw expected("sub-messages",e);return e.i++,a}if(r!==n.SEP)throw expected(`${n.SEP} or ${n.CLOSE}`,r,e.i);if(e.i++,skipSpace(e),n.subnumeric_types.includes(a.t)){const t=this.parseOffset(e);t&&(a.f=t,skipSpace(e))}if(n.submessage_types.includes(a.t)){const t=this.parseSubmessages(e,a);if(!t.other)throw expected("other sub-message",e);a.o=t}else{const t=this.parseText(e,null,!0,!0);if(!t)throw expected("format",e);a.f=t.trimRight()}if(skipSpace(e),r=i[e.i],r!==n.CLOSE)throw expected(n.CLOSE,r,e.i);return e.i++,a},s.parseSubmessages=function(e,t){const i=e.msg,n=i.length,s={};for(;e.i<n;){if(i[e.i]===this.opts.CLOSE)break;const n=this.parseText(e,null,!0,!1);if(!n)throw expected("sub-message selector",e);skipSpace(e),s[n]=this.parseSubmessage(e,t),skipSpace(e)}return s},s.parseSubmessage=function(e,t){const i=e.msg,n=this.opts;if(i[e.i]!==n.OPEN)throw expected(n.OPEN,e);e.i++;const s=this.parseAST(e,t);if(i[e.i]!==n.CLOSE)throw expected(n.CLOSE,e);return e.i++,s},s.parseOffset=function(e){const t=e.msg,i=this.opts.OFFSET,n=t.length;if(t.slice(e.i,e.i+i.length)!==i)return;e.i+=i.length,skipSpace(e);const s=e.i;for(;e.i<n&&/\d/.test(t[e.i]);)e.i++;if(s===e.i)throw expected("number",e);return+t.slice(s,e.i)}},function(e,t,i){"use strict";i.r(t),i.d(t,"ALIASES",(function(){return o})),i.d(t,"ICONS",(function(){return a})),i.d(t,"load",(function(){return load})),i.d(t,"maybeLoad",(function(){return maybeLoad}));var n=i(1),s=i(125),r=i.n(s);const o={ban:["ban","block"],ok:["ok","unban","untimeout"],"clock-o":["clock-o","clock","timeout"],times:["remove","close","times"],cog:["gear","cog"],repeat:["rotate-right","repeat"],outdent:["dedent","outdent"],"picture-o":["photo","image","picture-o"],"pencil-square-o":["edit","pencil-square-o"],share:["mail-forward","share"],"exclamation-triangle":["warning","exclamation-triangle"],"bar-chart":["bar-chart-o","bar-chart"],cogs:["gears","cogs"],facebook:["facebook-f","facebook"],rss:["feed","rss"],users:["group","users"],link:["chain","link"],scissors:["cut","scissors"],"files-o":["copy","files-o"],"floppy-o":["save","floppy-o"],bars:["navicon","reorder","bars"],sort:["unsorted","sort"],"sort-desc":["sort-down","sort-desc"],"sort-asc":["sort-up","sort-asc"],undo:["rotate-left","undo"],gavel:["legal","gavel"],tachometer:["dashboard","tachometer"],bolt:["flash","bolt"],clipboard:["paste","clipboard"],mobile:["mobile-phone","mobile"],reply:["mail-reply","reply"],"reply-all":["mail-reply-all","reply-all"],"star-half-o":["star-half-empty","star-half-full","star-half-o"],"chain-broken":["unlink","chain-broken"],"caret-square-o-down":["toggle-down","caret-square-o-down"],"caret-square-o-up":["toggle-up","caret-square-o-up"],"caret-square-o-right":["toggle-right","caret-square-o-right"],eur:["euro","eur"],usd:["dollar","usd"],inr:["rupee","inr"],jpy:["cny","rmb","yen","jpy"],rub:["ruble","rouble","rub"],krw:["won","krw"],btc:["bitcoin","btc"],gratipay:["gittip","gratipay"],"caret-square-o-left":["toggle-left","caret-square-o-left"],try:["turkish-lira","try"],university:["institution","bank","university"],"graduation-cap":["mortar-board","graduation-cap"],car:["automobile","car"],taxi:["cab","taxi"],"file-image-o":["file-photo-o","file-picture-o","file-image-o"],"file-archive-o":["file-zip-o","file-archive-o"],"file-audio-o":["file-sound-o","file-audio-o"],"file-video-o":["file-movie-o","file-video-o"],"life-ring":["life-bouy","life-buoy","life-saver","support","life-ring"],rebel:["ra","resistance","rebel"],empire:["ge","empire"],"hacker-news":["y-combinator-square","yc-square","hacker-news"],weixin:["wechat","weixin"],"paper-plane":["send","paper-plane"],"paper-plane-o":["send-o","paper-plane-o"],"futbol-o":["soccer-ball-o","futbol-o"],ils:["shekel","sheqel","ils"],transgender:["intersex","transgender"],bed:["hotel","bed"],"y-combinator":["yc","y-combinator"],"battery-full":["battery-4","battery","battery-full"],"battery-three-quarters":["battery-3","battery-three-quarters"],"battery-half":["battery-2","battery-half"],"battery-quarter":["battery-1","battery-quarter"],"battery-empty":["battery-0","battery-empty"],"hourglass-start":["hourglass-1","hourglass-start"],"hourglass-half":["hourglass-2","hourglass-half"],"hourglass-end":["hourglass-3","hourglass-end"],"hand-rock-o":["hand-grab-o","hand-rock-o"],"hand-paper-o":["hand-stop-o","hand-paper-o"],television:["tv","television"],"american-sign-language-interpreting":["asl-interpreting","american-sign-language-interpreting"],deaf:["deafness","hard-of-hearing","deaf"],"sign-language":["signing","sign-language"],"google-plus-official":["google-plus-circle","google-plus-official"],"font-awesome":["fa","font-awesome"],"address-card":["vcard","address-card"],"address-card-o":["vcard-o","address-card-o"],"id-card":["drivers-license","id-card"],"id-card-o":["drivers-license-o","id-card-o"],"thermometer-full":["thermometer-4","thermometer","thermometer-full"],"thermometer-three-quarters":["thermometer-3","thermometer-three-quarters"],"thermometer-half":["thermometer-2","thermometer-half"],"thermometer-quarter":["thermometer-1","thermometer-quarter"],"thermometer-empty":["thermometer-0","thermometer-empty"],bath:["bathtub","s15","bath"],"window-close":["times-rectangle","window-close"],"window-close-o":["times-rectangle-o","window-close-o"]},a=["glass","music","search","envelope-o","heart","star","star-o","user","film","th-large","th","th-list","check","times","search-plus","search-minus","power-off","signal","cog","trash-o","home","file-o","clock-o","road","download","arrow-circle-o-down","arrow-circle-o-up","inbox","play-circle-o","repeat","refresh","list-alt","lock","flag","headphones","volume-off","volume-down","volume-up","qrcode","barcode","tag","tags","book","bookmark","print","camera","font","bold","italic","text-height","text-width","align-left","align-center","align-right","align-justify","list","outdent","indent","video-camera","picture-o","pencil","map-marker","adjust","tint","pencil-square-o","share-square-o","check-square-o","arrows","step-backward","fast-backward","backward","play","pause","stop","forward","fast-forward","step-forward","eject","chevron-left","chevron-right","plus-circle","minus-circle","times-circle","check-circle","question-circle","info-circle","crosshairs","times-circle-o","check-circle-o","ban","arrow-left","arrow-right","arrow-up","arrow-down","share","expand","compress","plus","minus","asterisk","exclamation-circle","gift","leaf","fire","eye","eye-slash","exclamation-triangle","plane","calendar","random","comment","magnet","chevron-up","chevron-down","retweet","shopping-cart","folder","folder-open","arrows-v","arrows-h","bar-chart","twitter-square","facebook-square","camera-retro","key","cogs","comments","thumbs-o-up","thumbs-o-down","star-half","heart-o","sign-out","linkedin-square","thumb-tack","external-link","sign-in","trophy","github-square","upload","lemon-o","phone","square-o","bookmark-o","phone-square","twitter","facebook","github","unlock","credit-card","rss","hdd-o","bullhorn","bell","certificate","hand-o-right","hand-o-left","hand-o-up","hand-o-down","arrow-circle-left","arrow-circle-right","arrow-circle-up","arrow-circle-down","globe","wrench","tasks","filter","briefcase","arrows-alt","users","link","cloud","flask","scissors","files-o","paperclip","floppy-o","square","bars","list-ul","list-ol","strikethrough","underline","table","magic","truck","pinterest","pinterest-square","google-plus-square","google-plus","money","caret-down","caret-up","caret-left","caret-right","columns","sort","sort-desc","sort-asc","envelope","linkedin","undo","gavel","tachometer","comment-o","comments-o","bolt","sitemap","umbrella","clipboard","lightbulb-o","exchange","cloud-download","cloud-upload","user-md","stethoscope","suitcase","bell-o","coffee","cutlery","file-text-o","building-o","hospital-o","ambulance","medkit","fighter-jet","beer","h-square","plus-square","angle-double-left","angle-double-right","angle-double-up","angle-double-down","angle-left","angle-right","angle-up","angle-down","desktop","laptop","tablet","mobile","circle-o","quote-left","quote-right","spinner","circle","reply","github-alt","folder-o","folder-open-o","smile-o","frown-o","meh-o","gamepad","keyboard-o","flag-o","flag-checkered","terminal","code","reply-all","star-half-o","location-arrow","crop","code-fork","chain-broken","question","info","exclamation","superscript","subscript","eraser","puzzle-piece","microphone","microphone-slash","shield","calendar-o","fire-extinguisher","rocket","maxcdn","chevron-circle-left","chevron-circle-right","chevron-circle-up","chevron-circle-down","html5","css3","anchor","unlock-alt","bullseye","ellipsis-h","ellipsis-v","rss-square","play-circle","ticket","minus-square","minus-square-o","level-up","level-down","check-square","pencil-square","external-link-square","share-square","compass","caret-square-o-down","caret-square-o-up","caret-square-o-right","eur","gbp","usd","inr","jpy","rub","krw","btc","file","file-text","sort-alpha-asc","sort-alpha-desc","sort-amount-asc","sort-amount-desc","sort-numeric-asc","sort-numeric-desc","thumbs-up","thumbs-down","youtube-square","youtube","xing","xing-square","youtube-play","dropbox","stack-overflow","instagram","flickr","adn","bitbucket","bitbucket-square","tumblr","tumblr-square","long-arrow-down","long-arrow-up","long-arrow-left","long-arrow-right","apple","windows","android","linux","dribbble","skype","foursquare","trello","female","male","gratipay","sun-o","moon-o","archive","bug","vk","weibo","renren","pagelines","stack-exchange","arrow-circle-o-right","arrow-circle-o-left","caret-square-o-left","dot-circle-o","wheelchair","vimeo-square","try","plus-square-o","space-shuttle","slack","envelope-square","wordpress","openid","university","graduation-cap","yahoo","google","reddit","reddit-square","stumbleupon-circle","stumbleupon","delicious","digg","pied-piper-pp","pied-piper-alt","drupal","joomla","language","fax","building","child","paw","spoon","cube","cubes","behance","behance-square","steam","steam-square","recycle","car","taxi","tree","spotify","deviantart","soundcloud","database","file-pdf-o","file-word-o","file-excel-o","file-powerpoint-o","file-image-o","file-archive-o","file-audio-o","file-video-o","file-code-o","vine","codepen","jsfiddle","life-ring","circle-o-notch","rebel","empire","git-square","git","hacker-news","tencent-weibo","qq","weixin","paper-plane","paper-plane-o","history","circle-thin","header","paragraph","sliders","share-alt","share-alt-square","bomb","futbol-o","tty","binoculars","plug","slideshare","twitch","yelp","newspaper-o","wifi","calculator","paypal","google-wallet","cc-visa","cc-mastercard","cc-discover","cc-amex","cc-paypal","cc-stripe","bell-slash","bell-slash-o","trash","copyright","at","eyedropper","paint-brush","birthday-cake","area-chart","pie-chart","line-chart","lastfm","lastfm-square","toggle-off","toggle-on","bicycle","bus","ioxhost","angellist","cc","ils","meanpath","buysellads","connectdevelop","dashcube","forumbee","leanpub","sellsy","shirtsinbulk","simplybuilt","skyatlas","cart-plus","cart-arrow-down","diamond","ship","user-secret","motorcycle","street-view","heartbeat","venus","mars","mercury","transgender","transgender-alt","venus-double","mars-double","venus-mars","mars-stroke","mars-stroke-v","mars-stroke-h","neuter","genderless","facebook-official","pinterest-p","whatsapp","server","user-plus","user-times","bed","viacoin","train","subway","medium","y-combinator","optin-monster","opencart","expeditedssl","battery-full","battery-three-quarters","battery-half","battery-quarter","battery-empty","mouse-pointer","i-cursor","object-group","object-ungroup","sticky-note","sticky-note-o","cc-jcb","cc-diners-club","clone","balance-scale","hourglass-o","hourglass-start","hourglass-half","hourglass-end","hourglass","hand-rock-o","hand-paper-o","hand-scissors-o","hand-lizard-o","hand-spock-o","hand-pointer-o","hand-peace-o","trademark","registered","creative-commons","gg","gg-circle","tripadvisor","odnoklassniki","odnoklassniki-square","get-pocket","wikipedia-w","safari","chrome","firefox","opera","internet-explorer","television","contao","500px","amazon","calendar-plus-o","calendar-minus-o","calendar-times-o","calendar-check-o","industry","map-pin","map-signs","map-o","map","commenting","commenting-o","houzz","vimeo","black-tie","fonticons","reddit-alien","edge","credit-card-alt","codiepie","modx","fort-awesome","usb","product-hunt","mixcloud","scribd","pause-circle","pause-circle-o","stop-circle","stop-circle-o","shopping-bag","shopping-basket","hashtag","bluetooth","bluetooth-b","percent","gitlab","wpbeginner","wpforms","envira","universal-access","wheelchair-alt","question-circle-o","blind","audio-description","volume-control-phone","braille","assistive-listening-systems","american-sign-language-interpreting","deaf","glide","glide-g","sign-language","low-vision","viadeo","viadeo-square","snapchat","snapchat-ghost","snapchat-square","pied-piper","first-order","yoast","themeisle","google-plus-official","font-awesome","handshake-o","envelope-open","envelope-open-o","linode","address-book","address-book-o","address-card","address-card-o","user-circle","user-circle-o","user-o","id-badge","id-card","id-card-o","quora","free-code-camp","telegram","thermometer-full","thermometer-three-quarters","thermometer-half","thermometer-quarter","thermometer-empty","shower","bath","podcast","window-maximize","window-minimize","window-restore","window-close","window-close-o","bandcamp","grav","etsy","imdb","ravelry","eercast","microchip","snowflake-o","superpowers","wpexplorer","meetup"];let l=!1;const load=()=>{l||(l=!0,document.head.appendChild(Object(n.createElement)("link",{href:r.a,rel:"stylesheet",type:"text/css",crossOrigin:"anonymous"})))},maybeLoad=e=>{l||!String(e).startsWith("fa-")&&!String(e).startsWith("ffz-fa")||load()}},function(e,t,i){"use strict";i.d(t,"a",(function(){return TranslationManager})),i.d(t,"b",(function(){return transformPhrase}));var n=i(39),s=i.n(n),r=i(2),o=i(0),a=i(3),l=i(89);const c="https://api-test.frankerfacez.com",u=/\s*at\s+(.+?)\s+\((.+)\)$/,h=/^(.+):\/\/(.+?)(?:\?[a-zA-Z0-9]+)?:(\d+:\d+)$/,d={filter:e=>e.includes(".frankerfacez.com")||e.includes("localhost"),cacheGlobally:!0},f=["/src/i18n.js","/src/utilities/vue.js"],p=["(`)",";;w;;","owo","ono","oAo","oxo","ovo;","UwU",">w<","^w^","> w >","v.v"],transformText=(e,t)=>e.map(e=>{if("string"==typeof e)return t(e);if("object"==typeof e&&e.o){const i=Object.assign(e,{o:{}});for(const n of Object.keys(e.o))i.o[n]=transformText(e.o[n],t)}return e}),owo=e=>e.replace(/(?:r|l)/g,"w").replace(/(?:R|L)/g,"W").replace(/n([aeiou])/g,"ny$1").replace(/N([aeiou])/g,"Ny$1").replace(/N([AEIOU])/g,"NY$1").replace(/ove/g,"uv").replace(/!+/g,` ${Object(o.pick_random)(p)} `),g={double:(e,t)=>[...t," ",...t],upper:(e,t)=>transformText(t,e=>e.toUpperCase()),lower:(e,t)=>transformText(t,e=>e.toLowerCase()),append_key:(e,t)=>[...t,` (${e})`],set_key:e=>[e],owo:(e,t)=>transformText(t,owo)};class TranslationManager extends a.default{constructor(...e){super(...e),this.inject("settings"),this.parser=new s.a,this._seen=new Set,this.availableLocales=["en"],this.localeData={en:{name:"English"}},this.loadLocales(),this.strings_loaded=!1,this.new_strings=0,this.changed_strings=0,this.capturing=!1,this.captured=new Map,this.settings.addUI("i18n.debug.open",{path:"Debugging > Localization >> Editing",component:"i18n-open",force_seen:!0}),this.settings.add("i18n.debug.capture",{default:null,process:(e,t)=>null===t?r.DEBUG:t,ui:{path:"Debugging > Localization >> General",title:"Enable message capture.",description:"Capture all localized strings, including variables and call locations, for the purpose of reporting them to the backend. This is used to add new strings to the translation project. By default, message capture is enabled when running in development mode.",component:"setting-check-box",force_seen:!0},changed:e=>{this.capturing=e}}),this.settings.add("i18n.debug.transform",{default:null,ui:{path:"Debugging > Localization >> General",title:"Transformation",description:"Transform all localized strings to test string coverage as well as length.",component:"setting-select-box",data:[{value:null,title:"Disabled"},{value:"upper",title:"Upper Case"},{value:"lower",title:"Lower Case"},{value:"append_key",title:"Append Key"},{value:"set_key",title:"Set to Key"},{value:"double",title:"Double"},{value:"owo",title:"owo what's this"}]},changed:e=>{this._.transformation=g[e],this.emit(":transform"),this.emit(":update")}}),this.settings.add("i18n.locale",{default:-1,process:(e,t)=>{if(-1!==t&&"string"==typeof t||(t=e.get("context.session.languageCode")||"en"),this.availableLocales.includes(t))return t;const i=t.indexOf("-");return-1===i?"en":(t=t.slice(0,i),this.availableLocales.includes(t)?t:"en")},ui:{path:"Appearance > Localization >> General",title:"Language",description:"FrankerFaceZ is lovingly translated by volunteers from our community. Thank you. If you're interested in helping to translate FrankerFaceZ, please [join our Discord](https://discord.gg/UrAkGhT) and ask about localization.",component:"setting-select-box",data:(e,t)=>this.getLocaleOptions(t)},changed:e=>this.locale=e})}getLocaleOptions(e){void 0===e&&(e=this.settings.get("i18n.locale"));const t=this.availableLocales.map(t=>{const i=this.localeData[t];let n=null==i?void 0:i.native_name;return n||(n=(null==i?void 0:i.name)||t),null!=(null==i?void 0:i.coverage)&&(null==i?void 0:i.coverage)<100&&(n=this.t("i18n.locale-coverage","{name} ({coverage,number,percent} Complete)",{name:n,coverage:i.coverage/100})),{selected:e===t,value:t,title:n}});return t.sort((e,t)=>e.title.localeCompare(t.title)),t.unshift({selected:-1===e,value:-1,i18n_key:"setting.appearance.localization.general.language.twitch",title:"Use Twitch's Language"}),t}onEnable(){if(this.capturing=this.settings.get("i18n.debug.capture"),this.capturing&&this.loadStrings(),this._=new l.default({warn:(...e)=>this.log.warn(...e)}),window.BroadcastChannel){(this._broadcaster=new BroadcastChannel("ffz-i18n")).addEventListener("message",this._boundHandleMessage=this.handleMessage.bind(this))}this._.transformation=g[this.settings.get("i18n.debug.transform")],this.locale=this.settings.get("i18n.locale")}broadcast(e){this._broadcaster&&this._broadcaster.postMessage(e)}getKeys(){const e=[];for(const t of this.captured.values()){const i=Object(o.deep_copy)(t);i.translation=this._.phrases.get(i.key)||i.phrase,e.push(i)}return e}requestKeys(){this.broadcast({type:"request-keys"})}updatePhrase(e,t){this.broadcast({type:"update-key",key:e,phrase:t}),this._.extend({[e]:t}),this.emit(":loaded",[e]),this.emit(":update")}handleMessage(e){const t=e.data;if(t)if("update-key"===t.type)this._.extend({[t.key]:t.phrase}),this.emit(":loaded",[t.key]),this.emit(":update");else if("request-keys"===t.type)this.broadcast({type:"keys",data:Array.from(this.captured.values())});else if("keys"===t.type&&Array.isArray(t.data)){for(const e of t.data)this.captured.set(e.key,e);this.emit(":got-keys")}}openUI(e=!0){this.capturing||(this.capturing=!0,this.emit(":update"));const t=this.resolve("translation_ui");e?t.openPopout():t.enable()}get locale(){return this._.locale}set locale(e){this.setLocale(e)}async loadStrings(e=!1){if(this.strings_loaded&&!e)return;if(this.strings_loading)return;this.strings_loading=!0;const loadPage=async e=>{const t=await fetch(`${c}/v2/i18n/strings?page=${e}`);if(!t.ok)return this.log.warn(`Error Loading Strings -- Status: ${t.status}`),{next:!1,strings:[]};const i=await t.json();return{next:(null==i?void 0:i.pages)>e,strings:(null==i?void 0:i.strings)||[]}};let t=1,i=!0,n=[];for(;i;){const e=await loadPage(t++);n=n.concat(e.strings),i=e.next}for(const e of n){var s;const t=e.id;let i=this.captured.get(t);var r;if(!i)this.captured.set(t,i={key:t,phrase:e.default,hits:0,calls:[]}),(null===(r=e.source)||void 0===r?void 0:r.length)&&i.calls.push(e.source);if(!i.options&&(null===(s=e.context)||void 0===s?void 0:s.length))try{i.options=JSON.parse(e.context)}catch(e){}i.known=e.default,i.different=e.default!==i.phrase}this.new_strings=0,this.changed_strings=0;for(const e of this.captured.values())e.known||this.new_strings++,e.different&&this.changed_strings++;this.strings_loaded=!0,this.strings_loading=!1,this.log.info(`Loaded ${n.length} strings from the server.`),this.emit(":strings-loaded"),this.emit(":new-strings",this.new_strings),this.emit(":changed-strings",this.changed_strings)}see(e,t,n){if(!this.capturing)return;let s;try{s=(new Error).stack}catch(e){try{s=e.stack}catch(e){}}let r=this.captured.get(e);r||(this.captured.set(e,r={key:e,phrase:t,hits:0,calls:[]}),this.strings_loaded&&(this.new_strings++,this.emit(":new-strings",this.new_strings))),t!==r.phrase&&(r.phrase=t,r.known&&t!==r.known&&!r.different&&(r.different=!0,this.changed_strings++,this.emit(":changed-strings",this.changed_strings))),r.options=this.pluckVariables(e,n),r.hits++,s&&(this.mapStackTrace?this.mapStackTrace(s,e=>this.recordCall(r,e),d):i.e(141).then(i.t.bind(null,176,7)).then(e=>{this.mapStackTrace=e.mapStackTrace,this.mapStackTrace(s,e=>this.recordCall(r,e),d)}))}pluckVariables(e,t){const i=this._.cache.get(e);if(!i)return null;const n={};return this._doPluck(i,t,n),Object.keys(n).length?n:null}_doPluck(e,t,i){if(Array.isArray(e))for(const n of e)this._doPluck(n,t,i);else"object"==typeof e&&e.v&&(i[e.v]=Object(o.shallow_copy)(Object(o.get)(e.v,t)))}recordCall(e,t){if(Array.isArray(t))for(const i of t){const t=u.exec(i);if(!t)continue;const n=h.exec(t[2]);if(!n||"webpack"!==n[1])continue;const s=n[2];if(s.includes("/node_modules/")||f.includes(s))continue;let r;if("MainMenu.getSettingsTree"===t[1])r="FFZ Control Center";else{let e=t[1];("Proxy.render"===e||e.startsWith("Proxy.push"))&&n[2].includes(".vue")&&(e="Vue Component"),r=`${e} (${n[2]}:${n[3]})`}return void(e.calls.includes(r)||e.calls.push(r))}}async loadLocales(){const e=await fetch(`${c}/v2/i18n/locales`);if(!e.ok)throw this.log.warn(`Error Populating Locales -- Status: ${e.status}`),new Error(`http error ${e.status} loading locales`);let t=await e.json();Array.isArray(t)&&t.length||(t=[{id:"en",name:"English",coverage:100,rtl:!1}]),this.localeData={},this.availableLocales=[];for(const e of t){const t=e.id.toLowerCase();this.localeData[t]=e,this.availableLocales.push(t)}this.emit(":locales-loaded")}async loadLocale(e){if("en"===e)return{};const t=await fetch(`${c}/v2/i18n/locale/${e}`);if(!t.ok){if(404===t.status)return this.log.info(`Cannot Load Locale: ${e}`),{};throw this.log.warn(`Cannot Load Locale: ${e} -- Status: ${t.status}`),new Error(`http error ${t.status} loading phrases`)}const i=await t.json();return null==i?void 0:i.phrases}async setLocale(e){const t=this._.locale;if(e===t)return[];if(await this.loadDayjsLocale(e),this._.locale=e,this._.clear(),this.log.info(`Changed Locale: ${e} -- Old: ${t}`),this.emit(":changed",e,t),this.emit(":update"),"en"===e)return this.emit(":loaded",[]),[];const i=this.localeData[e],n=await this.loadLocale((null==i?void 0:i.id)||e);if(this._.locale!==e)throw new Error("locale has changed since we started loading");const s=this._.extend(n);return s.length&&(this.log.info(`Loaded Locale: ${e} -- Phrases: ${s.length}`),this.emit(":loaded",s),this.emit(":update")),s}async loadDayjsLocale(e){if("en"!==e)try{await i(144)(`./${e}.js`)}catch(t){this.log.warn(`Unable to load day.js locale data for locale "${e}"`,t)}}has(e){return this._.has(e)}formatNode(...e){return this._.formatNode(...e)}toLocaleString(...e){return this._.toLocaleString(...e)}toRelativeTime(...e){return this._.formatRelativeTime(...e)}formatNumber(...e){return this._.formatNumber(...e)}formatDate(...e){return this._.formatDate(...e)}formatTime(...e){return this._.formatTime(...e)}formatDateTime(...e){return this._.formatDateTime(...e)}t(e,...t){return this.see(e,...t),this._.t(e,...t)}tList(e,...t){return this.see(e,...t),this._.tList(e,...t)}}const m=/\$/g,_=String.prototype.replace;function transformPhrase(e,t,i,n,s){const r=Array.isArray(e);if(null==t)return r?e[0]:e;let a=e;const l="number"==typeof t?{count:t}:t;return r&&(a=a[0]),"string"==typeof a&&(a=_.call(a,n,(e,t,n)=>{let r=Object(o.get)(t,l);if(null==r)return"";const a=s[n];return"function"==typeof a?r=a(r,i,l):"string"==typeof r&&(r=_.call(r,m,"$$")),r})),a}},function(e,t,i){"use strict";i.d(t,"a",(function(){return User}));var n=i(0);class User{constructor(e,t,i,s){this.manager=e,this.room=t,this.emote_sets=new n.SourcedSet,this.badges=new n.SourcedSet,this._id=i,this.login=s,i&&((t||e).user_ids[i]=this)}destroy(){if(this.destroyed=!0,this.emote_sets){for(const e of this.emote_sets._cache)this.manager.emotes.unrefSet(e);this.emote_sets=null}const e=this.room||this.manager;e&&(this._login&&e.users&&e.users[this._login]===this&&(e.users[this._login]=null),e.user_ids&&e.user_ids[this._id]===this&&(e.user_ids[this._id]=null))}merge(e){if(!this.login&&e.login&&(this.login=e.login),e.emote_sets&&e.emote_sets._sources)for(const[t,i]of e.emote_sets._sources.entries())for(const e of i)this.addSet(t,e);if(e.badges&&e.badges._sources)for(const[t,i]of e.badges._sources.entries())for(const e of i)this.addBadge(t,e.id,e)}get id(){return this._id}get login(){return this._login}set login(e){if(this._login===e)return;const t=this.room||this.manager;if(this._login){t.users[this._login]===this&&(t.users[this._login]=null)}if(this._login=e,!e)return;const i=t.users[e];i&&i!==this&&(i.login=null),this._login=e,t.users[e]=this}addBadge(e,t,i){if(i?i.id=t:i={id:t},this.badges.has(e))for(const n of this.badges.get(e))if(n.id==t)return Object.assign(n,i),!1;return this.badges.push(e,i),!0}getBadge(e){for(const t of this.badges._cache)if(t.id==e)return t}removeBadge(e,t){if(!this.badges.has(e))return!1;for(const i of this.badges.get(e))if(i.id==t)return this.badges.remove(e,i),!0}addSet(e,t){if(!this.destroyed)return this.emote_sets.sourceIncludes(e,t)?void 0:(this.emote_sets.push(e,t),this.manager.emotes.refSet(t),this.manager.emotes.emit(":update-user-sets",this,e,t,!0),!0)}removeSet(e,t){this.destroyed||this.emote_sets.sourceIncludes(e,t)&&(this.emote_sets.remove(e,t),this.manager.emotes.unrefSet(t),this.manager.emotes.emit(":update-user-sets",this,e,t,!1))}}},function(e,t,i){"use strict";function isAutomaticReward(e){return"CommunityPointsAutomaticReward"===(null==e?void 0:e.__typename)}function isHighlightedReward(e){return isAutomaticReward(e)&&"SEND_HIGHLIGHTED_MESSAGE"===e.type}function getRewardCost(e){return isAutomaticReward(e)?e.cost||e.defaultCost:e.cost}function getRewardTitle(e,t){if(function isCustomReward(e){return"CommunityPointsCustomReward"===(null==e?void 0:e.__typename)}(e))return e.title;switch(e.type){case"SEND_HIGHLIGHTED_MESSAGE":return t.t("chat.points.highlighted","Highlight My Message");case"SINGLE_MESSAGE_BYPASS_SUB_MODE":return t.t("chat.points.bypass-sub","Send a Message in Sub-Only Mode");case"CHOSEN_SUB_EMOTE_UNLOCK":return t.t("chat.points.choose-emote","Choose an Emote to Unlock");case"RANDOM_SUB_EMOTE_UNLOCK":return t.t("chat.points.random-emote","Unlock a Random Sub Emote");case"CHOSEN_MODIFIED_SUB_EMOTE_UNLOCK":return t.t("chat.points.modify-emote","Modify a Single Emote");default:return t.t("chat.points.reward","Reward")}}i.d(t,"c",(function(){return isHighlightedReward})),i.d(t,"a",(function(){return getRewardCost})),i.d(t,"b",(function(){return getRewardTitle}))},function(e,t,i){"use strict";i.r(t),i.d(t,"open_url",(function(){return s})),i.d(t,"chat",(function(){return r})),i.d(t,"msg_delete",(function(){return o})),i.d(t,"ban",(function(){return a})),i.d(t,"timeout",(function(){return l})),i.d(t,"unban",(function(){return c})),i.d(t,"untimeout",(function(){return u})),i.d(t,"whisper",(function(){return h}));var n=i(1);const s={presets:[{appearance:{type:"icon",icon:"ffz-i-link-ext"}}],defaults:{url:"https://link.example/{{user.login}}"},editor:()=>i.e(134).then(i.bind(null,328)),title:"Open URL",description:"{options.url}",tooltip(e){const t=this.replaceVariables(e.options.url,e);return[Object(n.createElement)("div",{class:"tw-border-b tw-mg-b-05"},this.i18n.t("chat.actions.open_url","Open URL")),Object(n.createElement)("div",{class:"tw-align-left"},t)]},click(e,t){const i=this.replaceVariables(t.options.url,t),n=window.open();n&&(n.opener=null,n.location=i)}},r={presets:[{appearance:{type:"text",text:"C"}}],required_context:["room"],defaults:{command:"@{{user.login}} HeyGuys",paste:!1},title:"Chat Command",description:"{options.command}",editor:()=>i.e(134).then(i.bind(null,329)),tooltip(e){const t=this.replaceVariables(e.options.command,e);return[Object(n.createElement)("div",{class:"tw-border-b tw-mg-b-05"},this.i18n.t("chat.actions.chat","Chat Command")),Object(n.createElement)("div",{class:"tw-align-left"},t)]},click(e,t){const i=this.replaceVariables(t.options.command,t);t.options.paste?this.pasteMessage(t.room.login,i):this.sendMessage(t.room.login,i)}},o={presets:[{appearance:{type:"icon",icon:"ffz-i-trash"},display:{mod:!0,mod_icons:!0}}],defaults:{},required_context:["room","user","message"],title:"Delete Message",tooltip(e){return this.i18n.t("chat.actions.delete.tooltip","Delete {user.login}'s message",{user:e.user})},click(e,t){this.sendMessage(t.room.login,`/delete ${t.message_id}`)}},a={presets:[{appearance:{type:"icon",icon:"ffz-i-block"},display:{mod:!0,mod_icons:!0}}],defaults:{},required_context:["room","user"],uses_reason:!0,editor:()=>i.e(134).then(i.bind(null,330)),title:"Ban User",reason_text(e){return this.i18n.t("chat.actions.ban-reason","Ban {user.login} for:",{user:e.user})},tooltip(e){return this.i18n.t("chat.actions.ban.tooltip","Ban {user.login}",{user:e.user})},click(e,t){let i=t.reason||t.options.reason||"";i.length&&(i=this.replaceVariables(i,t)),this.sendMessage(t.room.login,`/ban ${t.user.login} ${i}`)}},l={presets:[{appearance:{type:"icon",icon:"ffz-i-clock"},display:{mod:!0,mod_icons:!0}}],defaults:{duration:600},required_context:["room","user"],uses_reason:!0,editor:()=>i.e(134).then(i.bind(null,331)),title:"Timeout User",description:"{options.duration,number} second{options.duration,en_plural}",reason_text(e){return this.i18n.t("chat.actions.timeout-reason","Timeout {user.login} for {duration,number} second{duration,en_plural} for:",{user:e.user,duration:e.options.duration})},tooltip(e){return this.i18n.t("chat.actions.timeout.tooltip","Timeout {user.login} for {duration,number} second{duration,en_plural}",{user:e.user,duration:e.options.duration})},click(e,t){let i=t.reason||t.options.reason||"";i.length&&(i=this.replaceVariables(i,t)),this.sendMessage(t.room.login,`/timeout ${t.user.login} ${t.options.duration} ${i}`)}},c={presets:[{appearance:{type:"icon",icon:"ffz-i-ok"},display:{mod:!0,mod_icons:!0}}],required_context:["room","user"],title:"Unban User",tooltip(e){return this.i18n.t("chat.actions.unban.tooltip","Unban {user.login}",{user:e.user})},click(e,t){this.sendMessage(t.room.login,`/unban ${t.user.login}`)}},u={presets:[{appearance:{type:"icon",icon:"ffz-i-ok"},display:{mod:!0,mod_icons:!0}}],required_context:["room","user"],title:"Untimeout User",tooltip(e){return this.i18n.t("chat.actions.untimeout.tooltip","Untimeout {user.login}",{user:e.user})},click(e,t){this.sendMessage(t.room.login,`/untimeout ${t.user.login}`)}},h={presets:[{appearance:{type:"text",text:"W"}}],required_context:["user"],title:"Whisper User",tooltip(e){return this.i18n.t("chat.actions.whisper.tooltip","Whisper {user.login}",e)},click(e,t){const i=this.resolve("site"),n=i&&i.getUser(),s=i&&i.store;if(!(n&&s&&t.user&&t.user.id&&n.id!=t.user.id))return;const r=parseInt(n.id,10),o=parseInt(t.user.id,10),a=r<o?`${r}_${o}`:`${o}_${r}`;s.dispatch({type:"whispers.THREAD_OPENED",data:{threadID:a,collapsed:!1}})}}},function(e,t,i){"use strict";i.r(t),i.d(t,"text",(function(){return s})),i.d(t,"icon",(function(){return r})),i.d(t,"combo",(function(){return o})),i.d(t,"image",(function(){return a}));var n=i(40);const s={title:"Text",title_i18n:"setting.actions.appearance.text",colored:!0,editor:()=>i.e(134).then(i.bind(null,332)),component:()=>i.e(134).then(i.bind(null,333)),render:(e,t,i)=>t("span",{style:{color:i}},e.text)},r={title:"Icon",title_i18n:"setting.actions.appearance.icon",colored:!0,editor:()=>i.e(134).then(i.bind(null,334)),load:e=>(e.icon&&e.icon.startsWith("ffz-fa")&&Object(n.load)(),!0),component:()=>i.e(134).then(i.bind(null,335)),render:(e,t,i)=>t("figure",{style:{color:i},class:`${e.icon||"ffz-i-zreknarf"}`})},o={title:"Text and Icon",title_i18n:"setting.actions.appearance.combo",colored:!0,editor:()=>i.e(134).then(i.bind(null,336)),load:e=>(e.icon&&e.icon.startsWith("ffz-fa")&&Object(n.load)(),!0),component:()=>i.e(134).then(i.bind(null,337)),render:(e,t,i)=>t("span",{style:{color:i},class:e.icon},e.text)},a={title:"Image",title_i18n:"setting.actions.appearance.image",editor:()=>i.e(134).then(i.bind(null,338)),component:()=>i.e(134).then(i.bind(null,339)),render:(e,t)=>t("figure",{class:"mod-icon__image"},t("img",{src:e.image}))}},function(e,t,i){"use strict";i.r(t),i.d(t,"Links",(function(){return c})),i.d(t,"Mentions",(function(){return u})),i.d(t,"UserHighlights",(function(){return h})),i.d(t,"BlockedUsers",(function(){return d})),i.d(t,"BadgeHighlights",(function(){return f})),i.d(t,"BlockedBadges",(function(){return p})),i.d(t,"CustomHighlights",(function(){return g})),i.d(t,"BlockedTerms",(function(){return m})),i.d(t,"AutomoddedTerms",(function(){return b})),i.d(t,"CheerEmotes",(function(){return v})),i.d(t,"AddonEmotes",(function(){return y})),i.d(t,"Emoji",(function(){return w})),i.d(t,"TwitchEmotes",(function(){return k}));var n=i(1),s=i(0),r=i(2);const o="chat-image chat-line__message--emote",a=/([^\w@#%\-+=:~])?((?:(https?:\/\/)?(?:[\w@#%\-+=:~]+\.)+[a-z]{2,6}(?:\/[\w./@#%&()\-+=:?~]*)?))([^\w./@#%&()\-+=:?~]|\s|$)/g,l=/^(['"*([{<\\/]*)(@)((?:[^\u0000-\u007F]|[\w-])+)(?:\b|$)/,c={type:"link",priority:50,component:()=>i.e(143).then(i.bind(null,170)),render:(e,t)=>t("a",{class:"ffz-tooltip link-fragment","data-tooltip-type":"link","data-url":e.url,"data-is-mail":e.is_mail,rel:"noopener noreferrer",target:"_blank",href:e.url},e.text),tooltip(e,t){return this.context.get("tooltip.rich-links")||e.dataset.forceTooltip?"true"===e.dataset.isMail?[this.i18n.t("tooltip.email-link","E-Mail {address}",{address:e.textContent})]:this.get_link_info(e.dataset.url).then(e=>{if(!e||(e.v||1)>4)return"";let i=e.content||e.html||"";if(e.urls&&e.urls.length>1&&(i+=(i.length?"<hr>":"")+Object(n.sanitize)(this.i18n.t("tooltip.link-destination","Destination: {url}",{url:e.urls[e.urls.length-1][1]}))),e.unsafe){const t=Array.from(new Set(e.urls.map(e=>e[2]).filter(e=>e))).join(", ");i=this.i18n.t("tooltip.link-unsafe","Caution: This URL is on Google's Safe Browsing List for: {reasons}",{reasons:Object(n.sanitize)(t.toLowerCase())})+(i.length?`<hr>${i}`:"")}return this.context.get("tooltip.link-images")&&(e.image_safe||this.context.get("tooltip.link-nsfw-images"))?(e.image&&!e.image_iframe&&(i=`<img class="preview-image" src="${Object(n.sanitize)(e.image)}">${i}`),setTimeout(()=>{if(t.element){for(const e of t.element.querySelectorAll("img"))e.addEventListener("load",t.update);for(const e of t.element.querySelectorAll("video"))e.addEventListener("loadedmetadata",t.update)}})):i.length&&(i=i.replace(/<!--MS-->.*<!--ME-->/g,"")),e.tooltip_class&&t.element.classList.add(e.tooltip_class),i}).catch(e=>Object(n.sanitize)(this.i18n.t("tooltip.error","An error occurred. ({error})",{error:e}))):""},process(e){if(!e||!e.length)return e;const t=[];for(const i of e){if("text"!==i.type){t.push(i);continue}a.lastIndex=0;const e=i.text;let n,s=0;for(;n=a.exec(e);){const i=n.index+(n[1]?n[1].length:0);s!==i&&t.push({type:"text",text:e.slice(s,i)});const r=!n[3]&&-1===n[2].indexOf("/")&&-1!==n[2].indexOf("@");t.push({type:"link",url:(n[3]?"":r?"mailto:":"https://")+n[2],is_mail:r,text:n[2]}),s=i+n[2].length}s<e.length&&t.push({type:"text",text:e.slice(s)})}return t}};c.tooltip.interactive=function(e){if(!this.context.get("tooltip.rich-links")||!this.context.get("tooltip.link-interaction")||"true"===e.dataset.isMail)return!1;const t=this.get_link_info(e.dataset.url,!0);return t&&t.interactive},c.tooltip.delayHide=function(e){return this.context.get("tooltip.rich-links")&&this.context.get("tooltip.link-interaction")&&"true"!==e.dataset.isMail?64:0};const u={type:"mention",priority:0,component:()=>i.e(143).then(i.bind(null,171)),oldRender:(e,t)=>t("strong",{class:`chat-line__message-mention${e.me?" ffz--mention-me":""}`},e.text),render(e,t){return t("strong",{class:`chat-line__message-mention${e.me?" ffz--mention-me":""}`,"data-login":e.recipient,onClick:this.handleMentionClick},e.text)},process(e,t,i){if(!e||!e.length)return e;const n=i&&i.login&&i.login==t.user.login&&!this.context.get("chat.filtering.process-own");let s,r,o,a=!1;i&&i.login&&!n?(r=i.login.toLowerCase(),o=i.displayName&&i.displayName.toLowerCase(),o===r&&(o=null),a=!0,s=new RegExp(`^(['"*([{<\\/]*)(?:(@?)(${i.login.toLowerCase()}${o?`|${o}`:""})|@((?:[^\0-]|[\\w-])+))(?:\\b|$)`,"i")):s=l;const c=[];for(const i of e){if("text"!==i.type){c.push(i);continue}let e=[];for(const n of i.text.split(/ +/)){const i=s.exec(n);if(i){(e.length||i[1])&&(c.push({type:"text",text:`${e.join(" ")} ${i[1]||""}`}),e=[]);let s,r=!1,o=i[2];i[4]?(s=i[4],o="@"):(s=i[3],r=a),c.push({type:"mention",text:`${o}${s}`,me:r,recipient:s?s.toLowerCase():""}),r&&(t.mentioned=!0),e.push(n.substr(i[0].length))}else e.push(n)}(e.length>1||1===e.length&&""!==e[0])&&c.push({type:"text",text:e.join(" ")})}return c}},h={type:"user_highlight",priority:90,process(e,t,i){if(i&&i.login&&i.login==t.user.login&&!this.context.get("chat.filtering.process-own"))return e;const n=this.context.get("chat.filtering.highlight-basic-users--color-regex");if(!n||!n.size)return e;const s=t.user;for(const[i,r]of n)if((r.test(s.login)||r.test(s.displayName))&&(t.mentioned=!0,i))return t.mention_color=i,e;return e}},d={type:"user_block",priority:100,process(e,t,i){if(i&&i.login&&i.login==t.user.login&&!this.context.get("chat.filtering.process-own"))return e;const n=t.user,s=this.context.get("chat.filtering.highlight-basic-users-blocked--regex");return s?(s[1]&&(s[1].test(n.login)||s[1].test(n.displayName))&&(t.deleted=!0,t.ffz_removed=!0),!t.deleted&&s[0]&&(s[0].test(n.login)||s[0].test(n.displayName))&&(t.deleted=!0),e):e}},f={type:"badge_highlight",priority:80,process(e,t,i){if(i&&i.login&&i.login==t.user.login&&!this.context.get("chat.filtering.process-own"))return e;const n=t.badges;if(!n)return e;const s=this.context.get("chat.filtering.highlight-basic-badges--colors");if(!s||!s.size)return e;for(const i of Object.keys(n))if(s.has(i)){const n=s.get(i);if(t.mentioned=!0,n)return t.mention_color=n,e}return e}},p={type:"badge_block",priority:100,process(e,t,i){if(i&&i.login&&i.login==t.user.login&&!this.context.get("chat.filtering.process-own"))return e;const n=t.badges;if(!n)return e;const s=this.context.get("chat.filtering.highlight-basic-badges-blocked--list");if(!s||!s[0].length&&!s[1].length)return e;for(const i of Object.keys(n)){if(s[1].includes(i))return t.deleted=!0,t.ffz_removed=!0,e;!t.deleted&&s[0].includes(i)&&(t.deleted=!0)}return e}},g={type:"highlight",priority:35,component:()=>i.e(143).then(i.bind(null,172)),render:(e,t)=>t("strong",{class:"ffz--highlight"},e.text),process(e,t,i){if(!e||!e.length)return e;if(i&&i.login&&i.login==t.user.login&&!this.context.get("chat.filtering.process-own"))return e;const n=this.context.get("chat.filtering.highlight-basic-terms--color-regex");if(!n||!n.size)return e;for(const[i,s]of n){const n=[];for(const r of e){if("text"!==r.type){n.push(r);continue}s.lastIndex=0;const e=r.text;let o,a=0;for(;o=s.exec(e);){const s=o.index,r=o[1]?o[1].length:0,l=s+r;a!==l&&n.push({type:"text",text:e.slice(a,l)}),t.mentioned=!0,t.mention_color=i||t.mention_color,n.push({type:"highlight",text:o[0].slice(r)}),a=s+o[0].length}a<e.length&&n.push({type:"text",text:e.slice(a)})}e=n}return e}};function blocked_process(e,t,i,n){const s=[];for(const r of e){if("text"!==r.type){s.push(r);continue}i.lastIndex=0;const e=r.text;let o,a=0;for(;o=i.exec(e);){const i=o.index,r=o[1]?o[1].length:0,l=i+r;a!==l&&s.push({type:"text",text:e.slice(a,l)}),s.push({type:"blocked",text:o[0].slice(r)}),n&&(t.ffz_removed=!0),a=i+o[0].length}a<e.length&&s.push({type:"text",text:e.slice(a)})}return s}const m={type:"blocked",priority:99,component:()=>i.e(143).then(i.bind(null,173)),render(e,t){return t("strong",{"data-text":e.text,"data-tooltip-type":"blocked",class:"ffz-tooltip ffz--blocked",onClick:this.clickToReveal},"")},tooltip(e){const t=e.dataset;return[Object(n.createElement)("div",{class:"tw-border-b tw-mg-b-05"},this.i18n.t("chat.filtering.blocked-term","Blocked Term")),t.text]},process(e,t,i){if(!e||!e.length)return e;if(i&&i.login&&i.login==t.user.login&&!this.context.get("chat.filtering.process-own"))return e;const n=this.context.get("chat.filtering.highlight-basic-blocked--regex");return n?(n[0]&&(e=blocked_process(e,t,n[0],!1)),n[1]&&(e=blocked_process(e,t,n[1],!0)),e):e}},_={A:"Hostility",I:"Discrimination",P:"Profanity",S:"Sexually Explicit Language"},b={type:"amterm",priority:99,component:()=>i.e(143).then(i.bind(null,174)),render(e,t){return t("strong",{"data-text":e.text,"data-categories":JSON.stringify(e.categories),"data-tooltip-type":"amterm",class:"ffz-tooltip ffz--blocked",onClick:this.clickToReveal},"")},tooltip(e){const t=e.dataset,i=[];let s;try{s=JSON.parse(t.categories);for(const e in s)s[e]&&_[e]&&i.push(this.i18n.t(`chat.filtering.automod.${e}`,_[e]))}catch(e){i.push("Parse Error")}return[Object(n.createElement)("div",{class:"tw-border-b tw-mg-b-05"},this.i18n.t("chat.filtering.automod-term","AutoMod Blocked Term")),this.i18n.t("chat.filtering.automod-why","This was flagged as: "),i.join(", ")]},process(e,t){if(!(e&&e.length&&t.flags&&Array.isArray(t.flags.list)))return e;const i=t.flags.preferences,n=t.flags.list.filter(e=>{if(!e||null==e.startIndex||null==e.endIndex)return!1;const t=e.categories;if(!t)return!1;for(const e in t)if(t[e]&&i[e])return!0}),r=n.length;if(!r)return e;const o=[];let a=0,l=0;const c=this.context.get("chat.automod.remove-messages");if(this.context.get("chat.automod.delete-messages")&&(t.deleted=!0),c)return t.ffz_removed=!0,e;for(const t of e){const e=a,i=a+(t.length||t.text&&Object(s.split_chars)(t.text).length||0);if("text"!==t.type){o.push(t),a=i;continue}const c=Object(s.split_chars)(t.text);for(;l<r;){const s=n[l],r=s.startIndex,u=s.endIndex+1;if(u<e){l++;continue}if(r>i){o.push(t),a=i;break}r>a&&o.push({type:"text",text:c.slice(a-e,r-e).join("")});let h=r-e;if(h<0&&(h=0),o.push({type:"amterm",categories:s.categories,text:c.slice(h,u-e).join("")}),u>i){a=i;break}a=u,l++}a<i&&(e===a?o.push(t):o.push({type:"text",text:c.slice(a-e).join("")}),a=i)}return o}},v={type:"cheer",priority:40,component:()=>i.e(143).then(i.bind(null,175)),render(e,t){return t("span",{class:"ffz-cheer ffz-tooltip","data-tooltip-type":"cheer","data-prefix":e.prefix,"data-amount":this.i18n.formatNumber(e.amount),"data-tier":e.tier,"data-individuals":JSON.stringify(e.individuals||null),alt:e.text})},tooltip(e){const t=e.dataset,i=parseInt(t.amount.replace(/,/g,""),10),s=t.prefix,r=t.tier,o=t.individuals&&JSON.parse(t.individuals),a=o&&o.length,l=[this.context.get("tooltip.emote-images")&&Object(n.createElement)("div",{class:"preview-image ffz-cheer-preview","data-prefix":s,"data-tier":r}),this.i18n.t("tooltip.bits","{count,number} Bits",i)];if(a>1){l.push(Object(n.createElement)("br",null)),o.sort(e=>-e[0]);for(let e=0;e<a&&e<12;e++){const[t,i,s]=o[e];l.push(this.tokenizers.cheer.render.call(this,{amount:t,prefix:s,tier:i},n.createElement))}a>12&&(l.push(Object(n.createElement)("br",null)),l.push(this.i18n.t("tooltip.bits.more","(and {count} more)",a-12)))}return l},process(e,t){if(!e||!e.length||!t.bits)return e;const i=this.getRoom(t.roomID,t.roomLogin,!0),n=i&&i.bitsConfig;if(!n)return e;const r=new RegExp(`^(${Object.keys(n).join("|")})(\\d+)$`,"i"),o=[],a={},l=this.context.get("chat.bits.stack");for(const t of e){if(!t||"text"!==t.type){o.push(t);continue}let e=[];for(const i of t.text.split(/ +/)){const t=r.exec(i);if(t){const s=t[1].toLowerCase(),r=n[s];if(!r){e.push(i);continue}const c=parseInt(t[2],10),u=r.tiers;let h,d;for(let e=0,t=u.length;e<t;e++)if(c>=u[e].amount){h=e;break}if(e.length&&(o.push({type:"text",text:`${e.join(" ")} `}),e=[]),o.push(d={type:"cheer",prefix:s,tier:h,amount:c,text:t[0]}),l){let e=2===l?"cheer":s;n[e]||(e=s);const t=a[e]=a[e]||{total:0,individuals:[]};t.total+=c,t.individuals.push([c,h,s]),d.hidden=!0}e.push("")}else e.push(i)}(e.length>1||1===e.length&&""!==e[0])&&o.push({type:"text",text:e.join(" ")})}if(l)for(const e in a)if(Object(s.has)(a,e)){const t=a[e],i=n[e].tiers;let s=0;for(let e=i.length;s<e&&!(t.total>=i[s].amount);s++);o.unshift({type:"cheer",prefix:e,tier:s,amount:t.total,individuals:t.individuals,length:0})}return o}},render_emote=(e,t,i)=>{const n=e.modifiers||[],s=n.length,r=t("img",{class:`${o} ffz-tooltip${"ffz"===e.provider?" ffz-emote":"emoji"===e.provider?" ffz-emoji":""}`,attrs:{src:e.src,srcSet:e.srcSet,alt:e.text,"data-tooltip-type":"emote","data-provider":e.provider,"data-id":e.id,"data-set":e.set,"data-code":e.code,"data-variant":e.variant,"data-modifiers":s?n.map(e=>e.id).join(" "):null,"data-modifier-info":s?JSON.stringify(n.map(e=>[e.set,e.id])):null}});return s?t("div",{class:"ffz--inline modified-emote",attrs:{"data-test-selector":"emote-button","data-provider":e.provider,"data-id":e.id,"data-set":e.set,"data-modifiers":s?n.map(e=>e.id).join(" "):null}},[r,n.map(e=>t("span",{key:e.text},render_emote(e,t,!0)))]):i?r:t("div",{className:"ffz--inline",attrs:{"data-test-selector":"emote-button"}},[r])},y={type:"emote",priority:10,component:{functional:!0,render:(e,{props:t})=>render_emote(t.token,e)},render(e,t,i){const n=e.modifiers||[],s=n.length,r=t("img",{class:`${o} ffz-tooltip${"ffz"===e.provider?" ffz-emote":"emoji"===e.provider?" ffz-emoji":""}`,src:e.src,srcSet:e.srcSet,alt:e.text,"data-tooltip-type":"emote","data-provider":e.provider,"data-id":e.id,"data-set":e.set,"data-code":e.code,"data-variant":e.variant,"data-modifiers":s?n.map(e=>e.id).join(" "):null,"data-modifier-info":s?JSON.stringify(n.map(e=>[e.set,e.id])):null,onClick:this.emotes.handleClick});return s?t("div",{class:"ffz--inline modified-emote","data-test-selector":"emote-button","data-provider":e.provider,"data-id":e.id,"data-set":e.set,"data-modifiers":s?n.map(e=>e.id).join(" "):null,onClick:this.emotes.handleClick},r,n.map(e=>t("span",{key:e.text},this.tokenizers.emote.render.call(this,e,t,!0)))):i?r:t("div",{class:"ffz--inline","data-test-selector":"emote-button"},r)},async tooltip(e,t){const i=e.dataset,s=i.provider,o=i.modifierInfo;let a,l,c,u,h,d,f,p=!1;const g="true"===i.noSource;if(o&&"null"!==o&&(h=JSON.parse(o).map(([e,t])=>{const i=this.emotes.emote_sets[e],s=i&&i.emotes[t];if(s)return Object(n.createElement)("span",{class:"tw-mg-05"},this.tokenizers.emote.render.call(this,s.token,n.createElement),` - ${s.hidden?"???":s.name}`)})),"twitch"===s){f=i.id;const e=g?null:await this.emotes.getTwitchEmoteSet(f),t=null!=e&&await this.emotes.getTwitchSetChannel(e);if(l=`${r.TWITCH_EMOTE_BASE}${i.id}/3.0?_=preview`,d="twitch",t){var m;const e=t.type;if(e===r.EmoteTypes.Global)c=this.i18n.t("emote.global","Twitch Global");else if(e===r.EmoteTypes.BitsTier){var _;c=this.i18n.t("emote.bits","Twitch Bits Reward"),(null===(_=t.owner)||void 0===_?void 0:_.login)&&(c=this.i18n.t("emote.bits-owner","{source}\nChannel: {channel}",{source:c,channel:t.owner.displayName||t.owner.login}))}else e===r.EmoteTypes.Prime||e===r.EmoteTypes.Turbo?c=this.i18n.t("emote.prime","Twitch Prime"):e===r.EmoteTypes.LimitedTime?c=this.i18n.t("emote.limited","Limited-Time Only Emote"):e===r.EmoteTypes.ChannelPoints?c=this.i18n.t("emote.points","Channel Points Emote"):e===r.EmoteTypes.Subscription&&(null===(m=t.owner)||void 0===m?void 0:m.login)&&(c=this.i18n.t("tooltip.channel","Channel: {source}",{source:t.owner.displayName||t.owner.login}))}}else if("ffz"===s){const e=this.emotes.emote_sets[i.set],t=e&&e.emotes[i.id];e&&(c=e.source_line||`${e.source||"FFZ"} ${e.title||"Global"}`,d=e.source||"ffz"),t&&(f=t.id,t.owner&&(u=this.i18n.t("emote.owner","By: {owner}",{owner:t.owner.display_name})),t.urls[4]?l=t.urls[4]:t.urls[2]&&(l=t.urls[2]))}else{if("emoji"!==s)return;{const e=this.emoji.emoji[i.code],s=this.context.get("chat.emoji.style"),r=i.variant?e.variants[i.variant]:e,o=i.variant?this.emoji.emoji[i.variant]:null;d="emoji",f=i.code,l=Object(n.createElement)("img",{class:"preview-image ffz-emoji",src:this.emoji.getFullImage(r.image,s),srcSet:this.emoji.getFullImageSet(r.image,s),onLoad:t.update}),p=!0,a=`:${e.names[0]}:${o?`:${o.names[0]}:`:""}`;const u=e.category?this.i18n.t(`emoji.category.${e.category.toSnakeCase()}`,e.category):null;c=this.i18n.t("tooltip.emoji","Emoji - {category}",{category:u})}}a||(a=i.name||e.alt);const b=d&&this.emotes.isFavorite(d,f);return[l&&this.context.get("tooltip.emote-images")&&("string"==typeof l?Object(n.createElement)("img",{class:"preview-image",src:l,onLoad:t.update}):l),p||g&&!u?a:this.i18n.t("tooltip.emote","Emote: {name}",{name:a}),!g&&c&&this.context.get("tooltip.emote-sources")&&Object(n.createElement)("div",{class:"tw-pd-t-05"},c),u&&this.context.get("tooltip.emote-sources")&&Object(n.createElement)("div",{class:"tw-pd-t-05"},u),i.sellout&&Object(n.createElement)("div",{class:"tw-mg-t-05 tw-border-t tw-pd-t-05"},i.sellout),h&&Object(n.createElement)("div",{class:"tw-pd-t-1"},h),b&&Object(n.createElement)("figure",{class:"ffz--favorite ffz-i-star"})]},process(e,t){if(!e||!e.length)return e;const i=this.emotes.getEmotes(t.user.id,t.user.login,t.roomID,t.roomLogin),n=[];if(!i)return e;let r,o;for(const t of e){if(!t)continue;if("text"!==t.type){"emote"!==t.type||t.modifiers||(t.modifiers=[]),n.push(t),r=t;continue}let e=[];for(const a of t.text.split(/ +/))if(Object(s.has)(i,a)){if(o=i[a],o.modifier&&r&&r.modifiers&&(!e.length||1===e.length&&""===e[0])){-1===r.modifiers.indexOf(o.token)&&r.modifiers.push(o.token);continue}if(e.length){const t={type:"text",text:`${e.join(" ")} `};n.push(t),t.text.trim().length&&(r=t),e=[]}const t=Object.assign({modifiers:[]},o.token);n.push(t),r=t,e.push("")}else e.push(a);(e.length>1||1===e.length&&""!==e[0])&&n.push({type:"text",text:e.join(" ")})}return n}},w={type:"emoji",priority:15,process(e){if(!e||!e.length)return e;const t=this.emoji.splitter,i=this.context.get("chat.emoji.style"),n=[];if(0===i)return e;for(const r of e){if(!r)continue;if("text"!==r.type){n.push(r);continue}const e=r.text;t.lastIndex=0;let o,a=0;for(;o=t.exec(e);){const t=o.index,r=this.emoji.chars.get(o[0]);if(!r)continue;const l=this.emoji.emoji[r[0]],c=r[1]?l.variants[r[1]]:l,u=Object(s.split_chars)(o[0]).length;a!==t&&n.push({type:"text",text:e.slice(a,t)}),n.push({type:"emote",provider:"emoji",code:r[0],variant:r[1],src:this.emoji.getFullImage(c.image,i),srcSet:this.emoji.getFullImageSet(c.image,i),text:o[0],length:u,modifiers:[]}),a=t+o[0].length}a<e.length&&n.push({type:"text",text:e.slice(a)})}return n}},k={type:"twitch-emote",priority:20,process(e,t){if(!t.ffz_emotes)return e;const i=t.ffz_emotes,n=[];for(const e in i)if(Object(s.has)(i,e))for(const t of i[e])n.push([e,t.startIndex,t.endIndex+1]);const o=[],a=n.length;if(!a)return e;n.sort((e,t)=>e[1]!==t[1]?e[1]-t[1]:t[0]-e[0]);let l=0,c=0;for(const t of e){const e=l,i=l+(t.length||t.text&&Object(s.split_chars)(t.text).length||0);if("text"!==t.type){o.push(t),l=i;continue}const u=Object(s.split_chars)(t.text);for(;c<a;){const[s,a,h]=n[c];if(a>i||h>i){e===l?o.push(t):o.push({type:"text",text:u.slice(l-e).join("")}),a<i&&h>i&&c++,l=i;break}if(a<l){c++;continue}let d,f;a>l&&o.push({type:"text",text:u.slice(l-e,a-e).join("")});const p=r.REPLACEMENTS[s];p&&this.context.get("chat.fix-bad-emotes")?(d=`${r.REPLACEMENT_BASE}${p}`,f=""):(d=`${r.TWITCH_EMOTE_BASE}${s}/1.0`,f=`${r.TWITCH_EMOTE_BASE}${s}/1.0 1x, ${r.TWITCH_EMOTE_BASE}${s}/2.0 2x`),o.push({type:"emote",id:s,provider:"twitch",src:d,srcSet:f,text:u.slice(a-e,h-e).join(""),modifiers:[]}),l=h,c++}l<i&&(e===l?o.push(t):o.push({type:"text",text:u.slice(l-e).join("")}),l=i)}return o}}},function(e,t,i){"use strict";i.r(t),i.d(t,"Links",(function(){return u})),i.d(t,"Clips",(function(){return h})),i.d(t,"Videos",(function(){return d}));var n=i(133),s=i.n(n),r=i(134),o=i.n(r);const a=/^(?:https?:\/\/)?clips\.twitch\.tv\/(\w+)(?:\/)?(\w+)?(?:\/edit)?/,l=/^(?:https?:\/\/)?(?:www\.)?twitch\.tv\/\w+\/clip\/(\w+)/,c=/^(?:https?:\/\/)?(?:www\.)?twitch\.tv\/(?:\w+\/v|videos)\/(\w+)/,u={type:"link",hide_token:!1,priority:-10,test(e){return!(!this.context.get("chat.rich.all-links")&&!e.force_rich)&&"link"===e.type},process(e){return{card_tooltip:!0,url:e.url,timeout:0,getData:async()=>{let t;try{t=await this.get_link_info(e.url)}catch(t){return{url:e.url,title:this.i18n.t("card.error","An error occurred."),desc_1:String(t)}}return t?{url:e.url,image:this.context.get("tooltip.link-images")&&(t.image_safe||this.context.get("tooltip.link-nsfw-images"))?t.preview||t.image:null,title:t.title,desc_1:t.desc_1,desc_2:t.desc_2}:{url:e.url,title:this.i18n.t("card.error","An error occurred."),desc_1:this.i18n.t("card.empty","No data was returned.")}}}}},h={type:"clip",hide_token:!0,test:e=>"link"===e.type&&(a.test(e.url)||l.test(e.url)),process(e){let t=a.exec(e.url);t||(t=l.exec(e.url));const i=this.resolve("site.apollo");if(i&&t&&"create"!==t[1])return{url:e.url,getData:async()=>{const n=await i.client.query({query:s.a,variables:{slug:t[1]}});if(!(n&&n.data&&n.data.clip&&n.data.clip.broadcaster))return null;const r=n.data.clip,o=r.broadcaster.displayName,a=r.game,l=a&&a.name,c=a&&a.displayName;let u;return u="creative"===l?this.i18n.t("clip.desc.1.creative","{user} being Creative",{user:o}):a?this.i18n.t("clip.desc.1.playing","{user} playing {game}",{user:o,game:c}):this.i18n.t("clip.desc.1","Clip of {user}",{user:o}),{url:e.url,image:r.thumbnailURL,title:r.title,desc_1:u,desc_2:this.i18n.t("clip.desc.2","Clipped by {curator}  {views,number} View{views,en_plural}",{curator:r.curator?r.curator.displayName:this.i18n.t("clip.unknown","Unknown"),views:r.viewCount})}}}}},d={type:"video",hide_token:!0,test:e=>"link"===e.type&&c.test(e.url),process(e){const t=c.exec(e.url),i=this.resolve("site.apollo");if(i&&t)return{getData:async()=>{const n=await i.client.query({query:o.a,variables:{id:t[1]}});if(!(n&&n.data&&n.data.video&&n.data.video.owner))return null;const s=n.data.video,r=s.owner.displayName,a=s.game,l=a&&a.name,c=a&&a.displayName;let u;return u="creative"===l?this.i18n.t("clip.desc.1.creative","{user} being Creative",{user:r}):a?this.i18n.t("clip.desc.1.playing","{user} playing {game}",{user:r,game:c}):this.i18n.t("video.desc.1","Video of {user}",{user:r}),{url:e.url,image:s.previewThumbnailURL,title:s.title,desc_1:u,desc_2:this.i18n.t("video.desc.2","{length,duration}  {views,number} Views - {date,datetime}",{length:s.lengthSeconds,views:s.viewCount,date:s.publishedAt})}}}}}},,function(e,t,i){(function(t){var n=i(50),s=i(30),r=i(51),o=i(52),a=i(18),l=a.isErrorEvent,c=a.isDOMError,u=a.isDOMException,h=a.isError,d=a.isObject,f=a.isPlainObject,p=a.isUndefined,g=a.isFunction,m=a.isString,_=a.isArray,b=a.isEmptyObject,v=a.each,y=a.objectMerge,w=a.truncate,k=a.objectFrozen,C=a.hasKey,x=a.joinRegExp,S=a.urlencode,E=a.uuid4,F=a.htmlTreeAsString,O=a.isSameException,A=a.isSameStacktrace,j=a.parseUrl,T=a.fill,z=a.supportsFetch,M=a.supportsReferrerPolicy,D=a.serializeKeysForMessage,P=a.serializeException,N=a.sanitize,L=i(53).wrapMethod,R="source protocol user pass host port path".split(" "),$=/^(?:(\w+):)?\/\/(?:(\w+)(:\w+)?@)?([\w\.-]+)(?::(\d+))?(\/.*)/;function now(){return+new Date}var B="undefined"!=typeof window?window:void 0!==t?t:"undefined"!=typeof self?self:{},I=B.document,U=B.navigator;function keepOriginalCallback(e,t){return g(t)?function(i){return t(i,e)}:t}function Raven(){for(var e in this._hasJSON=!("object"!=typeof JSON||!JSON.stringify),this._hasDocument=!p(I),this._hasNavigator=!p(U),this._lastCapturedException=null,this._lastData=null,this._lastEventId=null,this._globalServer=null,this._globalKey=null,this._globalProject=null,this._globalContext={},this._globalOptions={release:B.SENTRY_RELEASE&&B.SENTRY_RELEASE.id,logger:"javascript",ignoreErrors:[],ignoreUrls:[],whitelistUrls:[],includePaths:[],headers:null,collectWindowErrors:!0,captureUnhandledRejections:!0,maxMessageLength:0,maxUrlLength:250,stackTraceLimit:50,autoBreadcrumbs:!0,instrument:!0,sampleRate:1,sanitizeKeys:[]},this._fetchDefaults={method:"POST",referrerPolicy:M()?"origin":""},this._ignoreOnError=0,this._isRavenInstalled=!1,this._originalErrorStackTraceLimit=Error.stackTraceLimit,this._originalConsole=B.console||{},this._originalConsoleMethods={},this._plugins=[],this._startTime=now(),this._wrappedBuiltIns=[],this._breadcrumbs=[],this._lastCapturedEvent=null,this._keypressTimeout,this._location=B.location,this._lastHref=this._location&&this._location.href,this._resetBackoff(),this._originalConsole)this._originalConsoleMethods[e]=this._originalConsole[e]}Raven.prototype={VERSION:"3.27.2",debug:!1,TraceKit:n,config:function(e,t){var i=this;if(i._globalServer)return this._logDebug("error","Error: Raven has already been configured"),i;if(!e)return i;var s=i._globalOptions;t&&v(t,(function(e,t){"tags"===e||"extra"===e||"user"===e?i._globalContext[e]=t:s[e]=t})),i.setDSN(e),s.ignoreErrors.push(/^Script error\.?$/),s.ignoreErrors.push(/^Javascript error: Script error\.? on line 0$/),s.ignoreErrors=x(s.ignoreErrors),s.ignoreUrls=!!s.ignoreUrls.length&&x(s.ignoreUrls),s.whitelistUrls=!!s.whitelistUrls.length&&x(s.whitelistUrls),s.includePaths=x(s.includePaths),s.maxBreadcrumbs=Math.max(0,Math.min(s.maxBreadcrumbs||100,100));var r={xhr:!0,console:!0,dom:!0,location:!0,sentry:!0},o=s.autoBreadcrumbs;"[object Object]"==={}.toString.call(o)?o=y(r,o):!1!==o&&(o=r),s.autoBreadcrumbs=o;var a={tryCatch:!0},l=s.instrument;return"[object Object]"==={}.toString.call(l)?l=y(a,l):!1!==l&&(l=a),s.instrument=l,n.collectWindowErrors=!!s.collectWindowErrors,i},install:function(){var e=this;return e.isSetup()&&!e._isRavenInstalled&&(n.report.subscribe((function(){e._handleOnErrorStackInfo.apply(e,arguments)})),e._globalOptions.captureUnhandledRejections&&e._attachPromiseRejectionHandler(),e._patchFunctionToString(),e._globalOptions.instrument&&e._globalOptions.instrument.tryCatch&&e._instrumentTryCatch(),e._globalOptions.autoBreadcrumbs&&e._instrumentBreadcrumbs(),e._drainPlugins(),e._isRavenInstalled=!0),Error.stackTraceLimit=e._globalOptions.stackTraceLimit,this},setDSN:function(e){var t=this._parseDSN(e),i=t.path.lastIndexOf("/"),n=t.path.substr(1,i);this._dsn=e,this._globalKey=t.user,this._globalSecret=t.pass&&t.pass.substr(1),this._globalProject=t.path.substr(i+1),this._globalServer=this._getGlobalServer(t),this._globalEndpoint=this._globalServer+"/"+n+"api/"+this._globalProject+"/store/",this._resetBackoff()},context:function(e,t,i){return g(e)&&(i=t||[],t=e,e={}),this.wrap(e,t).apply(this,i)},wrap:function(e,t,i){var n=this;if(p(t)&&!g(e))return e;if(g(e)&&(t=e,e=void 0),!g(t))return t;try{if(t.__raven__)return t;if(t.__raven_wrapper__)return t.__raven_wrapper__}catch(e){return t}function wrapped(){var s=[],r=arguments.length,o=!e||e&&!1!==e.deep;for(i&&g(i)&&i.apply(this,arguments);r--;)s[r]=o?n.wrap(e,arguments[r]):arguments[r];try{return t.apply(this,s)}catch(t){throw n._ignoreNextOnError(),n.captureException(t,e),t}}for(var s in t)C(t,s)&&(wrapped[s]=t[s]);return wrapped.prototype=t.prototype,t.__raven_wrapper__=wrapped,wrapped.__raven__=!0,wrapped.__orig__=t,wrapped},uninstall:function(){return n.report.uninstall(),this._detachPromiseRejectionHandler(),this._unpatchFunctionToString(),this._restoreBuiltIns(),this._restoreConsole(),Error.stackTraceLimit=this._originalErrorStackTraceLimit,this._isRavenInstalled=!1,this},_promiseRejectionHandler:function(e){this._logDebug("debug","Raven caught unhandled promise rejection:",e),this.captureException(e.reason,{mechanism:{type:"onunhandledrejection",handled:!1}})},_attachPromiseRejectionHandler:function(){return this._promiseRejectionHandler=this._promiseRejectionHandler.bind(this),B.addEventListener&&B.addEventListener("unhandledrejection",this._promiseRejectionHandler),this},_detachPromiseRejectionHandler:function(){return B.removeEventListener&&B.removeEventListener("unhandledrejection",this._promiseRejectionHandler),this},captureException:function(e,t){if(t=y({trimHeadFrames:0},t||{}),l(e)&&e.error)e=e.error;else{if(c(e)||u(e)){var i=e.name||(c(e)?"DOMError":"DOMException"),s=e.message?i+": "+e.message:i;return this.captureMessage(s,y(t,{stacktrace:!0,trimHeadFrames:t.trimHeadFrames+1}))}if(h(e))e=e;else{if(!f(e))return this.captureMessage(e,y(t,{stacktrace:!0,trimHeadFrames:t.trimHeadFrames+1}));t=this._getCaptureExceptionOptionsFromPlainObject(t,e),e=new Error(t.message)}}this._lastCapturedException=e;try{var r=n.computeStackTrace(e);this._handleStackInfo(r,t)}catch(t){if(e!==t)throw t}return this},_getCaptureExceptionOptionsFromPlainObject:function(e,t){var i=Object.keys(t).sort(),n=y(e,{message:"Non-Error exception captured with keys: "+D(i),fingerprint:[r(i)],extra:e.extra||{}});return n.extra.__serialized__=P(t),n},captureMessage:function(e,t){if(!this._globalOptions.ignoreErrors.test||!this._globalOptions.ignoreErrors.test(e)){var i,s=y({message:e+=""},t=t||{});try{throw new Error(e)}catch(e){i=e}i.name=null;var r=n.computeStackTrace(i),o=_(r.stack)&&r.stack[1];o&&"Raven.captureException"===o.func&&(o=r.stack[2]);var a=o&&o.url||"";if((!this._globalOptions.ignoreUrls.test||!this._globalOptions.ignoreUrls.test(a))&&(!this._globalOptions.whitelistUrls.test||this._globalOptions.whitelistUrls.test(a))){if(this._globalOptions.stacktrace||t.stacktrace||""===s.message){s.fingerprint=null==s.fingerprint?e:s.fingerprint,(t=y({trimHeadFrames:0},t)).trimHeadFrames+=1;var l=this._prepareFrames(r,t);s.stacktrace={frames:l.reverse()}}return s.fingerprint&&(s.fingerprint=_(s.fingerprint)?s.fingerprint:[s.fingerprint]),this._send(s),this}}},captureBreadcrumb:function(e){var t=y({timestamp:now()/1e3},e);if(g(this._globalOptions.breadcrumbCallback)){var i=this._globalOptions.breadcrumbCallback(t);if(d(i)&&!b(i))t=i;else if(!1===i)return this}return this._breadcrumbs.push(t),this._breadcrumbs.length>this._globalOptions.maxBreadcrumbs&&this._breadcrumbs.shift(),this},addPlugin:function(e){var t=[].slice.call(arguments,1);return this._plugins.push([e,t]),this._isRavenInstalled&&this._drainPlugins(),this},setUserContext:function(e){return this._globalContext.user=e,this},setExtraContext:function(e){return this._mergeContext("extra",e),this},setTagsContext:function(e){return this._mergeContext("tags",e),this},clearContext:function(){return this._globalContext={},this},getContext:function(){return JSON.parse(s(this._globalContext))},setEnvironment:function(e){return this._globalOptions.environment=e,this},setRelease:function(e){return this._globalOptions.release=e,this},setDataCallback:function(e){var t=this._globalOptions.dataCallback;return this._globalOptions.dataCallback=keepOriginalCallback(t,e),this},setBreadcrumbCallback:function(e){var t=this._globalOptions.breadcrumbCallback;return this._globalOptions.breadcrumbCallback=keepOriginalCallback(t,e),this},setShouldSendCallback:function(e){var t=this._globalOptions.shouldSendCallback;return this._globalOptions.shouldSendCallback=keepOriginalCallback(t,e),this},setTransport:function(e){return this._globalOptions.transport=e,this},lastException:function(){return this._lastCapturedException},lastEventId:function(){return this._lastEventId},isSetup:function(){return!!this._hasJSON&&(!!this._globalServer||(this.ravenNotConfiguredError||(this.ravenNotConfiguredError=!0,this._logDebug("error","Error: Raven has not been configured.")),!1))},afterLoad:function(){var e=B.RavenConfig;e&&this.config(e.dsn,e.config).install()},showReportDialog:function(e){if(I){if(!(e=y({eventId:this.lastEventId(),dsn:this._dsn,user:this._globalContext.user||{}},e)).eventId)throw new o("Missing eventId");if(!e.dsn)throw new o("Missing DSN");var t=encodeURIComponent,i=[];for(var n in e)if("user"===n){var s=e.user;s.name&&i.push("name="+t(s.name)),s.email&&i.push("email="+t(s.email))}else i.push(t(n)+"="+t(e[n]));var r=this._getGlobalServer(this._parseDSN(e.dsn)),a=I.createElement("script");a.async=!0,a.src=r+"/api/embed/error-page/?"+i.join("&"),(I.head||I.body).appendChild(a)}},_ignoreNextOnError:function(){var e=this;this._ignoreOnError+=1,setTimeout((function(){e._ignoreOnError-=1}))},_triggerEvent:function(e,t){var i,n;if(this._hasDocument){for(n in t=t||{},e="raven"+e.substr(0,1).toUpperCase()+e.substr(1),I.createEvent?(i=I.createEvent("HTMLEvents")).initEvent(e,!0,!0):(i=I.createEventObject()).eventType=e,t)C(t,n)&&(i[n]=t[n]);if(I.createEvent)I.dispatchEvent(i);else try{I.fireEvent("on"+i.eventType.toLowerCase(),i)}catch(e){}}},_breadcrumbEventHandler:function(e){var t=this;return function(i){if(t._keypressTimeout=null,t._lastCapturedEvent!==i){var n;t._lastCapturedEvent=i;try{n=F(i.target)}catch(e){n="<unknown>"}t.captureBreadcrumb({category:"ui."+e,message:n})}}},_keypressEventHandler:function(){var e=this;return function(t){var i;try{i=t.target}catch(e){return}var n=i&&i.tagName;if(n&&("INPUT"===n||"TEXTAREA"===n||i.isContentEditable)){var s=e._keypressTimeout;s||e._breadcrumbEventHandler("input")(t),clearTimeout(s),e._keypressTimeout=setTimeout((function(){e._keypressTimeout=null}),1e3)}}},_captureUrlChange:function(e,t){var i=j(this._location.href),n=j(t),s=j(e);this._lastHref=t,i.protocol===n.protocol&&i.host===n.host&&(t=n.relative),i.protocol===s.protocol&&i.host===s.host&&(e=s.relative),this.captureBreadcrumb({category:"navigation",data:{to:t,from:e}})},_patchFunctionToString:function(){var e=this;e._originalFunctionToString=Function.prototype.toString,Function.prototype.toString=function(){return"function"==typeof this&&this.__raven__?e._originalFunctionToString.apply(this.__orig__,arguments):e._originalFunctionToString.apply(this,arguments)}},_unpatchFunctionToString:function(){this._originalFunctionToString&&(Function.prototype.toString=this._originalFunctionToString)},_instrumentTryCatch:function(){var e=this,t=e._wrappedBuiltIns;function wrapTimeFn(t){return function(i,n){for(var s=new Array(arguments.length),r=0;r<s.length;++r)s[r]=arguments[r];var o=s[0];return g(o)&&(s[0]=e.wrap({mechanism:{type:"instrument",data:{function:t.name||"<anonymous>"}}},o)),t.apply?t.apply(this,s):t(s[0],s[1])}}var i=this._globalOptions.autoBreadcrumbs;function wrapEventTarget(n){var s=B[n]&&B[n].prototype;s&&s.hasOwnProperty&&s.hasOwnProperty("addEventListener")&&(T(s,"addEventListener",(function(t){return function(s,r,o,a){try{r&&r.handleEvent&&(r.handleEvent=e.wrap({mechanism:{type:"instrument",data:{target:n,function:"handleEvent",handler:r&&r.name||"<anonymous>"}}},r.handleEvent))}catch(e){}var l,c,u;return i&&i.dom&&("EventTarget"===n||"Node"===n)&&(c=e._breadcrumbEventHandler("click"),u=e._keypressEventHandler(),l=function(e){if(e){var t;try{t=e.type}catch(e){return}return"click"===t?c(e):"keypress"===t?u(e):void 0}}),t.call(this,s,e.wrap({mechanism:{type:"instrument",data:{target:n,function:"addEventListener",handler:r&&r.name||"<anonymous>"}}},r,l),o,a)}}),t),T(s,"removeEventListener",(function(e){return function(t,i,n,s){try{i=i&&(i.__raven_wrapper__?i.__raven_wrapper__:i)}catch(e){}return e.call(this,t,i,n,s)}}),t))}T(B,"setTimeout",wrapTimeFn,t),T(B,"setInterval",wrapTimeFn,t),B.requestAnimationFrame&&T(B,"requestAnimationFrame",(function(t){return function(i){return t(e.wrap({mechanism:{type:"instrument",data:{function:"requestAnimationFrame",handler:t&&t.name||"<anonymous>"}}},i))}}),t);for(var n=["EventTarget","Window","Node","ApplicationCache","AudioTrackList","ChannelMergerNode","CryptoOperation","EventSource","FileReader","HTMLUnknownElement","IDBDatabase","IDBRequest","IDBTransaction","KeyOperation","MediaController","MessagePort","ModalWindow","Notification","SVGElementInstance","Screen","TextTrack","TextTrackCue","TextTrackList","WebSocket","WebSocketWorker","Worker","XMLHttpRequest","XMLHttpRequestEventTarget","XMLHttpRequestUpload"],s=0;s<n.length;s++)wrapEventTarget(n[s])},_instrumentBreadcrumbs:function(){var e=this,t=this._globalOptions.autoBreadcrumbs,i=e._wrappedBuiltIns;function wrapProp(t,i){t in i&&g(i[t])&&T(i,t,(function(i){return e.wrap({mechanism:{type:"instrument",data:{function:t,handler:i&&i.name||"<anonymous>"}}},i)}))}if(t.xhr&&"XMLHttpRequest"in B){var n=B.XMLHttpRequest&&B.XMLHttpRequest.prototype;T(n,"open",(function(t){return function(i,n){return m(n)&&-1===n.indexOf(e._globalKey)&&(this.__raven_xhr={method:i,url:n,status_code:null}),t.apply(this,arguments)}}),i),T(n,"send",(function(t){return function(){var i=this;function onreadystatechangeHandler(){if(i.__raven_xhr&&4===i.readyState){try{i.__raven_xhr.status_code=i.status}catch(e){}e.captureBreadcrumb({type:"http",category:"xhr",data:i.__raven_xhr})}}for(var n=["onload","onerror","onprogress"],s=0;s<n.length;s++)wrapProp(n[s],i);return"onreadystatechange"in i&&g(i.onreadystatechange)?T(i,"onreadystatechange",(function(t){return e.wrap({mechanism:{type:"instrument",data:{function:"onreadystatechange",handler:t&&t.name||"<anonymous>"}}},t,onreadystatechangeHandler)})):i.onreadystatechange=onreadystatechangeHandler,t.apply(this,arguments)}}),i)}t.xhr&&z()&&T(B,"fetch",(function(t){return function(){for(var i=new Array(arguments.length),n=0;n<i.length;++n)i[n]=arguments[n];var s,r=i[0],o="GET";if("string"==typeof r?s=r:"Request"in B&&r instanceof B.Request?(s=r.url,r.method&&(o=r.method)):s=""+r,-1!==s.indexOf(e._globalKey))return t.apply(this,i);i[1]&&i[1].method&&(o=i[1].method);var a={method:o,url:s,status_code:null};return t.apply(this,i).then((function(t){return a.status_code=t.status,e.captureBreadcrumb({type:"http",category:"fetch",data:a}),t})).catch((function(t){throw e.captureBreadcrumb({type:"http",category:"fetch",data:a,level:"error"}),t}))}}),i),t.dom&&this._hasDocument&&(I.addEventListener?(I.addEventListener("click",e._breadcrumbEventHandler("click"),!1),I.addEventListener("keypress",e._keypressEventHandler(),!1)):I.attachEvent&&(I.attachEvent("onclick",e._breadcrumbEventHandler("click")),I.attachEvent("onkeypress",e._keypressEventHandler())));var s=B.chrome,r=!(s&&s.app&&s.app.runtime)&&B.history&&B.history.pushState&&B.history.replaceState;if(t.location&&r){var o=B.onpopstate;B.onpopstate=function(){var t=e._location.href;if(e._captureUrlChange(e._lastHref,t),o)return o.apply(this,arguments)};var historyReplacementFunction=function(t){return function(){var i=arguments.length>2?arguments[2]:void 0;return i&&e._captureUrlChange(e._lastHref,i+""),t.apply(this,arguments)}};T(B.history,"pushState",historyReplacementFunction,i),T(B.history,"replaceState",historyReplacementFunction,i)}if(t.console&&"console"in B&&console.log){var consoleMethodCallback=function(t,i){e.captureBreadcrumb({message:t,level:i.level,category:"console"})};v(["debug","info","warn","error","log"],(function(e,t){L(console,t,consoleMethodCallback)}))}},_restoreBuiltIns:function(){for(var e;this._wrappedBuiltIns.length;){var t=(e=this._wrappedBuiltIns.shift())[0],i=e[1],n=e[2];t[i]=n}},_restoreConsole:function(){for(var e in this._originalConsoleMethods)this._originalConsole[e]=this._originalConsoleMethods[e]},_drainPlugins:function(){var e=this;v(this._plugins,(function(t,i){var n=i[0],s=i[1];n.apply(e,[e].concat(s))}))},_parseDSN:function(e){var t=$.exec(e),i={},n=7;try{for(;n--;)i[R[n]]=t[n]||""}catch(t){throw new o("Invalid DSN: "+e)}if(i.pass&&!this._globalOptions.allowSecretKey)throw new o("Do not specify your secret key in the DSN. See: http://bit.ly/raven-secret-key");return i},_getGlobalServer:function(e){var t="//"+e.host+(e.port?":"+e.port:"");return e.protocol&&(t=e.protocol+":"+t),t},_handleOnErrorStackInfo:function(e,t){(t=t||{}).mechanism=t.mechanism||{type:"onerror",handled:!1},this._ignoreOnError||this._handleStackInfo(e,t)},_handleStackInfo:function(e,t){var i=this._prepareFrames(e,t);this._triggerEvent("handle",{stackInfo:e,options:t}),this._processException(e.name,e.message,e.url,e.lineno,i,t)},_prepareFrames:function(e,t){var i=this,n=[];if(e.stack&&e.stack.length&&(v(e.stack,(function(t,s){var r=i._normalizeFrame(s,e.url);r&&n.push(r)})),t&&t.trimHeadFrames))for(var s=0;s<t.trimHeadFrames&&s<n.length;s++)n[s].in_app=!1;return n=n.slice(0,this._globalOptions.stackTraceLimit)},_normalizeFrame:function(e,t){var i={filename:e.url,lineno:e.line,colno:e.column,function:e.func||"?"};return e.url||(i.filename=t),i.in_app=!(this._globalOptions.includePaths.test&&!this._globalOptions.includePaths.test(i.filename)||/(Raven|TraceKit)\./.test(i.function)||/raven\.(min\.)?js$/.test(i.filename)),i},_processException:function(e,t,i,n,s,r){var o,a=(e?e+": ":"")+(t||"");if((!this._globalOptions.ignoreErrors.test||!this._globalOptions.ignoreErrors.test(t)&&!this._globalOptions.ignoreErrors.test(a))&&(s&&s.length?(i=s[0].filename||i,s.reverse(),o={frames:s}):i&&(o={frames:[{filename:i,lineno:n,in_app:!0}]}),(!this._globalOptions.ignoreUrls.test||!this._globalOptions.ignoreUrls.test(i))&&(!this._globalOptions.whitelistUrls.test||this._globalOptions.whitelistUrls.test(i)))){var l=y({exception:{values:[{type:e,value:t,stacktrace:o}]},transaction:i},r),c=l.exception.values[0];null==c.type&&""===c.value&&(c.value="Unrecoverable error caught"),!l.exception.mechanism&&l.mechanism&&(l.exception.mechanism=l.mechanism,delete l.mechanism),l.exception.mechanism=y({type:"generic",handled:!0},l.exception.mechanism||{}),this._send(l)}},_trimPacket:function(e){var t=this._globalOptions.maxMessageLength;if(e.message&&(e.message=w(e.message,t)),e.exception){var i=e.exception.values[0];i.value=w(i.value,t)}var n=e.request;return n&&(n.url&&(n.url=w(n.url,this._globalOptions.maxUrlLength)),n.Referer&&(n.Referer=w(n.Referer,this._globalOptions.maxUrlLength))),e.breadcrumbs&&e.breadcrumbs.values&&this._trimBreadcrumbs(e.breadcrumbs),e},_trimBreadcrumbs:function(e){for(var t,i,n,s=["to","from","url"],r=0;r<e.values.length;++r)if((i=e.values[r]).hasOwnProperty("data")&&d(i.data)&&!k(i.data)){n=y({},i.data);for(var o=0;o<s.length;++o)t=s[o],n.hasOwnProperty(t)&&n[t]&&(n[t]=w(n[t],this._globalOptions.maxUrlLength));e.values[r].data=n}},_getHttpData:function(){if(this._hasNavigator||this._hasDocument){var e={};return this._hasNavigator&&U.userAgent&&(e.headers={"User-Agent":U.userAgent}),B.location&&B.location.href&&(e.url=B.location.href),this._hasDocument&&I.referrer&&(e.headers||(e.headers={}),e.headers.Referer=I.referrer),e}},_resetBackoff:function(){this._backoffDuration=0,this._backoffStart=null},_shouldBackoff:function(){return this._backoffDuration&&now()-this._backoffStart<this._backoffDuration},_isRepeatData:function(e){var t=this._lastData;return!(!t||e.message!==t.message||e.transaction!==t.transaction)&&(e.stacktrace||t.stacktrace?A(e.stacktrace,t.stacktrace):e.exception||t.exception?O(e.exception,t.exception):!e.fingerprint&&!t.fingerprint||Boolean(e.fingerprint&&t.fingerprint)&&JSON.stringify(e.fingerprint)===JSON.stringify(t.fingerprint))},_setBackoffState:function(e){if(!this._shouldBackoff()){var t=e.status;if(400===t||401===t||429===t){var i;try{i=z()?e.headers.get("Retry-After"):e.getResponseHeader("Retry-After"),i=1e3*parseInt(i,10)}catch(e){}this._backoffDuration=i||(2*this._backoffDuration||1e3),this._backoffStart=now()}}},_send:function(e){var t=this._globalOptions,i={project:this._globalProject,logger:t.logger,platform:"javascript"},n=this._getHttpData();n&&(i.request=n),e.trimHeadFrames&&delete e.trimHeadFrames,(e=y(i,e)).tags=y(y({},this._globalContext.tags),e.tags),e.extra=y(y({},this._globalContext.extra),e.extra),e.extra["session:duration"]=now()-this._startTime,this._breadcrumbs&&this._breadcrumbs.length>0&&(e.breadcrumbs={values:[].slice.call(this._breadcrumbs,0)}),this._globalContext.user&&(e.user=this._globalContext.user),t.environment&&(e.environment=t.environment),t.release&&(e.release=t.release),t.serverName&&(e.server_name=t.serverName),e=this._sanitizeData(e),Object.keys(e).forEach((function(t){(null==e[t]||""===e[t]||b(e[t]))&&delete e[t]})),g(t.dataCallback)&&(e=t.dataCallback(e)||e),e&&!b(e)&&(g(t.shouldSendCallback)&&!t.shouldSendCallback(e)||(this._shouldBackoff()?this._logDebug("warn","Raven dropped error due to backoff: ",e):"number"==typeof t.sampleRate?Math.random()<t.sampleRate&&this._sendProcessedPayload(e):this._sendProcessedPayload(e)))},_sanitizeData:function(e){return N(e,this._globalOptions.sanitizeKeys)},_getUuid:function(){return E()},_sendProcessedPayload:function(e,t){var i=this,n=this._globalOptions;if(this.isSetup())if(e=this._trimPacket(e),this._globalOptions.allowDuplicates||!this._isRepeatData(e)){this._lastEventId=e.event_id||(e.event_id=this._getUuid()),this._lastData=e,this._logDebug("debug","Raven about to send:",e);var s={sentry_version:"7",sentry_client:"raven-js/"+this.VERSION,sentry_key:this._globalKey};this._globalSecret&&(s.sentry_secret=this._globalSecret);var r=e.exception&&e.exception.values[0];this._globalOptions.autoBreadcrumbs&&this._globalOptions.autoBreadcrumbs.sentry&&this.captureBreadcrumb({category:"sentry",message:r?(r.type?r.type+": ":"")+r.value:e.message,event_id:e.event_id,level:e.level||"error"});var o=this._globalEndpoint;(n.transport||this._makeRequest).call(this,{url:o,auth:s,data:e,options:n,onSuccess:function success(){i._resetBackoff(),i._triggerEvent("success",{data:e,src:o}),t&&t()},onError:function failure(n){i._logDebug("error","Raven transport failed to send: ",n),n.request&&i._setBackoffState(n.request),i._triggerEvent("failure",{data:e,src:o}),n=n||new Error("Raven send failed (no additional details provided)"),t&&t(n)}})}else this._logDebug("warn","Raven dropped repeat event: ",e)},_makeRequest:function(e){var t=e.url+"?"+S(e.auth),i=null,n={};if(e.options.headers&&(i=this._evaluateHash(e.options.headers)),e.options.fetchParameters&&(n=this._evaluateHash(e.options.fetchParameters)),z()){n.body=s(e.data);var r=y({},this._fetchDefaults),o=y(r,n);return i&&(o.headers=i),B.fetch(t,o).then((function(t){if(t.ok)e.onSuccess&&e.onSuccess();else{var i=new Error("Sentry error code: "+t.status);i.request=t,e.onError&&e.onError(i)}})).catch((function(){e.onError&&e.onError(new Error("Sentry error code: network unavailable"))}))}var a=B.XMLHttpRequest&&new B.XMLHttpRequest;a&&(("withCredentials"in a||"undefined"!=typeof XDomainRequest)&&("withCredentials"in a?a.onreadystatechange=function(){if(4===a.readyState)if(200===a.status)e.onSuccess&&e.onSuccess();else if(e.onError){var t=new Error("Sentry error code: "+a.status);t.request=a,e.onError(t)}}:(a=new XDomainRequest,t=t.replace(/^https?:/,""),e.onSuccess&&(a.onload=e.onSuccess),e.onError&&(a.onerror=function(){var t=new Error("Sentry error code: XDomainRequest");t.request=a,e.onError(t)})),a.open("POST",t),i&&v(i,(function(e,t){a.setRequestHeader(e,t)})),a.send(s(e.data))))},_evaluateHash:function(e){var t={};for(var i in e)if(e.hasOwnProperty(i)){var n=e[i];t[i]="function"==typeof n?n():n}return t},_logDebug:function(e){this._originalConsoleMethods[e]&&(this.debug||this._globalOptions.debug)&&Function.prototype.apply.call(this._originalConsoleMethods[e],this._originalConsole,[].slice.call(arguments,1))},_mergeContext:function(e,t){p(t)?delete this._globalContext[e]:this._globalContext[e]=y(this._globalContext[e]||{},t)}},Raven.prototype.setUser=Raven.prototype.setUserContext,Raven.prototype.setReleaseContext=Raven.prototype.setRelease,e.exports=Raven}).call(this,i(11))},function(e,t,i){(function(t){var n=i(18),s={collectWindowErrors:!0,debug:!1},r="undefined"!=typeof window?window:void 0!==t?t:"undefined"!=typeof self?self:{},o=[].slice,a="?",l=/^(?:[Uu]ncaught (?:exception: )?)?(?:((?:Eval|Internal|Range|Reference|Syntax|Type|URI|)Error): )?(.*)$/;function getLocationHref(){return"undefined"==typeof document||null==document.location?"":document.location.href}s.report=function reportModuleWrapper(){var e,t,i=[],c=null,u=null,h=null;function notifyHandlers(e,t){var n=null;if(!t||s.collectWindowErrors){for(var r in i)if(i.hasOwnProperty(r))try{i[r].apply(null,[e].concat(o.call(arguments,2)))}catch(e){n=e}if(n)throw n}}function traceKitWindowOnError(t,i,r,o,c){var u=n.isErrorEvent(c)?c.error:c,d=n.isErrorEvent(t)?t.message:t;if(h)s.computeStackTrace.augmentStackTraceWithInitialElement(h,i,r,d),processLastException();else if(u&&n.isError(u))notifyHandlers(s.computeStackTrace(u),!0);else{var f,p={url:i,line:r,column:o},g=void 0;if("[object String]"==={}.toString.call(d))(f=d.match(l))&&(g=f[1],d=f[2]);p.func=a,notifyHandlers({name:g,message:d,url:getLocationHref(),stack:[p]},!0)}return!!e&&e.apply(this,arguments)}function processLastException(){var e=h,t=c;c=null,h=null,u=null,notifyHandlers.apply(null,[e,!1].concat(t))}function report(e,t){var i=o.call(arguments,1);if(h){if(u===e)return;processLastException()}var n=s.computeStackTrace(e);if(h=n,u=e,c=i,setTimeout((function(){u===e&&processLastException()}),n.incomplete?2e3:0),!1!==t)throw e}return report.subscribe=function subscribe(n){!function installGlobalHandler(){if(t)return;e=r.onerror,r.onerror=traceKitWindowOnError,t=!0}(),i.push(n)},report.unsubscribe=function unsubscribe(e){for(var t=i.length-1;t>=0;--t)i[t]===e&&i.splice(t,1)},report.uninstall=function unsubscribeAll(){!function uninstallGlobalHandler(){if(!t)return;r.onerror=e,t=!1,e=void 0}(),i=[]},report}(),s.computeStackTrace=function computeStackTraceWrapper(){function computeStackTraceFromStackProp(e){if(void 0!==e.stack&&e.stack){for(var t,i,n,s=/^\s*at (?:(.*?) ?\()?((?:file|https?|blob|chrome-extension|native|eval|webpack|<anonymous>|[a-z]:|\/).*?)(?::(\d+))?(?::(\d+))?\)?\s*$/i,r=/^\s*at (?:((?:\[object object\])?.+) )?\(?((?:file|ms-appx(?:-web)|https?|webpack|blob):.*?):(\d+)(?::(\d+))?\)?\s*$/i,o=/^\s*(.*?)(?:\((.*?)\))?(?:^|@)((?:file|https?|blob|chrome|webpack|resource|moz-extension).*?:\/.*?|\[native code\]|[^@]*(?:bundle|\d+\.js))(?::(\d+))?(?::(\d+))?\s*$/i,l=/(\S+) line (\d+)(?: > eval line \d+)* > eval/i,c=/\((\S*)(?::(\d+))(?::(\d+))\)/,u=e.stack.split("\n"),h=[],d=(/^(.*) is undefined$/.exec(e.message),0),f=u.length;d<f;++d){if(i=s.exec(u[d])){var p=i[2]&&0===i[2].indexOf("native");i[2]&&0===i[2].indexOf("eval")&&(t=c.exec(i[2]))&&(i[2]=t[1],i[3]=t[2],i[4]=t[3]),n={url:p?null:i[2],func:i[1]||a,args:p?[i[2]]:[],line:i[3]?+i[3]:null,column:i[4]?+i[4]:null}}else if(i=r.exec(u[d]))n={url:i[2],func:i[1]||a,args:[],line:+i[3],column:i[4]?+i[4]:null};else{if(!(i=o.exec(u[d])))continue;i[3]&&i[3].indexOf(" > eval")>-1&&(t=l.exec(i[3]))?(i[3]=t[1],i[4]=t[2],i[5]=null):0!==d||i[5]||void 0===e.columnNumber||(h[0].column=e.columnNumber+1),n={url:i[3],func:i[1]||a,args:i[2]?i[2].split(","):[],line:i[4]?+i[4]:null,column:i[5]?+i[5]:null}}if(!n.func&&n.line&&(n.func=a),n.url&&"blob:"===n.url.substr(0,5)){var g=new XMLHttpRequest;if(g.open("GET",n.url,!1),g.send(null),200===g.status){var m=g.responseText||"",_=(m=m.slice(-300)).match(/\/\/# sourceMappingURL=(.*)$/);if(_){var b=_[1];"~"===b.charAt(0)&&(b=("undefined"==typeof document||null==document.location?"":document.location.origin?document.location.origin:document.location.protocol+"//"+document.location.hostname+(document.location.port?":"+document.location.port:""))+b.slice(1)),n.url=b.slice(0,-4)}}}h.push(n)}return h.length?{name:e.name,message:e.message,url:getLocationHref(),stack:h}:null}}function augmentStackTraceWithInitialElement(e,t,i,n){var s={url:t,line:i};if(s.url&&s.line){if(e.incomplete=!1,s.func||(s.func=a),e.stack.length>0&&e.stack[0].url===s.url){if(e.stack[0].line===s.line)return!1;if(!e.stack[0].line&&e.stack[0].func===s.func)return e.stack[0].line=s.line,!1}return e.stack.unshift(s),e.partial=!0,!0}return e.incomplete=!0,!1}function computeStackTraceByWalkingCallerChain(e,t){for(var i,n,r=/function\s+([_$a-zA-Z\xA0-\uFFFF][_$a-zA-Z0-9\xA0-\uFFFF]*)?\s*\(/i,o=[],l={},c=!1,u=computeStackTraceByWalkingCallerChain.caller;u&&!c;u=u.caller)if(u!==computeStackTrace&&u!==s.report){if(n={url:null,func:a,line:null,column:null},u.name?n.func=u.name:(i=r.exec(u.toString()))&&(n.func=i[1]),void 0===n.func)try{n.func=i.input.substring(0,i.input.indexOf("{"))}catch(e){}l[""+u]?c=!0:l[""+u]=!0,o.push(n)}t&&o.splice(0,t);var h={name:e.name,message:e.message,url:getLocationHref(),stack:o};return augmentStackTraceWithInitialElement(h,e.sourceURL||e.fileName,e.line||e.lineNumber,e.message||e.description),h}function computeStackTrace(e,t){var i=null;t=null==t?0:+t;try{if(i=computeStackTraceFromStackProp(e))return i}catch(e){if(s.debug)throw e}try{if(i=computeStackTraceByWalkingCallerChain(e,t+1))return i}catch(e){if(s.debug)throw e}return{name:e.name,message:e.message,url:getLocationHref()}}return computeStackTrace.augmentStackTraceWithInitialElement=augmentStackTraceWithInitialElement,computeStackTrace.computeStackTraceFromStackProp=computeStackTraceFromStackProp,computeStackTrace}(),e.exports=s}).call(this,i(11))},function(e,t){function safeAdd(e,t){var i=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(i>>16)<<16|65535&i}function md5cmn(e,t,i,n,s,r){return safeAdd(function bitRotateLeft(e,t){return e<<t|e>>>32-t}(safeAdd(safeAdd(t,e),safeAdd(n,r)),s),i)}function md5ff(e,t,i,n,s,r,o){return md5cmn(t&i|~t&n,e,t,s,r,o)}function md5gg(e,t,i,n,s,r,o){return md5cmn(t&n|i&~n,e,t,s,r,o)}function md5hh(e,t,i,n,s,r,o){return md5cmn(t^i^n,e,t,s,r,o)}function md5ii(e,t,i,n,s,r,o){return md5cmn(i^(t|~n),e,t,s,r,o)}function binlMD5(e,t){var i,n,s,r,o;e[t>>5]|=128<<t%32,e[14+(t+64>>>9<<4)]=t;var a=1732584193,l=-271733879,c=-1732584194,u=271733878;for(i=0;i<e.length;i+=16)n=a,s=l,r=c,o=u,a=md5ff(a,l,c,u,e[i],7,-680876936),u=md5ff(u,a,l,c,e[i+1],12,-389564586),c=md5ff(c,u,a,l,e[i+2],17,606105819),l=md5ff(l,c,u,a,e[i+3],22,-1044525330),a=md5ff(a,l,c,u,e[i+4],7,-176418897),u=md5ff(u,a,l,c,e[i+5],12,1200080426),c=md5ff(c,u,a,l,e[i+6],17,-1473231341),l=md5ff(l,c,u,a,e[i+7],22,-45705983),a=md5ff(a,l,c,u,e[i+8],7,1770035416),u=md5ff(u,a,l,c,e[i+9],12,-1958414417),c=md5ff(c,u,a,l,e[i+10],17,-42063),l=md5ff(l,c,u,a,e[i+11],22,-1990404162),a=md5ff(a,l,c,u,e[i+12],7,1804603682),u=md5ff(u,a,l,c,e[i+13],12,-40341101),c=md5ff(c,u,a,l,e[i+14],17,-1502002290),a=md5gg(a,l=md5ff(l,c,u,a,e[i+15],22,1236535329),c,u,e[i+1],5,-165796510),u=md5gg(u,a,l,c,e[i+6],9,-1069501632),c=md5gg(c,u,a,l,e[i+11],14,643717713),l=md5gg(l,c,u,a,e[i],20,-373897302),a=md5gg(a,l,c,u,e[i+5],5,-701558691),u=md5gg(u,a,l,c,e[i+10],9,38016083),c=md5gg(c,u,a,l,e[i+15],14,-660478335),l=md5gg(l,c,u,a,e[i+4],20,-405537848),a=md5gg(a,l,c,u,e[i+9],5,568446438),u=md5gg(u,a,l,c,e[i+14],9,-1019803690),c=md5gg(c,u,a,l,e[i+3],14,-187363961),l=md5gg(l,c,u,a,e[i+8],20,1163531501),a=md5gg(a,l,c,u,e[i+13],5,-1444681467),u=md5gg(u,a,l,c,e[i+2],9,-51403784),c=md5gg(c,u,a,l,e[i+7],14,1735328473),a=md5hh(a,l=md5gg(l,c,u,a,e[i+12],20,-1926607734),c,u,e[i+5],4,-378558),u=md5hh(u,a,l,c,e[i+8],11,-2022574463),c=md5hh(c,u,a,l,e[i+11],16,1839030562),l=md5hh(l,c,u,a,e[i+14],23,-35309556),a=md5hh(a,l,c,u,e[i+1],4,-1530992060),u=md5hh(u,a,l,c,e[i+4],11,1272893353),c=md5hh(c,u,a,l,e[i+7],16,-155497632),l=md5hh(l,c,u,a,e[i+10],23,-1094730640),a=md5hh(a,l,c,u,e[i+13],4,681279174),u=md5hh(u,a,l,c,e[i],11,-358537222),c=md5hh(c,u,a,l,e[i+3],16,-722521979),l=md5hh(l,c,u,a,e[i+6],23,76029189),a=md5hh(a,l,c,u,e[i+9],4,-640364487),u=md5hh(u,a,l,c,e[i+12],11,-421815835),c=md5hh(c,u,a,l,e[i+15],16,530742520),a=md5ii(a,l=md5hh(l,c,u,a,e[i+2],23,-995338651),c,u,e[i],6,-198630844),u=md5ii(u,a,l,c,e[i+7],10,1126891415),c=md5ii(c,u,a,l,e[i+14],15,-1416354905),l=md5ii(l,c,u,a,e[i+5],21,-57434055),a=md5ii(a,l,c,u,e[i+12],6,1700485571),u=md5ii(u,a,l,c,e[i+3],10,-1894986606),c=md5ii(c,u,a,l,e[i+10],15,-1051523),l=md5ii(l,c,u,a,e[i+1],21,-2054922799),a=md5ii(a,l,c,u,e[i+8],6,1873313359),u=md5ii(u,a,l,c,e[i+15],10,-30611744),c=md5ii(c,u,a,l,e[i+6],15,-1560198380),l=md5ii(l,c,u,a,e[i+13],21,1309151649),a=md5ii(a,l,c,u,e[i+4],6,-145523070),u=md5ii(u,a,l,c,e[i+11],10,-1120210379),c=md5ii(c,u,a,l,e[i+2],15,718787259),l=md5ii(l,c,u,a,e[i+9],21,-343485551),a=safeAdd(a,n),l=safeAdd(l,s),c=safeAdd(c,r),u=safeAdd(u,o);return[a,l,c,u]}function binl2rstr(e){var t,i="",n=32*e.length;for(t=0;t<n;t+=8)i+=String.fromCharCode(e[t>>5]>>>t%32&255);return i}function rstr2binl(e){var t,i=[];for(i[(e.length>>2)-1]=void 0,t=0;t<i.length;t+=1)i[t]=0;var n=8*e.length;for(t=0;t<n;t+=8)i[t>>5]|=(255&e.charCodeAt(t/8))<<t%32;return i}function rstr2hex(e){var t,i,n="";for(i=0;i<e.length;i+=1)t=e.charCodeAt(i),n+="0123456789abcdef".charAt(t>>>4&15)+"0123456789abcdef".charAt(15&t);return n}function str2rstrUTF8(e){return unescape(encodeURIComponent(e))}function rawMD5(e){return function rstrMD5(e){return binl2rstr(binlMD5(rstr2binl(e),8*e.length))}(str2rstrUTF8(e))}function rawHMACMD5(e,t){return function rstrHMACMD5(e,t){var i,n,s=rstr2binl(e),r=[],o=[];for(r[15]=o[15]=void 0,s.length>16&&(s=binlMD5(s,8*e.length)),i=0;i<16;i+=1)r[i]=909522486^s[i],o[i]=1549556828^s[i];return n=binlMD5(r.concat(rstr2binl(t)),512+8*t.length),binl2rstr(binlMD5(o.concat(n),640))}(str2rstrUTF8(e),str2rstrUTF8(t))}e.exports=function md5(e,t,i){return t?i?rawHMACMD5(t,e):function hexHMACMD5(e,t){return rstr2hex(rawHMACMD5(e,t))}(t,e):i?rawMD5(e):function hexMD5(e){return rstr2hex(rawMD5(e))}(e)}},function(e,t){function RavenConfigError(e){this.name="RavenConfigError",this.message=e}RavenConfigError.prototype=new Error,RavenConfigError.prototype.constructor=RavenConfigError,e.exports=RavenConfigError},function(e,t,i){var n=i(18);e.exports={wrapMethod:function(e,t,i){var s=e[t],r=e;if(t in e){var o="warn"===t?"warning":t;e[t]=function(){var e=[].slice.call(arguments),a=n.safeJoin(e," "),l={level:o,logger:"console",extra:{arguments:e}};"assert"===t?!1===e[0]&&(a="Assertion failed: "+(n.safeJoin(e.slice(1)," ")||"console.assert"),l.extra.arguments=e.slice(1),i&&i(a,l)):i&&i(a,l),s&&Function.prototype.apply.call(s,r,e)}}}}},function(e,t,i){"use strict";e.exports=i(55)},function(e,t,i){"use strict";var n=i(56),s=i(32),r=i(63),o=i(14),a=i(19),l=i(33),c=i(82),u=i(88).RegExpTree,h={parser:o,fa:c,TransformResult:a.TransformResult,parse:function parse(e,t){return o.parse(""+e,t)},traverse:function traverse(e,t,i){return l.traverse(e,t,i)},transform:function transform(e,t){return a.transform(e,t)},generate:function generate(e){return s.generate(e)},toRegExp:function toRegExp(e){var t=this.compatTranspile(e);return new RegExp(t.getSource(),t.getFlags())},optimize:function optimize(e,t){return r.optimize(e,t)},compatTranspile:function compatTranspile(e,t){return n.transform(e,t)},exec:function exec(e,t){if("string"==typeof e){var i=this.compatTranspile(e),n=i.getExtra();e=n.namedCapturingGroups?new u(i.toRegExp(),{flags:i.getFlags(),source:i.getSource(),groups:n.namedCapturingGroups}):i.toRegExp()}return e.exec(t)}};e.exports=h},function(e,t,i){"use strict";var n=i(57),s=i(19);e.exports={transform:function transform(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],i=t.length>0?t:Object.keys(n),r=void 0,o={};return i.forEach((function(t){if(!n.hasOwnProperty(t))throw new Error("Unknown compat-transform: "+t+". Available transforms are: "+Object.keys(n).join(", "));var i=n[t];r=s.transform(e,i),e=r.getAST(),"function"==typeof i.getExtra&&(o[t]=i.getExtra())})),r.setExtra(o),r}}},function(e,t,i){"use strict";e.exports={dotAll:i(58),namedCapturingGroups:i(59),xFlag:i(60)}},function(e,t,i){"use strict";e.exports={_hasUFlag:!1,shouldRun:function shouldRun(e){var shouldRun=e.flags.includes("s");return!!shouldRun&&(e.flags=e.flags.replace("s",""),this._hasUFlag=e.flags.includes("u"),!0)},Char:function Char(e){var t=e.node;if("meta"===t.kind&&"."===t.value){var i="\\uFFFF",n="";this._hasUFlag&&(i="\\u{10FFFF}",n=""),e.replace({type:"CharacterClass",expressions:[{type:"ClassRange",from:{type:"Char",value:"\\0",kind:"decimal",symbol:"\0"},to:{type:"Char",value:i,kind:"unicode",symbol:n}}]})}}}},function(e,t,i){"use strict";e.exports={_groupNames:{},init:function init(){this._groupNames={}},getExtra:function getExtra(){return this._groupNames},Group:function Group(e){var t=e.node;t.name&&(this._groupNames[t.name]=t.number,delete t.name)},Backreference:function Backreference(e){var t=e.node;"name"===t.kind&&(t.kind="number",t.reference=t.number)}}},function(e,t,i){"use strict";e.exports={RegExp:function RegExp(e){var t=e.node;t.flags.includes("x")&&(t.flags=t.flags.replace("x",""))}}},function(e,t,i){"use strict";var _slicedToArray=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function sliceIterator(e,t){var i=[],n=!0,s=!1,r=void 0;try{for(var o,a=e[Symbol.iterator]();!(n=(o=a.next()).done)&&(i.push(o.value),!t||i.length!==t);n=!0);}catch(e){s=!0,r=e}finally{try{!n&&a.return&&a.return()}finally{if(s)throw r}}return i}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")};function _toConsumableArray(e){if(Array.isArray(e)){for(var t=0,i=Array(e.length);t<e.length;t++)i[t]=e[t];return i}return Array.from(e)}var n=void 0,s={},r=void 0,o=void 0;function yyloc(e,t){return s.options.captureLocations?e&&t?{startOffset:e.startOffset,endOffset:t.endOffset,startLine:e.startLine,endLine:t.endLine,startColumn:e.startColumn,endColumn:t.endColumn}:e||t:null}var a="$",l=[[-1,1,function(e,t){o=yyloc(t,t),r=e}],[0,4,function(e,t,i,n,s,a,l,c){o=yyloc(s,c),r=Node({type:"RegExp",body:t,flags:checkFlags(n)},loc(s,c||l))}],[1,1,function(e,t){o=yyloc(t,t),r=e}],[1,0,function(){o=null,r=""}],[2,1,function(e,t){o=yyloc(t,t),r=e}],[2,2,function(e,t,i,n){o=yyloc(i,n),r=e+t}],[3,1,function(e,t){o=yyloc(t,t),r=e}],[4,1,function(e,t){o=yyloc(t,t),r=e}],[4,3,function(e,t,i,n,s,a){o=yyloc(n,a);var l=null;s&&(l=loc(n||s,a||s)),r=Node({type:"Disjunction",left:e,right:i},l)}],[5,1,function(e,t){o=yyloc(t,t),r=0!==e.length?1===e.length?Node(e[0],o):Node({type:"Alternative",expressions:e},o):null}],[6,0,function(){o=null,r=[]}],[6,2,function(e,t,i,n){o=yyloc(i,n),r=e.concat(t)}],[7,1,function(e,t){o=yyloc(t,t),r=Node(Object.assign({type:"Assertion"},e),o)}],[7,2,function(e,t,i,n){o=yyloc(i,n),r=e,t&&(r=Node({type:"Repetition",expression:e,quantifier:t},o))}],[8,1,function(e,t){o=yyloc(t,t),r={kind:"^"}}],[8,1,function(e,t){o=yyloc(t,t),r={kind:"$"}}],[8,1,function(e,t){o=yyloc(t,t),r={kind:"\\b"}}],[8,1,function(e,t){o=yyloc(t,t),r={kind:"\\B"}}],[8,3,function(e,t,i,n,s,a){o=yyloc(n,a),r={kind:"Lookahead",assertion:t}}],[8,3,function(e,t,i,n,s,a){o=yyloc(n,a),r={kind:"Lookahead",negative:!0,assertion:t}}],[8,3,function(e,t,i,n,s,a){o=yyloc(n,a),r={kind:"Lookbehind",assertion:t}}],[8,3,function(e,t,i,n,s,a){o=yyloc(n,a),r={kind:"Lookbehind",negative:!0,assertion:t}}],[9,1,function(e,t){o=yyloc(t,t),r=e}],[9,1,function(e,t){o=yyloc(t,t),r=e}],[9,1,function(e,t){o=yyloc(t,t),r=e}],[10,1,function(e,t){o=yyloc(t,t),r=Char(e,"simple",o)}],[10,1,function(e,t){o=yyloc(t,t),(r=Char(e.slice(1),"simple",o)).escaped=!0}],[10,1,function(e,t){o=yyloc(t,t),(r=Char(e,"unicode",o)).isSurrogatePair=!0}],[10,1,function(e,t){o=yyloc(t,t),r=Char(e,"unicode",o)}],[10,1,function(e,t){o=yyloc(t,t),r=function UnicodeProperty(e,t){var i="P"===e[1],n=e.indexOf("="),s=e.slice(3,-1!==n?n:-1),r=void 0,o=-1===n&&y.isGeneralCategoryValue(s),a=-1===n&&y.isBinaryPropertyName(s);if(o)r=s,s="General_Category";else if(a)r=s;else{if(!y.isValidName(s))throw new SyntaxError("Invalid unicode property name: "+s+".");if(r=e.slice(n+1,-1),!y.isValidValue(s,r))throw new SyntaxError("Invalid "+s+" unicode property value: "+r+".")}return Node({type:"UnicodeProperty",name:s,value:r,negative:i,shorthand:o,binary:a,canonicalName:y.getCanonicalName(s)||s,canonicalValue:y.getCanonicalValue(r)||r},t)}(e,o)}],[10,1,function(e,t){o=yyloc(t,t),r=Char(e,"control",o)}],[10,1,function(e,t){o=yyloc(t,t),r=Char(e,"hex",o)}],[10,1,function(e,t){o=yyloc(t,t),r=Char(e,"oct",o)}],[10,1,function(e,t){o=yyloc(t,t),r=function GroupRefOrDecChar(e,t){var i=Number(e.slice(1));if(i>0&&i<=_)return Node({type:"Backreference",kind:"number",number:i,reference:i},t);return Char(e,"decimal",t)}(e,o)}],[10,1,function(e,t){o=yyloc(t,t),r=Char(e,"meta",o)}],[10,1,function(e,t){o=yyloc(t,t),r=Char(e,"meta",o)}],[10,1,function(e,t){o=yyloc(t,t),r=function NamedGroupRefOrChars(e,t){var i=e.slice(3,-1);if(b.hasOwnProperty(i))return Node({type:"Backreference",kind:"name",number:b[i],reference:i},t);var n=null,s=null,r=null,o=null;t&&(n=t.startOffset,s=t.startLine,r=t.endLine,o=t.startColumn);var a=/^[\w$<>]/,l=void 0,c=[Char(e.slice(1,2),"simple",n?{startLine:s,endLine:r,startColumn:o,startOffset:n,endOffset:n+=2,endColumn:o+=2}:null)];c[0].escaped=!0,e=e.slice(2);for(;e.length>0;){var u=null;(u=e.match(k))||(u=e.match(C))?(n&&(l={startLine:s,endLine:r,startColumn:o,startOffset:n,endOffset:n+=u[0].length,endColumn:o+=u[0].length}),c.push(Char(u[0],"unicode",l)),e=e.slice(u[0].length)):(u=e.match(a))&&(n&&(l={startLine:s,endLine:r,startColumn:o,startOffset:n,endOffset:++n,endColumn:++o}),c.push(Char(u[0],"simple",l)),e=e.slice(1))}return c}(e,t)}],[11,1,function(e,t){o=yyloc(t,t),r=e}],[11,0],[12,1,function(e,t){o=yyloc(t,t),r=e}],[12,2,function(e,t,i,n){o=yyloc(i,n),e.greedy=!1,r=e}],[13,1,function(e,t){o=yyloc(t,t),r=Node({type:"Quantifier",kind:e,greedy:!0},o)}],[13,1,function(e,t){o=yyloc(t,t),r=Node({type:"Quantifier",kind:e,greedy:!0},o)}],[13,1,function(e,t){o=yyloc(t,t),r=Node({type:"Quantifier",kind:e,greedy:!0},o)}],[13,1,function(e,t){o=yyloc(t,t);var i=getRange(e);r=Node({type:"Quantifier",kind:"Range",from:i[0],to:i[0],greedy:!0},o)}],[13,1,function(e,t){o=yyloc(t,t),r=Node({type:"Quantifier",kind:"Range",from:getRange(e)[0],greedy:!0},o)}],[13,1,function(e,t){o=yyloc(t,t);var i=getRange(e);r=Node({type:"Quantifier",kind:"Range",from:i[0],to:i[1],greedy:!0},o)}],[14,1,function(e,t){o=yyloc(t,t),r=e}],[14,1,function(e,t){o=yyloc(t,t),r=e}],[15,3,function(e,t,i,n,s,a){if(o=yyloc(n,a),b.hasOwnProperty(e))throw new SyntaxError('Duplicate of the named group "'+e+'".');b[e]=e.groupNumber,r=Node({type:"Group",capturing:!0,name:e,number:e.groupNumber,expression:t},o)}],[15,3,function(e,t,i,n,s,a){o=yyloc(n,a),r=Node({type:"Group",capturing:!0,number:e.groupNumber,expression:t},o)}],[16,3,function(e,t,i,n,s,a){o=yyloc(n,a),r=Node({type:"Group",capturing:!1,expression:t},o)}],[17,3,function(e,t,i,n,s,a){o=yyloc(n,a),r=Node({type:"CharacterClass",negative:!0,expressions:t},o)}],[17,3,function(e,t,i,n,s,a){o=yyloc(n,a),r=Node({type:"CharacterClass",expressions:t},o)}],[18,0,function(){o=null,r=[]}],[18,1,function(e,t){o=yyloc(t,t),r=e}],[19,1,function(e,t){o=yyloc(t,t),r=[e]}],[19,2,function(e,t,i,n){o=yyloc(i,n),r=[e].concat(t)}],[19,4,function(e,t,i,n,s,a,l,c){o=yyloc(s,c),checkClassRange(e,i),r=[Node({type:"ClassRange",from:e,to:i},loc(s,l))],n&&(r=r.concat(n))}],[20,1,function(e,t){o=yyloc(t,t),r=e}],[20,2,function(e,t,i,n){o=yyloc(i,n),r=[e].concat(t)}],[20,4,function(e,t,i,n,s,a,l,c){o=yyloc(s,c),checkClassRange(e,i),r=[Node({type:"ClassRange",from:e,to:i},loc(s,l))],n&&(r=r.concat(n))}],[21,1,function(e,t){o=yyloc(t,t),r=Char(e,"simple",o)}],[21,1,function(e,t){o=yyloc(t,t),r=e}],[22,1,function(e,t){o=yyloc(t,t),r=e}],[22,1,function(e,t){o=yyloc(t,t),r=Char(e,"meta",o)}]],c={SLASH:"23",CHAR:"24",BAR:"25",BOS:"26",EOS:"27",ESC_b:"28",ESC_B:"29",POS_LA_ASSERT:"30",R_PAREN:"31",NEG_LA_ASSERT:"32",POS_LB_ASSERT:"33",NEG_LB_ASSERT:"34",ESC_CHAR:"35",U_CODE_SURROGATE:"36",U_CODE:"37",U_PROP_VALUE_EXP:"38",CTRL_CH:"39",HEX_CODE:"40",OCT_CODE:"41",DEC_CODE:"42",META_CHAR:"43",ANY:"44",NAMED_GROUP_REF:"45",Q_MARK:"46",STAR:"47",PLUS:"48",RANGE_EXACT:"49",RANGE_OPEN:"50",RANGE_CLOSED:"51",NAMED_CAPTURE_GROUP:"52",L_PAREN:"53",NON_CAPTURE_GROUP:"54",NEG_CLASS:"55",R_BRACKET:"56",L_BRACKET:"57",DASH:"58",$:"59"},u=[{0:1,23:"s2"},{59:"acc"},{3:3,4:4,5:5,6:6,23:"r10",24:"r10",25:"r10",26:"r10",27:"r10",28:"r10",29:"r10",30:"r10",32:"r10",33:"r10",34:"r10",35:"r10",36:"r10",37:"r10",38:"r10",39:"r10",40:"r10",41:"r10",42:"r10",43:"r10",44:"r10",45:"r10",52:"r10",53:"r10",54:"r10",55:"r10",57:"r10"},{23:"s7"},{23:"r6",25:"s12"},{23:"r7",25:"r7",31:"r7"},{7:14,8:15,9:16,10:25,14:27,15:42,16:43,17:26,23:"r9",24:"s28",25:"r9",26:"s17",27:"s18",28:"s19",29:"s20",30:"s21",31:"r9",32:"s22",33:"s23",34:"s24",35:"s29",36:"s30",37:"s31",38:"s32",39:"s33",40:"s34",41:"s35",42:"s36",43:"s37",44:"s38",45:"s39",52:"s44",53:"s45",54:"s46",55:"s40",57:"s41"},{1:8,2:9,24:"s10",59:"r3"},{59:"r1"},{24:"s11",59:"r2"},{24:"r4",59:"r4"},{24:"r5",59:"r5"},{5:13,6:6,23:"r10",24:"r10",25:"r10",26:"r10",27:"r10",28:"r10",29:"r10",30:"r10",31:"r10",32:"r10",33:"r10",34:"r10",35:"r10",36:"r10",37:"r10",38:"r10",39:"r10",40:"r10",41:"r10",42:"r10",43:"r10",44:"r10",45:"r10",52:"r10",53:"r10",54:"r10",55:"r10",57:"r10"},{23:"r8",25:"r8",31:"r8"},{23:"r11",24:"r11",25:"r11",26:"r11",27:"r11",28:"r11",29:"r11",30:"r11",31:"r11",32:"r11",33:"r11",34:"r11",35:"r11",36:"r11",37:"r11",38:"r11",39:"r11",40:"r11",41:"r11",42:"r11",43:"r11",44:"r11",45:"r11",52:"r11",53:"r11",54:"r11",55:"r11",57:"r11"},{23:"r12",24:"r12",25:"r12",26:"r12",27:"r12",28:"r12",29:"r12",30:"r12",31:"r12",32:"r12",33:"r12",34:"r12",35:"r12",36:"r12",37:"r12",38:"r12",39:"r12",40:"r12",41:"r12",42:"r12",43:"r12",44:"r12",45:"r12",52:"r12",53:"r12",54:"r12",55:"r12",57:"r12"},{11:47,12:48,13:49,23:"r38",24:"r38",25:"r38",26:"r38",27:"r38",28:"r38",29:"r38",30:"r38",31:"r38",32:"r38",33:"r38",34:"r38",35:"r38",36:"r38",37:"r38",38:"r38",39:"r38",40:"r38",41:"r38",42:"r38",43:"r38",44:"r38",45:"r38",46:"s52",47:"s50",48:"s51",49:"s53",50:"s54",51:"s55",52:"r38",53:"r38",54:"r38",55:"r38",57:"r38"},{23:"r14",24:"r14",25:"r14",26:"r14",27:"r14",28:"r14",29:"r14",30:"r14",31:"r14",32:"r14",33:"r14",34:"r14",35:"r14",36:"r14",37:"r14",38:"r14",39:"r14",40:"r14",41:"r14",42:"r14",43:"r14",44:"r14",45:"r14",52:"r14",53:"r14",54:"r14",55:"r14",57:"r14"},{23:"r15",24:"r15",25:"r15",26:"r15",27:"r15",28:"r15",29:"r15",30:"r15",31:"r15",32:"r15",33:"r15",34:"r15",35:"r15",36:"r15",37:"r15",38:"r15",39:"r15",40:"r15",41:"r15",42:"r15",43:"r15",44:"r15",45:"r15",52:"r15",53:"r15",54:"r15",55:"r15",57:"r15"},{23:"r16",24:"r16",25:"r16",26:"r16",27:"r16",28:"r16",29:"r16",30:"r16",31:"r16",32:"r16",33:"r16",34:"r16",35:"r16",36:"r16",37:"r16",38:"r16",39:"r16",40:"r16",41:"r16",42:"r16",43:"r16",44:"r16",45:"r16",52:"r16",53:"r16",54:"r16",55:"r16",57:"r16"},{23:"r17",24:"r17",25:"r17",26:"r17",27:"r17",28:"r17",29:"r17",30:"r17",31:"r17",32:"r17",33:"r17",34:"r17",35:"r17",36:"r17",37:"r17",38:"r17",39:"r17",40:"r17",41:"r17",42:"r17",43:"r17",44:"r17",45:"r17",52:"r17",53:"r17",54:"r17",55:"r17",57:"r17"},{4:57,5:5,6:6,24:"r10",25:"r10",26:"r10",27:"r10",28:"r10",29:"r10",30:"r10",31:"r10",32:"r10",33:"r10",34:"r10",35:"r10",36:"r10",37:"r10",38:"r10",39:"r10",40:"r10",41:"r10",42:"r10",43:"r10",44:"r10",45:"r10",52:"r10",53:"r10",54:"r10",55:"r10",57:"r10"},{4:59,5:5,6:6,24:"r10",25:"r10",26:"r10",27:"r10",28:"r10",29:"r10",30:"r10",31:"r10",32:"r10",33:"r10",34:"r10",35:"r10",36:"r10",37:"r10",38:"r10",39:"r10",40:"r10",41:"r10",42:"r10",43:"r10",44:"r10",45:"r10",52:"r10",53:"r10",54:"r10",55:"r10",57:"r10"},{4:61,5:5,6:6,24:"r10",25:"r10",26:"r10",27:"r10",28:"r10",29:"r10",30:"r10",31:"r10",32:"r10",33:"r10",34:"r10",35:"r10",36:"r10",37:"r10",38:"r10",39:"r10",40:"r10",41:"r10",42:"r10",43:"r10",44:"r10",45:"r10",52:"r10",53:"r10",54:"r10",55:"r10",57:"r10"},{4:63,5:5,6:6,24:"r10",25:"r10",26:"r10",27:"r10",28:"r10",29:"r10",30:"r10",31:"r10",32:"r10",33:"r10",34:"r10",35:"r10",36:"r10",37:"r10",38:"r10",39:"r10",40:"r10",41:"r10",42:"r10",43:"r10",44:"r10",45:"r10",52:"r10",53:"r10",54:"r10",55:"r10",57:"r10"},{23:"r22",24:"r22",25:"r22",26:"r22",27:"r22",28:"r22",29:"r22",30:"r22",31:"r22",32:"r22",33:"r22",34:"r22",35:"r22",36:"r22",37:"r22",38:"r22",39:"r22",40:"r22",41:"r22",42:"r22",43:"r22",44:"r22",45:"r22",46:"r22",47:"r22",48:"r22",49:"r22",50:"r22",51:"r22",52:"r22",53:"r22",54:"r22",55:"r22",57:"r22"},{23:"r23",24:"r23",25:"r23",26:"r23",27:"r23",28:"r23",29:"r23",30:"r23",31:"r23",32:"r23",33:"r23",34:"r23",35:"r23",36:"r23",37:"r23",38:"r23",39:"r23",40:"r23",41:"r23",42:"r23",43:"r23",44:"r23",45:"r23",46:"r23",47:"r23",48:"r23",49:"r23",50:"r23",51:"r23",52:"r23",53:"r23",54:"r23",55:"r23",57:"r23"},{23:"r24",24:"r24",25:"r24",26:"r24",27:"r24",28:"r24",29:"r24",30:"r24",31:"r24",32:"r24",33:"r24",34:"r24",35:"r24",36:"r24",37:"r24",38:"r24",39:"r24",40:"r24",41:"r24",42:"r24",43:"r24",44:"r24",45:"r24",46:"r24",47:"r24",48:"r24",49:"r24",50:"r24",51:"r24",52:"r24",53:"r24",54:"r24",55:"r24",57:"r24"},{23:"r25",24:"r25",25:"r25",26:"r25",27:"r25",28:"r25",29:"r25",30:"r25",31:"r25",32:"r25",33:"r25",34:"r25",35:"r25",36:"r25",37:"r25",38:"r25",39:"r25",40:"r25",41:"r25",42:"r25",43:"r25",44:"r25",45:"r25",46:"r25",47:"r25",48:"r25",49:"r25",50:"r25",51:"r25",52:"r25",53:"r25",54:"r25",55:"r25",56:"r25",57:"r25",58:"r25"},{23:"r26",24:"r26",25:"r26",26:"r26",27:"r26",28:"r26",29:"r26",30:"r26",31:"r26",32:"r26",33:"r26",34:"r26",35:"r26",36:"r26",37:"r26",38:"r26",39:"r26",40:"r26",41:"r26",42:"r26",43:"r26",44:"r26",45:"r26",46:"r26",47:"r26",48:"r26",49:"r26",50:"r26",51:"r26",52:"r26",53:"r26",54:"r26",55:"r26",56:"r26",57:"r26",58:"r26"},{23:"r27",24:"r27",25:"r27",26:"r27",27:"r27",28:"r27",29:"r27",30:"r27",31:"r27",32:"r27",33:"r27",34:"r27",35:"r27",36:"r27",37:"r27",38:"r27",39:"r27",40:"r27",41:"r27",42:"r27",43:"r27",44:"r27",45:"r27",46:"r27",47:"r27",48:"r27",49:"r27",50:"r27",51:"r27",52:"r27",53:"r27",54:"r27",55:"r27",56:"r27",57:"r27",58:"r27"},{23:"r28",24:"r28",25:"r28",26:"r28",27:"r28",28:"r28",29:"r28",30:"r28",31:"r28",32:"r28",33:"r28",34:"r28",35:"r28",36:"r28",37:"r28",38:"r28",39:"r28",40:"r28",41:"r28",42:"r28",43:"r28",44:"r28",45:"r28",46:"r28",47:"r28",48:"r28",49:"r28",50:"r28",51:"r28",52:"r28",53:"r28",54:"r28",55:"r28",56:"r28",57:"r28",58:"r28"},{23:"r29",24:"r29",25:"r29",26:"r29",27:"r29",28:"r29",29:"r29",30:"r29",31:"r29",32:"r29",33:"r29",34:"r29",35:"r29",36:"r29",37:"r29",38:"r29",39:"r29",40:"r29",41:"r29",42:"r29",43:"r29",44:"r29",45:"r29",46:"r29",47:"r29",48:"r29",49:"r29",50:"r29",51:"r29",52:"r29",53:"r29",54:"r29",55:"r29",56:"r29",57:"r29",58:"r29"},{23:"r30",24:"r30",25:"r30",26:"r30",27:"r30",28:"r30",29:"r30",30:"r30",31:"r30",32:"r30",33:"r30",34:"r30",35:"r30",36:"r30",37:"r30",38:"r30",39:"r30",40:"r30",41:"r30",42:"r30",43:"r30",44:"r30",45:"r30",46:"r30",47:"r30",48:"r30",49:"r30",50:"r30",51:"r30",52:"r30",53:"r30",54:"r30",55:"r30",56:"r30",57:"r30",58:"r30"},{23:"r31",24:"r31",25:"r31",26:"r31",27:"r31",28:"r31",29:"r31",30:"r31",31:"r31",32:"r31",33:"r31",34:"r31",35:"r31",36:"r31",37:"r31",38:"r31",39:"r31",40:"r31",41:"r31",42:"r31",43:"r31",44:"r31",45:"r31",46:"r31",47:"r31",48:"r31",49:"r31",50:"r31",51:"r31",52:"r31",53:"r31",54:"r31",55:"r31",56:"r31",57:"r31",58:"r31"},{23:"r32",24:"r32",25:"r32",26:"r32",27:"r32",28:"r32",29:"r32",30:"r32",31:"r32",32:"r32",33:"r32",34:"r32",35:"r32",36:"r32",37:"r32",38:"r32",39:"r32",40:"r32",41:"r32",42:"r32",43:"r32",44:"r32",45:"r32",46:"r32",47:"r32",48:"r32",49:"r32",50:"r32",51:"r32",52:"r32",53:"r32",54:"r32",55:"r32",56:"r32",57:"r32",58:"r32"},{23:"r33",24:"r33",25:"r33",26:"r33",27:"r33",28:"r33",29:"r33",30:"r33",31:"r33",32:"r33",33:"r33",34:"r33",35:"r33",36:"r33",37:"r33",38:"r33",39:"r33",40:"r33",41:"r33",42:"r33",43:"r33",44:"r33",45:"r33",46:"r33",47:"r33",48:"r33",49:"r33",50:"r33",51:"r33",52:"r33",53:"r33",54:"r33",55:"r33",56:"r33",57:"r33",58:"r33"},{23:"r34",24:"r34",25:"r34",26:"r34",27:"r34",28:"r34",29:"r34",30:"r34",31:"r34",32:"r34",33:"r34",34:"r34",35:"r34",36:"r34",37:"r34",38:"r34",39:"r34",40:"r34",41:"r34",42:"r34",43:"r34",44:"r34",45:"r34",46:"r34",47:"r34",48:"r34",49:"r34",50:"r34",51:"r34",52:"r34",53:"r34",54:"r34",55:"r34",56:"r34",57:"r34",58:"r34"},{23:"r35",24:"r35",25:"r35",26:"r35",27:"r35",28:"r35",29:"r35",30:"r35",31:"r35",32:"r35",33:"r35",34:"r35",35:"r35",36:"r35",37:"r35",38:"r35",39:"r35",40:"r35",41:"r35",42:"r35",43:"r35",44:"r35",45:"r35",46:"r35",47:"r35",48:"r35",49:"r35",50:"r35",51:"r35",52:"r35",53:"r35",54:"r35",55:"r35",56:"r35",57:"r35",58:"r35"},{23:"r36",24:"r36",25:"r36",26:"r36",27:"r36",28:"r36",29:"r36",30:"r36",31:"r36",32:"r36",33:"r36",34:"r36",35:"r36",36:"r36",37:"r36",38:"r36",39:"r36",40:"r36",41:"r36",42:"r36",43:"r36",44:"r36",45:"r36",46:"r36",47:"r36",48:"r36",49:"r36",50:"r36",51:"r36",52:"r36",53:"r36",54:"r36",55:"r36",56:"r36",57:"r36",58:"r36"},{10:70,18:65,19:66,21:67,22:69,24:"s28",28:"s71",35:"s29",36:"s30",37:"s31",38:"s32",39:"s33",40:"s34",41:"s35",42:"s36",43:"s37",44:"s38",45:"s39",56:"r54",58:"s68"},{10:70,18:83,19:66,21:67,22:69,24:"s28",28:"s71",35:"s29",36:"s30",37:"s31",38:"s32",39:"s33",40:"s34",41:"s35",42:"s36",43:"s37",44:"s38",45:"s39",56:"r54",58:"s68"},{23:"r47",24:"r47",25:"r47",26:"r47",27:"r47",28:"r47",29:"r47",30:"r47",31:"r47",32:"r47",33:"r47",34:"r47",35:"r47",36:"r47",37:"r47",38:"r47",39:"r47",40:"r47",41:"r47",42:"r47",43:"r47",44:"r47",45:"r47",46:"r47",47:"r47",48:"r47",49:"r47",50:"r47",51:"r47",52:"r47",53:"r47",54:"r47",55:"r47",57:"r47"},{23:"r48",24:"r48",25:"r48",26:"r48",27:"r48",28:"r48",29:"r48",30:"r48",31:"r48",32:"r48",33:"r48",34:"r48",35:"r48",36:"r48",37:"r48",38:"r48",39:"r48",40:"r48",41:"r48",42:"r48",43:"r48",44:"r48",45:"r48",46:"r48",47:"r48",48:"r48",49:"r48",50:"r48",51:"r48",52:"r48",53:"r48",54:"r48",55:"r48",57:"r48"},{4:85,5:5,6:6,24:"r10",25:"r10",26:"r10",27:"r10",28:"r10",29:"r10",30:"r10",31:"r10",32:"r10",33:"r10",34:"r10",35:"r10",36:"r10",37:"r10",38:"r10",39:"r10",40:"r10",41:"r10",42:"r10",43:"r10",44:"r10",45:"r10",52:"r10",53:"r10",54:"r10",55:"r10",57:"r10"},{4:87,5:5,6:6,24:"r10",25:"r10",26:"r10",27:"r10",28:"r10",29:"r10",30:"r10",31:"r10",32:"r10",33:"r10",34:"r10",35:"r10",36:"r10",37:"r10",38:"r10",39:"r10",40:"r10",41:"r10",42:"r10",43:"r10",44:"r10",45:"r10",52:"r10",53:"r10",54:"r10",55:"r10",57:"r10"},{4:89,5:5,6:6,24:"r10",25:"r10",26:"r10",27:"r10",28:"r10",29:"r10",30:"r10",31:"r10",32:"r10",33:"r10",34:"r10",35:"r10",36:"r10",37:"r10",38:"r10",39:"r10",40:"r10",41:"r10",42:"r10",43:"r10",44:"r10",45:"r10",52:"r10",53:"r10",54:"r10",55:"r10",57:"r10"},{23:"r13",24:"r13",25:"r13",26:"r13",27:"r13",28:"r13",29:"r13",30:"r13",31:"r13",32:"r13",33:"r13",34:"r13",35:"r13",36:"r13",37:"r13",38:"r13",39:"r13",40:"r13",41:"r13",42:"r13",43:"r13",44:"r13",45:"r13",52:"r13",53:"r13",54:"r13",55:"r13",57:"r13"},{23:"r37",24:"r37",25:"r37",26:"r37",27:"r37",28:"r37",29:"r37",30:"r37",31:"r37",32:"r37",33:"r37",34:"r37",35:"r37",36:"r37",37:"r37",38:"r37",39:"r37",40:"r37",41:"r37",42:"r37",43:"r37",44:"r37",45:"r37",52:"r37",53:"r37",54:"r37",55:"r37",57:"r37"},{23:"r39",24:"r39",25:"r39",26:"r39",27:"r39",28:"r39",29:"r39",30:"r39",31:"r39",32:"r39",33:"r39",34:"r39",35:"r39",36:"r39",37:"r39",38:"r39",39:"r39",40:"r39",41:"r39",42:"r39",43:"r39",44:"r39",45:"r39",46:"s56",52:"r39",53:"r39",54:"r39",55:"r39",57:"r39"},{23:"r41",24:"r41",25:"r41",26:"r41",27:"r41",28:"r41",29:"r41",30:"r41",31:"r41",32:"r41",33:"r41",34:"r41",35:"r41",36:"r41",37:"r41",38:"r41",39:"r41",40:"r41",41:"r41",42:"r41",43:"r41",44:"r41",45:"r41",46:"r41",52:"r41",53:"r41",54:"r41",55:"r41",57:"r41"},{23:"r42",24:"r42",25:"r42",26:"r42",27:"r42",28:"r42",29:"r42",30:"r42",31:"r42",32:"r42",33:"r42",34:"r42",35:"r42",36:"r42",37:"r42",38:"r42",39:"r42",40:"r42",41:"r42",42:"r42",43:"r42",44:"r42",45:"r42",46:"r42",52:"r42",53:"r42",54:"r42",55:"r42",57:"r42"},{23:"r43",24:"r43",25:"r43",26:"r43",27:"r43",28:"r43",29:"r43",30:"r43",31:"r43",32:"r43",33:"r43",34:"r43",35:"r43",36:"r43",37:"r43",38:"r43",39:"r43",40:"r43",41:"r43",42:"r43",43:"r43",44:"r43",45:"r43",46:"r43",52:"r43",53:"r43",54:"r43",55:"r43",57:"r43"},{23:"r44",24:"r44",25:"r44",26:"r44",27:"r44",28:"r44",29:"r44",30:"r44",31:"r44",32:"r44",33:"r44",34:"r44",35:"r44",36:"r44",37:"r44",38:"r44",39:"r44",40:"r44",41:"r44",42:"r44",43:"r44",44:"r44",45:"r44",46:"r44",52:"r44",53:"r44",54:"r44",55:"r44",57:"r44"},{23:"r45",24:"r45",25:"r45",26:"r45",27:"r45",28:"r45",29:"r45",30:"r45",31:"r45",32:"r45",33:"r45",34:"r45",35:"r45",36:"r45",37:"r45",38:"r45",39:"r45",40:"r45",41:"r45",42:"r45",43:"r45",44:"r45",45:"r45",46:"r45",52:"r45",53:"r45",54:"r45",55:"r45",57:"r45"},{23:"r46",24:"r46",25:"r46",26:"r46",27:"r46",28:"r46",29:"r46",30:"r46",31:"r46",32:"r46",33:"r46",34:"r46",35:"r46",36:"r46",37:"r46",38:"r46",39:"r46",40:"r46",41:"r46",42:"r46",43:"r46",44:"r46",45:"r46",46:"r46",52:"r46",53:"r46",54:"r46",55:"r46",57:"r46"},{23:"r40",24:"r40",25:"r40",26:"r40",27:"r40",28:"r40",29:"r40",30:"r40",31:"r40",32:"r40",33:"r40",34:"r40",35:"r40",36:"r40",37:"r40",38:"r40",39:"r40",40:"r40",41:"r40",42:"r40",43:"r40",44:"r40",45:"r40",52:"r40",53:"r40",54:"r40",55:"r40",57:"r40"},{25:"s12",31:"s58"},{23:"r18",24:"r18",25:"r18",26:"r18",27:"r18",28:"r18",29:"r18",30:"r18",31:"r18",32:"r18",33:"r18",34:"r18",35:"r18",36:"r18",37:"r18",38:"r18",39:"r18",40:"r18",41:"r18",42:"r18",43:"r18",44:"r18",45:"r18",52:"r18",53:"r18",54:"r18",55:"r18",57:"r18"},{25:"s12",31:"s60"},{23:"r19",24:"r19",25:"r19",26:"r19",27:"r19",28:"r19",29:"r19",30:"r19",31:"r19",32:"r19",33:"r19",34:"r19",35:"r19",36:"r19",37:"r19",38:"r19",39:"r19",40:"r19",41:"r19",42:"r19",43:"r19",44:"r19",45:"r19",52:"r19",53:"r19",54:"r19",55:"r19",57:"r19"},{25:"s12",31:"s62"},{23:"r20",24:"r20",25:"r20",26:"r20",27:"r20",28:"r20",29:"r20",30:"r20",31:"r20",32:"r20",33:"r20",34:"r20",35:"r20",36:"r20",37:"r20",38:"r20",39:"r20",40:"r20",41:"r20",42:"r20",43:"r20",44:"r20",45:"r20",52:"r20",53:"r20",54:"r20",55:"r20",57:"r20"},{25:"s12",31:"s64"},{23:"r21",24:"r21",25:"r21",26:"r21",27:"r21",28:"r21",29:"r21",30:"r21",31:"r21",32:"r21",33:"r21",34:"r21",35:"r21",36:"r21",37:"r21",38:"r21",39:"r21",40:"r21",41:"r21",42:"r21",43:"r21",44:"r21",45:"r21",52:"r21",53:"r21",54:"r21",55:"r21",57:"r21"},{56:"s72"},{56:"r55"},{10:70,20:73,21:75,22:76,24:"s28",28:"s71",35:"s29",36:"s30",37:"s31",38:"s32",39:"s33",40:"s34",41:"s35",42:"s36",43:"s37",44:"s38",45:"s39",56:"r56",58:"s74"},{24:"r62",28:"r62",35:"r62",36:"r62",37:"r62",38:"r62",39:"r62",40:"r62",41:"r62",42:"r62",43:"r62",44:"r62",45:"r62",56:"r62",58:"r62"},{24:"r63",28:"r63",35:"r63",36:"r63",37:"r63",38:"r63",39:"r63",40:"r63",41:"r63",42:"r63",43:"r63",44:"r63",45:"r63",56:"r63",58:"r63"},{24:"r64",28:"r64",35:"r64",36:"r64",37:"r64",38:"r64",39:"r64",40:"r64",41:"r64",42:"r64",43:"r64",44:"r64",45:"r64",56:"r64",58:"r64"},{24:"r65",28:"r65",35:"r65",36:"r65",37:"r65",38:"r65",39:"r65",40:"r65",41:"r65",42:"r65",43:"r65",44:"r65",45:"r65",56:"r65",58:"r65"},{23:"r52",24:"r52",25:"r52",26:"r52",27:"r52",28:"r52",29:"r52",30:"r52",31:"r52",32:"r52",33:"r52",34:"r52",35:"r52",36:"r52",37:"r52",38:"r52",39:"r52",40:"r52",41:"r52",42:"r52",43:"r52",44:"r52",45:"r52",46:"r52",47:"r52",48:"r52",49:"r52",50:"r52",51:"r52",52:"r52",53:"r52",54:"r52",55:"r52",57:"r52"},{56:"r57"},{10:70,21:77,22:69,24:"s28",28:"s71",35:"s29",36:"s30",37:"s31",38:"s32",39:"s33",40:"s34",41:"s35",42:"s36",43:"s37",44:"s38",45:"s39",56:"r62",58:"s68"},{56:"r59"},{10:70,20:79,21:75,22:76,24:"s28",28:"s71",35:"s29",36:"s30",37:"s31",38:"s32",39:"s33",40:"s34",41:"s35",42:"s36",43:"s37",44:"s38",45:"s39",56:"r63",58:"s80"},{10:70,18:78,19:66,21:67,22:69,24:"s28",28:"s71",35:"s29",36:"s30",37:"s31",38:"s32",39:"s33",40:"s34",41:"s35",42:"s36",43:"s37",44:"s38",45:"s39",56:"r54",58:"s68"},{56:"r58"},{56:"r60"},{10:70,21:81,22:69,24:"s28",28:"s71",35:"s29",36:"s30",37:"s31",38:"s32",39:"s33",40:"s34",41:"s35",42:"s36",43:"s37",44:"s38",45:"s39",56:"r62",58:"s68"},{10:70,18:82,19:66,21:67,22:69,24:"s28",28:"s71",35:"s29",36:"s30",37:"s31",38:"s32",39:"s33",40:"s34",41:"s35",42:"s36",43:"s37",44:"s38",45:"s39",56:"r54",58:"s68"},{56:"r61"},{56:"s84"},{23:"r53",24:"r53",25:"r53",26:"r53",27:"r53",28:"r53",29:"r53",30:"r53",31:"r53",32:"r53",33:"r53",34:"r53",35:"r53",36:"r53",37:"r53",38:"r53",39:"r53",40:"r53",41:"r53",42:"r53",43:"r53",44:"r53",45:"r53",46:"r53",47:"r53",48:"r53",49:"r53",50:"r53",51:"r53",52:"r53",53:"r53",54:"r53",55:"r53",57:"r53"},{25:"s12",31:"s86"},{23:"r49",24:"r49",25:"r49",26:"r49",27:"r49",28:"r49",29:"r49",30:"r49",31:"r49",32:"r49",33:"r49",34:"r49",35:"r49",36:"r49",37:"r49",38:"r49",39:"r49",40:"r49",41:"r49",42:"r49",43:"r49",44:"r49",45:"r49",46:"r49",47:"r49",48:"r49",49:"r49",50:"r49",51:"r49",52:"r49",53:"r49",54:"r49",55:"r49",57:"r49"},{25:"s12",31:"s88"},{23:"r50",24:"r50",25:"r50",26:"r50",27:"r50",28:"r50",29:"r50",30:"r50",31:"r50",32:"r50",33:"r50",34:"r50",35:"r50",36:"r50",37:"r50",38:"r50",39:"r50",40:"r50",41:"r50",42:"r50",43:"r50",44:"r50",45:"r50",46:"r50",47:"r50",48:"r50",49:"r50",50:"r50",51:"r50",52:"r50",53:"r50",54:"r50",55:"r50",57:"r50"},{25:"s12",31:"s90"},{23:"r51",24:"r51",25:"r51",26:"r51",27:"r51",28:"r51",29:"r51",30:"r51",31:"r51",32:"r51",33:"r51",34:"r51",35:"r51",36:"r51",37:"r51",38:"r51",39:"r51",40:"r51",41:"r51",42:"r51",43:"r51",44:"r51",45:"r51",46:"r51",47:"r51",48:"r51",49:"r51",50:"r51",51:"r51",52:"r51",53:"r51",54:"r51",55:"r51",57:"r51"}],h=[],d=void 0,f=[[/^#[^\n]+/,function(){}],[/^\s+/,function(){}],[/^\\-/,function(){return"ESC_CHAR"}],[/^-/,function(){return"DASH"}],[/^\//,function(){return"CHAR"}],[/^#/,function(){return"CHAR"}],[/^\|/,function(){return"CHAR"}],[/^\./,function(){return"CHAR"}],[/^\{/,function(){return"CHAR"}],[/^\{\d+\}/,function(){return"RANGE_EXACT"}],[/^\{\d+,\}/,function(){return"RANGE_OPEN"}],[/^\{\d+,\d+\}/,function(){return"RANGE_CLOSED"}],[/^\\k<([\w$]|\\u[0-9a-fA-F]{4}|\\u\{[0-9a-fA-F]{1,}\})+>/,function(){return validateUnicodeGroupName(n.slice(3,-1),this.getCurrentState()),"NAMED_GROUP_REF"}],[/^\\b/,function(){return"ESC_b"}],[/^\\B/,function(){return"ESC_B"}],[/^\\c[a-zA-Z]/,function(){return"CTRL_CH"}],[/^\\0\d{1,2}/,function(){return"OCT_CODE"}],[/^\\0/,function(){return"DEC_CODE"}],[/^\\\d{1,3}/,function(){return"DEC_CODE"}],[/^\\u[dD][89abAB][0-9a-fA-F]{2}\\u[dD][c-fC-F][0-9a-fA-F]{2}/,function(){return"U_CODE_SURROGATE"}],[/^\\u\{[0-9a-fA-F]{1,}\}/,function(){return"U_CODE"}],[/^\\u[0-9a-fA-F]{4}/,function(){return"U_CODE"}],[/^\\[pP]\{\w+(?:=\w+)?\}/,function(){return"U_PROP_VALUE_EXP"}],[/^\\x[0-9a-fA-F]{2}/,function(){return"HEX_CODE"}],[/^\\[tnrdDsSwWvf]/,function(){return"META_CHAR"}],[/^\\\//,function(){return"ESC_CHAR"}],[/^\\[ #]/,function(){return"ESC_CHAR"}],[/^\\[^*?+\[()\\|]/,function(){var e=this.getCurrentState();if("u"===e||"xu"===e||"u_class"===e)throw new SyntaxError("invalid Unicode escape "+n);return"ESC_CHAR"}],[/^\\[*?+\[()\\|]/,function(){return"ESC_CHAR"}],[/^\(/,function(){return"CHAR"}],[/^\)/,function(){return"CHAR"}],[/^\(\?=/,function(){return"POS_LA_ASSERT"}],[/^\(\?!/,function(){return"NEG_LA_ASSERT"}],[/^\(\?<=/,function(){return"POS_LB_ASSERT"}],[/^\(\?<!/,function(){return"NEG_LB_ASSERT"}],[/^\(\?:/,function(){return"NON_CAPTURE_GROUP"}],[/^\(\?<([\w$]|\\u[0-9a-fA-F]{4}|\\u\{[0-9a-fA-F]{1,}\})+>/,function(){return validateUnicodeGroupName(n=n.slice(3,-1),this.getCurrentState()),"NAMED_CAPTURE_GROUP"}],[/^\(/,function(){return"L_PAREN"}],[/^\)/,function(){return"R_PAREN"}],[/^[*?+[^$]/,function(){return"CHAR"}],[/^\\\]/,function(){return"ESC_CHAR"}],[/^\]/,function(){return this.popState(),"R_BRACKET"}],[/^\^/,function(){return"BOS"}],[/^\$/,function(){return"EOS"}],[/^\*/,function(){return"STAR"}],[/^\?/,function(){return"Q_MARK"}],[/^\+/,function(){return"PLUS"}],[/^\|/,function(){return"BAR"}],[/^\./,function(){return"ANY"}],[/^\//,function(){return"SLASH"}],[/^[^*?+\[()\\|]/,function(){return"CHAR"}],[/^\[\^/,function(){var e=this.getCurrentState();return this.pushState("u"===e||"xu"===e?"u_class":"class"),"NEG_CLASS"}],[/^\[/,function(){var e=this.getCurrentState();return this.pushState("u"===e||"xu"===e?"u_class":"class"),"L_BRACKET"}]],p={INITIAL:[9,10,11,12,13,14,15,16,17,18,21,23,24,25,27,28,31,32,33,34,35,36,37,38,42,43,44,45,46,47,48,49,50,51,52],u:[9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,27,28,31,32,33,34,35,36,37,38,42,43,44,45,46,47,48,49,50,51,52],xu:[0,1,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,31,32,33,34,35,36,37,38,42,43,44,45,46,47,48,49,50,51,52],x:[0,1,9,10,11,12,13,14,15,16,17,18,21,23,24,25,27,28,31,32,33,34,35,36,37,38,42,43,44,45,46,47,48,49,50,51,52],u_class:[2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52],class:[2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,21,23,24,25,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52]},g={type:a,value:""};d={initString:function initString(e){return this._string=e,this._cursor=0,this._states=["INITIAL"],this._tokensQueue=[],this._currentLine=1,this._currentColumn=0,this._currentLineBeginOffset=0,this._tokenStartOffset=0,this._tokenEndOffset=0,this._tokenStartLine=1,this._tokenEndLine=1,this._tokenStartColumn=0,this._tokenEndColumn=0,this},getStates:function getStates(){return this._states},getCurrentState:function getCurrentState(){return this._states[this._states.length-1]},pushState:function pushState(e){this._states.push(e)},begin:function begin(e){this.pushState(e)},popState:function popState(){return this._states.length>1?this._states.pop():this._states[0]},getNextToken:function getNextToken(){if(this._tokensQueue.length>0)return this.onToken(this._toToken(this._tokensQueue.shift()));if(!this.hasMoreTokens())return this.onToken(g);for(var e=this._string.slice(this._cursor),t=p[this.getCurrentState()],i=0;i<t.length;i++){var s=t[i],r=f[s],o=this._match(e,r[0]);if(""===e&&""===o&&this._cursor++,null!==o){(n=o).length;var a=r[1].call(this);if(!a)return this.getNextToken();if(Array.isArray(a)){var l,c=a.slice(1);if(a=a[0],c.length>0)(l=this._tokensQueue).unshift.apply(l,_toConsumableArray(c))}return this.onToken(this._toToken(a,n))}}if(this.isEOF())return this._cursor++,g;this.throwUnexpectedToken(e[0],this._currentLine,this._currentColumn)},throwUnexpectedToken:function throwUnexpectedToken(e,t,i){var n=this._string.split("\n")[t-1],s="";n&&(s="\n\n"+n+"\n"+" ".repeat(i)+"^\n");throw new SyntaxError(s+'Unexpected token: "'+e+'" at '+t+":"+i+".")},getCursor:function getCursor(){return this._cursor},getCurrentLine:function getCurrentLine(){return this._currentLine},getCurrentColumn:function getCurrentColumn(){return this._currentColumn},_captureLocation:function _captureLocation(e){var t=/\n/g;this._tokenStartOffset=this._cursor,this._tokenStartLine=this._currentLine,this._tokenStartColumn=this._tokenStartOffset-this._currentLineBeginOffset;for(var i=void 0;null!==(i=t.exec(e));)this._currentLine++,this._currentLineBeginOffset=this._tokenStartOffset+i.index+1;this._tokenEndOffset=this._cursor+e.length,this._tokenEndLine=this._currentLine,this._tokenEndColumn=this._currentColumn=this._tokenEndOffset-this._currentLineBeginOffset},_toToken:function _toToken(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return{type:e,value:t,startOffset:this._tokenStartOffset,endOffset:this._tokenEndOffset,startLine:this._tokenStartLine,endLine:this._tokenEndLine,startColumn:this._tokenStartColumn,endColumn:this._tokenEndColumn}},isEOF:function isEOF(){return this._cursor===this._string.length},hasMoreTokens:function hasMoreTokens(){return this._cursor<=this._string.length},_match:function _match(e,t){var i=e.match(t);return i?(this._captureLocation(i[0]),this._cursor+=i[0].length,i[0]):null},onToken:function onToken(e){return e}},s.lexer=d,s.tokenizer=d,s.options={captureLocations:!0};var m={setOptions:function setOptions(e){return s.options=e,this},getOptions:function getOptions(){return s.options},parse:function parse(e,t){if(!d)throw new Error("Tokenizer instance wasn't specified.");d.initString(e);var i=s.options;t&&(s.options=Object.assign({},s.options,t)),m.onParseBegin(e,d,s.options),h.length=0,h.push(0);var a=d.getNextToken(),f=null;do{a||(s.options=i,unexpectedEndOfInput());var p=h[h.length-1],g=c[a.type];u[p].hasOwnProperty(g)||(s.options=i,unexpectedToken(a));var _=u[p][g];if("s"===_[0]){var b=null;s.options.captureLocations&&(b={startOffset:a.startOffset,endOffset:a.endOffset,startLine:a.startLine,endLine:a.endLine,startColumn:a.startColumn,endColumn:a.endColumn}),f=this.onShift(a),h.push({symbol:c[f.type],semanticValue:f.value,loc:b},Number(_.slice(1))),a=d.getNextToken()}else if("r"===_[0]){var v=_.slice(1),y=l[v],w="function"==typeof y[2],k=w?[]:null,C=w&&s.options.captureLocations?[]:null;if(0!==y[1])for(var x=y[1];x-- >0;){h.pop();var S=h.pop();w&&(k.unshift(S.semanticValue),C&&C.unshift(S.loc))}var E={symbol:y[0]};if(w){n=f?f.value:null,f?f.value.length:null;var F=null!==C?k.concat(C):k;y[2].apply(y,_toConsumableArray(F)),E.semanticValue=r,C&&(E.loc=o)}var O=h[h.length-1],A=y[0];h.push(E,u[O][A])}else if("acc"===_){h.pop();var j=h.pop();return(1!==h.length||0!==h[0]||d.hasMoreTokens())&&(s.options=i,unexpectedToken(a)),j.hasOwnProperty("semanticValue")?(s.options=i,m.onParseEnd(j.semanticValue),j.semanticValue):(m.onParseEnd(),s.options=i,!0)}}while(d.hasMoreTokens()||h.length>1)},setTokenizer:function setTokenizer(e){return d=e,m},getTokenizer:function getTokenizer(){return d},onParseBegin:function onParseBegin(e,t,i){},onParseEnd:function onParseEnd(e){},onShift:function onShift(e){return e}},_=0,b={},v="";function getRange(e){var t=e.match(/\d+/g).map(Number);if(Number.isFinite(t[1])&&t[1]<t[0])throw new SyntaxError("Numbers out of order in "+e+" quantifier");return t}function checkClassRange(e,t){if("control"===e.kind||"control"===t.kind||!isNaN(e.codePoint)&&!isNaN(t.codePoint)&&e.codePoint>t.codePoint)throw new SyntaxError("Range "+e.value+"-"+t.value+" out of order in character class")}m.onParseBegin=function(e,t){v=e,_=0,b={};var i=e.lastIndexOf("/"),n=e.slice(i);n.includes("x")&&n.includes("u")?t.pushState("xu"):(n.includes("x")&&t.pushState("x"),n.includes("u")&&t.pushState("u"))},m.onShift=function(e){return"L_PAREN"!==e.type&&"NAMED_CAPTURE_GROUP"!==e.type||(e.value=new String(e.value),e.value.groupNumber=++_),e};var y=i(62);function Char(e,t,i){var n=void 0,s=void 0;switch(t){case"decimal":s=Number(e.slice(1)),n=String.fromCodePoint(s);break;case"oct":s=parseInt(e.slice(1),8),n=String.fromCodePoint(s);break;case"hex":case"unicode":if(e.lastIndexOf("\\u")>0){var r=e.split("\\u").slice(1),o=_slicedToArray(r,2),a=o[0],l=o[1];s=1024*((a=parseInt(a,16))-55296)+((l=parseInt(l,16))-56320)+65536,n=String.fromCodePoint(s)}else{var c=e.slice(2).replace("{","");if((s=parseInt(c,16))>1114111)throw new SyntaxError("Bad character escape sequence: "+e);n=String.fromCodePoint(s)}break;case"meta":switch(e){case"\\t":s=(n="\t").codePointAt(0);break;case"\\n":s=(n="\n").codePointAt(0);break;case"\\r":s=(n="\r").codePointAt(0);break;case"\\v":s=(n="\v").codePointAt(0);break;case"\\f":s=(n="\f").codePointAt(0);break;case"\\b":s=(n="\b").codePointAt(0);case"\\0":n="\0",s=0;case".":n=".",s=NaN;break;default:s=NaN}break;case"simple":s=(n=e).codePointAt(0)}return Node({type:"Char",value:e,kind:t,symbol:n,codePoint:s},i)}var w="gimsuxy";function checkFlags(e){var t=new Set,i=!0,n=!1,s=void 0;try{for(var r,o=e[Symbol.iterator]();!(i=(r=o.next()).done);i=!0){var a=r.value;if(t.has(a)||!w.includes(a))throw new SyntaxError("Invalid flags: "+e);t.add(a)}}catch(e){n=!0,s=e}finally{try{!i&&o.return&&o.return()}finally{if(n)throw s}}return e.split("").sort().join("")}var k=/^\\u[0-9a-fA-F]{4}/,C=/^\\u\{[0-9a-fA-F]{1,}\}/;function validateUnicodeGroupName(e,t){if((k.test(e)||C.test(e))&&!("u"===t||"xu"===t||"u_class"===t))throw new SyntaxError('invalid group Unicode name "'+e+'", use `u` flag.')}function Node(e,t){return s.options.captureLocations&&(e.loc={source:v.slice(t.startOffset,t.endOffset),start:{line:t.startLine,column:t.startColumn,offset:t.startOffset},end:{line:t.endLine,column:t.endColumn,offset:t.endOffset}}),e}function loc(e,t){return s.options.captureLocations?{startOffset:e.startOffset,endOffset:t.endOffset,startLine:e.startLine,endLine:t.endLine,startColumn:e.startColumn,endColumn:t.endColumn}:null}function unexpectedToken(e){e.type===a&&unexpectedEndOfInput(),d.throwUnexpectedToken(e.value,e.startLine,e.startColumn)}function unexpectedEndOfInput(){!function parseError(e){throw new SyntaxError(e)}("Unexpected end of input.")}e.exports=m},function(e,t,i){"use strict";var n={General_Category:"gc",Script:"sc",Script_Extensions:"scx"},s=inverseMap(n),r={ASCII:"ASCII",ASCII_Hex_Digit:"AHex",Alphabetic:"Alpha",Any:"Any",Assigned:"Assigned",Bidi_Control:"Bidi_C",Bidi_Mirrored:"Bidi_M",Case_Ignorable:"CI",Cased:"Cased",Changes_When_Casefolded:"CWCF",Changes_When_Casemapped:"CWCM",Changes_When_Lowercased:"CWL",Changes_When_NFKC_Casefolded:"CWKCF",Changes_When_Titlecased:"CWT",Changes_When_Uppercased:"CWU",Dash:"Dash",Default_Ignorable_Code_Point:"DI",Deprecated:"Dep",Diacritic:"Dia",Emoji:"Emoji",Emoji_Component:"Emoji_Component",Emoji_Modifier:"Emoji_Modifier",Emoji_Modifier_Base:"Emoji_Modifier_Base",Emoji_Presentation:"Emoji_Presentation",Extended_Pictographic:"Extended_Pictographic",Extender:"Ext",Grapheme_Base:"Gr_Base",Grapheme_Extend:"Gr_Ext",Hex_Digit:"Hex",IDS_Binary_Operator:"IDSB",IDS_Trinary_Operator:"IDST",ID_Continue:"IDC",ID_Start:"IDS",Ideographic:"Ideo",Join_Control:"Join_C",Logical_Order_Exception:"LOE",Lowercase:"Lower",Math:"Math",Noncharacter_Code_Point:"NChar",Pattern_Syntax:"Pat_Syn",Pattern_White_Space:"Pat_WS",Quotation_Mark:"QMark",Radical:"Radical",Regional_Indicator:"RI",Sentence_Terminal:"STerm",Soft_Dotted:"SD",Terminal_Punctuation:"Term",Unified_Ideograph:"UIdeo",Uppercase:"Upper",Variation_Selector:"VS",White_Space:"space",XID_Continue:"XIDC",XID_Start:"XIDS"},o=inverseMap(r),a={Cased_Letter:"LC",Close_Punctuation:"Pe",Connector_Punctuation:"Pc",Control:["Cc","cntrl"],Currency_Symbol:"Sc",Dash_Punctuation:"Pd",Decimal_Number:["Nd","digit"],Enclosing_Mark:"Me",Final_Punctuation:"Pf",Format:"Cf",Initial_Punctuation:"Pi",Letter:"L",Letter_Number:"Nl",Line_Separator:"Zl",Lowercase_Letter:"Ll",Mark:["M","Combining_Mark"],Math_Symbol:"Sm",Modifier_Letter:"Lm",Modifier_Symbol:"Sk",Nonspacing_Mark:"Mn",Number:"N",Open_Punctuation:"Ps",Other:"C",Other_Letter:"Lo",Other_Number:"No",Other_Punctuation:"Po",Other_Symbol:"So",Paragraph_Separator:"Zp",Private_Use:"Co",Punctuation:["P","punct"],Separator:"Z",Space_Separator:"Zs",Spacing_Mark:"Mc",Surrogate:"Cs",Symbol:"S",Titlecase_Letter:"Lt",Unassigned:"Cn",Uppercase_Letter:"Lu"},l=inverseMap(a),c={Adlam:"Adlm",Ahom:"Ahom",Anatolian_Hieroglyphs:"Hluw",Arabic:"Arab",Armenian:"Armn",Avestan:"Avst",Balinese:"Bali",Bamum:"Bamu",Bassa_Vah:"Bass",Batak:"Batk",Bengali:"Beng",Bhaiksuki:"Bhks",Bopomofo:"Bopo",Brahmi:"Brah",Braille:"Brai",Buginese:"Bugi",Buhid:"Buhd",Canadian_Aboriginal:"Cans",Carian:"Cari",Caucasian_Albanian:"Aghb",Chakma:"Cakm",Cham:"Cham",Cherokee:"Cher",Common:"Zyyy",Coptic:["Copt","Qaac"],Cuneiform:"Xsux",Cypriot:"Cprt",Cyrillic:"Cyrl",Deseret:"Dsrt",Devanagari:"Deva",Dogra:"Dogr",Duployan:"Dupl",Egyptian_Hieroglyphs:"Egyp",Elbasan:"Elba",Ethiopic:"Ethi",Georgian:"Geor",Glagolitic:"Glag",Gothic:"Goth",Grantha:"Gran",Greek:"Grek",Gujarati:"Gujr",Gunjala_Gondi:"Gong",Gurmukhi:"Guru",Han:"Hani",Hangul:"Hang",Hanifi_Rohingya:"Rohg",Hanunoo:"Hano",Hatran:"Hatr",Hebrew:"Hebr",Hiragana:"Hira",Imperial_Aramaic:"Armi",Inherited:["Zinh","Qaai"],Inscriptional_Pahlavi:"Phli",Inscriptional_Parthian:"Prti",Javanese:"Java",Kaithi:"Kthi",Kannada:"Knda",Katakana:"Kana",Kayah_Li:"Kali",Kharoshthi:"Khar",Khmer:"Khmr",Khojki:"Khoj",Khudawadi:"Sind",Lao:"Laoo",Latin:"Latn",Lepcha:"Lepc",Limbu:"Limb",Linear_A:"Lina",Linear_B:"Linb",Lisu:"Lisu",Lycian:"Lyci",Lydian:"Lydi",Mahajani:"Mahj",Makasar:"Maka",Malayalam:"Mlym",Mandaic:"Mand",Manichaean:"Mani",Marchen:"Marc",Medefaidrin:"Medf",Masaram_Gondi:"Gonm",Meetei_Mayek:"Mtei",Mende_Kikakui:"Mend",Meroitic_Cursive:"Merc",Meroitic_Hieroglyphs:"Mero",Miao:"Plrd",Modi:"Modi",Mongolian:"Mong",Mro:"Mroo",Multani:"Mult",Myanmar:"Mymr",Nabataean:"Nbat",New_Tai_Lue:"Talu",Newa:"Newa",Nko:"Nkoo",Nushu:"Nshu",Ogham:"Ogam",Ol_Chiki:"Olck",Old_Hungarian:"Hung",Old_Italic:"Ital",Old_North_Arabian:"Narb",Old_Permic:"Perm",Old_Persian:"Xpeo",Old_Sogdian:"Sogo",Old_South_Arabian:"Sarb",Old_Turkic:"Orkh",Oriya:"Orya",Osage:"Osge",Osmanya:"Osma",Pahawh_Hmong:"Hmng",Palmyrene:"Palm",Pau_Cin_Hau:"Pauc",Phags_Pa:"Phag",Phoenician:"Phnx",Psalter_Pahlavi:"Phlp",Rejang:"Rjng",Runic:"Runr",Samaritan:"Samr",Saurashtra:"Saur",Sharada:"Shrd",Shavian:"Shaw",Siddham:"Sidd",SignWriting:"Sgnw",Sinhala:"Sinh",Sogdian:"Sogd",Sora_Sompeng:"Sora",Soyombo:"Soyo",Sundanese:"Sund",Syloti_Nagri:"Sylo",Syriac:"Syrc",Tagalog:"Tglg",Tagbanwa:"Tagb",Tai_Le:"Tale",Tai_Tham:"Lana",Tai_Viet:"Tavt",Takri:"Takr",Tamil:"Taml",Tangut:"Tang",Telugu:"Telu",Thaana:"Thaa",Thai:"Thai",Tibetan:"Tibt",Tifinagh:"Tfng",Tirhuta:"Tirh",Ugaritic:"Ugar",Vai:"Vaii",Warang_Citi:"Wara",Yi:"Yiii",Zanabazar_Square:"Zanb"},u=inverseMap(c);function inverseMap(e){var t={};for(var i in e)if(e.hasOwnProperty(i)){var n=e[i];if(Array.isArray(n))for(var s=0;s<n.length;s++)t[n[s]]=i;else t[n]=i}return t}function isGeneralCategoryValue(e){return a.hasOwnProperty(e)||l.hasOwnProperty(e)}function isScriptCategoryValue(e){return c.hasOwnProperty(e)||u.hasOwnProperty(e)}e.exports={isAlias:function isAlias(e){return s.hasOwnProperty(e)||o.hasOwnProperty(e)},isValidName:function isValidName(e){return n.hasOwnProperty(e)||s.hasOwnProperty(e)||r.hasOwnProperty(e)||o.hasOwnProperty(e)},isValidValue:function isValidValue(e,t){return function isGeneralCategoryName(e){return"General_Category"===e||"gc"==e}(e)?isGeneralCategoryValue(t):!!function isScriptCategoryName(e){return"Script"===e||"Script_Extensions"===e||"sc"===e||"scx"===e}(e)&&isScriptCategoryValue(t)},isGeneralCategoryValue:isGeneralCategoryValue,isScriptCategoryValue:isScriptCategoryValue,isBinaryPropertyName:function isBinaryPropertyName(e){return r.hasOwnProperty(e)||o.hasOwnProperty(e)},getCanonicalName:function getCanonicalName(e){return s.hasOwnProperty(e)?s[e]:o.hasOwnProperty(e)?o[e]:null},getCanonicalValue:function getCanonicalValue(e){return l.hasOwnProperty(e)?l[e]:u.hasOwnProperty(e)?u[e]:o.hasOwnProperty(e)?o[e]:null},NON_BINARY_PROP_NAMES_TO_ALIASES:n,NON_BINARY_ALIASES_TO_PROP_NAMES:s,BINARY_PROP_NAMES_TO_ALIASES:r,BINARY_ALIASES_TO_PROP_NAMES:o,GENERAL_CATEGORY_VALUE_TO_ALIASES:a,GENERAL_CATEGORY_VALUE_ALIASES_TO_VALUES:l,SCRIPT_VALUE_TO_ALIASES:c,SCRIPT_VALUE_ALIASES_TO_VALUE:u}},function(e,t,i){"use strict";var n=i(64),s=i(14),r=i(19),o=i(65);e.exports={optimize:function optimize(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],i=t.length>0?t:Object.keys(o),a=e;e instanceof RegExp&&(e=""+e),"string"==typeof e&&(a=s.parse(e));var l=new r.TransformResult(a),c=void 0;do{c=l.toString(),a=n(l.getAST()),i.forEach((function(e){if(!o.hasOwnProperty(e))throw new Error("Unknown optimization-transform: "+e+". Available transforms are: "+Object.keys(o).join(", "));var t=o[e],i=r.transform(a,t);i.toString()!==l.toString()&&(i.toString().length<=l.toString().length?l=i:a=n(l.getAST()))}))}while(l.toString()!==c);return l}}},function(e,t,i){"use strict";e.exports=function clone(e){if(null===e||"object"!=typeof e)return e;var t=void 0;for(var i in t=Array.isArray(e)?[]:{},e)t[i]=clone(e[i]);return t}},function(e,t,i){"use strict";e.exports={charSurrogatePairToSingleUnicode:i(66),charCodeToSimpleChar:i(67),charCaseInsensitiveLowerCaseTransform:i(68),charClassRemoveDuplicates:i(69),quantifiersMerge:i(70),quantifierRangeToSymbol:i(71),charClassClassrangesToChars:i(72),charClassClassrangesMerge:i(73),charClassToMeta:i(74),charClassToSingleChar:i(75),charEscapeUnescape:i(76),disjunctionRemoveDuplicates:i(77),groupSingleCharsToCharClass:i(78),removeEmptyGroup:i(79),ungroup:i(80),combineRepeatingPatterns:i(81)}},function(e,t,i){"use strict";e.exports={shouldRun:function shouldRun(e){return e.flags.includes("u")},Char:function Char(e){var t=e.node;"unicode"===t.kind&&t.isSurrogatePair&&!isNaN(t.codePoint)&&(t.value="\\u{"+t.codePoint.toString(16)+"}",delete t.isSurrogatePair)}}},function(e,t,i){"use strict";var n="A".codePointAt(0),s="Z".codePointAt(0),r="a".codePointAt(0),o="z".codePointAt(0),a="0".codePointAt(0),l="9".codePointAt(0);e.exports={Char:function Char(e){var t=e.node,i=e.parent;if(!isNaN(t.codePoint)&&"simple"!==t.kind&&("ClassRange"!==i.type||function isSimpleRange(e){var t=e.from,i=e.to;return t.codePoint>=a&&t.codePoint<=l&&i.codePoint>=a&&i.codePoint<=l||t.codePoint>=n&&t.codePoint<=s&&i.codePoint>=n&&i.codePoint<=s||t.codePoint>=r&&t.codePoint<=o&&i.codePoint>=r&&i.codePoint<=o}(i))&&function isPrintableASCIIChar(e){return e>=32&&e<=126}(t.codePoint)){var c=String.fromCodePoint(t.codePoint),u={type:"Char",kind:"simple",value:c,symbol:c,codePoint:t.codePoint};(function needsEscape(e,t){if("ClassRange"===t||"CharacterClass"===t)return/[\]\\^-]/.test(e);return/[*[()+?^$./\\|{}]/.test(e)})(c,i.type)&&(u.escaped=!0),e.replace(u)}}}},function(e,t,i){"use strict";var n="A".codePointAt(0),s="Z".codePointAt(0);e.exports={_AZClassRanges:null,_hasUFlag:!1,init:function init(e){this._AZClassRanges=new Set,this._hasUFlag=e.flags.includes("u")},shouldRun:function shouldRun(e){return e.flags.includes("i")},Char:function Char(e){var t=e.node,i=e.parent;if(!isNaN(t.codePoint)&&(this._hasUFlag||!(t.codePoint>=4096))){if("ClassRange"===i.type){if(!this._AZClassRanges.has(i)&&!function isAZClassRange(e){var t=e.from,i=e.to;return t.codePoint>=n&&t.codePoint<=s&&i.codePoint>=n&&i.codePoint<=s}(i))return;this._AZClassRanges.add(i)}var r=t.symbol.toLowerCase();r!==t.symbol&&(t.value=function displaySymbolAsValue(e,t){var i=e.codePointAt(0);if("decimal"===t.kind)return"\\"+i;if("oct"===t.kind)return"\\0"+i.toString(8);if("hex"===t.kind)return"\\x"+i.toString(16);if("unicode"===t.kind){if(t.isSurrogatePair){var n=function getSurrogatePairFromCodePoint(e){var t=Math.floor((e-65536)/1024)+55296,i=(e-65536)%1024+56320;return{lead:t.toString(16),trail:i.toString(16)}}(i),s=n.lead,r=n.trail;return"\\u"+"0".repeat(4-s.length)+s+"\\u"+"0".repeat(4-r.length)+r}if(t.value.includes("{"))return"\\u{"+i.toString(16)+"}";var o=i.toString(16);return"\\u"+"0".repeat(4-o.length)+o}return e}(r,t),t.symbol=r,t.codePoint=r.codePointAt(0))}}}},function(e,t,i){"use strict";e.exports={CharacterClass:function CharacterClass(e){for(var t=e.node,i={},n=0;n<t.expressions.length;n++){var s=e.getChild(n),r=s.jsonEncode();i.hasOwnProperty(r)&&(s.remove(),n--),i[r]=!0}}}},function(e,t,i){"use strict";var n=i(21).increaseQuantifierByOne;function isGreedyOpenRange(e){return e.greedy&&("+"===e.kind||"*"===e.kind||"Range"===e.kind&&!e.to)}function extractFromTo(e){var t=void 0,i=void 0;return"*"===e.kind?t=0:"+"===e.kind?t=1:"?"===e.kind?(t=0,i=1):(t=e.from,e.to&&(i=e.to)),{from:t,to:i}}e.exports={Repetition:function Repetition(e){var t=e.node;if("Alternative"===e.parent.type&&e.index){var i=e.getPreviousSibling();if(i)if("Repetition"===i.node.type){if(!i.getChild().hasEqualSource(e.getChild()))return;var s=extractFromTo(i.node.quantifier),r=s.from,o=s.to,a=extractFromTo(t.quantifier),l=a.from,c=a.to;if(i.node.quantifier.greedy!==t.quantifier.greedy&&!isGreedyOpenRange(i.node.quantifier)&&!isGreedyOpenRange(t.quantifier))return;t.quantifier.kind="Range",t.quantifier.from=r+l,o&&c?t.quantifier.to=o+c:delete t.quantifier.to,(isGreedyOpenRange(i.node.quantifier)||isGreedyOpenRange(t.quantifier))&&(t.quantifier.greedy=!0),i.remove()}else{if(!i.hasEqualSource(e.getChild()))return;n(t.quantifier),i.remove()}}}}},function(e,t,i){"use strict";e.exports={Quantifier:function Quantifier(e){"Range"===e.node.kind&&(!function rewriteOpenZero(e){var t=e.node;if(0!==t.from||t.to)return;t.kind="*",delete t.from}(e),function rewriteOpenOne(e){var t=e.node;if(1!==t.from||t.to)return;t.kind="+",delete t.from}(e),function rewriteExactOne(e){var t=e.node;if(1!==t.from||1!==t.to)return;e.parentPath.replace(e.parentPath.node.expression)}(e))}}},function(e,t,i){"use strict";e.exports={ClassRange:function ClassRange(e){var t=e.node;t.from.codePoint===t.to.codePoint?e.replace(t.from):t.from.codePoint===t.to.codePoint-1&&(e.getParent().insertChildAt(t.to,e.index+1),e.replace(t.from))}}},function(e,t,i){"use strict";function sortCharClass(e,t){var i=getSortValue(e),n=getSortValue(t);if(i===n){if("ClassRange"===e.type&&"ClassRange"!==t.type)return-1;if("ClassRange"===t.type&&"ClassRange"!==e.type)return 1;if("ClassRange"===e.type&&"ClassRange"===t.type)return getSortValue(e.to)-getSortValue(t.to);if(isMeta(e)&&isMeta(t)||isControl(e)&&isControl(t))return e.value<t.value?-1:1}return i-n}function getSortValue(e){return"Char"===e.type?"control"===e.kind?1/0:"meta"===e.kind&&isNaN(e.codePoint)?-1:e.codePoint:e.from.codePoint}function isMeta(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return"Char"===e.type&&"meta"===e.kind&&(t?e.value===t:/^\\[dws]$/i.test(e.value))}function isControl(e){return"Char"===e.type&&"control"===e.kind}function fitsInMetas(e,t,i){for(var n=0;n<t.length;n++)if(fitsInMeta(e,t[n],i))return!0;return!1}function fitsInMeta(e,t,i){return"ClassRange"===e.type?fitsInMeta(e.from,t,i)&&fitsInMeta(e.to,t,i):!("\\S"!==t||!isMeta(e,"\\w")&&!isMeta(e,"\\d"))||(!("\\D"!==t||!isMeta(e,"\\W")&&!isMeta(e,"\\s"))||(!("\\w"!==t||!isMeta(e,"\\d"))||(!("\\W"!==t||!isMeta(e,"\\s"))||"Char"===e.type&&!isNaN(e.codePoint)&&("\\s"===t?fitsInMetaS(e):"\\S"===t?!fitsInMetaS(e):"\\d"===t?fitsInMetaD(e):"\\D"===t?!fitsInMetaD(e):"\\w"===t?fitsInMetaW(e,i):"\\W"===t&&!fitsInMetaW(e,i)))))}function fitsInMetaS(e){return 9===e.codePoint||10===e.codePoint||11===e.codePoint||12===e.codePoint||13===e.codePoint||32===e.codePoint||160===e.codePoint||5760===e.codePoint||e.codePoint>=8192&&e.codePoint<=8202||8232===e.codePoint||8233===e.codePoint||8239===e.codePoint||8287===e.codePoint||12288===e.codePoint||65279===e.codePoint}function fitsInMetaD(e){return e.codePoint>=48&&e.codePoint<=57}function fitsInMetaW(e,t){return fitsInMetaD(e)||e.codePoint>=65&&e.codePoint<=90||e.codePoint>=97&&e.codePoint<=122||"_"===e.value||t&&(383===e.codePoint||8490===e.codePoint)}function combinesWithPrecedingClassRange(e,t){if(t&&"ClassRange"===t.type){if(function fitsInClassRange(e,t){if("Char"===e.type&&isNaN(e.codePoint))return!1;if("ClassRange"===e.type)return fitsInClassRange(e.from,t)&&fitsInClassRange(e.to,t);return e.codePoint>=t.from.codePoint&&e.codePoint<=t.to.codePoint}(e,t))return!0;if(isMetaWCharOrCode(e)&&t.to.codePoint===e.codePoint-1)return t.to=e,!0;if("ClassRange"===e.type&&e.from.codePoint<=t.to.codePoint+1&&e.to.codePoint>=t.from.codePoint-1)return e.from.codePoint<t.from.codePoint&&(t.from=e.from),e.to.codePoint>t.to.codePoint&&(t.to=e.to),!0}return!1}function combinesWithFollowingClassRange(e,t){return!(!t||"ClassRange"!==t.type||!isMetaWCharOrCode(e)||t.from.codePoint!==e.codePoint+1)&&(t.from=e,!0)}function charCombinesWithPrecedingChars(e,t,i){if(!isMetaWCharOrCode(e))return 0;for(var n=0;t>0;){var s=i[t],r=i[t-1];if(!isMetaWCharOrCode(r)||r.codePoint!==s.codePoint-1)break;n++,t--}return n>1?(i[t]={type:"ClassRange",from:i[t],to:e},n):0}function isMetaWCharOrCode(e){return e&&"Char"===e.type&&!isNaN(e.codePoint)&&(fitsInMetaW(e,!1)||"unicode"===e.kind||"hex"===e.kind||"oct"===e.kind||"decimal"===e.kind)}e.exports={_hasIUFlags:!1,init:function init(e){this._hasIUFlags=e.flags.includes("i")&&e.flags.includes("u")},CharacterClass:function CharacterClass(e){var t=e.node.expressions,i=[];t.forEach((function(e){isMeta(e)&&i.push(e.value)})),t.sort(sortCharClass);for(var n=0;n<t.length;n++){var s=t[n];if(fitsInMetas(s,i,this._hasIUFlags)||combinesWithPrecedingClassRange(s,t[n-1])||combinesWithFollowingClassRange(s,t[n+1]))t.splice(n,1),n--;else{var r=charCombinesWithPrecedingChars(s,n,t);t.splice(n-r+1,r),n-=r}}}}},function(e,t,i){"use strict";function isChar(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"simple";return"Char"===e.type&&e.value===t&&e.kind===i}function isMetaChar(e,t){return isChar(e,t,"meta")}e.exports={_hasIFlag:!1,_hasUFlag:!1,init:function init(e){this._hasIFlag=e.flags.includes("i"),this._hasUFlag=e.flags.includes("u")},CharacterClass:function CharacterClass(e){!function rewriteNumberRanges(e){e.node.expressions.forEach((function(t,i){(function isFullNumberRange(e){return"ClassRange"===e.type&&"0"===e.from.value&&"9"===e.to.value})(t)&&e.getChild(i).replace({type:"Char",value:"\\d",kind:"meta"})}))}(e),function rewriteWordRanges(e,t,i){var n=e.node,s=null,r=null,o=null,a=null,l=null,c=null;n.expressions.forEach((function(n,u){isMetaChar(n,"\\d")?s=e.getChild(u):!function isLowerCaseRange(e){return"ClassRange"===e.type&&"a"===e.from.value&&"z"===e.to.value}(n)?!function isUpperCaseRange(e){return"ClassRange"===e.type&&"A"===e.from.value&&"Z"===e.to.value}(n)?!function isUnderscore(e){return"Char"===e.type&&"_"===e.value&&"simple"===e.kind}(n)?t&&i&&function isU017fPath(e){return"Char"===e.type&&"unicode"===e.kind&&383===e.codePoint}(n)?l=e.getChild(u):t&&i&&function isU212aPath(e){return"Char"===e.type&&"unicode"===e.kind&&8490===e.codePoint}(n)&&(c=e.getChild(u)):a=e.getChild(u):o=e.getChild(u):r=e.getChild(u)})),s&&(r&&o||t&&(r||o))&&a&&(!i||!t||l&&c)&&(s.replace({type:"Char",value:"\\w",kind:"meta"}),r&&r.remove(),o&&o.remove(),a.remove(),l&&l.remove(),c&&c.remove())}(e,this._hasIFlag,this._hasUFlag),function rewriteWhitespaceRanges(e){var t=e.node,i=null,n=null,s=null,r=null,o=null;t.expressions.forEach((function(t,a){isChar(t," ")?i=e.getChild(a):isMetaChar(t,"\\t")?n=e.getChild(a):isMetaChar(t,"\\n")?s=e.getChild(a):isMetaChar(t,"\\r")?r=e.getChild(a):isMetaChar(t,"\\f")&&(o=e.getChild(a))})),i&&n&&s&&r&&(s.node.value="\\s",i.remove(),n.remove(),r.remove(),o&&o.remove())}(e)}}},function(e,t,i){"use strict";function shouldEscape(e){return/[*[()+?$./{}|]/.test(e)}e.exports={CharacterClass:function CharacterClass(e){var t=e.node;if(1===t.expressions.length&&function isAppropriateChar(e){return"Char"===e.type&&"\\b"!==e.value}(t.expressions[0])){var i=t.expressions[0],n=i.value,s=i.kind,r=i.escaped;if(t.negative){if(!function isMeta(e){return/^\\[dwsDWS]$/.test(e)}(n))return;n=function getInverseMeta(e){return/[dws]/.test(e)?e.toUpperCase():e.toLowerCase()}(n)}e.replace({type:"Char",value:n,kind:s,escaped:r||shouldEscape(n)})}}}},function(e,t,i){"use strict";function consumeNumbers(e,t,i){for(var n=e,s=(i?n>=0:n<t.expressions.length)&&t.expressions[n];s&&"Char"===s.type&&"simple"===s.kind&&!s.escaped&&/\d/.test(s.value);)i?n--:n++,s=(i?n>=0:n<t.expressions.length)&&t.expressions[n];return Math.abs(e-n)}function isSimpleChar(e,t){return e&&"Char"===e.type&&"simple"===e.kind&&!e.escaped&&e.value===t}e.exports={_hasXFlag:!1,init:function init(e){this._hasXFlag=e.flags.includes("x")},Char:function Char(e){var t=e.node;t.escaped&&function shouldUnescape(e,t){var i=e.node.value,n=e.index,s=e.parent;if("CharacterClass"!==s.type&&"ClassRange"!==s.type)return!function preservesEscape(e,t,i,n){if("{"===e)return function preservesOpeningCurlyBraceEscape(e,t){var i=consumeNumbers(e+1,t),n=e+i+1,s=n<t.expressions.length&&t.expressions[n];if(i){if(isSimpleChar(s,"}"))return!0;if(isSimpleChar(s,","))return i=consumeNumbers(n+1,t),isSimpleChar(s=(n=n+i+1)<t.expressions.length&&t.expressions[n],"}")}return!1}(t,i);if("}"===e)return function preservesClosingCurlyBraceEscape(e,t){var i=consumeNumbers(e-1,t,!0),n=e-i-1,s=n>=0&&t.expressions[n];if(i&&isSimpleChar(s,"{"))return!0;if(isSimpleChar(s,","))return i=consumeNumbers(n-1,t,!0),s=(n=n-i-1)<t.expressions.length&&t.expressions[n],i&&isSimpleChar(s,"{");return!1}(t,i);if(n&&/[ #]/.test(e))return!0;return/[*[()+?^$./\\|]/.test(e)}(i,n,s,t);return!function preservesInCharClass(e,t,i){if("^"===e)return 0===t&&!i.negative;if("-"===e)return 0!==t&&t!==i.expressions.length-1;return/[\]\\]/.test(e)}(i,n,s)}(e,this._hasXFlag)&&delete t.escaped}}},function(e,t,i){"use strict";var n=i(20),s=i(21),r=s.disjunctionToList,o=s.listToDisjunction;e.exports={Disjunction:function Disjunction(e){var t=e.node,i={},s=r(t).filter((function(e){var t=e?n.getForNode(e).jsonEncode():"null";return!i.hasOwnProperty(t)&&(i[t]=e,!0)}));e.replace(o(s))}}},function(e,t,i){"use strict";e.exports={Disjunction:function Disjunction(e){var t=e.node,i=e.parent;if(n[i.type]){var s=new Map;if(function shouldProcess(e,t){if(!e)return!1;var i=e.type;if("Disjunction"===i){var n=e.left,s=e.right;return shouldProcess(n,t)&&shouldProcess(s,t)}if("Char"===i){var r=e.value;return t.set(r,e),!0}if("CharacterClass"===i)return e.expressions.every((function(e){return shouldProcess(e,t)}));return!1}(t,s)&&s.size){var r={type:"CharacterClass",expressions:Array.from(s.keys()).sort().map((function(e){return s.get(e)}))};n[i.type](e.getParent(),r)}}}};var n={RegExp:function RegExp(e,t){e.node.body=t},Group:function Group(e,t){var i=e.node;i.capturing?i.expression=t:e.replace(t)}}},function(e,t,i){"use strict";e.exports={Group:function Group(e){var t=e.node,i=e.parent,n=e.getChild();t.capturing||n||("Repetition"===i.type?e.getParent().replace(t):"RegExp"!==i.type&&e.remove())}}},function(e,t,i){"use strict";function _toConsumableArray(e){if(Array.isArray(e)){for(var t=0,i=Array(e.length);t<e.length;t++)i[t]=e[t];return i}return Array.from(e)}e.exports={Group:function Group(e){var t=e.node,i=e.parent,n=e.getChild();if(!t.capturing&&n&&!("Disjunction"===n.node.type&&"RegExp"!==i.type||"Repetition"===i.type&&"Char"!==n.node.type&&"CharacterClass"!==n.node.type))if("Alternative"===n.node.type){var s=e.getParent();"Alternative"===s.node.type&&s.replace({type:"Alternative",expressions:[].concat(_toConsumableArray(i.expressions.slice(0,e.index)),_toConsumableArray(n.node.expressions),_toConsumableArray(i.expressions.slice(e.index+1)))})}else e.replace(n.node)}}},function(e,t,i){"use strict";function _toConsumableArray(e){if(Array.isArray(e)){for(var t=0,i=Array(e.length);t<e.length;t++)i[t]=e[t];return i}return Array.from(e)}var n=i(20),s=i(21).increaseQuantifierByOne;function combineRepeatingPatternLeft(e,t,i){for(var s=e.node,r=Math.ceil(i/2),o=0;o<r;){var a=i-2*o-1,l=void 0,c=void 0;if(0===o?(l=t,c=e.getChild(a)):(l=n.getForNode({type:"Alternative",expressions:[].concat(_toConsumableArray(s.expressions.slice(i-o,i)),[t.node])}),c=n.getForNode({type:"Alternative",expressions:[].concat(_toConsumableArray(s.expressions.slice(a,i-o)))})),l.hasEqualSource(c)){for(var u=0;u<2*o+1;u++)e.getChild(a).remove();return t.replace({type:"Repetition",expression:0===o?l.node:{type:"Group",capturing:!1,expression:l.node},quantifier:{type:"Quantifier",kind:"Range",from:2,to:2,greedy:!0}}),a}o++}return i}function combineWithPreviousRepetition(e,t,i){for(var r=e.node,o=0;o<i;){var a=e.getChild(o);if("Repetition"===a.node.type&&a.node.quantifier.greedy){var l=a.getChild(),c=void 0;if("Group"!==l.node.type||l.node.capturing||(l=l.getChild()),o+1===i?"Group"!==(c=t).node.type||c.node.capturing||(c=c.getChild()):c=n.getForNode({type:"Alternative",expressions:[].concat(_toConsumableArray(r.expressions.slice(o+1,i+1)))}),l.hasEqualSource(c)){for(var u=o;u<i;u++)e.getChild(o+1).remove();return s(a.node.quantifier),o}}o++}return i}function combineRepetitionWithPrevious(e,t,i){var r=e.node;if("Repetition"===t.node.type&&t.node.quantifier.greedy){var o=t.getChild(),a=void 0;"Group"!==o.node.type||o.node.capturing||(o=o.getChild());var l=void 0;if("Alternative"===o.node.type?(l=o.node.expressions.length,a=n.getForNode({type:"Alternative",expressions:[].concat(_toConsumableArray(r.expressions.slice(i-l,i)))})):(l=1,"Group"!==(a=e.getChild(i-1)).node.type||a.node.capturing||(a=a.getChild())),a.hasEqualSource(o)){for(var c=i-l;c<i;c++)e.getChild(i-l).remove();return s(t.node.quantifier),i-l}}return i}e.exports={Alternative:function Alternative(e){for(var t=e.node,i=1;i<t.expressions.length;){var n=e.getChild(i);if((i=Math.max(1,combineRepeatingPatternLeft(e,n,i)))>=t.expressions.length)break;if(n=e.getChild(i),(i=Math.max(1,combineWithPreviousRepetition(e,n,i)))>=t.expressions.length)break;n=e.getChild(i),i=Math.max(1,combineRepetitionWithPrevious(e,n,i)),i++}}}},function(e,t,i){"use strict";var n=i(34),s=i(83),r=i(85),o=i(35);e.exports={NFA:n,DFA:s,builders:o,toNFA:function toNFA(e){return r.build(e)},toDFA:function toDFA(e){return new s(this.toNFA(e))},test:function test(e,t){return this.toDFA(e).matches(t)}}},function(e,t,i){"use strict";var n=function(){function defineProperties(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,i){return t&&defineProperties(e.prototype,t),i&&defineProperties(e,i),e}}();function _toConsumableArray(e){if(Array.isArray(e)){for(var t=0,i=Array(e.length);t<e.length;t++)i[t]=e[t];return i}return Array.from(e)}var s=i(84),r=i(15).EPSILON_CLOSURE,o=function(){function DFA(e){!function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,DFA),this._nfa=e}return n(DFA,[{key:"minimize",value:function minimize(){this.getTransitionTable(),this._originalAcceptingStateNumbers=this._acceptingStateNumbers,this._originalTransitionTable=this._transitionTable,s.minimize(this)}},{key:"getAlphabet",value:function getAlphabet(){return this._nfa.getAlphabet()}},{key:"getAcceptingStateNumbers",value:function getAcceptingStateNumbers(){return this._acceptingStateNumbers||this.getTransitionTable(),this._acceptingStateNumbers}},{key:"getOriginaAcceptingStateNumbers",value:function getOriginaAcceptingStateNumbers(){return this._originalAcceptingStateNumbers||this.getTransitionTable(),this._originalAcceptingStateNumbers}},{key:"setTransitionTable",value:function setTransitionTable(e){this._transitionTable=e}},{key:"setAcceptingStateNumbers",value:function setAcceptingStateNumbers(e){this._acceptingStateNumbers=e}},{key:"getTransitionTable",value:function getTransitionTable(){var e=this;if(this._transitionTable)return this._transitionTable;var t=this._nfa.getTransitionTable(),i=Object.keys(t);this._acceptingStateNumbers=new Set;for(var n=[t[i[0]][r]],s=this.getAlphabet(),o=this._nfa.getAcceptingStateNumbers(),a={},l=function updateAcceptingStates(t){var i=!0,n=!1,s=void 0;try{for(var r,a=o[Symbol.iterator]();!(i=(r=a.next()).done);i=!0){var l=r.value;if(-1!==t.indexOf(l)){e._acceptingStateNumbers.add(t.join(","));break}}}catch(e){n=!0,s=e}finally{try{!i&&a.return&&a.return()}finally{if(n)throw s}}};n.length>0;){var c=n.shift(),u=c.join(",");a[u]={};var h=!0,d=!1,f=void 0;try{for(var p,g=s[Symbol.iterator]();!(h=(p=g.next()).done);h=!0){var m=p.value,_=[];l(c);var b=!0,v=!1,y=void 0;try{for(var w,k=c[Symbol.iterator]();!(b=(w=k.next()).done);b=!0){var C=t[w.value][m];if(C){var x=!0,S=!1,E=void 0;try{for(var F,O=C[Symbol.iterator]();!(x=(F=O.next()).done);x=!0){var A=F.value;t[A]&&_.push.apply(_,_toConsumableArray(t[A][r]))}}catch(e){S=!0,E=e}finally{try{!x&&O.return&&O.return()}finally{if(S)throw E}}}}}catch(e){v=!0,y=e}finally{try{!b&&k.return&&k.return()}finally{if(v)throw y}}var j=new Set(_),T=[].concat(_toConsumableArray(j));if(T.length>0){var z=T.join(",");a[u][m]=z,a.hasOwnProperty(z)||n.unshift(T)}}}catch(e){d=!0,f=e}finally{try{!h&&g.return&&g.return()}finally{if(d)throw f}}}return this._transitionTable=this._remapStateNumbers(a)}},{key:"_remapStateNumbers",value:function _remapStateNumbers(e){var t={};this._originalTransitionTable=e;var i={};for(var n in Object.keys(e).forEach((function(e,i){t[e]=i+1})),e){var s=e[n],r={};for(var o in s)r[o]=t[s[o]];i[t[n]]=r}this._originalAcceptingStateNumbers=this._acceptingStateNumbers,this._acceptingStateNumbers=new Set;var a=!0,l=!1,c=void 0;try{for(var u,h=this._originalAcceptingStateNumbers[Symbol.iterator]();!(a=(u=h.next()).done);a=!0){var d=u.value;this._acceptingStateNumbers.add(t[d])}}catch(e){l=!0,c=e}finally{try{!a&&h.return&&h.return()}finally{if(l)throw c}}return i}},{key:"getOriginalTransitionTable",value:function getOriginalTransitionTable(){return this._originalTransitionTable||this.getTransitionTable(),this._originalTransitionTable}},{key:"matches",value:function matches(e){for(var t=1,i=0,n=this.getTransitionTable();e[i];)if(!(t=n[t][e[i++]]))return!1;return!!this.getAcceptingStateNumbers().has(t)}}]),DFA}();e.exports=o},function(e,t,i){"use strict";var _slicedToArray=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function sliceIterator(e,t){var i=[],n=!0,s=!1,r=void 0;try{for(var o,a=e[Symbol.iterator]();!(n=(o=a.next()).done)&&(i.push(o.value),!t||i.length!==t);n=!0);}catch(e){s=!0,r=e}finally{try{!n&&a.return&&a.return()}finally{if(s)throw r}}return i}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")};function _toConsumableArray(e){if(Array.isArray(e)){for(var t=0,i=Array(e.length);t<e.length;t++)i[t]=e[t];return i}return Array.from(e)}var n=null;function sameRow(e,t){if(!t)return!1;if(e.length!==t.length)return!1;for(var i=0;i<e.length;i++){var n=e[i],s=t[i];if(n.size!==s.size)return!1;if([].concat(_toConsumableArray(n)).sort().join(",")!==[].concat(_toConsumableArray(s)).sort().join(","))return!1}return!0}function areEquivalent(e,t,i,n){var s=!0,r=!1,o=void 0;try{for(var a,l=n[Symbol.iterator]();!(s=(a=l.next()).done);s=!0){if(!goToSameSet(e,t,i,a.value))return!1}}catch(e){r=!0,o=e}finally{try{!s&&l.return&&l.return()}finally{if(r)throw o}}return!0}function goToSameSet(e,t,i,s){if(!n[e]||!n[t])return!1;var r=i[e][s],o=i[t][s];return!r&&!o||n[e].has(r)&&n[t].has(o)}e.exports={minimize:function minimize(e){var t=e.getTransitionTable(),i=Object.keys(t),s=e.getAlphabet(),r=e.getAcceptingStateNumbers();n={};var o=new Set;i.forEach((function(e){e=Number(e),r.has(e)?n[e]=r:(o.add(e),n[e]=o)}));var a=[[o,r].filter((function(e){return e.size>0}))],l=void 0,c=void 0;l=a[a.length-1],c=a[a.length-2];for(var u=function _loop(){var e,i={},r=!0,o=!1,u=void 0;try{for(var h,d=l[Symbol.iterator]();!(r=(h=d.next()).done);r=!0){var f=h.value,p={},g=(e=f,Array.isArray(e)?e:Array.from(e)),m=g[0],_=g.slice(1);p[m]=new Set([m]);var b=!0,v=!1,y=void 0;try{e:for(var w,k=_[Symbol.iterator]();!(b=(w=k.next()).done);b=!0){var C=w.value,x=!0,S=!1,E=void 0;try{for(var F,O=Object.keys(p)[Symbol.iterator]();!(x=(F=O.next()).done);x=!0){var A=F.value;if(areEquivalent(C,A,t,s)){p[A].add(C),p[C]=p[A];continue e}}}catch(e){S=!0,E=e}finally{try{!x&&O.return&&O.return()}finally{if(S)throw E}}p[C]=new Set([C])}}catch(e){v=!0,y=e}finally{try{!b&&k.return&&k.return()}finally{if(v)throw y}}Object.assign(i,p)}}catch(e){o=!0,u=e}finally{try{!r&&d.return&&d.return()}finally{if(o)throw u}}n=i;var j=new Set(Object.keys(i).map((function(e){return i[e]})));a.push([].concat(_toConsumableArray(j))),l=a[a.length-1],c=a[a.length-2]};!sameRow(l,c);)u();var h=new Map,d=1;l.forEach((function(e){return h.set(e,d++)}));var f={},p=new Set,g=function updateAcceptingStates(e,t){var i=!0,n=!1,s=void 0;try{for(var o,a=e[Symbol.iterator]();!(i=(o=a.next()).done);i=!0){var l=o.value;r.has(l)&&p.add(t)}}catch(e){n=!0,s=e}finally{try{!i&&a.return&&a.return()}finally{if(n)throw s}}},m=!0,_=!1,b=void 0;try{for(var v,y=h.entries()[Symbol.iterator]();!(m=(v=y.next()).done);m=!0){var w=v.value,k=_slicedToArray(w,2),C=k[0],x=k[1];f[x]={};var S=!0,E=!1,F=void 0;try{for(var O,A=s[Symbol.iterator]();!(S=(O=A.next()).done);S=!0){var j=O.value;g(C,x);var T=void 0,z=!0,M=!1,D=void 0;try{for(var P,N=C[Symbol.iterator]();!(z=(P=N.next()).done);z=!0){var L=P.value;if(T=t[L][j])break}}catch(e){M=!0,D=e}finally{try{!z&&N.return&&N.return()}finally{if(M)throw D}}T&&(f[x][j]=h.get(n[T]))}}catch(e){E=!0,F=e}finally{try{!S&&A.return&&A.return()}finally{if(E)throw F}}}}catch(e){_=!0,b=e}finally{try{!m&&y.return&&y.return()}finally{if(_)throw b}}return e.setTransitionTable(f),e.setAcceptingStateNumbers(p),e}}},function(e,t,i){"use strict";var n=i(14),s=i(35),r=s.alt,o=s.char,a=s.or,l=s.rep,c=s.plusRep,u=s.questionRep;function gen(e){if(e&&!h[e.type])throw new Error(e.type+" is not supported in NFA/DFA interpreter.");return e?h[e.type](e):""}var h={RegExp:function RegExp(e){if(""!==e.flags)throw new Error("NFA/DFA: Flags are not supported yet.");return gen(e.body)},Alternative:function Alternative(e){var t=(e.expressions||[]).map(gen);return r.apply(void 0,function _toConsumableArray(e){if(Array.isArray(e)){for(var t=0,i=Array(e.length);t<e.length;t++)i[t]=e[t];return i}return Array.from(e)}(t))},Disjunction:function Disjunction(e){return a(gen(e.left),gen(e.right))},Repetition:function Repetition(e){switch(e.quantifier.kind){case"*":return l(gen(e.expression));case"+":return c(gen(e.expression));case"?":return u(gen(e.expression));default:throw new Error("Unknown repeatition: "+e.quantifier.kind+".")}},Char:function Char(e){if("simple"!==e.kind)throw new Error("NFA/DFA: Only simple chars are supported yet.");return o(e.value)},Group:function Group(e){return gen(e.expression)}};e.exports={build:function build(e){var t=e;return e instanceof RegExp&&(e=""+e),"string"==typeof e&&(t=n.parse(e,{captureLocations:!0})),gen(t)}}},function(e,t,i){"use strict";var n=function(){function defineProperties(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,i){return t&&defineProperties(e.prototype,t),i&&defineProperties(e,i),e}}();var s=i(87),r=i(15).EPSILON,o=function(e){function NFAState(){return function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,NFAState),function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(NFAState.__proto__||Object.getPrototypeOf(NFAState)).apply(this,arguments))}return function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(NFAState,e),n(NFAState,[{key:"matches",value:function matches(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Set;if(t.has(this))return!1;if(t.add(this),0===e.length){if(this.accepting)return!0;var i=!0,n=!1,s=void 0;try{for(var o,a=this.getTransitionsOnSymbol(r)[Symbol.iterator]();!(i=(o=a.next()).done);i=!0){var l=o.value;if(l.matches("",t))return!0}}catch(e){n=!0,s=e}finally{try{!i&&a.return&&a.return()}finally{if(n)throw s}}return!1}var c=e[0],u=e.slice(1),h=this.getTransitionsOnSymbol(c),d=!0,f=!1,p=void 0;try{for(var g,m=h[Symbol.iterator]();!(d=(g=m.next()).done);d=!0){var _=g.value;if(_.matches(u))return!0}}catch(e){f=!0,p=e}finally{try{!d&&m.return&&m.return()}finally{if(f)throw p}}var b=!0,v=!1,y=void 0;try{for(var w,k=this.getTransitionsOnSymbol(r)[Symbol.iterator]();!(b=(w=k.next()).done);b=!0){var C=w.value;if(C.matches(e,t))return!0}}catch(e){v=!0,y=e}finally{try{!b&&k.return&&k.return()}finally{if(v)throw y}}return!1}},{key:"getEpsilonClosure",value:function getEpsilonClosure(){var e=this;return this._epsilonClosure||function(){var t=e.getTransitionsOnSymbol(r),i=e._epsilonClosure=new Set;i.add(e);var n=!0,s=!1,o=void 0;try{for(var a,l=t[Symbol.iterator]();!(n=(a=l.next()).done);n=!0){var c=a.value;if(!i.has(c))i.add(c),c.getEpsilonClosure().forEach((function(e){return i.add(e)}))}}catch(e){s=!0,o=e}finally{try{!n&&l.return&&l.return()}finally{if(s)throw o}}}(),this._epsilonClosure}}]),NFAState}(s);e.exports=o},function(e,t,i){"use strict";var n=function(){function defineProperties(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,i){return t&&defineProperties(e.prototype,t),i&&defineProperties(e,i),e}}();var s=function(){function State(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).accepting,t=void 0!==e&&e;!function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,State),this._transitions=new Map,this.accepting=t}return n(State,[{key:"getTransitions",value:function getTransitions(){return this._transitions}},{key:"addTransition",value:function addTransition(e,t){return this.getTransitionsOnSymbol(e).add(t),this}},{key:"getTransitionsOnSymbol",value:function getTransitionsOnSymbol(e){var t=this._transitions.get(e);return t||(t=new Set,this._transitions.set(e,t)),t}}]),State}();e.exports=s},function(e,t,i){"use strict";var n=function(){function defineProperties(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,i){return t&&defineProperties(e.prototype,t),i&&defineProperties(e,i),e}}();var s=function(){function RegExpTree(e,t){var i=t.flags,n=t.groups,s=t.source;!function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,RegExpTree),this._re=e,this._groups=n,this.flags=i,this.source=s||e.source,this.dotAll=i.includes("s"),this.global=e.global,this.ignoreCase=e.ignoreCase,this.multiline=e.multiline,this.sticky=e.sticky,this.unicode=e.unicode}return n(RegExpTree,[{key:"test",value:function test(e){return this._re.test(e)}},{key:"compile",value:function compile(e){return this._re.compile(e)}},{key:"toString",value:function toString(){return this._toStringResult||(this._toStringResult="/"+this.source+"/"+this.flags),this._toStringResult}},{key:"exec",value:function exec(e){var t=this._re.exec(e);if(!this._groups||!t)return t;for(var i in t.groups={},this._groups){var n=this._groups[i];t.groups[i]=t[n]}return t}}]),RegExpTree}();e.exports={RegExpTree:s}},function(e,t,i){"use strict";i.r(t),i.d(t,"DEFAULT_TYPES",(function(){return h})),i.d(t,"DEFAULT_FORMATS",(function(){return d})),i.d(t,"default",(function(){return TranslationCore})),i.d(t,"getCardinalName",(function(){return getCardinalName})),i.d(t,"getOrdinalName",(function(){return getOrdinalName}));var n=i(8),s=i.n(n),r=i(101),o=i.n(r),a=i(39),l=i.n(a),c=i(0),u=i(6);s.a.extend(o.a);const h={tostring:e=>`${e}`,select(e,t,i,n,s,r){const o=t.o&&(t.o[e]||t.o.other);if(o)return this._processAST(o,r,i)},plural(e,t,i,n,s,r){const o=t.o&&(t.o[`=${e}`]||t.o[getCardinalName(i,e)]||t.o.other);if(o)return this._processAST(o,r,i)},selectordinal(e,t,i,n,s,r){const o=t.o&&(t.o[`=${e}`]||t.o[getOrdinalName(i,e)]||t.o.other);if(o)return this._processAST(o,r,i)},number(e,t){return"number"!=typeof e?e:this.formatNumber(e,t.f)},date(e,t){return this.formatDate(e,t.f)},time(e,t){return this.formatTime(e,t.f)},datetime(e,t){return this.formatDateTime(e,t.f)},duration:e=>Object(u.duration_to_string)(e),localestring(e){return this.toLocaleString(e)},relativetime(e,t){return this.formatRelativeTime(e,t.f)},humantime(e,t){return this.formatRelativeTime(e,t.f)},en_plural:e=>1!==e?"s":""},d={number:{currency:{style:"currency"},percent:{style:"percent"}},date:{short:{month:"numeric",day:"numeric",year:"2-digit"},long:{month:"long",day:"numeric",year:"numeric"},full:{weekday:"long",month:"long",day:"numeric",year:"numeric"}},time:{short:{hour:"numeric",minute:"numeric"},medium:{hour:"numeric",minute:"numeric",second:"numeric"},long:{hour:"numeric",minute:"numeric",second:"numeric",timeZoneName:"short"},full:{hour:"numeric",minute:"numeric",second:"numeric",timeZoneName:"short"}},datetime:{short:{month:"numeric",day:"numeric",year:"2-digit",hour:"numeric",minute:"numeric"},medium:{month:"numeric",day:"numeric",year:"2-digit",hour:"numeric",minute:"numeric",second:"numeric"},long:{month:"long",day:"numeric",year:"numeric",hour:"numeric",minute:"numeric",second:"numeric",timeZoneName:"short"},full:{weekday:"long",month:"long",day:"numeric",year:"numeric",hour:"numeric",minute:"numeric",second:"numeric",timeZoneName:"short"}}};class TranslationCore{constructor(e){if(e=e||{},this.warn=e.warn,this._locale=e.locale||"en",this.defaultLocale=e.defaultLocale||this._locale,this.transformation=null,this.phrases=new Map,this.cache=new Map,this.numberFormats=new Map,this.formats=Object.assign({},d),e.formats)for(const t of Object.keys(e.formats))this.formats[t]=Object.assign({},this.formats[t],e.formats[t]);this.types=Object.assign({},h,e.types||{}),this.parser=new l.a(e.parserOptions),e.phrases&&this.extend(e.phrases)}get locale(){return this._locale}set locale(e){e!==this._locale&&(this._locale=e,this.numberFormats.clear())}toLocaleString(e){return e&&e.toLocaleString?e.toLocaleString(this._locale):e}formatRelativeTime(e){e instanceof Date||(e=new Date(Date.now()+1e3*e));const t=s()(e);try{return t.locale(this._locale).fromNow(!0)}catch(e){return t.fromNow(!0)}}formatNumber(e,t){let i=this.numberFormats.get(t);return i||(i=new Intl.NumberFormat(this.locale,this.formats.number[t]),this.numberFormats.set(t,i)),i.format(e)}formatDate(e,t){if("string"==typeof t&&t.startsWith("::")){const i=t.substr(2),n=s()(e);try{return n.locale(this._locale).format(i)}catch(e){return n.format(i)}}return e instanceof Date||(e=new Date(e)),e.toLocaleDateString(this._locale,this.formats.date[t]||{})}formatTime(e,t){if("string"==typeof t&&t.startsWith("::")){const i=t.substr(2),n=s()(e);try{return n.locale(this._locale).format(i)}catch(e){return n.format(i)}}return e instanceof Date||(e=new Date(e)),e.toLocaleTimeString(this._locale,this.formats.time[t]||{})}formatDateTime(e,t){if("string"==typeof t&&t.startsWith("::")){const i=t.substr(2),n=s()(e);try{return n.locale(this._locale).format(i)}catch(e){return n.format(i)}}return e instanceof Date||(e=new Date(e)),e.toLocaleString(this._locale,this.formats.datetime[t]||{})}extend(e,t){const i=[];if(!e||"object"!=typeof e)return i;for(const n of Object.keys(e)){const s=t?"_"===n?t:`${t}.${n}`:n,r=e[n];if("object"==typeof r)i.push(...this.extend(r,s));else{let e;try{e=this.parser.parse(r)}catch(e){this.warn&&this.warn(`Error parsing i18n phrase for key "${s}": ${r}`,e);continue}this.phrases.set(s,r),this.cache.set(s,e),i.push(s)}}return i}unset(e,t){"string"==typeof e&&(e=[e]);const i=Array.isArray(e)?e:Object.keys(e);for(const n of i){const i=t?"_"===n?t:`${t}.${n}`:n;"object"==typeof e[n]?this.unset(e,i):(this.phrases.delete(i),this.cache.delete(i))}}has(e){return this.phrases.has(e)}set(e,t){const i=this.parser.parse(t);this.phrases.set(e,t),this.cache.set(e,i)}clear(){this.phrases.clear(),this.cache.clear()}replace(e){this.clear(),this.extend(e)}_preTransform(e,t,i,n={}){let s,r,o=null==i?{}:i;if("number"==typeof o&&(o={count:o}),!n.noCache&&this.phrases.has(e))s=this.cache.get(e),r=this.locale;else if(!n.noCache&&this.cache.has(e))s=this.cache.get(e),r=this.defaultLocale;else{let i=null;try{i=this.parser.parse(t)}catch(i){if(n.throwParse)throw i;!n.noWarn&&this.warn&&this.warn(`Error parsing i18n phrase for key "${e}": ${t}`,i),s=["parsing error"],r=this.defaultLocale}i&&(s=i,r=this.locale,n.noCache||(this.locale===this.defaultLocale&&this.phrases.set(e,t),this.cache.set(e,i)))}return this.transformation&&(s=this.transformation(e,s)),[s,o,r]}t(e,t,i,n){return listToString(this.tList(e,t,i,n))}tList(e,t,i,n){return this._processAST(...this._preTransform(e,t,i,n))}formatNode(e,t,i=null,n=null,s=null){if(!e||"object"!=typeof e)return e;null==i&&(i=this.locale);const r=Object(c.get)(e.v,t);if(null==r)return null;if(e.t){if(this.types[e.t])return this.types[e.t].call(this,r,e,i,n,s,t);this.warn&&this.warn(`Encountered unknown type "${e.t}" when formatting node.`)}return r}_processAST(e,t,i){const n=[];for(const s of e){const r=this.formatNode(s,t,i,n,e);null!=r&&n.push(r)}return n}}function listToString(e){return Array.isArray(e)?e.map(listToString).join(""):String(e)}const f={arabic:["ar"],czech:["cs"],danish:["da"],german:["de","el","en","es","fi","hu","it","nl","no","nb","tr","sv"],hebrew:["he"],persian:["fa"],polish:["pl"],serbian:["sr"],french:["fr","pt"],russian:["ru","uk"],slov:["sl"]},p={other:()=>5,arabic(e){if(0===e)return 0;if(1===e)return 1;if(2===e)return 2;const t=e%1e3;return t>=3&&t<=10?3:t>=11?4:5},czech:(e,t,i)=>0!==i?4:1===t?1:t>=2&&t<=4?3:5,danish:(e,t,i,n)=>1===e||0!==n&&(0===t||1===t)?1:5,french:(e,t)=>0===t||1===t?1:5,german:e=>1===e?1:5,hebrew:e=>1===e?1:2===e?2:e>10&&e%10==0?4:5,persian:(e,t)=>0===t||1===e?1:5,slov(e,t,i){if(0!==i)return 3;const n=e%100;return 1===n?1:2===n?2:3===n||4===n?3:5},serbian(e,t,i,n){if(0!==i)return 5;const s=t%10,r=t%100,o=n%10,a=n%100;return 1===s&&11!==r?1:1===o&&11!==a?1:s>=2&&s<=4&&!(r>=12&&r<=14)?3:o>=2&&o<=4&&!(a>=12&&a<=14)?3:5},polish(e,t,i){if(0!==i)return 5;if(1===e)return 1;const n=e%10,s=e%100;return n>=2&&n<=4&&!(s>=12&&s<=14)?3:1===t||0!==n&&1!==n?n>=5&&n<=9?4:s>=12&&s<=14?4:5:4},russian(e,t,i){const n=e%10,s=e%100;return 1===n&&11!==s?1:0===i&&n>=2&&n<=4&&(s<12||s>14)?3:0===i&&(0===n||n>=5&&n<=9||s>=11||s<=14)?4:5}},g={english:["en"],hungarian:["hu"],italian:["it"],one:["fr","lo","ms"],swedish:["sv"],ukranian:["uk"]},m={other:()=>5,one:e=>1===e?1:5,english(e){const t=e%10,i=e%100;return 1===t&&11!==i?1:2===t&&12!==i?2:3===t&&13!==i?3:5},ukranian:e=>3===e%10&&13!==e%100?3:5,hungarian:e=>1===e||5===e?1:5,italian:e=>11===e||8===e||80===e||800===e?4:5,swedish(e){const t=e%10,i=e%100;return 1!==t&&2!==t||11===i||12===i?5:1}},_=["zero","one","two","few","many","other"],b={},v={};for(const e of Object.keys(f))for(const t of f[e])b[t]=e;for(const e of Object.keys(g))for(const t of g[e])v[t]=e;function executePlural(e,t){t=Math.abs(Number(t));const i=Math.floor(t);let n,s;return i===t?(n=0,s=0):(s=`${t}`.split(".")[1],n=s?s.length:0,s=s?Number(s):0),_[e(t,i,n,s)]}function getCardinalName(e,t){let i=b[e];if(!i){const t=e.indexOf("-");i=-1!==t&&b[e.slice(0,t)]||"other",b[e]=i}return executePlural(p[i],t)}function getOrdinalName(e,t){let i=v[e];if(!i){const t=e.indexOf("-");i=-1!==t&&v[e.slice(0,t)]||"other",v[e]=i}return executePlural(m[i],t)}},function(e,t,i){"use strict";i.r(t),i.d(t,"default",(function(){return ChatHook})),i.d(t,"formatBitsConfig",(function(){return formatBitsConfig}));var n=i(9),s=i(1),r=i(0),o=i(2),a=i(5),l=i(3),c=i(4),u=i(104),h=i(105),d=i(107),f=i(108),p=i(109),g=i(110);const m=Object(r.make_enum)("Post","Action","PostWithMention"),_=Object(r.make_enum)("Ban","Timeout","Delete"),b=Object(r.make_enum)("MessageRejectedPrompt","CheerMessageRejectedPrompt","MessageRejected","MessageAllowed","MessageDenied","CheerMessageDenied","CheerMessageTimeout","MessageModApproved","MessageModDenied"),v=Object(r.make_enum)("Message","ExtensionMessage","Moderation","ModerationAction","TargetedModerationAction","AutoMod","SubscriberOnlyMode","FollowerOnlyMode","SlowMode","EmoteOnlyMode","R9KMode","Connected","Disconnected","Reconnect","Hosting","Unhost","Hosted","Subscription","Resubscription","GiftPaidUpgrade","AnonGiftPaidUpgrade","PrimePaidUpgrade","PrimeCommunityGiftReceivedEvent","ExtendSubscription","SubGift","AnonSubGift","Clear","RoomMods","RoomState","Raid","Unraid","Ritual","Notice","Info","BadgesUpdated","Purchase","BitsCharity","CrateGift","RewardGift","SubMysteryGift","AnonSubMysteryGift","StandardPayForward","CommunityPayForward","FirstCheerMessage","BitsBadgeTierMessage","InlinePrivateCallout","ChannelPointsReward"),y=["Reconnect","RoomState","BadgesUpdated","Clear"],w=["onBadgesUpdatedEvent"];class ChatHook extends l.default{constructor(...e){super(...e),this.should_enable=!0,this.colors=new n.ColorAdjuster,this.inverse_colors=new n.ColorAdjuster,this.inject("settings"),this.inject("i18n"),this.inject("site"),this.inject("site.router"),this.inject("site.fine"),this.inject("site.web_munch"),this.inject("site.css_tweaks"),this.inject("chat"),this.inject(u.a),this.inject(h.a),this.inject(d.a),this.inject(f.a),this.inject(p.a),this.inject(g.a),this.ChatService=this.fine.define("chat-service",e=>e.join&&e.connectHandlers,c.a.CHAT_ROUTES),this.ChatBuffer=this.fine.define("chat-buffer",e=>e.updateHandlers&&e.delayedMessageBuffer&&e.handleMessage,c.a.CHAT_ROUTES),this.ChatController=this.fine.define("chat-controller",e=>e.hostingHandler&&e.onRoomStateUpdated,c.a.CHAT_ROUTES),this.ChatContainer=this.fine.define("chat-container",e=>e.showViewersList&&e.onChatInputFocus,c.a.CHAT_ROUTES),this.ChatBufferConnector=this.fine.define("chat-buffer-connector",e=>e.clearBufferHandle&&e.syncBufferedMessages,c.a.CHAT_ROUTES),this.PinnedCheer=this.fine.define("pinned-cheer",e=>e.collapseCheer&&e.saveRenderedMessageRef,c.a.CHAT_ROUTES),this.RoomPicker=this.fine.define("chat-picker",e=>e.closeRoomPicker&&e.handleRoomSelect,c.a.CHAT_ROUTES),this.InlineCallout=this.fine.define("inline-callout",e=>e.showCTA&&e.toggleContextMenu&&e.actionClick,c.a.CHAT_ROUTES),this.PinnedCallout=this.fine.define("pinned-callout",e=>e.getCalloutTitle&&e.buildCalloutProps&&e.pin,c.a.CHAT_ROUTES),this.CalloutSelector=this.fine.define("callout-selector",e=>e.selectCalloutComponent&&e.props&&e.props.callouts,c.a.CHAT_ROUTES),this.PointsButton=this.fine.define("points-button",e=>e.renderIcon&&e.renderFlame&&e.handleIconAnimationComplete,c.a.CHAT_ROUTES),this.PointsClaimButton=this.fine.define("points-claim-button",e=>e.getClaim&&e.onClick&&e.props&&e.props.claimCommunityPoints,c.a.CHAT_ROUTES),this.CommunityChestBanner=this.fine.define("community-chest-banner",e=>e.getLastGifterText&&e.getBannerText&&Object(r.has)(e,"finalCount"),c.a.CHAT_ROUTES),this.PointsInfo=this.fine.define("points-info",e=>void 0!==e.pointIcon&&void 0!==e.pointName,c.a.CHAT_ROUTES),this.GiftBanner=this.fine.define("gift-banner",e=>e.getBannerText&&e.onGiftMoreClick,c.a.CHAT_ROUTES),this.settings.add("chat.hide-community-highlights",{default:!1,ui:{path:"Chat > Appearance >> Community",title:"Hide all Community Highlights from the top of chat.",component:"setting-check-box",description:"Community Highlights are polls, community gift subs, etc. that float over the top of chat temporarily with no way to close them."}}),this.settings.add("chat.subs.gift-banner",{default:!0,ui:{path:"Chat > Appearance >> Community",title:"Display a banner at the top of chat when a mass gift sub happens.",component:"setting-check-box"}}),this.settings.add("chat.community-chest.show",{default:!0,ui:{path:"Chat > Appearance >> Community",title:"Display the Community Gift Chest banner.",component:"setting-check-box"}}),this.settings.add("chat.points.custom-rendering",{default:!0,ui:{path:"Chat > Channel Points >> Appearance",title:"Use custom rendering for channel points reward messages in chat.",description:"Custom rendering applies a background color to highlighted messages, which some users may not appreciate.",component:"setting-check-box"}}),this.settings.add("chat.points.show-callouts",{default:!0,ui:{path:"Chat > Channel Points >> General",title:"Display messages in chat about Channel Points rewards.",component:"setting-check-box"}}),this.settings.add("chat.points.show-button",{default:!0,ui:{path:"Chat > Channel Points >> General",title:"Display Channel Points button beneath chat.",component:"setting-check-box"}}),this.settings.add("chat.points.show-rewards",{default:!0,ui:{path:"Chat > Channel Points >> Behavior",title:"Allow available rewards to appear next to the Channel Points button.",component:"setting-check-box"}}),this.settings.add("chat.pin-resubs",{default:!1,ui:{path:"Chat > Behavior >> General",title:"Automatically pin re-subscription messages in chat.",component:"setting-check-box"}}),this.settings.add("chat.width",{default:340,ui:{path:'Chat > Appearance >> General @{"sort": -1}',title:"Width",description:"How wide chat should be, in pixels. This may be affected by your browser's zoom and font size settings.",component:"setting-text-box",process:e=>(e=parseInt(e,10),isNaN(e)||!isFinite(e)||e<=0?340:e)}}),this.settings.add("chat.use-width",{requires:["chat.width","context.ui.rightColumnExpanded"],process:e=>!!e.get("context.ui.rightColumnExpanded")&&340!=e.get("chat.width")}),this.settings.add("chat.bits.show-pinned",{requires:["chat.bits.show"],default:null,process:(e,t)=>null!=t?t:e.get("chat.bits.show"),ui:{path:"Chat > Bits and Cheering >> Appearance",title:"Display Top Cheerers",description:"By default, this inherits its value from Display Bits.",component:"setting-check-box"}}),this.settings.add("chat.bits.show-rewards",{requires:["chat.bits.show"],default:null,process:(e,t)=>null!=t?t:e.get("chat.bits.show"),ui:{path:"Chat > Bits and Cheering >> Behavior",title:"Display messages when a cheer shares rewards to people in chat.",description:"By default, this inherits its value from Display Bits. This setting only affects newly arrived messages.",component:"setting-check-box"}}),this.settings.add("chat.rituals.show",{default:!0,ui:{path:"Chat > Filtering >> Rituals",title:'Display ritual messages such as "User is new here! Say Hello!".',component:"setting-check-box"}}),this.settings.add("chat.subs.show",{default:3,ui:{path:"Chat > Appearance >> Subscriptions",title:"Display Subs in Chat",component:"setting-select-box",description:'**Note**: Messages sent with re-subs will always be displayed. This only controls the special "X subscribed!" message.',data:[{value:0,title:"Do Not Display"},{value:1,title:"Re-Subs with Messages Only"},{value:2,title:"Re-Subs Only"},{value:3,title:"Display All"}]}}),this.settings.add("chat.subs.compact",{default:!1,ui:{path:"Chat > Appearance >> Subscriptions",title:"Display subscription notices in a more compact (classic style) form.",component:"setting-check-box"}}),this.settings.add("chat.subs.merge-gifts",{default:1e3,ui:{path:"Chat > Appearance >> Subscriptions",title:"Merge Mass Sub Gifts",component:"setting-select-box",data:[{value:1e3,title:"Disabled"},{value:50,title:"More than 50"},{value:20,title:"More than 20"},{value:10,title:"More than 10"},{value:5,title:"More than 5"},{value:0,title:"Always"}],description:"Merge mass gift subscriptions into a single message, depending on the quantity.\n**Note:** Only affects newly gifted subs."}}),this.settings.add("chat.subs.merge-gifts-visibility",{default:!1,ui:{path:"Chat > Appearance >> Subscriptions",title:"Expand merged mass sub gift messages by default.",component:"setting-check-box"}}),this.settings.add("chat.lines.alternate",{default:!1,ui:{path:"Chat > Appearance >> Chat Lines",title:"Display lines with alternating background colors.",component:"setting-check-box"}}),this.settings.add("chat.lines.padding",{default:!1,ui:{path:"Chat > Appearance >> Chat Lines",title:"Reduce padding around lines.",component:"setting-check-box"}}),this.settings.add("chat.lines.borders",{default:0,ui:{path:"Chat > Appearance >> Chat Lines",title:"Separators",component:"setting-select-box",data:[{value:0,title:"Disabled"},{value:1,title:"Basic Line (1px Solid)"},{value:2,title:"3D Line (2px Groove)"},{value:3,title:"3D Line (2px Groove Inset)"},{value:4,title:"Wide Line (2px Solid)"}]}})}get currentChat(){for(const e of this.ChatController.instances)if(e&&e.chatService)return e;return null}updateColors(){const e=this.chat.context.get("theme.is-dark"),t=this.chat.context.get("chat.adjustment-mode"),i=this.chat.context.get("chat.adjustment-contrast"),n=this.colors,s=this.inverse_colors;n._base=e?"#191919":"#e0e0e0",n.mode=t,n.contrast=i,s._base=e?"#dad8de":"#19171c",s.mode=t,s.contrast=i,this.updateChatLines(),this.updateMentionCSS(),this.emit(":update-colors")}updateChatCSS(){this._update_css_waiter||(this._update_css_waiter=requestAnimationFrame(()=>this._updateChatCSS()))}_updateChatCSS(){cancelAnimationFrame(this._update_css_waiter),this._update_css_waiter=null;const e=this.chat.context.get("chat.width"),t=this.chat.context.get("chat.font-size"),i=this.chat.context.get("chat.lines.emote-alignment"),n=Math.round(20/12*t);let s=this.chat.context.get("chat.font-family")||"inherit";-1!==s.indexOf(" ")&&-1===s.indexOf(",")&&-1===s.indexOf('"')&&-1===s.indexOf("'")&&(s=`"${s}"`),this.css_tweaks.setVariable("chat-font-size",`${t/10}rem`),this.css_tweaks.setVariable("chat-line-height",`${n/10}rem`),this.css_tweaks.setVariable("chat-font-family",s),this.css_tweaks.setVariable("chat-width",`${e/10}rem`),this.css_tweaks.toggle("chat-font",12!==t||s),this.css_tweaks.toggle("chat-width",this.settings.get("chat.use-width")),this.css_tweaks.toggle("emote-alignment-padded",1===i),this.css_tweaks.toggle("emote-alignment-baseline",2===i),this.emit(":update-chat-css")}updateLineBorders(){const e=this.chat.context.get("chat.lines.borders");this.css_tweaks.toggle("chat-borders",e>0),this.css_tweaks.toggle("chat-borders-3d",2===e),this.css_tweaks.toggle("chat-borders-3d-inset",3===e),this.css_tweaks.toggle("chat-borders-wide",4===e)}updateMentionCSS(){const e=this.chat.context.get("chat.filtering.highlight-mentions");this.css_tweaks.toggle("chat-mention-token",this.chat.context.get("chat.filtering.highlight-tokens"));const t=this.chat.context.get("chat.filtering.mention-color");t?(this.css_tweaks.toggle("chat-mention-bg",!1),this.css_tweaks.toggle("chat-mention-bg-alt",!1),this.css_tweaks.toggle("chat-mention-bg-custom",!0),this.css_tweaks.setVariable("chat-mention-color",this.inverse_colors.process(t))):(this.css_tweaks.toggle("chat-mention-bg-custom",!1),this.css_tweaks.toggle("chat-mention-bg",e),this.css_tweaks.toggle("chat-mention-bg-alt",e&&this.chat.context.get("chat.lines.alternate")))}updatePointsInfo(e){const t=null==e?void 0:e.pointIcon,i=null==e?void 0:e.pointName;t?this.css_tweaks.set("points-icon",`.ffz--points-icon:before { display: none }\n.ffz--points-icon:after {\n\tdisplay: inline-block;\n\tmargin: 0 0.5rem -0.6rem;\n\tbackground-image: url("${t.url}");\n\tbackground-image: ${o.WEBKIT_CSS}image-set(url("${t.url}") 1x, url("${t.url2x}") 2x, url("${t.url4x}") 4x);\n}`):this.css_tweaks.delete("points-icon"),this.point_name=i||null}async grabTypes(){const e=await this.web_munch.findModule("chat-types"),t=[];this.automod_types=e&&e.a||b,this.chat_types=e&&e.b||v,this.message_types=e&&e.c||m,this.mod_types=e&&e.e||_,e&&(e.a&&!Object(r.shallow_object_equals)(e.a,b)&&t.push("AUTOMOD_TYPES"),e.b&&!Object(r.shallow_object_equals)(e.b,v)&&t.push("CHAT_TYPES"),e.c&&!Object(r.shallow_object_equals)(e.c,m)&&t.push("MESSAGE_TYPES"),e.e&&!Object(r.shallow_object_equals)(e.e,_)&&t.push("MOD_TYPES"),t.length&&this.log.info("Chat Types have changed from static mappings for categories:",t.join(" ")))}onEnable(){this.on("site.web_munch:loaded",this.grabTypes),this.grabTypes(),this.chat.context.on("changed:chat.points.show-callouts",()=>{this.InlineCallout.forceUpdate(),this.CalloutSelector.forceUpdate()}),this.chat.context.on("changed:chat.points.show-button",()=>this.PointsButton.forceUpdate()),this.chat.context.on("changed:chat.points.show-rewards",()=>{this.PointsButton.forceUpdate(),this.PointsClaimButton.forceUpdate()}),this.chat.context.on("changed:chat.subs.gift-banner",()=>this.GiftBanner.forceUpdate(),this),this.chat.context.on("changed:chat.width",this.updateChatCSS,this),this.settings.main_context.on("changed:chat.use-width",this.updateChatCSS,this),this.chat.context.on("changed:chat.font-size",this.updateChatCSS,this),this.chat.context.on("changed:chat.font-family",this.updateChatCSS,this),this.chat.context.on("changed:chat.lines.emote-alignment",this.updateChatCSS,this),this.chat.context.on("changed:chat.adjustment-mode",this.updateColors,this),this.chat.context.on("changed:chat.adjustment-contrast",this.updateColors,this),this.chat.context.on("changed:theme.is-dark",this.updateColors,this),this.chat.context.on("changed:chat.lines.borders",this.updateLineBorders,this),this.chat.context.on("changed:chat.filtering.highlight-mentions",this.updateMentionCSS,this),this.chat.context.on("changed:chat.filtering.highlight-tokens",this.updateMentionCSS,this),this.chat.context.on("changed:chat.filtering.mention-color",this.updateMentionCSS,this),this.chat.context.on("changed:chat.fix-bad-emotes",this.updateChatLines,this),this.chat.context.on("changed:chat.filtering.display-deleted",this.updateChatLines,this),this.chat.context.on("changed:chat.filtering.display-mod-action",this.updateChatLines,this),this.chat.context.on("changed:chat.filtering.clickable-mentions",e=>this.css_tweaks.toggle("clickable-mentions",e)),this.chat.context.on("changed:chat.pin-resubs",e=>{e&&(this.updateInlineCallouts(),this.updatePinnedCallouts())},this),this.chat.context.on("changed:chat.community-chest.show",()=>{this.CommunityChestBanner.forceUpdate(),this.CalloutSelector.forceUpdate()},this),this.chat.context.on("changed:chat.lines.alternate",e=>{this.css_tweaks.toggle("chat-rows",e),this.updateMentionCSS()}),this.chat.context.on("changed:chat.lines.padding",e=>this.css_tweaks.toggle("chat-padding",e)),this.chat.context.on("changed:chat.bits.show",e=>this.css_tweaks.toggle("hide-bits",!e)),this.chat.context.on("changed:chat.bits.show-pinned",e=>this.css_tweaks.toggleHide("pinned-cheer",!e)),this.chat.context.on("changed:chat.filtering.deleted-style",e=>{this.css_tweaks.toggle("chat-deleted-strike",1===e||2===e),this.css_tweaks.toggle("chat-deleted-fade",e<2)});const e=this.chat.context.get("chat.filtering.deleted-style");this.css_tweaks.toggle("chat-deleted-strike",1===e||2===e),this.css_tweaks.toggle("chat-deleted-fade",e<2),this.css_tweaks.toggle("clickable-mentions",this.chat.context.get("chat.filtering.clickable-mentions")),this.chat.context.on("changed:chat.hide-community-highlights",e=>this.css_tweaks.toggleHide("community-highlights",e)),this.css_tweaks.toggleHide("community-highlights",this.chat.context.get("chat.hide-community-highlights")),this.css_tweaks.toggleHide("pinned-cheer",!this.chat.context.get("chat.bits.show-pinned")),this.css_tweaks.toggle("hide-bits",!this.chat.context.get("chat.bits.show")),this.css_tweaks.toggle("chat-rows",this.chat.context.get("chat.lines.alternate")),this.css_tweaks.toggle("chat-padding",this.chat.context.get("chat.lines.padding")),this.updateChatCSS(),this.updateColors(),this.updateLineBorders(),this.updateMentionCSS(),this.InlineCallout.on("mount",this.onInlineCallout,this),this.InlineCallout.on("update",this.onInlineCallout,this),this.InlineCallout.ready(()=>this.updateInlineCallouts()),this.PinnedCallout.on("mount",this.onPinnedCallout,this),this.PinnedCallout.on("update",this.onPinnedCallout,this),this.PinnedCallout.ready(()=>this.updatePinnedCallouts());const t=this;this.PointsInfo.on("mount",this.updatePointsInfo,this),this.PointsInfo.on("update",this.updatePointsInfo,this),this.PointsInfo.on("unmount",()=>this.updatePointsInfo(null)),this.PointsInfo.ready(()=>this.updatePointsInfo(this.PointsInfo.first)),this.GiftBanner.ready(e=>{const i=e.prototype.render;e.prototype.render=function(){return t.chat.context.get("chat.subs.gift-banner")?i.call(this):null},this.GiftBanner.forceUpdate()}),this.CommunityChestBanner.ready(e=>{const i=e.prototype.render;e.prototype.render=function(){try{if(!t.chat.context.get("chat.community-chest.show"))return null}catch(e){t.log.capture(e),t.log.error(e)}return i.call(this)},this.CommunityChestBanner.forceUpdate()}),this.InlineCallout.ready(e=>{const i=e.prototype.render;e.prototype.render=function(){try{var e,n;const i=null===(e=this.props)||void 0===e?void 0:null===(n=e.event)||void 0===n?void 0:n.callout,s=null==i?void 0:i.trackingType;if("community_points_reward"===s&&!t.chat.context.get("chat.points.show-callouts"))return null;if("prime_gift_bomb"===s&&!t.chat.context.get("chat.community-chest.show"))return null;if("megacheer_emote_recipient"===s&&!t.chat.context.get("chat.bits.show-rewards"))return null}catch(e){t.log.capture(e),t.log.error(e)}return i.call(this)},this.InlineCallout.forceUpdate()}),this.CalloutSelector.ready(e=>{const i=e.prototype.render;e.prototype.render=function(){try{var e;const i=this.props.callouts[0]||this.props.pinnedCallout,n=null==i?void 0:null===(e=i.event)||void 0===e?void 0:e.type;if("prime-gift-bomb-gifter"===n&&!t.chat.context.get("chat.community-chest.show"))return null;if("community-points-rewards"===n&&!t.chat.context.get("chat.points.show-callouts"))return null;if(("mega-recipient-rewards"===n||"mega-benefactor-rewards"===n)&&!t.chat.context.get("chat.bits.show-rewards"))return null}catch(e){t.log.capture(e),t.log.error(e)}return i.call(this)},this.CalloutSelector.forceUpdate()}),this.PointsButton.ready(e=>{const i=e.prototype.render;e.prototype.render=function(){try{if(!t.chat.context.get("chat.points.show-button"))return null;if(!t.chat.context.get("chat.points.show-rewards")){const e=this.state.animationQueue;this.state.animationQueue=[];const t=i.call(this);return this.state.animationQueue=e,t}}catch(e){t.log.capture(e),t.log.error(e)}return i.call(this)},this.PointsButton.forceUpdate()}),this.PointsClaimButton.ready(e=>{e.prototype.ffzHasOffer=function(){var e;return!this.props.hidden&&!(null===(e=this.state)||void 0===e?void 0:e.error)&&null!=this.getClaim()};const i=e.prototype.render;e.prototype.render=function(){try{if(this.ffzHasOffer()&&!this._ffz_timer&&t.chat.context.get("chat.points.auto-rewards")&&(this._ffz_timer=setTimeout(()=>{this._ffz_timer=null,this.onClick&&this.ffzHasOffer()&&this.onClick()},1e3+Math.floor(5e3*Math.random()))),!t.chat.context.get("chat.points.show-rewards"))return null}catch(e){t.log.capture(e),t.log.error(e)}return i.call(this)},this.PointsClaimButton.forceUpdate()}),this.ChatController.on("mount",this.chatMounted,this),this.ChatController.on("unmount",this.chatUnmounted,this),this.ChatController.on("update",this.chatUpdated,this),this.ChatService.ready((e,t)=>{this.wrapChatService(e);for(const e of t)e.client.events.removeAll(),e._ffzInstall(),e.connectHandlers(),e.props.setChatConnectionAPI({sendMessage:e.sendMessage,_ffz_inst:e})}),this.ChatBuffer.ready((e,t)=>{this.wrapChatBuffer(e);for(const e of t){const t=e.props.messageHandlerAPI;if(t&&t.removeMessageHandler(e.handleMessage),e._ffzInstall(),t&&t.addMessageHandler(e.handleMessage),Array.isArray(e.buffer)){let t=e.buffer.length;const i=this.chat_types||v;for(;t--;){const n=e.buffer[t];if(n&&n.type===i.RoomState&&n.state){this.chat.context.updateContext({chat_state:n.state});break}}}e.props.setMessageBufferAPI({addUpdateHandler:e.addUpdateHandler,removeUpdateHandler:e.removeUpdateHandler,getMessages:e.getMessages,isPaused:e.isPaused,setPaused:e.setPaused,hasNewerLeft:e.hasNewerLeft,loadNewer:e.loadNewer,loadNewest:e.loadNewest,_ffz_inst:e})}}),this.ChatBufferConnector.on("mount",this.connectorMounted,this),this.ChatBufferConnector.on("update",this.connectorUpdated,this),this.ChatBufferConnector.on("unmount",this.connectorUnmounted,this),this.ChatBufferConnector.ready((e,t)=>{for(const e of t)this.connectorMounted(e)}),this.ChatController.ready((e,t)=>{const i=this,n=e.prototype.componentDidCatch,s=e.prototype.render;e.prototype.componentDidCatch=function(e,t){const s=this.state.ffz_errors||0;if(s<100&&(this.setState({ffz_errors:s+1}),i.log.info("Error within Chat",e,t,s)),n)return n.call(this,e,t)},e.prototype.render=function(){if(this.state.ffz_errors>0){const e=i.web_munch.getModule("react"),t=e&&e.createElement;return t?t("div",{className:"tw-border-l tw-c-background-alt-2 tw-c-text-base tw-full-width tw-full-height tw-align-items-center tw-flex tw-flex-column tw-justify-content-center tw-relative"},"There was an error displaying chat."):null}return s.call(this)};for(const e of t)this.chatMounted(e)}),this.ChatContainer.on("mount",this.containerMounted,this),this.ChatContainer.on("unmount",this.removeRoom,this),this.ChatContainer.on("update",this.containerUpdated,this),this.ChatContainer.ready((e,t)=>{const i=this,n=e.prototype.componentDidCatch;e.prototype.componentDidCatch=function(e,t){const s=this.state.ffz_errors||0;if(s<100&&(this.setState({ffz_errors:s+1}),i.log.info("Error within Chat Container",e,t,s)),n)return n.call(this,e,t)};for(const e of t)this.containerMounted(e)}),this.PinnedCheer.on("mount",this.fixPinnedCheer,this),this.PinnedCheer.on("update",this.fixPinnedCheer,this),this.PinnedCheer.ready((e,t)=>{for(const e of t)this.fixPinnedCheer(e)}),this.RoomPicker.ready((e,t)=>{for(const e of t)this.closeRoomPicker(e)}),this.RoomPicker.on("mount",this.closeRoomPicker,this)}updatePinnedCallouts(){for(const e of this.PinnedCallout.instances)this.onPinnedCallout(e)}onPinnedCallout(e){if(!this.chat.context.get("chat.pin-resubs")||e._ffz_pinned)return;const t=e.props,i=t&&t.event;!t.pinned&&i&&"share-resub"===i.type&&(this.log.info("Automatically pinning re-sub notice."),e._ffz_pinned=!0,e.pin())}updateInlineCallouts(){for(const e of this.InlineCallout.instances)this.onInlineCallout(e)}onInlineCallout(e){if(!this.chat.context.get("chat.pin-resubs")||e._ffz_pinned)return;const t=Object(r.get)("props.event.callout",e);if(!t||"Share"!==t.cta)return;const i=Object(r.get)("contextMenuProps.onPin",t);i&&(this.log.info("Automatically pinning re-sub notice."),e._ffz_pinned=!0,e.hideOnContextMenuAction?e.hideOnContextMenuAction(i)():i())}tryUpdateBadges(){this._badge_timer||(this._badge_timer=setTimeout(()=>this._tryUpdateBadges(),0))}_tryUpdateBadges(){this._badge_timer&&clearTimeout(this._badge_timer),this._badge_timer=null,this.log.info("Trying to update badge data from the chat container.");const e=this.ChatContainer.first;e&&this.containerUpdated(e,e.props)}closeRoomPicker(e){e.closeRoomPicker()}wrapChatBuffer(e){if(e.prototype._ffz_was_here)return;const t=this,i=e.prototype.clear,n=e.prototype.flushRawMessages,s=e.prototype.componentDidMount;e.prototype._ffzInstall=function(){if(this._ffz_installed)return;this._ffz_installed=!0;const e=this,i=e.handleMessage,n=e.props.setMessageBufferAPI;e.props.setMessageBufferAPI=function(t){return t&&(t._ffz_inst=e),n(t)},e.handleMessage=function(n){if(n)try{const i=t.chat_types||{},s=t.mod_types||{};if(n.type===i.RewardGift&&!t.chat.context.get("chat.bits.show-rewards"))return;if(n.type===i.Message){const i=t.chat.standardizeMessage(n),s=e._ffz_connector,r=s&&s.props.channelID;let o=i.roomLogin=i.roomLogin?i.roomLogin:i.channel?i.channel.slice(1):s&&s.props.channelLogin;if(!o&&r){const e=t.chat.getRoom(r,null,!0);e&&e.login&&(o=i.roomLogin=e.login)}const l=t.site.getUser(),c={id:r,login:o};l&&s&&(l.moderator=s.props.isCurrentUserModerator,l.staff=s.props.isStaff),i.ffz_tokens=i.ffz_tokens||t.chat.tokenizeMessage(i,l,c);const u=new a.FFZEvent({message:i,channel:o,channelID:r});if(t.emit("chat:receive-message",u),u.defaultPrevented||i.ffz_removed)return}else if(n.type===i.ModerationAction&&e.markUserEventDeleted&&e.unsetModeratedUser){if(n.level&&n.level.length||!n.targetUserLogin||n.targetUserLogin!==e.props.currentUserLogin){if(!e.props.isCurrentUserModerator)return;const s=n.moderationActionType;if("ban"===s||"timeout"===s||"delete"===s){const s=n.targetUserLogin;if(e.moderatedUsers.has(s))return;if(3===t.chat.context.get("chat.filtering.remove-deleted")){const t=e.buffer.length,r=n.messageID;e.buffer=e.buffer.filter(e=>e.type!==i.Message||!e.user||e.user.userLogin!==s||r&&e.id!==r),t===e.buffer.length||e.props.isBackground||e.notifySubscribers(),e.ffzModerateBuffer([e.delayedMessageBuffer],n)}else e.ffzModerateBuffer([e.buffer,e.delayedMessageBuffer],n);return e.moderatedUsers.add(s),setTimeout(e.unsetModeratedUser(s),1e3),void e.delayedMessageBuffer.push({event:n,time:Date.now(),shouldDelay:!1})}}}else{if(n.type===i.Moderation&&e.markUserEventDeleted&&e.unsetModeratedUser){if(e.props.isCurrentUserModerator)return;const r=n.userLogin;if(e.moderatedUsers.has(r))return;const o=n.moderationType;let a;if(o===s.Ban?a="ban":o===s.Delete?a="delete":o===s.Unban?a="unban":o===s.Timeout&&(a="timeout"),a&&(n.moderationActionType=a),3===t.chat.context.get("chat.filtering.remove-deleted")){const t=e.buffer.length,s=n.targetMessageID;e.buffer=e.buffer.filter(e=>e.type!==i.Message||!e.user||e.user.userLogin!==r||s&&e.id!==s),t===e.buffer.length||e.props.isBackground||e.notifySubscribers(),e.ffzModerateBuffer([e.delayedMessageBuffer],n)}else e.ffzModerateBuffer([e.buffer,e.delayedMessageBuffer],n);return e.moderatedUsers.add(r),setTimeout(e.unsetModeratedUser(r),1e3),void e.delayedMessageBuffer.push({event:n,time:Date.now(),shouldDelay:!1})}n.type===i.Clear&&t.chat.context.get("chat.filtering.ignore-clear")&&(n={type:i.Info,message:t.i18n.t("chat.ignore-clear","An attempt by a moderator to clear chat was ignored.")})}}catch(e){t.log.error("Error processing chat event.",e),t.log.capture(e,{extra:{msg:n}})}return i.call(e,n)},e.ffzModerateBuffer=function(i,n){const s=t.mod_types||{},r=n.moderationActionType,o=n.targetUserLogin||n.userLogin,a=n.createdByLogin,l=n.targetMessageID||n.messageID;let c,u=0;const h=r===s.Delete,updater=t=>{if(t.event&&(t=t.event),l&&t.id!==l)return;const i=e.markUserEventDeleted(t,o);return i?(c=i,u++,i.modLogin=a,i.modActionType=r,i.duration=n.duration,!!h||void 0):void 0};for(const e of i)if(e.some(updater))break;c&&(c.deletedCount=u)},e.setPaused=function(i){e.paused!==i&&(e.paused=i,i||(e.slidingWindowEnd=Math.min(e.buffer.length,t.chat.context.get("chat.scrollback-length")),e.props.isBackground||e.notifySubscribers()))},e.loadNewer=function(){if(!e.hasNewerLeft())return;const i=Math.min(e.buffer.length,e.slidingWindowEnd+40),n=Math.max(0,i-t.chat.context.get("chat.scrollback-length"));e.clear(e.buffer.length-n),e.slidingWindowEnd=i-n,e.props.isBackground||e.notifySubscribers()},e.loadNewest=function(){if(!e.hasNewerLeft())return;const i=t.chat.context.get("chat.scrollback-length");e.clear(i),e.slidingWindowEnd=Math.min(i,e.buffer.length),e.props.isBackground||e.notifySubscribers()},e.getMessages=function(){return e.buffer.slice(0,e.slidingWindowEnd+(e.ffz_extra||0))}},e.prototype.componentDidMount=function(){try{this._ffzInstall()}catch(e){t.log.error("Error installing FFZ features onto chat buffer.",e)}return s.call(this)},e.prototype.clear=function(e){try{null==e&&(e=0);const i=t.chat.context.get("chat.scrollback-length");if(!this.isPaused()&&e>i&&(e=i),e<=0)this.ffz_extra=0,this.buffer=[],this.delayedMessageBuffer=[],this.paused=!1;else{const i=this.buffer,n=t.chat_types||v,s=i.length-e;if(s>0){let t,r=0;for(let e=0;e<s;e++)i[e]&&!y.includes(n[i[e].type])&&(r++,t=e);this.buffer=i.slice(r%2!=0?Math.max(s-4,t):s),this.ffz_extra=i.length-e}else this.ffz_extra=0,this.buffer=this.buffer.slice(0);this.paused&&this.buffer.length>=900&&this.setPaused(!1)}}catch(n){return t.log.error("Error running clear",n),i.call(this,e)}},e.prototype.flushRawMessages=function(){try{const e=[],i=Date.now(),n=t.chat.context.get("chat.delay"),s=i-(-1===n?this.delayDuration:n),r=this.shouldSeeBlockedAndDeletedMessages||this.props&&this.props.shouldSeeBlockedAndDeletedMessages,o=this.hasNewerLeft(),a=this.isPaused(),l=t.chat.context.get("chat.scrollback-length"),c=t.chat.context.get("chat.filtering.remove-deleted");let u=0,h=this.slidingWindowEnd,d=!1;for(const t of this.delayedMessageBuffer)if(t.time<=s||!t.shouldDelay){if(0!==c&&(c>1||!r)&&this.isDeletable(t.event)&&t.event.deleted)continue;this.buffer.push(t.event),d=!0,this.paused||(this.buffer.length>l?u++:h++)}else e.push(t);this.delayedMessageBuffer=e,d&&(this.clear(Math.min(900,this.buffer.length-u)),0===u&&h===this.slidingWindowEnd&&o===this.hasNewerLeft()&&a===this.isPaused()||(this.slidingWindowEnd=h,this.props.isBackground||this.notifySubscribers()))}catch(e){return t.log.error("Error running flush.",e),n.call(this)}}}sendMessage(e,t){const i=this.ChatService.first;return i&&e?(e.startsWith("#")&&(e=e.slice(1)),e.toLowerCase()!==i.props.channelLogin.toLowerCase()?i.client.sendCommand(e,t):void i.sendMessage(t)):null}wrapChatService(e){const t=this,i=e.prototype.componentDidMount,n=e.prototype.connectHandlers;e.prototype._ffz_was_here=!0,e.prototype._ffzInstall=function(){if(this._ffz_installed)return;this._ffz_installed=!0;const e=this,i=this.sendMessage;e.sendMessage=function(n){if((n=n.replace(/\s+/g," ")).startsWith("/ffz"))return e.addMessage({type:t.chat_types.Notice,message:"The /ffz command is not yet re-implemented."}),!1;const s=new a.FFZEvent({message:n,channel:e.props.channelLogin});return t.emit("chat:pre-send-message",s),s.defaultPrevented?void 0:i.call(this,s.message)}},e.prototype.componentDidMount=function(){try{this._ffzInstall()}catch(e){t.log.error("Error installing FFZ features onto chat service.",e)}return i.call(this)},e.prototype.connectHandlers=function(...e){if(!this._ffz_init){const e=this;for(const t of w){const i=this[t];i&&(this[t]=function(t,n){e._wrapped=t;const s=i.call(e,t,n);return e._wrapped=null,s})}const i=this.onChatMessageEvent;this.onChatMessageEvent=function(t){return i.call(e,t)};const n=this.onChatActionEvent;this.onChatActionEvent=function(t){return n.call(e,t)};const s=this.onSubscriptionEvent;this.onSubscriptionEvent=function(i){try{if(t.chat.context.get("chat.subs.show")<3)return;i.body="";const n=e.convertMessage({message:i});return n.ffz_type="resub",n.sub_plan=i.methods,e.postMessageToCurrentChannel(i,n)}catch(n){return t.log.capture(n,{extra:i}),s.call(e,i)}};const o=this.onRoomStateEvent;this.onRoomStateEvent=function(i){try{const e=i.channel,n=t.chat.context.get("context.channel");!e||e!==n&&e!==`#${n}`||t.chat.context.updateContext({chat_state:i.state})}catch(e){t.log.capture(e,{extra:i})}return o.call(e,i)};const a=this.onResubscriptionEvent;this.onResubscriptionEvent=function(i){try{if(t.chat.context.get("chat.subs.show")<2&&!i.body)return;const n=e.convertMessage({message:i});return n.ffz_type="resub",n.sub_cumulative=i.cumulativeMonths||0,n.sub_streak=i.streakMonths||0,n.sub_share_streak=i.shouldShareStreakTenure,n.sub_months=i.months,n.sub_plan=i.methods,e.postMessageToCurrentChannel(i,n)}catch(n){return t.log.capture(n,{extra:i}),a.call(e,i)}};const l=this.ffz_mysteries={},c=this.onSubscriptionGiftEvent;this.onSubscriptionGiftEvent=function(i){try{const t=`${i.channel}:${i.user.userID}`,n=l[t];if(n){if(!(n.expires<Date.now()))return n.recipients.push({id:i.recipientID,login:i.recipientLogin,displayName:i.recipientName}),n.recipients.length>=n.size&&(l[t]=null),void(n.line&&n.line.forceUpdate());l[t]=null}i.body="";const s=e.convertMessage({message:i});return s.ffz_type="sub_gift",s.sub_recipient={id:i.recipientID,login:i.recipientLogin,displayName:i.recipientName},s.sub_plan=i.methods,s.sub_total=i.senderCount,e.postMessageToCurrentChannel(i,s)}catch(n){return t.log.capture(n,{extra:i}),c.call(e,i)}};const u=this.onAnonSubscriptionGiftEvent;this.onAnonSubscriptionGiftEvent=function(i){try{const t=`${i.channel}:ANON`,n=l[t];if(n){if(!(n.expires<Date.now()))return n.recipients.push({id:i.recipientID,login:i.recipientLogin,displayName:i.recipientName}),n.recipients.length>=n.size&&(l[t]=null),void(n.line&&n.line.forceUpdate());l[t]=null}i.body="";const s=e.convertMessage({message:i});return s.ffz_type="sub_gift",s.sub_anon=!0,s.sub_recipient={id:i.recipientID,login:i.recipientLogin,displayName:i.recipientName},s.sub_plan=i.methods,s.sub_total=i.senderCount,e.postMessageToCurrentChannel(i,s)}catch(n){return t.log.capture(n,{extra:i}),u.call(e,i)}};const h=this.onSubscriptionMysteryGiftEvent;this.onSubscriptionMysteryGiftEvent=function(i){try{let n=null;if(i.massGiftCount>t.chat.context.get("chat.subs.merge-gifts")){const e=`${i.channel}:${i.user.userID}`;n=l[e]={recipients:[],size:i.massGiftCount,expires:Date.now()+3e4}}i.body="";const s=e.convertMessage({message:i});return s.ffz_type="sub_mystery",s.mystery=n,s.sub_plan=i.plan,s.sub_count=i.massGiftCount,s.sub_total=i.senderCount,e.postMessageToCurrentChannel(i,s)}catch(n){return t.log.capture(n,{extra:i}),h.call(e,i)}};const d=this.onAnonSubscriptionMysteryGiftEvent;this.onAnonSubscriptionMysteryGiftEvent=function(i){try{let n=null;if(i.massGiftCount>t.chat.context.get("chat.subs.merge-gifts")){const e=`${i.channel}:ANON`;n=l[e]={recipients:[],size:i.massGiftCount,expires:Date.now()+3e4}}i.body="";const s=e.convertMessage({message:i});return s.ffz_type="sub_mystery",s.sub_anon=!0,s.mystery=n,s.sub_plan=i.plan,s.sub_count=i.massGiftCount,s.sub_total=i.senderCount,e.postMessageToCurrentChannel(i,s)}catch(n){return t.log.capture(n,{extra:i}),d.call(e,i)}};const f=this.onRitualEvent;this.onRitualEvent=function(i){try{const t=e.convertMessage(i);return t.ffz_type="ritual",t.ritual=i.type,e.postMessageToCurrentChannel(i,t)}catch(n){return t.log.capture(n,{extra:i}),f.call(e,i)}};const p=this.onChannelPointsRewardEvent;this.onChannelPointsRewardEvent=function(i){try{if(t.chat.context.get("chat.points.custom-rendering")){const t=i.rewardID&&Object(r.get)(i.rewardID,e.props.rewardMap);if(t){const n=e.convertMessage(i);return n.ffz_type="points",n.ffz_reward=t,e.postMessageToCurrentChannel(i,n)}}}catch(e){t.log.error(e),t.log.capture(e,{extra:i})}return p.call(e,i)};const g=this.onHostingEvent;this.onHostingEvent=function(i,n){return t.emit("tmi:host",i,n),g.call(e,i,n)};const m=this.onUnhostEvent;this.onUnhostEvent=function(i,n){return t.emit("tmi:unhost",i,n),m.call(e,i,n)};const _=this.addMessage;this.addMessage=function(t){const i=e._wrapped;return i&&!t._ffz_checked?e.postMessageToCurrentChannel(i,t):_.call(e,t)},this._ffz_init=!0}return n.apply(this,...e)},e.prototype.postMessageToCurrentChannel=function(e,i){const n=i;if(i._ffz_checked=!0,i.type===t.chat_types.ChannelPointsReward&&(i=i.message),e.channel){let t=i.channel=e.channel.toLowerCase();if(t.startsWith("#")&&(t=t.slice(1)),t!==this.props.channelLogin.toLowerCase())return;i.roomLogin=t}if(e.message){const n=e.message.user,s=e.message.flags;if(n&&(i.emotes=n.emotes),s&&this.getFilterFlagOptions){const e=this.props.isCurrentUserModerator&&t.chat.context.get("chat.automod.run-as-mod");e&&(this.props.isCurrentUserModerator=!1),i.flags=this.getFilterFlagOptions(s),e&&(this.props.isCurrentUserModerator=!0)}"string"==typeof e.action?i.message=e.action:i.message=e.message.body}this.addMessage(n)}}updateChatLines(){this.PinnedCheer.forceUpdate(),this.chat_line.updateLines()}fixPinnedCheer(e){const t=this.fine.getChildNode(e),i=t&&t.querySelector&&t.querySelector(".pinned-cheer__headline"),n=e.props.topCheer;if(!i||!n)return;if(i.dataset.roomId=e.props.channelID,i.dataset.room=e.props.channelLogin&&e.props.channelLogin.toLowerCase(),i.dataset.userId=n.user.userID,i.dataset.user=n.user.userLogin&&n.user.userLogin.toLowerCase(),n.user.color){const e=i.querySelector(".chat-author__display-name");e&&(e.style.color=this.colors.process(n.user.color));const t=i.querySelector(".chat-author__intl-login");t&&(t.style.color=this.colors.process(n.user.color))}const r=i.querySelector(".chat-line__message--emote"),o=r?r.parentElement.parentElement:i.querySelector(".ffz--pinned-top-emote"),a=function extractCheerPrefix(e){for(const t of e)if(3===t.type&&t.content.cheerAmount)return t.content.alt;return null}(n.messageParts);if(o&&a){const e=this.chat.tokenizeString(`${a}${n.bits}`,n);o.classList.add("ffz--pinned-top-emote"),o.innerHTML="",Object(s.setChildren)(o,this.chat.renderTokens(e))}}addRoom(e,t){if(t||(t=e.props),!t.channelID)return null;const i=e._ffz_room=this.chat.getRoom(t.channelID,t.channelLogin&&t.channelLogin.toLowerCase(),!1,!0);return i.ref(e),i}removeRoom(e){e._ffz_room&&(e._ffz_room.unref(e),e._ffz_room=null)}chatMounted(e,t){e.chatBuffer&&(e.chatBuffer.ffzController=e),t||(t=e.props),this.addRoom(e,t)&&(this.updateRoomBitsConfig(e,t.bitsConfig),this.settings.updateContext({moderator:t.isCurrentUserModerator,chatHidden:t.isHidden}),(t.isEmbedded||t.isPopout)&&this.settings.updateContext({channel:t.channelLogin&&t.channelLogin.toLowerCase(),channelID:t.channelID}),this.chat.context.updateContext({moderator:t.isCurrentUserModerator,channel:t.channelLogin&&t.channelLogin.toLowerCase(),channelID:t.channelID}))}chatUnmounted(e){e.chatBuffer&&e.chatBuffer.ffzController===this&&(e.chatBuffer.ffzController=null),(e.props.isEmbedded||e.props.isPopout)&&this.settings.updateContext({channel:null,channelID:null}),this.settings.updateContext({moderator:!1,chatHidden:!1}),this.chat.context.updateContext({moderator:!1,channel:null,channelID:null}),this.removeRoom(e)}chatUpdated(e,t){if(e.chatBuffer&&(e.chatBuffer.ffzController=e),!e._ffz_room||t.channelID!=e._ffz_room.id)return this.removeRoom(e),void(e._ffz_mounted&&this.chatMounted(e));t.bitsConfig!==e.props.bitsConfig&&this.updateRoomBitsConfig(e,e.props.bitsConfig);let i=e.props.channelLogin;i&&(i=i.toLowerCase()),(e.props.isEmbedded||e.props.isPopout)&&this.settings.updateContext({channel:i,channelID:e.props.channelID}),this.settings.updateContext({moderator:e.props.isCurrentUserModerator,chatHidden:e.props.isHidden}),this.chat.context.updateContext({moderator:e.props.isCurrentUserModerator,channel:i,channelID:e.props.channelID})}updateRoomBitsConfig(e,t){const i=e._ffz_room;if(!i)return;let n=null;if(t&&Array.isArray(t.orderedActions)){n=new Set;for(const e of t.orderedActions)e&&e.prefix&&n.add(e.prefix)}!this._ffz_old_bits&&!n||Object(r.set_equals)(this._ffz_old_bits,n)||(this._ffz_old_bits=n,i.updateBitsConfig(formatBitsConfig(t)),this.updateChatLines())}connectorMounted(e){const t=e.props.messageBufferAPI;t&&t._ffz_inst&&t._ffz_inst._ffz_connector!==e&&(t._ffz_inst._ffz_connector=e)}connectorUpdated(e,t){const i=t.messageBufferAPI,n=e.props.messageBufferAPI;i!==n&&(i&&i._ffz_inst&&i._ffz_inst._ffz_connector===e&&(i._ffz_inst._ffz_connector=null),n&&n._ffz_inst&&n._ffz_inst._ffz_connector!==e&&(i._ffz_inst._ffz_connector=e))}connectorUnmounted(e){const t=e.props.messageBufferAPI;t&&t._ffz_inst&&t._ffz_inst._ffz_connector===e&&(t._ffz_inst._ffz_connector=null)}containerMounted(e,t){t||(t=e.props),this.addRoom(e,t)&&(this.updateRoomBitsConfig(e,t.bitsConfig),t.data&&(this.chat.badges.updateTwitchBadges(t.data.badges),this.updateRoomBadges(e,t.data.user&&t.data.user.broadcastBadges),this.updateRoomRules(e,t.chatRules)))}containerUpdated(e,t){if(!e._ffz_room||t.channelID!=e._ffz_room.id)return this.removeRoom(e),void(e._ffz_mounted&&this.containerMounted(e,t));t.bitsConfig!==e.props.bitsConfig&&this.updateRoomBitsConfig(e,t.bitsConfig);const i=t.data||{},n=e.props.data||{},s=i.badges||[],r=n.badges||[],o=i.user&&i.user.broadcastBadges||[],a=n.user&&n.user.broadcastBadges||[];this.chat.badges.getTwitchBadgeCount()===s.length&&s.length===r.length||this.chat.badges.updateTwitchBadges(s),e._ffz_room.badgeCount()===o.length&&o.length===a.length||this.updateRoomBadges(e,o),this.updateRoomRules(e,t.chatRules)}hasRoomBadges(e){const t=e._ffz_room;return!!t&&t.hasBadges()}updateRoomBadges(e,t){const i=e._ffz_room;i&&(i.updateBadges(t),this.updateChatLines())}updateRoomRules(e,t){const i=e._ffz_room;i&&(i.rules=t)}}function formatBitsConfig(e){if(!e)return;const t={},i=e.indexedActions;for(const e in i)if(Object(r.has)(i,e)){const n=i[e],s=t[e]={id:n.id,prefix:n.prefix,tiers:[]};for(const e of n.orderedTiers){const t={};for(const i of e.images){const e=t[i.theme]=t[i.theme]||[],n=i.isAnimated?"animated":"static";(e[n]=e[n]||{})[i.dpiScale]=i.url}s.tiers.push({amount:e.bits,color:e.color,id:e.id,images:t})}}return t}},function(e,t,i){"use strict";i.r(t),i.d(t,"MERGE_METHODS",(function(){return n})),i.d(t,"mergeList",(function(){return mergeList})),i.d(t,"default",(function(){return merge}));const n={Document:(e,t)=>(e.definitions&&t.definitions?e.definitions=mergeList(e.definitions,t.definitions):t.definitions&&(e.definitions=t.definitions),e),Field:(e,t)=>!e.name||t.name&&t.name.value===e.name.value?(e.selectionSet&&t.selectionSet?e.selectionSet=merge(e.selectionSet,t.selectionSet):t.selectionSet&&(e.selectionSet=t.selectionSet),e):e,OperationDefinition:(e,t)=>e.operation!==t.operation?e:(e.selectionSet&&t.selectionSet?e.selectionSet=merge(e.selectionSet,t.selectionSet):t.selectionSet&&(e.selectionSet=t.selectionSet),e),FragmentDefinition:(e,t)=>{if(e.typeCondition&&t.typeCondition){if(e.typeCondition.kind!==t.typeCondition.kind)return e;if(e.typeCondition.name.value!=t.typeCondition.name.value)return e}return e.selectionSet&&t.selectionSet?e.selectionSet=merge(e.selectionSet,t.selectionSet):t.selectionSet&&(e.selectionSet=t.selectionSet),e},SelectionSet:(e,t)=>(e.selections&&t.selections?e.selections=mergeList(e.selections,t.selections):t.selections&&(e.selections=t.selections),e)};function mergeList(e,t){let i=!1;const n={};for(const t of e)t&&t.name&&"Name"===t.name.kind&&(t.operation&&(i=!0),n[t.name.value]=t);for(const s of t){if(!s||!s.name||"Name"!==s.name.kind)continue;const t=s.name.value,r=n[t]?e.indexOf(n[t]):-1;if(-1!==r){if(e[r].operation&&s.operation&&e[r].operation!==s.operation)continue;e[r]=merge(e[r],s),e[r].operation&&(i=!0)}else{if(i&&s.operation)continue;e.push(s)}}return e}function merge(e,t){return e.kind!==t.kind?e:n[e.kind]?n[e.kind](e,t):e}},function(e,t,i){"use strict";i.r(t),i.d(t,"default",(function(){return Actions}));var n=i(3),s=i(0),r=i(1),o=i(12),a=i(44),l=i(45),c=i(41);const u=/\{\{(.*?)(?:\|(.*?))?\}\}/g;class Actions extends n.default{constructor(...e){super(...e),this.inject("settings"),this.inject("tooltips"),this.inject("i18n"),this.actions={},this.renderers={},this.settings.add("chat.actions.reasons",{default:[{v:{text:"One-Man Spam",i18n:"chat.reasons.spam"}},{v:{text:"Posting Bad Links",i18n:"chat.reasons.links"}},{v:{text:"Ban Evasion",i18n:"chat.reasons.evasion"}},{v:{text:"Threats / Personal Info",i18n:"chat.reasons.personal"}},{v:{text:"Hate / Harassment",i18n:"chat.reasons.hate"}},{v:{text:"Ignoring Broadcaster / Moderators",i18n:"chat.reason.ignore"}}],type:"array_merge",always_inherit:!0,process(e,t){if(Array.isArray(t))for(const e of t)e.i18n&&"string"!=typeof e.i18n&&delete e.i18n;return t},ui:{path:"Chat > Actions > Reasons >> Custom Reasons",component:"chat-reasons"}}),this.settings.add("chat.actions.inline",{process:(e,t)=>t.filter(e=>e.appearance&&this.renderers[e.appearance.type]&&(!this.renderers[e.appearance.type].load||this.renderers[e.appearance.type].load(e.appearance))&&(!e.action||this.actions[e.action])),default:[{v:{action:"ban",appearance:{type:"icon",icon:"ffz-i-block"},options:{},display:{mod:!0,mod_icons:!0,deleted:!1}}},{v:{action:"unban",appearance:{type:"icon",icon:"ffz-i-ok"},options:{},display:{mod:!0,mod_icons:!0,deleted:!0}}},{v:{action:"timeout",appearance:{type:"icon",icon:"ffz-i-clock"},display:{mod:!0,mod_icons:!0}}},{v:{action:"msg_delete",appearance:{type:"icon",icon:"ffz-i-trash"},options:{},display:{mod:!0,mod_icons:!0}}}],type:"array_merge",ui:{path:'Chat > Actions > In-Line @{"description": "Here, you can define custom actions that will appear along messages in chat. If you aren\'t seeing an action you\'ve defined here in chat, please make sure that you have enabled Mod Icons in the chat settings menu."}',component:"chat-actions",context:["user","room","message"],inline:!0,modifiers:!0,data:()=>{const e=this.resolve("site.chat");return{color:t=>e&&e.colors?e.colors.process(t):t,actions:Object(s.deep_copy)(this.actions),renderers:Object(s.deep_copy)(this.renderers)}}}}),this.settings.add("chat.actions.user-context",{process:(e,t)=>t.filter(e=>e.type||e.appearance&&this.renderers[e.appearance.type]&&(!this.renderers[e.appearance.type].load||this.renderers[e.appearance.type].load(e.appearance))&&(!e.action||this.actions[e.action])),default:[],type:"array_merge",ui:{path:'Chat > Actions > User Context @{"description": "Here, you can define custom actions that will appear in a context menu when you right-click a username in chat."}',component:"chat-actions",context:["user","room","message"],mod_icons:!0,data:()=>{const e=this.resolve("site.chat");return{color:t=>e&&e.colors?e.colors.process(t):t,actions:Object(s.deep_copy)(this.actions),renderers:Object(s.deep_copy)(this.renderers)}}}}),this.settings.add("chat.actions.room",{process:(e,t)=>t.filter(e=>e.type||e.appearance&&this.renderers[e.appearance.type]&&(!this.renderers[e.appearance.type].load||this.renderers[e.appearance.type].load(e.appearance))&&(!e.action||this.actions[e.action])),default:[],type:"array_merge",ui:{path:'Chat > Actions > Room @{"description": "Here, you can define custom actions that will appear above the chat input box."}',component:"chat-actions",context:["room","room-mode"],inline:!0,data:()=>{const e=this.resolve("site.chat");return{color:t=>e&&e.colors?e.colors.process(t):t,actions:Object(s.deep_copy)(this.actions),renderers:Object(s.deep_copy)(this.renderers)}}}}),this.settings.add("chat.actions.room-above",{default:!1,ui:{path:"Chat > Actions > Room >> General",component:"setting-check-box",title:"Display Room Actions above the chat input box."}}),this.settings.add("chat.actions.rules-as-reasons",{default:!0,ui:{path:"Chat > Actions > Reasons >> Rules",component:"setting-check-box",title:"Include the current room's rules in the list of reasons."}}),this.handleClick=this.handleClick.bind(this),this.handleContext=this.handleContext.bind(this),this.handleUserContext=this.handleUserContext.bind(this)}onEnable(){this.tooltips.types.action=(e,t)=>{const i=this.getData(e);return i?i.definition.tooltip?i.tip&&i.tip.length?this.replaceVariables(i.tip,i):Object(s.maybe_call)(i.definition.tooltip,this,i,e,t):`Error: The "${i.action}" action provider does not have tooltip support.`:this.i18n.t("chat.actions.unknown","Unknown Action Type")};for(const e in a)Object(s.has)(a,e)&&this.addAction(e,a[e]);for(const e in l)Object(s.has)(l,e)&&this.addRenderer(e,l[e])}addAction(e,t){if(Object(s.has)(this.actions,e))return this.log.warn(`Attempted to add action "${e}" which is already defined.`);this.actions[e]=t;for(const e of this.settings.__contexts)e.update("chat.actions.inline")}addRenderer(e,t){if(Object(s.has)(this.renderers,e))return this.log.warn(`Attempted to add renderer "${e}" which is already defined.`);this.renderers[e]=t;for(const e of this.settings.__contexts)e.update("chat.actions.inline")}replaceVariables(e,t){return Object(c.b)(e,t,this.i18n.locale,u,{})}renderInlineReasons(e,t,i){const n=this.parent.context.get("chat.actions.reasons"),s=[],o=this.parent.context.get("chat.actions.rules-as-reasons")&&this.parent.getRoom(e.room.id,e.room.login,!0),a=o&&o.rules;if(!n&&!a)return i.hide(),null;const click_fn=t=>n=>(i.hide(),e.definition.click.call(this,n,Object.assign({reason:t},e)),n.preventDefault(),!1);if(n&&n.length)for(const t of n){const i=this.replaceVariables("string"==typeof t.i18n?this.i18n.t(t.i18n,t.text):t.text,e);s.push(Object(r.createElement)("li",{class:"tw-full-width tw-relative"},Object(r.createElement)("a",{href:"#",class:"tw-block tw-full-width tw-interactable tw-interactable--hover-enabled tw-interactable--inverted tw-interactive tw-pd-05",onClick:click_fn(i)},i)))}if(a&&a.length){n&&n.length&&s.push(Object(r.createElement)("div",{class:"tw-mg-y-05 tw-border-b"}));for(const e of a)s.push(Object(r.createElement)("li",{class:"tw-full-width tw-relative"},Object(r.createElement)("a",{href:"#",class:"tw-block tw-full-width tw-interactable tw-interactable--hover-enabled tw-interactable--inverted tw-interactive tw-pd-05",onClick:click_fn(e)},e)))}let l;return l=e.definition.reason_text?e.definition.reason_text.call(this,e,t,i):this.i18n.t("chat.actions.select-reason","Please select a reason from the list below:"),Object(r.createElement)("div",{class:"ffz--inline-reasons"},l?Object(r.createElement)("div",{class:"tw-pd-05 tw-border-b"},l):null,Object(r.createElement)("ul",null,s))}renderInlineContext(e,t){const i=t.definition;let n;if(i.context)n=(e,n)=>i.context.call(this,t,e,n);else{if(!i.uses_reason)return;n=(e,i)=>this.renderInlineReasons(t,e,i)}return this.renderPopup(e,n)}renderPopup(e,t){if(e._ffz_destroy)return e._ffz_destroy();const i=e._ffz_destroy=()=>{if(e._ffz_outside&&e._ffz_outside.destroy(),e._ffz_popup){const t=e._ffz_popup;e._ffz_popup=null,t.destroy()}e._ffz_destroy=e._ffz_outside=null},n=document.body.querySelector("#root>div")||document.body;(e._ffz_popup=new o.default(n,e,{logger:this.log,manual:!0,live:!1,html:!0,hover_events:!0,no_update:!0,tooltipClass:"ffz-action-balloon tw-balloon tw-block tw-border tw-elevation-1 tw-border-radius-small tw-c-background-base",arrowClass:"tw-balloon__tail tw-overflow-hidden tw-absolute",arrowInner:"tw-balloon__tail-symbol tw-border-t tw-border-r tw-border-b tw-border-l tw-border-radius-small tw-c-background-base  tw-absolute",innerClass:"",popper:{placement:"bottom",modifiers:{preventOverflow:{boundariesElement:n},flip:{behavior:["bottom","top","left","right"]}}},content:t,onShow:async(t,n)=>{await n.waitForDom(),e._ffz_outside=new r.ClickOutside(n.outer,i)},onMove:(e,t,i)=>{this.emit("tooltips:mousemove",e,t,i)},onLeave:(e,t,i)=>{this.emit("tooltips:leave",e,t,i)},onHide:i}))._enter(e)}getUserLevel(e,t){return e&&t?e.id===t.id||e.login===t.login?5:t.moderator||"mod"===t.type||t.badges&&t.badges.moderator?3:0:0}renderRoom(e,t,i,n,r){const o=[],a=this.resolve("site.chat");for(const n of this.parent.context.get("chat.actions.room")){if(!n||!n.action||!n.appearance)continue;let l=n.appearance||{};const c=n.display||{},u=this.actions[n.action];if(!u||c.disabled||null!=c.mod_icons&&c.mod_icons!==!!e||null!=c.mod&&c.mod!==(!!t&&!!t.mod)||null!=c.staff&&c.staff!==(!!t&&!!t.staff)||null!=c.emoteOnly&&c.emoteOnly!==i.emoteOnly||null!=c.slowMode&&c.slowMode!==i.slowMode||null!=c.subsMode&&c.subsMode!==i.subsMode||null!=c.r9kMode&&c.r9kMode!==i.r9kMode||null!=c.followersOnly&&c.followersOnly!==i.followersOnly)continue;if(u.override_appearance){const s=u.override_appearance.call(this,Object.assign({},l),n,null,i,t,e);s&&(l=s)}const h=this.renderers[l.type];if(!h)continue;const d=h.colored&&l.color,f=Object(s.maybe_call)(u.disabled,this,n,null,i,t,e)||!1,p=d&&(a&&a.colors?a.colors.process(l.color):l.color),g=h.render.call(this,l,r,p);o.push(r("button",{class:`ffz-tooltip tw-pd-x-05 ffz-mod-icon mod-icon tw-c-text-alt-2${f?" disabled":""}${d?" colored":""}`,"data-tooltip-type":"action","data-action":n.action,"data-options":n.options?JSON.stringify(n.options):null,"data-tip":l.tooltip,onClick:this.handleClick,onContextMenu:this.handleContext},g))}return o.length?r("div",{class:`ffz--room-actions ffz-action-data tw-flex tw-flex-grow-1 tw-flex-wrap tw-align-items-center ${n?"tw-pd-y-05 tw-border-t":"tw-mg-x-05"}`,"data-room":i&&JSON.stringify(i)},o):null}renderUserContext(e,t){var i;const n=this.resolve("site.fine"),o=this.resolve("site"),a=this.resolve("site.chat"),l=n&&n.searchParent(e,e=>e.props&&e.props.message),c=null==l?void 0:null===(i=l.props)||void 0===i?void 0:i.message;if(!c||!o||!a)return;let u=c.roomLogin?c.roomLogin:c.channel?c.channel.slice(1):void 0;if(!u&&l.props.channelID){const e=this.parent.getRoom(l.props.channelID,null,!0);e&&e.login&&(u=c.roomLogin=e.login)}const h=o.getUser(),d={id:l.props.channelID,login:u};c.roomId=d.id,h&&(h.moderator=l.props.isCurrentUserModerator,h.staff=l.props.isCurrentUserStaff);const f=this.getUserLevel(d,h),p=this.getUserLevel(d,c.user);let g=l.props.showModerationIcons;return f<3&&(g=!1),this.renderPopup(e,(e,i)=>{const n=[];let o=null;const handle_click=e=>{i.hide(),this.handleClick(e)};for(const e of t){if(!e)continue;if("new-line"===e.type){o=null;continue}if("space-small"===e.type){o||n.push(o=[]),o.push(Object(r.createElement)("div",{class:"tw-pd-x-1"}));continue}if("space"===e.type){o||n.push(o=[]),o.push(Object(r.createElement)("div",{class:"tw-flex-grow-1"}));continue}if(!e.action||!e.appearance)continue;let t=e.appearance||{};const i=e.display||{},l=this.actions[e.action];if(!l||i.disabled||null!=i.mod_icons&&i.mod_icons!==!!g||null!=i.mod&&i.mod!==f>p||null!=i.staff&&i.staff!==(!!h&&!!h.staff)||null!=i.deleted&&i.deleted!==!!c.deleted)continue;if(l.override_appearance){const i=l.override_appearance.call(this,Object.assign({},t),e,c,d,h,g);i&&(t=i)}const u=this.renderers[t.type];if(!u)continue;const m=u.colored&&t.color,_=Object(s.maybe_call)(l.disabled,this,e,c,d,h,g)||!1,b=m&&(a&&a.colors?a.colors.process(t.color):t.color),v=u.render.call(this,t,r.createElement,b);o||n.push(o=[]);const y=Object(r.createElement)("button",{class:`ffz-tooltip ffz-tooltip--no-mouse tw-button tw-button--text${_?" tw-button--disabled disabled":""}`,disabled:_,"data-tooltip-type":"action","data-action":e.action,"data-options":e.options?JSON.stringify(e.options):null,onClick:handle_click,onContextMenu:this.handleContext},Object(r.createElement)("span",{class:"tw-button__text"},v));t.tooltip&&(y.dataset.tip=t.tooltip),o.push(y)}const l=Object(r.createElement)("div",{class:"ffz-action-data tw-pd-05","data-source":"msg"},Object(r.createElement)("div",{class:"tw-pd-b-05 tw-border-b"},Object(r.createElement)("strong",null,c.user.displayName||c.user.login),"..."),n.map(e=>e&&e.length?Object(r.createElement)("div",{class:"tw-flex tw-flex-no-wrap"},e):null));return l.ffz_message=c,l})}renderInline(e,t,i,n,r){const o=[];if(e.user&&i&&i.login===e.user.login)return;const a=this.getUserLevel(n,i),l=this.getUserLevel(n,e.user);a<3&&(t=!1);const c=this.resolve("site.chat"),u=[];let h=!1;for(const d of this.parent.context.get("chat.actions.inline")){if(!d.action||!d.appearance)continue;let f=d.appearance||{};const p=d.display||{},g=p.keys,m=this.actions[d.action];if(!m||p.disabled||null!=p.mod_icons&&p.mod_icons!==!!t||null!=p.mod&&p.mod!==a>l||null!=p.staff&&p.staff!==(!!i&&!!i.staff)||null!=p.deleted&&p.deleted!==!!e.deleted)continue;if(m.override_appearance){const s=m.override_appearance.call(this,Object.assign({},f),d,e,n,i,t);s&&(f=s)}const _=this.renderers[f.type];if(!_)continue;const b=_.colored&&f.color,v=Object(s.maybe_call)(m.disabled,this,d,e,n,i,t)||!1,y=b&&(c&&c.colors?c.colors.process(f.color):f.color),w=_.render.call(this,f,r,y);let k=o;g&&(k=u),h=!0,k.push(r("button",{class:`ffz-tooltip ffz-mod-icon mod-icon tw-c-text-alt-2${v?" disabled":""}${b?" colored":""}${g?` ffz-modifier-${g}`:""}`,disabled:v,"data-tooltip-type":"action","data-action":d.action,"data-options":d.options?JSON.stringify(d.options):null,"data-tip":f.tooltip,onClick:this.handleClick,onContextMenu:this.handleContext},w))}if(!h)return null;let d=null;if(o.length&&(d=r("div",{class:"ffz--inline-actions ffz-action-data tw-inline-block tw-mg-r-05","data-source":"line"},o)),u.length){const e=r("div",{class:"ffz--inline-actions ffz--modifier-actions ffz-action-data","data-source":"line"},u);return d?[d,e]:e}return d}getData(e){const t=e.dataset,i=e.closest(".ffz-action-data"),n=i&&i.dataset,r=t&&t.action,o=this.actions[r];if(!o)return null;let a,l,c,u=!1;if(n){if("msg"===n.source&&i.ffz_message){const e=i.ffz_message;u=!0,a=e.user?{color:e.user.color,id:e.user.id,login:e.user.login,displayName:e.user.displayName,type:e.user.type}:null,l={login:e.roomLogin,id:e.roomId},c={id:e.id,text:e.message}}else if("line"===n.source){const e=this.resolve("site.fine"),t=e&&e.searchParent(i,e=>e.props&&e.props.message);if(t&&t.props&&t.props.message){u=!0;const e=t.props.message;a=e.user?{color:e.user.color,id:e.user.id,login:e.user.login,displayName:e.user.displayName,type:e.user.type}:null,l={login:t.props.channelLogin,id:t.props.channelID},c={id:e.id,text:e.message}}}u||(a=n.user?JSON.parse(n.user):null,l=n.room?JSON.parse(n.room):null,c=n.message?JSON.parse(n.message):n.msgId?{id:n.msgId}:null)}const h={action:r,definition:o,tip:t.tip,options:t.options?JSON.parse(t.options):null,user:a,room:l,message:c,message_id:c?c.id:null};return o.defaults&&(h.options=Object.assign({},Object(s.maybe_call)(o.defaults,this,h,e),h.options)),h}handleClick(e){const t=e.target,i=this.getData(t);if(i&&!t.classList.contains("disabled"))return i.definition.click?(t._ffz_tooltip$0&&t._ffz_tooltip$0.hide(),i.definition.click.call(this,e,i)):i.definition.context?this.handleContext(e):this.log.warn(`No click handler for action provider "${i.action}"`)}handleContext(e){if(e.shiftKey)return;e.preventDefault();const t=e.target,i=this.getData(e.target);i&&(t.classList.contains("disabled")||(t._ffz_tooltip$0&&t._ffz_tooltip$0.hide(),(i.definition.context||i.definition.uses_reason)&&this.renderInlineContext(t,i)))}handleUserContext(e){if(e.shiftKey)return;const t=this.parent.context.get("chat.actions.user-context");if(!Array.isArray(t)||!t.length)return;e.preventDefault();const i=e.target;i._ffz_tooltip$0&&i._ffz_tooltip$0.hide(),this.renderUserContext(i,t)}pasteMessage(e,t){return this.resolve("site.chat.input").pasteMessage(e,t)}sendMessage(e,t){return this.resolve("site.chat").sendMessage(e,t)}}},function(e,t){var i={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"FFZ_EmoteMenu_SubStatus"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"first"}},type:{kind:"NamedType",name:{kind:"Name",value:"Int"}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"after"}},type:{kind:"NamedType",name:{kind:"Name",value:"Cursor"}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"criteria"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"SubscriptionBenefitCriteriaInput"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"currentUser"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"subscriptionBenefits"},arguments:[{kind:"Argument",name:{kind:"Name",value:"first"},value:{kind:"Variable",name:{kind:"Name",value:"first"}}},{kind:"Argument",name:{kind:"Name",value:"after"},value:{kind:"Variable",name:{kind:"Name",value:"after"}}},{kind:"Argument",name:{kind:"Name",value:"criteria"},value:{kind:"Variable",name:{kind:"Name",value:"criteria"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"pageInfo"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"hasNextPage"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"edges"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"cursor"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"node"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"gift"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"isGift"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"purchasedWithPrime"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"endsAt"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"renewsAt"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"product"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"emoteSetID"},arguments:[],directives:[]}]}}]}}]}}]}}]}}]}}],loc:{start:0,end:428}};i.loc.source={body:"query FFZ_EmoteMenu_SubStatus($first: Int, $after: Cursor, $criteria: SubscriptionBenefitCriteriaInput!) {\n\tcurrentUser {\n\t\tid\n\t\tsubscriptionBenefits(first: $first, after: $after, criteria: $criteria) {\n\t\t\tpageInfo {\n\t\t\t\thasNextPage\n\t\t\t}\n\t\t\tedges {\n\t\t\t\tcursor\n\t\t\t\tnode {\n\t\t\t\t\tid\n\t\t\t\t\tgift {\n\t\t\t\t\t\tisGift\n\t\t\t\t\t}\n\t\t\t\t\tpurchasedWithPrime\n\t\t\t\t\tendsAt\n\t\t\t\t\trenewsAt\n\t\t\t\t\tproduct {\n\t\t\t\t\t\tid\n\t\t\t\t\t\temoteSetID\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n}",name:"GraphQL request",locationOffset:{line:1,column:1}};var n={};function findOperation(e,t){for(var i=0;i<e.definitions.length;i++){var n=e.definitions[i];if(n.name&&n.name.value==t)return n}}!function extractReferences(){i.definitions.forEach((function(e){if(e.name){var t=new Set;!function collectFragmentReferences(e,t){if("FragmentSpread"===e.kind)t.add(e.name.value);else if("VariableDefinition"===e.kind){var i=e.type;"NamedType"===i.kind&&t.add(i.name.value)}e.selectionSet&&e.selectionSet.selections.forEach((function(e){collectFragmentReferences(e,t)})),e.variableDefinitions&&e.variableDefinitions.forEach((function(e){collectFragmentReferences(e,t)})),e.definitions&&e.definitions.forEach((function(e){collectFragmentReferences(e,t)}))}(e,t),n[e.name.value]=t}}))}(),e.exports=i,e.exports.FFZ_EmoteMenu_SubStatus=function oneQuery(e,t){var i={kind:e.kind,definitions:[findOperation(e,t)]};e.hasOwnProperty("loc")&&(i.loc=e.loc);var s=n[t]||new Set,r=new Set,o=new Set;for(s.forEach((function(e){o.add(e)}));o.size>0;){var a=o;o=new Set,a.forEach((function(e){r.has(e)||(r.add(e),(n[e]||new Set).forEach((function(e){o.add(e)})))}))}return r.forEach((function(t){var n=findOperation(e,t);n&&i.definitions.push(n)})),i}(i,"FFZ_EmoteMenu_SubStatus")},function(e,t){var i={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"targetID"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"disableNotifications"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"followUser"},arguments:[{kind:"Argument",name:{kind:"Name",value:"input"},value:{kind:"ObjectValue",fields:[{kind:"ObjectField",name:{kind:"Name",value:"disableNotifications"},value:{kind:"Variable",name:{kind:"Name",value:"disableNotifications"}}},{kind:"ObjectField",name:{kind:"Name",value:"targetID"},value:{kind:"Variable",name:{kind:"Name",value:"targetID"}}}]}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"follow"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"disableNotifications"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"followedAt"},arguments:[],directives:[]}]}}]}}]}}],loc:{start:0,end:230}};i.loc.source={body:"mutation($targetID: ID!, $disableNotifications: Boolean!) {\n  followUser(input: {\n    disableNotifications: $disableNotifications,\n    targetID: $targetID\n  }) {\n    follow {\n      disableNotifications\n      followedAt\n    }\n  }\n}",name:"GraphQL request",locationOffset:{line:1,column:1}};var n={};!function extractReferences(){i.definitions.forEach((function(e){if(e.name){var t=new Set;!function collectFragmentReferences(e,t){if("FragmentSpread"===e.kind)t.add(e.name.value);else if("VariableDefinition"===e.kind){var i=e.type;"NamedType"===i.kind&&t.add(i.name.value)}e.selectionSet&&e.selectionSet.selections.forEach((function(e){collectFragmentReferences(e,t)})),e.variableDefinitions&&e.variableDefinitions.forEach((function(e){collectFragmentReferences(e,t)})),e.definitions&&e.definitions.forEach((function(e){collectFragmentReferences(e,t)}))}(e,t),n[e.name.value]=t}}))}(),e.exports=i},function(e,t){var i={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"FFZ_GetEmoteInfo"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"id"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"emote"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"id"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"owner"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"login"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"displayName"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"setID"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"text"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"subscriptionProduct"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"state"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"owner"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"login"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"displayName"},arguments:[],directives:[]}]}}]}}]}}]}}],loc:{start:0,end:213}};i.loc.source={body:"query FFZ_GetEmoteInfo($id: ID!) {\n\temote(id: $id) {\n\t\tid\n\t\towner {\n\t\t\tid\n\t\t\tlogin\n\t\t\tdisplayName\n\t\t}\n\t\tsetID\n\t\ttext\n\t\tsubscriptionProduct {\n\t\t\tid\n\t\t\tstate\n\t\t\towner {\n\t\t\t\tid\n\t\t\t\tlogin\n\t\t\t\tdisplayName\n\t\t\t}\n\t\t}\n\t}\n}",name:"GraphQL request",locationOffset:{line:1,column:1}};var n={};function findOperation(e,t){for(var i=0;i<e.definitions.length;i++){var n=e.definitions[i];if(n.name&&n.name.value==t)return n}}!function extractReferences(){i.definitions.forEach((function(e){if(e.name){var t=new Set;!function collectFragmentReferences(e,t){if("FragmentSpread"===e.kind)t.add(e.name.value);else if("VariableDefinition"===e.kind){var i=e.type;"NamedType"===i.kind&&t.add(i.name.value)}e.selectionSet&&e.selectionSet.selections.forEach((function(e){collectFragmentReferences(e,t)})),e.variableDefinitions&&e.variableDefinitions.forEach((function(e){collectFragmentReferences(e,t)})),e.definitions&&e.definitions.forEach((function(e){collectFragmentReferences(e,t)}))}(e,t),n[e.name.value]=t}}))}(),e.exports=i,e.exports.FFZ_GetEmoteInfo=function oneQuery(e,t){var i={kind:e.kind,definitions:[findOperation(e,t)]};e.hasOwnProperty("loc")&&(i.loc=e.loc);var s=n[t]||new Set,r=new Set,o=new Set;for(s.forEach((function(e){o.add(e)}));o.size>0;){var a=o;o=new Set,a.forEach((function(e){r.has(e)||(r.add(e),(n[e]||new Set).forEach((function(e){o.add(e)})))}))}return r.forEach((function(t){var n=findOperation(e,t);n&&i.definitions.push(n)})),i}(i,"FFZ_GetEmoteInfo")},function(e,t,i){"use strict";var n=i(0);t.a={data:()=>({value:void 0,has_value:!1,profile:null,_unseen:!1,source:null,source_value:void 0}),created(){const e=this.context.context,t=this.item.setting;e._add_user(),this._update_profile(),this._uses_changed(e.uses(t)),this.item.unseen&&(this._unseen=!0,this.item.unseen=0),e.on(`uses_changed:${t}`,this._uses_changed,this)},destroyed(){const e=this.context.context,t=this.item.setting;this.profile&&this.profile.off("changed",this._setting_changed,this),this.source&&this.source.off("changed",this._source_setting_changed,this),e.off(`uses_changed:${t}`,this._uses_changed,this),this.value=void 0,this.has_value=!1,this.profile=null,this.source_value=void 0,this.source=null,e._remove_user()},watch:{"context.currentProfile"(){this._update_profile()}},computed:{data(){const e=this.item.data;return"function"==typeof e?e(this.profile,this.value):e},unseen(){return this._unseen||this.item.unseen>0},default_value(){return"function"==typeof this.item.default?this.item.default(this.context.context):Object(n.deep_copy)(this.item.default)},isInherited(){return!this.has_value&&this.source&&this.sourceOrder>this.profileOrder},isDefault(){return!this.has_value&&!this.source},isOverridden(){return this.source&&this.sourceOrder<this.profileOrder},sourceOrder(){return this.source?this.source.order:1/0},profileOrder(){return this.profile?this.profile.order:1/0},sourceTitle(){if(this.source)return this.source.i18n_key?this.t(this.source.i18n_key,this.source.title,this.source):this.source.title},sourceDisplay(){const e={title:this.sourceTitle};return this.isInherited?this.t("setting.inherited-from","Inherited From: {title}",e):this.isOverridden?this.t("setting.overridden-by","Overridden By: {title}",e):void 0}},methods:{_update_profile(){this.profile&&this.profile.off("changed",this._setting_changed,this);const e=this.profile=this.context.currentProfile,t=this.item.setting;e.on("changed",this._setting_changed,this),this.has_value=e.has(t),this.value=this.has_value?Object(n.deep_copy)(e.get(t)):this.isInherited?this.source_value:this.default_value},_setting_changed(e,t,i){e===this.item.setting&&(this.has_value=!0!==i,this.value=this.has_value?Object(n.deep_copy)(t):this.isInherited?this.source_value:this.default_value)},_source_setting_changed(e,t,i){e===this.item.setting&&(this.source_value=Object(n.deep_copy)(t),this.isInherited&&(this.value=i?this.default_value:t))},_uses_changed(e){this.source&&this.source.off("changed",this._source_setting_changed,this),e=e?e[0]:null;const t=this.source=this.context.profile_keys[e],i=this.item.setting;t?(t.on("changed",this._source_setting_changed,this),this.source_value=Object(n.deep_copy)(t.get(i))):this.source_value=void 0,this.has_value||(this.value=this.isInherited?this.source_value:this.default_value)},set(e){this.item.process&&(e=this.item.process(e)),this.profile.set(this.item.setting,e),this.item.onUIChange&&this.item.onUIChange(e)},clear(){this.profile.delete(this.item.setting),this.item.onUIChange&&this.item.onUIChange(this.value)}}}},function(e,t,i){"use strict";i.d(t,"a",(function(){return AddonManager}));var n=i(3),s=i(2),r=i(1),o=i(0),a=i(6);const fetchJSON=(e,t)=>fetch(e,t).then(e=>e.ok?e.json():null).catch(()=>null);class AddonManager extends n.default{constructor(...e){super(...e),this.should_enable=!0,this.inject("settings"),this.inject("i18n"),this.has_dev=!1,this.reload_required=!1,this.addons={},this.enabled_addons=[]}async onEnable(){this.settings.addUI("add-ons",{path:'Add-Ons @{"description": "Add-Ons are additional modules, often written by other people, that can be loaded automatically by FrankerFaceZ to add new capabilities and behaviors to the extension and Twitch.", "profile_warning": false}',component:"addon-list",title:"Add-Ons",no_filter:!0,getExtraSearch:()=>Object.values(this.addons).map(e=>e.search_terms),isReady:()=>this.enabled,getAddons:()=>Object.values(this.addons),hasAddon:e=>this.hasAddon(e),getVersion:e=>this.getVersion(e),isAddonEnabled:e=>this.isAddonEnabled(e),isAddonExternal:e=>this.isAddonExternal(e),enableAddon:e=>this.enableAddon(e),disableAddon:e=>this.disableAddon(e),isReloadRequired:()=>this.reload_required,refresh:()=>window.location.reload(),on:(...e)=>this.on(...e),off:(...e)=>this.off(...e)}),this.settings.add("addons.dev.server",{default:!1,ui:{path:"Add-Ons >> Development",title:"Use Local Development Server",description:"Attempt to load add-ons from local development server on port 8001.",component:"setting-check-box"}}),this.on("i18n:update",this.rebuildAddonSearch,this),this.settings.provider.on("changed",this.onProviderChange,this),await this.loadAddonData(),this.enabled_addons=this.settings.provider.get("addons.enabled",[]);for(const e of this.enabled_addons)this.hasAddon(e)&&this._enableAddon(e);this.emit(":ready")}generateLog(){const e=["Known"];for(const[t,i]of Object.entries(this.addons))e.push(`${t} | ${this.isAddonEnabled(t)?"enabled":"disabled"} | ${i.dev?"dev | ":""}${this.isAddonExternal(t)?"external | ":""}${i.short_name} v${i.version}`);e.push(""),e.push("Modules");for(const[t,i]of Object.entries(this.__modules))i&&e.push(`${i.loaded?"loaded  ":i.loading?"loading ":"unloaded"} | ${i.enabled?"enabled ":i.enabling?"enabling":"disabled"} | ${t}`);return e.join("\n")}onProviderChange(e,t){if("addons.enabled"!=e)return;t||(t=[]);const i=[...this.enabled_addons];for(const e of i)t.includes(e)||this.disableAddon(e,!1);for(const e of t)i.includes(e)||this.enableAddon(e,!1)}async loadAddonData(){const[e,t]=await Promise.all([fetchJSON(`${s.SERVER}/script/addons.json?_=${Object(a.getBuster)(30)}`),this.settings.get("addons.dev.server")?fetchJSON(`https://localhost:8001/script/addons.json?_=${Object(a.getBuster)()}`):null]);if(Array.isArray(e))for(const t of e)this.addAddon(t,!1);if(Array.isArray(t)){this.has_dev=!0;for(const e of t)this.addAddon(e,!0)}this.rebuildAddonSearch(),this.emit(":data-loaded")}addAddon(e,t=!1){const i=this.addons[e.id];this.addons[e.id]=e,e.dev=t,e.requires=e.requires||[],e.required_by=Array.isArray(i)?i:i&&i.required_by||[],e._search=e.search_terms;for(const t of e.requires){const i=this.addons[t];Array.isArray(i)?i.push(e.id):i?i.required_by.push(e.id):this.addons[t]=[e.id]}this.emit(":added")}rebuildAddonSearch(){for(const e of Object.values(this.addons)){const t=new Set([e._search,e.name,e.short_name,e.author,e.description]);"en"!==this.i18n.locale&&(e.name_i18n&&t.add(this.i18n.t(e.name_i18n,e.name)),e.short_name_i18n&&t.add(this.i18n.t(e.short_name_i18n,e.short_name)),e.author_i18n&&t.add(this.i18n.t(e.author_i18n,e.author)),e.description_i18n&&t.add(this.i18n.t(e.description_i18n,e.description))),e.search_terms=[...t].map(e=>e?e.toLocaleLowerCase():"").join("\n")}}isAddonEnabled(e){return!!this.isAddonExternal(e)||this.enabled_addons.includes(e)}getAddon(e){const t=this.addons[e];return Array.isArray(t)?null:t}hasAddon(e){return null!=this.getAddon(e)}getVersion(e){const t=this.getAddon(e);if(!t)throw new Error(`Unknown add-on id: ${e}`);const i=this.resolve(`addon.${e}`);if(i){if(Object(o.has)(i,"version"))return i.version;if(i.constructor&&Object(o.has)(i.constructor,"version"))return i.constructor.version}return t.version}isAddonExternal(e){if(!this.hasAddon(e))throw new Error(`Unknown add-on id: ${e}`);const t=this.resolve(`addon.${e}`);return!!t&&(!document.head.querySelector(`script#ffz-loaded-addon-${e}`)||(t.external||t.constructor&&t.constructor.external))}async _enableAddon(e){if(!this.getAddon(e))throw new Error(`Unknown add-on id: ${e}`);await this.loadAddon(e);const t=this.resolve(`addon.${e}`);t&&!t.enabled&&await t.enable()}async loadAddon(e){const t=this.getAddon(e);if(!t)throw new Error(`Unknown add-on id: ${e}`);let i=this.resolve(`addon.${e}`);if(i)return i.loaded||await i.load(),void this.emit(":addon-loaded",e);document.head.appendChild(Object(r.createElement)("script",{id:`ffz-loaded-addon-${t.id}`,type:"text/javascript",src:t.src||`${t.dev?"https://localhost:8001":s.SERVER}/script/addons/${t.id}/script.js?_=${Object(a.getBuster)(30)}`,crossorigin:"anonymous"})),await Object(o.timeout)(this.waitFor(`addon.${e}:registered`),5e3),i=this.resolve(`addon.${e}`),i&&!i.loaded&&await i.load(),this.emit(":addon-loaded",e)}unloadAddon(e){const t=this.resolve(`addon.${e}`);if(t)return t.unload()}enableAddon(e,t=!0){const i=this.getAddon(e);if(!i)throw new Error(`Unknown add-on id: ${e}`);if(!this.isAddonEnabled(e)){if(Array.isArray(i.requires))for(const e of i.requires){if(!this.hasAddon(e))throw new Error(`Unknown add-on id: ${e}`);this.enableAddon(e)}this.emit(":addon-enabled",e),this.enabled_addons.push(e),t&&this.settings.provider.set("addons.enabled",this.enabled_addons),this._enableAddon(e)}}async disableAddon(e,t=!0){const i=this.getAddon(e);if(!i)throw new Error(`Unknown add-on id: ${e}`);if(this.isAddonExternal(e))throw new Error(`Cannot disable external add-on with id: ${e}`);if(this.isAddonEnabled(e)){if(Array.isArray(i.required_by)){const e=[];for(const t of i.required_by)e.push(this.disableAddon(t));await Promise.all(e)}this.emit(":addon-disabled",e),this.enabled_addons.splice(this.enabled_addons.indexOf(e),1),t&&this.settings.provider.set("addons.enabled",this.enabled_addons);try{const t=this.resolve(`addon.${e}`);t&&await t.disable()}catch(e){this.reload_required=!0,this.emit(":reload-required")}}}}},function(e,t,i){"use strict";i.d(t,"a",(function(){return ExperimentManager}));var n=i(2),s=i(3),r=i(0),o=i(6),a=i(17),l=i.n(a),c=i(99),u=i.n(c),h=i(100),d=i.n(h);const f="experiment_overrides",p={expires:7,domain:".twitch.tv"};class ExperimentManager extends s.default{constructor(...e){super(...e),this.inject("settings"),this.settings.addUI("experiments",{path:"Debugging > Experiments",component:"experiments",unique_id:()=>this.unique_id,ffz_data:()=>Object(r.deep_copy)(this.experiments),twitch_data:()=>Object(r.deep_copy)(this.getTwitchExperiments()),usingTwitchExperiment:e=>this.usingTwitchExperiment(e),getTwitchAssignment:e=>this.getTwitchAssignment(e),hasTwitchOverride:e=>this.hasTwitchOverride(e),setTwitchOverride:(e,t)=>this.setTwitchOverride(e,t),deleteTwitchOverride:e=>this.deleteTwitchOverride(e),getAssignment:e=>this.getAssignment(e),hasOverride:e=>this.hasOverride(e),setOverride:(e,t)=>this.setOverride(e,t),deleteOverride:e=>this.deleteOverride(e),on:(...e)=>this.on(...e),off:(...e)=>this.off(...e)}),this.unique_id=l.a.get("unique_id"),this.Cookie=l.a,this.experiments={},this.cache=new Map}async onLoad(){await this.loadExperiments()}async loadExperiments(){let e;try{e=await fetch(n.DEBUG?d.a:`${n.SERVER}/script/experiments.json?_=${Object(o.getBuster)()}`).then(e=>e.ok?e.json():null)}catch(e){this.log.warn("Unable to load experiment data.",e)}if(!e)return;this.experiments=e;const t=this.cache;this.cache=new Map;let i=0;for(const[e,n]of t.entries()){const t=this.getAssignment(e);n!==t&&(i++,this.emit(":changed",e,t),this.emit(`:changed:${e}`,t))}this.log.info(`Loaded information on ${Object.keys(e).length} experiments.${i>0?` ${i} values updated.`:""}`)}onEnable(){this.on("socket:command:reload_experiments",this.loadExperiments,this),this.on("socket:command:update_experiment",this.updateExperiment,this)}updateExperiment(e,t){this.log.info(`Received updated data for experiment "${e}" via WebSocket.`,t),t.groups?this.experiments[e]=t:this.experiments[e].groups=t,this._rebuildKey(e)}generateLog(){const e=[`Unique ID: ${this.unique_id}`,""];for(const[t,i]of Object.entries(this.experiments))e.push(`FFZ | ${i.name}: ${this.getAssignment(t)}${this.hasOverride(t)?" (Overriden)":""}`);for(const[t,i]of Object.entries(this.getTwitchExperiments()))this.usingTwitchExperiment(t)&&e.push(`TWITCH | ${i.name}: ${this.getTwitchAssignment(t)}${this.hasTwitchOverride(t)?" (Overriden)":""}`);return e.join("\n")}getTwitchExperiments(){var e;if(window.__twilightSettings)return window.__twilightSettings.experiments;const t=null===(e=this.resolve("site"))||void 0===e?void 0:e.getCore();return t&&t.experiments.experiments}usingTwitchExperiment(e){var t;const i=null===(t=this.resolve("site"))||void 0===t?void 0:t.getCore();return i&&Object(r.has)(i.experiments.assignments,e)}setTwitchOverride(e,t=null){var i;const n=l.a.getJSON(f)||{};n[e]=t,l.a.set(f,n,p);const s=null===(i=this.resolve("site"))||void 0===i?void 0:i.getCore();s&&(s.experiments.overrides[e]=t),this._rebuildTwitchKey(e,!0,t)}deleteTwitchOverride(e){var t;const i=l.a.getJSON(f);if(!i||!Object(r.has)(i,e))return;const n=i[e];delete i[e],l.a.set(f,i,p);const s=null===(t=this.resolve("site"))||void 0===t?void 0:t.getCore();s&&delete s.experiments.overrides[e],this._rebuildTwitchKey(e,!1,n)}hasTwitchOverride(e){const t=l.a.getJSON(f);return t&&Object(r.has)(t,e)}getTwitchAssignment(e){var t;const i=null===(t=this.resolve("site"))||void 0===t?void 0:t.getCore(),n=i&&i.experiments;if(!n)return null;if(!n.hasInitialized&&n.initialize)try{n.initialize()}catch(e){this.log.warn("Error attempting to initialize Twitch experiments tracker.",e)}return n.overrides&&n.overrides[e]?n.overrides[e]:n.assignments&&n.assignments[e]?n.assignments[e]:null}getTwitchKeyFromName(e){const t=this.getTwitchExperiments();if(t){e=e.toLowerCase();for(const i in t)if(Object(r.has)(t,i)){const n=t[i];if(n&&n.name&&n.name.toLowerCase()===e)return i}}}getTwitchAssignmentByName(e){return this.getTwitchAssignment(this.getTwitchKeyFromName(e))}_rebuildTwitchKey(e,t,i){var n;const s=(null===(n=this.resolve("site"))||void 0===n?void 0:n.getCore()).experiments,o=Object(r.has)(s.assignments,e)?s.assignments[e]:void 0;if(o!==i){const n=t?i:o;this.emit(":twitch-changed",e,n),this.emit(`:twitch-changed:${e}`,n)}}setOverride(e,t=null){const i=this.settings.provider.get("experiment-overrides")||{};i[e]=t,this.settings.provider.set("experiment-overrides",i),this._rebuildKey(e)}deleteOverride(e){const t=this.settings.provider.get("experiment-overrides");t&&Object(r.has)(t,e)&&(delete t[e],this.settings.provider.set("experiment-overrides",t),this._rebuildKey(e))}hasOverride(e){const t=this.settings.provider.get("experiment-overrides");return t&&Object(r.has)(t,e)}getAssignment(e){if(this.cache.has(e))return this.cache.get(e);const t=this.experiments[e];if(!t)return this.log.warn(`Tried to get assignment for experiment "${e}" which is not known.`),null;const i=this.settings.provider.get("experiment-overrides"),n=i&&Object(r.has)(i,e)?i[e]:ExperimentManager.selectGroup(e,t,this.unique_id);return this.cache.set(e,n),n}_rebuildKey(e){if(!this.cache.has(e))return;const t=this.cache.get(e);this.cache.delete(e);const i=this.getAssignment(e);i!==t&&(this.emit(":changed",e,i),this.emit(`:changed:${e}`,i))}static selectGroup(e,t,i){const n=e+i+(t.seed||""),s=t.groups.reduce((e,t)=>e+t.weight,0);let r=(u()(n).words[0]>>>0)/Math.pow(2,32);for(const e of t.groups)if(r-=e.weight/s,r<=0)return e.value;return null}}},function(e,t,i){var n,s,r,o,a,l,c,u;e.exports=(u=i(143),s=(n=u).lib,r=s.WordArray,o=s.Hasher,a=n.algo,l=[],c=a.SHA1=o.extend({_doReset:function(){this._hash=new r.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(e,t){for(var i=this._hash.words,n=i[0],s=i[1],r=i[2],o=i[3],a=i[4],c=0;c<80;c++){if(c<16)l[c]=0|e[t+c];else{var u=l[c-3]^l[c-8]^l[c-14]^l[c-16];l[c]=u<<1|u>>>31}var h=(n<<5|n>>>27)+a+l[c];h+=c<20?1518500249+(s&r|~s&o):c<40?1859775393+(s^r^o):c<60?(s&r|s&o|r&o)-1894007588:(s^r^o)-899497514,a=o,o=r,r=s<<30|s>>>2,s=n,n=h}i[0]=i[0]+n|0,i[1]=i[1]+s|0,i[2]=i[2]+r|0,i[3]=i[3]+o|0,i[4]=i[4]+a|0},_doFinalize:function(){var e=this._data,t=e.words,i=8*this._nDataBytes,n=8*e.sigBytes;return t[n>>>5]|=128<<24-n%32,t[14+(n+64>>>9<<4)]=Math.floor(i/4294967296),t[15+(n+64>>>9<<4)]=i,e.sigBytes=4*t.length,this._process(),this._hash},clone:function(){var e=o.clone.call(this);return e._hash=this._hash.clone(),e}}),n.SHA1=o._createHelper(c),n.HmacSHA1=o._createHmacHelper(c),u.SHA1)},function(e,t,i){e.exports=i.p+"experiments.abc9912ff13e4f3bfd52df6b3890ed12.json"},function(e,t,i){e.exports=function(){"use strict";return function(e,t,i){var n=t.prototype;i.en.relativeTime={future:"in %s",past:"%s ago",s:"a few seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"};var o=function(e,t,n,s){for(var r,o,a=n.$locale().relativeTime,l=[{l:"s",r:44,d:"second"},{l:"m",r:89},{l:"mm",r:44,d:"minute"},{l:"h",r:89},{l:"hh",r:21,d:"hour"},{l:"d",r:35},{l:"dd",r:25,d:"day"},{l:"M",r:45},{l:"MM",r:10,d:"month"},{l:"y",r:17},{l:"yy",d:"year"}],c=l.length,u=0;u<c;u+=1){var h=l[u];h.d&&(r=s?i(e).diff(n,h.d,!0):n.diff(e,h.d,!0));var d=Math.round(Math.abs(r));if(d<=h.r||!h.r){1===d&&u>0&&(h=l[u-1]),o=a[h.l].replace("%d",d);break}}return t?o:(r>0?a.future:a.past).replace("%s",o)};n.to=function(e,t){return o(e,t,this,!0)},n.from=function(e,t){return o(e,t,this)};var d=function(e){return e.$u?i.utc():i()};n.toNow=function(e){return this.to(d(this),e)},n.fromNow=function(e){return this.from(d(this),e)}}}()},function(e,t,i){"use strict";i.d(t,"a",(function(){return SocketClient}));var n=i(3),s=i(2);const r={DISCONNECTED:0,CONNECTING:1,CONNECTED:2},o="683b45e4-f853-4c45-bf96-7d799cc93e34";class SocketClient extends n.default{constructor(...e){super(...e),this.inject("settings"),this.settings.add("socket.use-cluster",{default:"Production",ui:{path:'Debugging @{"expanded": false, "sort": 9999} > Socket >> General',title:"Server Cluster",description:"Which server cluster to connect to. Do not change this unless you are actually doing development work on the socket server backend. Doing so will break all features relying on the socket server, including emote information lookups, link tooltips, and live data updates.",component:"setting-select-box",data:[{value:null,title:"Disabled"}].concat(Object.keys(s.WS_CLUSTERS).map(e=>({value:e,title:e})))}}),this._want_connected=!1,this._topics=new Map,this._pending=[],this._awaiting=new Map,this._socket=null,this._state=0,this._last_id=1,this._delay=0,this._last_ping=null,this._time_drift=0,this._host_idx=-1,this._host_pool=-1,this.settings.on(":changed:socket.use-cluster",()=>{this._host=null,this.disconnected?this.connect():this.reconnect()}),this.on(":command:reconnect",this.reconnect,this),this.on(":command:do_authorize",e=>{const t=this.resolve("site.chat"),i=t&&t.ChatService.first,n=i.client&&i.client.connection;n&&n.send&&n.send(`PRIVMSG #frankerfacezauthorizer :AUTH ${e}`)}),this.enable()}onEnable(){this.connect()}onDisable(){this.disconnect()}get connected(){return this._state===r.CONNECTED}get connecting(){return this._state===r.CONNECTING}get disconnected(){return this._state===r.DISCONNECTED}getAPIToken(){return this._cached_token&&this._cached_token.expires>Date.now()+15e3?Promise.resolve(this._cached_token):this._token_waiters?new Promise((e,t)=>this._token_waiters.push([e,t])):(this._token_waiters=[],new Promise((e,t)=>{this._token_waiters.push([e,t]),this.call("get_api_token").then(e=>{e.expires=new Date(e.expires).getTime(),this._cached_token=e;const t=this._token_waiters;this._token_waiters=null;for(const i of t)i[0](e)}).catch(e=>{this.log.error("Unable to get API token.",e);const t=this._token_waiters;this._token_waiters=null;for(const i of t)i[1](e)})}))}async getBareAPIToken(){var e;return null===(e=await this.getAPIToken())||void 0===e?void 0:e.token}selectHost(){const e=this.settings.get("socket.use-cluster"),t=s.WS_CLUSTERS[e],i=t&&t.length;if(!i)return null;let n=0,r=i;for(;r-- >0;)n+=t[r][1];let o=Math.random()*n;for(let e=0;e<i;e++)if(o-=t[e][1],o<=0)return t[e][0];return t[i-1][0]}_reconnect(){this._reconnect_timer||(this._delay<6e4?this._delay+=1e3*(Math.floor(15*Math.random())+5):this._delay=1e3*(Math.floor(60*Math.random())+30),this._reconnect_timer=setTimeout(()=>{this.connect()},this._delay))}reconnect(){this.disconnect(),this._reconnect()}connect(){if(this._want_connected=!0,this._reconnect_timer&&(clearTimeout(this._reconnect_timer),this._reconnect_timer=null),!this.disconnected)return;const e=this._host=this._host||this.selectHost();if(!e)return;let t;this._state=r.CONNECTING,this._last_id=1,this._delay=0,this._last_ping=null,this.log.info(`Using Server: ${e}`);try{t=this._socket=new WebSocket(e)}catch(e){return this._state=r.DISCONNECTED,this._reconnect(),void this.log.error("Unable to create WebSocket.",e)}t.onopen=()=>{if(this._socket!==t)return this.log.warn("A socket connected that is not our primary socket."),t.close();this._state=r.CONNECTED,this._sent_user=!1,this.log.info("Connected."),this._ping_time=performance.now(),this._send("hello",[`ffz_${window.FrankerFaceZ.version_info}`,o],(e,t)=>{if(!e)return this.log.warn("Error Saying Hello",t);this._on_pong(!1,e,t[1])});const e=this.resolve("site"),send_user=()=>{if(this._sent_user||!this.connected)return;const t=e.getUser();t&&t.login?(this._sent_user=!0,this._send("setuser",t.login)):e.enabled||this.once("site:enabled",send_user,this)};send_user();for(const e of this._topics.keys())this._send("sub",e);for(const[e,t,i]of this._pending)this._send(e,t,i);this._pending=[],this._send("ready",this._offline_time||0),this._offline_time=null,this.emit(":connected")},t.onerror=()=>{t===this._socket&&(this._offline_time||(this._offline_time=Date.now()))},t.onclose=e=>{if(t!==this._socket)return;const i=this._state;this.log.info(`Disconnected. (${e.code}:${e.reason})`),this._state=r.DISCONNECTED;for(const[e,t]of this._awaiting){const i=new Error("disconnected");try{"function"==typeof t?t(!1,i):t[1](i)}catch(t){this.log.warn(`Callback Error #${e}`,t)}}this._awaiting.clear(),this._want_connected&&(this._offline_time||(this._offline_time=Date.now()),i!==r.CONNECTED&&(this._host=null),this._reconnect(),this.emit(":closed",e.code,e.reason))},t.onmessage=e=>{if(t!==this._socket)return;const i=e.data,n=i.indexOf(" ");if(-1===n)return this.log.warn("Malformed message from server.",e.data);const r=parseInt(i.slice(0,n),10),o=i.indexOf(" ",n+1),a=i.slice(n+1,-1===o?i.length:o),l=-1===o?void 0:JSON.parse(i.slice(o+1));if(-1===r)this.log.debug(`Received Command: ${a}`,l),this.emit(`:command:${a}`,l);else{const e="ok"===a,t=this._awaiting.get(r);t?(this._awaiting.delete(r),"function"==typeof t?t(e,l):t[e?0:1](l)):e&&!s.DEBUG||this.log.info(`Received Reply #${r}:`,e?"OK":"Error",l)}}}disconnect(){if(this._want_connected=!1,this._reconnect_timer&&(clearTimeout(this._reconnect_timer),this._reconnect_timer=null),!this.disconnected){try{this._socket.close()}catch(e){}this._socket=null,this._state=r.DISCONNECTED}}_on_pong(e,t,i){const n=performance.now();if(t){if(this._ping_time){const t=Date.now(),s=n-this._ping_time,r=this._last_ping=s/2;this._ping_time=null;const o=this._time_drift=t-(i+r);e||(this.log.info("Server Time:",new Date(i).toISOString()),this.log.info(" Local Time:",new Date(t).toISOString()),this.log.info(`  Est. Ping: ${r.toFixed(5)}ms`),this.log.info(`Time Offset: ${o/1e3}`),Math.abs(o)>3e5&&this.log.warn("Local time differs from server time by more than 5 minutes."))}}else this._ping_time=null,e||this.log.warn("Error Pinging Server",i)}ping(e){!this._ping_time&&this.connected&&(this._ping_time=performance.now(),this._send("ping",void 0,(t,i)=>this._on_pong(e,t,i)))}_send(e,t,i){if(!this.connected)return this.log.warn(`Tried sending command "${e}" while disconnected.`);const n=this._last_id++;i&&this._awaiting.set(n,i),this._socket.send(`${n} ${e}${void 0!==t?` ${JSON.stringify(t)}`:""}`)}send(e,...t){1===t.length&&(t=t[0]),this.connected?this._send(e,t):this._pending.push([e,t])}call(e,...t){return 1===t.length&&(t=t[0]),new Promise((i,n)=>{this.connected?this._send(e,t,[i,n]):this._pending.push([e,t,[i,n]])})}subscribe(e,...t){const i=this._topics;for(const n of t){i.has(n)||(this.connected&&this._send("sub",n),i.set(n,new Set)),i.get(n).add(e)}}unsubscribe(e,...t){const i=this._topics;for(const n of t){if(!i.has(n))continue;const t=i.get(n);t.delete(e),t.size||(i.delete(n),this.connected&&this._send("unsub",n))}}get topics(){return Array.from(this._topics.keys())}}SocketClient.State=r},function(e,t,i){"use strict";i.d(t,"a",(function(){return BaseSite}));var n=i(3);let s=0,r=0;class BaseSite extends n.default{constructor(...e){super(...e),this._id=`_ffz$${s++}`,this.inject("settings"),this.log.info(`Using: ${this.constructor.name}`)}populateModules(){const e=i(145),t=this.populate(e,this.log);this.log.info(`Loaded descriptions of ${Object.keys(t).length} modules.`)}awaitElement(e,t,i=6e4){t||(t=document.documentElement);const n=t.querySelector(e);return n?Promise.resolve(n):new Promise((n,s)=>{const o=`${this._id}$observer`,a=t[o],l=r++,c=i&&setTimeout(()=>{const e=t[o];if(!e)return;const[i,n]=e;for(let e=0;e<n.length;e++){const t=n[e];if(t[0]===l){n.splice(e,1),t[3]("Timed out");break}}n.length||(i.disconnect(),t[o]=null)},i);if(a)return void a[1].push([l,e,n,s,c]);const u=new MutationObserver(()=>{const e=t[o];if(!e)return void u.disconnect();const i=e[1];for(let e=0;e<i.length;e++){const n=i[e],s=t.querySelector(n[1]);s&&(i.splice(e,1),e--,n[4]&&clearTimeout(n[4]),n[2](s))}i.length||(u.disconnect(),t[o]=null)});t[o]=[u,[[l,e,n,s,c]]],u.observe(t,{childList:!0,attributes:!0,characterData:!0,subtree:!0})})}}},function(e,t,i){"use strict";i.d(t,"a",(function(){return Scroller}));var n=i(4),s=i(3);const r=["touchmove","scroll","wheel","mousewheel","DOMMouseScroll"];let o=0;class Scroller extends s.default{constructor(...e){super(...e),this.inject("settings"),this.inject("i18n"),this.inject("chat"),this.inject("site.fine"),this.inject("site.web_munch"),this.ChatScroller=this.fine.define("chat-scroller",e=>e.saveScrollRef&&e.handleScrollEvent&&!e.renderLines&&e.resume,n.a.CHAT_ROUTES),this.settings.add("chat.scroller.freeze",{default:0,ui:{path:"Chat > Behavior >> Scrolling",title:"Pause Chat Scrolling",description:"Automatically stop chat from scrolling when moving the mouse over it or holding a key.",component:"setting-select-box",data:[{value:0,title:"Disabled"},{value:1,title:"On Hover"},{value:2,title:"When Ctrl is Held"},{value:3,title:"When Meta is Held"},{value:4,title:"When Alt is Held"},{value:5,title:"When Shift is Held"},{value:6,title:"Ctrl or Hover"},{value:7,title:"Meta or Hover"},{value:8,title:"Alt or Hover"},{value:9,title:"Shift or Hover"}]}}),this.settings.add("chat.scroller.freeze-requires-hover",{default:!0,ui:{path:"Chat > Behavior >> Scrolling",title:"Require the mouse to be over chat to freeze with a hotkey.",component:"setting-check-box"}}),this.settings.add("chat.scroller.hover-delay",{default:750,ui:{path:"Chat > Behavior >> Scrolling",title:"Hover Timeout",description:"Chat will only remain frozen due to mouse hovering for this long after the mouse stops moving.",component:"setting-combo-box",data:[{value:250,title:"0.25 Seconds"},{value:500,title:"0.50 Seconds"},{value:750,title:"0.75 Seconds"},{value:1e3,title:"1 Second"},{value:2500,title:"2.5 Seconds"},{value:5e3,title:"5 Seconds"}]}}),this.settings.add("chat.scroller.smooth-scroll",{default:0,ui:{path:"Chat > Behavior >> Scrolling",title:"Smooth Scrolling",description:"**Note:** This setting has been disabled until such time as someone is able to fix major bugs with it.\n\nSmoothly slide new chat messages into view. Speed will increase as necessary to keep up with chat.",component:"setting-select-box",data:[{value:0,title:"Disabled"},{value:1,title:"Slow"},{value:2,title:"Medium"},{value:3,title:"Fast"},{value:4,title:"Very Fast"}]}})}updateUseKeys(){const e=this.use_keys;this.use_keys=!1;for(const e of this.chat.context.get("chat.actions.inline"))if(e&&e.display&&e.display.keys){this.use_keys=!0;break}if(this.use_keys!==e)for(const e of this.ChatScroller.instances)e&&e.ffzUpdateKeys&&e.ffzUpdateKeys()}async onEnable(){this.on("i18n:update",()=>this.ChatScroller.forceUpdate()),this.chat.context.on("changed:chat.actions.inline",this.updateUseKeys,this),this.updateUseKeys(),this.pause_hover=this.chat.context.get("chat.scroller.freeze-requires-hover"),this.chat.context.on("changed:chat.scroller.freeze-requires-hover",e=>{this.pause_hover=e;for(const e of this.ChatScroller.instances)e.ffzMaybeUnpause()}),this.pause_delay=this.chat.context.get("chat.scroller.hover-delay"),this.chat.context.on("changed:chat.scroller.hover-delay",e=>{this.pause_delay=e;for(const e of this.ChatScroller.instances)e.ffzMaybeUnpause()}),this.pause=this.chat.context.get("chat.scroller.freeze"),this.chat.context.on("changed:chat.scroller.freeze",e=>{this.pause=e;for(const e of this.ChatScroller.instances)e.ffzMaybeUnpause()}),this.smooth_scroll=0,this.chat.context.on("changed:chat.scroller.smooth-scroll",e=>{this.smooth_scroll=0;for(const e of this.ChatScroller.instances)e.ffzSetSmoothScroll(0)});const e=this,t=await this.web_munch.findModule("react"),i=t&&t.createElement;if(!i)return e.log.warn("Unable to get React.");this.ChatScroller.ready((t,n)=>{const s=t.prototype.componentDidCatch,a=t.prototype.getSnapshotBeforeUpdate,l=t.prototype.render;a&&(t.prototype.getSnapshotBeforeUpdate=function(){const e=a.call(this);return this._ffz_snapshot=e||this.lastLine&&{lastLine:this.lastLine,offsetTop:this.lastLine.offsetTop}||null,e}),t.prototype.componentDidCatch=function(t,i){const n=this.state.ffz_errors||0;if(n<100&&(this.setState({ffz_errors:n+1,ffz_total_errors:(this.state.ffz_total_errors||0)+1}),e.log.capture(t,{extra:i}),e.log.info("Error within Chat",t,i,n)),s)return s.call(this,t,i)},t.prototype.ffzZeroErrors=function(){this.setState({ffz_errors:0})},t.prototype.render=function(){if(this.state.ffz_errors>0){let e;const t=this.state.ffz_total_errors<10,handler=()=>{clearTimeout(e),this.ffzZeroErrors()};return t&&(e=setTimeout(handler,250)),i?i("div",{className:"tw-border-l tw-c-background-alt-2 tw-c-text-base tw-full-width tw-full-height tw-align-items-center tw-flex tw-flex-column tw-justify-content-center tw-relative"},[i("div",{className:"tw-mg-b-1"},"There was an error displaying chat."),!t&&i("button",{className:"tw-button",onClick:handler},i("span",{className:"tw-button__text"},"Try Again"))]):null}return l.call(this)},t.prototype.ffzInstallHandler=function(){if(this._ffz_installed)return;this._ffz_installed=!0;const t=this;t.ffz_outside=!0,t._ffz_accessor=`_ffz_contains_${o++}`,e.on("tooltips:mousemove",this.ffzTooltipHover,this),e.on("tooltips:leave",this.ffzTooltipLeave,this),t.ffz_oldScrollEvent=t.handleScrollEvent,t.ffz_oldScroll=t.scrollToBottom,t.ffz_doScroll=function(){t._ffz_scroll_frame=null,t.state.isAutoScrolling&&!t.state.isPaused&&(t.ffz_smooth_scroll&&!t._ffz_one_fast_scroll?t.smoothScrollBottom():(t._ffz_one_fast_scroll=!1,t._ffz_snapshot=null,t.ffz_oldScroll()))},t.scrollToBottom=function(){t._ffz_scroll_request||(t._ffz_scroll_request=requestAnimationFrame(t._scrollToBottom))},t._scrollToBottom=function(){if(t._ffz_scroll_request=null,t.ffz_smooth_scroll&&!t._ffz_one_fast_scroll&&t._ffz_snapshot){const e=t._ffz_snapshot&&t._ffz_snapshot.lastLine?t._ffz_snapshot.lastLine.offsetTop-t._ffz_snapshot.offsetTop:0;t.scroll&&t.scroll.scrollContent&&0!=e&&(t.scroll.scrollContent.scrollTop+=e)}t._ffz_snapshot=null,t.state.isAutoScrolling&&!t.state.isPaused&&(t.ffz_smooth_scroll&&!t._ffz_one_fast_scroll?t.smoothScrollBottom():(t._ffz_one_fast_scroll=!1,t.ffz_oldScroll()))},t.handleScrollEvent=function(e){if(!t.scroll||!t.scroll.scrollContent)return;if(!(e.which>0||"mousewheel"===e.type||"wheel"===e.type||"touchmove"===e.type))return;const i=t.scroll.scrollContent,n=i.scrollHeight-i.scrollTop-i.offsetHeight;n<=10&&!t.state.isAutoScrolling?t.resume():t.state.isAutoScrolling&&n>10&&(t.state.isPaused&&(t.setState({isPaused:!1},()=>{t.props.setPaused&&t.props.setPaused(!1)}),t.setLoadMoreEnabled(!0)),t.setState({isAutoScrolling:!1}))},t.pause=function(){t.state.isAutoScrolling&&t.setState({isPaused:!0},()=>{t.props.setPaused&&t.props.setPaused(!0)})};const i=t.resume;t.ffzFastResume=function(){t._ffz_one_fast_scroll=!0,t.resume()},t.resume=function(){clearInterval(t._ffz_hover_timer),t._ffz_hover_timer=null,i.call(t)};const n=e.web_munch.getModule("mousetrap")||window.Mousetrap;null!=n&&(n.unbind("alt","keydown"),n.unbind("alt","keyup")),t.ffzHandleKey=t.ffzHandleKey.bind(t),window.addEventListener("keydown",t.ffzHandleKey),window.addEventListener("keyup",t.ffzHandleKey),t.hoverPause=t.ffzMouseMove.bind(t),t.hoverResume=t.ffzMouseLeave.bind(t);const s=e.fine.getChildNode(t);s&&s.addEventListener("mousemove",t.hoverPause);const a=this.scroll&&this.scroll.scrollContent;if(a)for(const e of r)a.removeEventListener(e,t.ffz_oldScrollEvent),a.addEventListener(e,t.handleScrollEvent);t.forceUpdate(),e.emit("site:dom-update","chat-scroller",t)},t.prototype.ffzSetSmoothScroll=function(e){this.ffz_smooth_scroll=e,this.ffzMaybeUnpause()},t.prototype.ffzReadKeysFromEvent=function(e){return(e.altKey!==this.ffz_alt||e.shiftKey!==this.ffz_shift||e.ctrlKey!==this.ffz_ctrl||e.metaKey!==this.ffz_meta)&&(this.ffz_alt=e.altKey,this.ffz_shift=e.shiftKey,this.ffz_ctrl=e.ctrlKey,this.ffz_meta=e.metaKey,!0)},t.prototype.ffzHandleKey=function(t){if(!this.ffzReadKeysFromEvent(t))return;if(this.ffzUpdateKeyTags(),e.pause_hover&&this.ffz_outside||e.pause<2)return;const i=this.ffzShouldBePaused();i!==this.state.isPaused&&(i?(this.pause(),this.setLoadMoreEnabled(!1)):this.resume())},t.prototype.ffzInstallHoverTimer=function(){this._ffz_hover_timer||(this._ffz_hover_timer=setInterval(()=>{this.state.isPaused&&this.ffzShouldBePaused()||this.ffzMaybeUnpause()},50))},t.prototype.ffzMouseMove=function(e){this.ffz_last_move=Date.now();const t=this.ffz_outside;this.ffz_outside=!1,this._ffz_outside_timer&&(clearTimeout(this._ffz_outside_timer),this._ffz_outside_timer=null);const i=this.ffzReadKeysFromEvent(e);if(!i&&e.screenX===this.ffz_sx&&e.screenY===this.ffz_sy)return void(t&&this.ffzUpdateKeyTags());this.ffz_sx=e.screenX,this.ffz_sy=e.screenY,(i||t)&&this.ffzUpdateKeyTags();const n=this.ffzShouldBePaused();n!==this.state.isPaused&&(n?(this.pause(),this.ffzInstallHoverTimer(),this.setLoadMoreEnabled(!1)):this.resume())},t.prototype.ffzMouseLeave=function(){this.ffz_outside=!0,this._ffz_outside_timer&&clearTimeout(this._ffz_outside_timer),this._ffz_outside_timer=setTimeout(()=>this.ffzMaybeUnpause(),64),this.ffzUpdateKeyTags()},t.prototype.ffzTooltipHover=function(e,t,i){if(null==e[this._ffz_accessor]){const t=this.scroll&&this.scroll.scrollContent;e[this._ffz_accessor]=!!t&&t.contains(e)}e[this._ffz_accessor]&&this.ffzMouseMove(i)},t.prototype.ffzTooltipLeave=function(e){if(!this.ffz_outside){if(null==e[this._ffz_accessor]){const t=this.scroll&&this.scroll.scrollContent;e[this._ffz_accessor]=!!t&&t.contains(e)}e[this._ffz_accessor]&&this.ffzMouseLeave()}},t.prototype.ffzUpdateKeyTags=function(){this._ffz_key_frame||(this._ffz_key_frame=requestAnimationFrame(()=>this.ffz_updateKeyTags()))},t.prototype.ffz_updateKeyTags=function(){if(this._ffz_key_frame=null,!e.use_keys&&this.ffz_use_keys===e.use_keys)return;if(!this.scroll||!this.scroll.root)return;this.ffz_use_keys=e.use_keys,this.scroll.root.classList.toggle("ffz--keys",e.use_keys);const t=this.scroll.root.dataset;e.use_keys?(t.alt=!this.ffz_outside&&this.ffz_alt,t.ctrl=!this.ffz_outside&&this.ffz_ctrl,t.shift=!this.ffz_outside&&this.ffz_shift,t.meta=!this.ffz_outside&&this.ffz_meta):(delete t.alt,delete t.ctrl,delete t.shift,delete t.meta)},t.prototype.ffzShouldBePaused=function(t){null==t&&(t=Date.now()-this.ffz_last_move);const i=e.pause;return(!e.pause_hover||!this.ffz_outside)&&this.state.isAutoScrolling&&(this.ffz_ctrl&&(2===i||6===i)||this.ffz_meta&&(3===i||7===i)||this.ffz_alt&&(4===i||8===i)||this.ffz_shift&&(5===i||9===i)||!this.ffz_outside&&t<e.pause_delay&&(1===i||i>5))},t.prototype.ffzMaybeUnpause=function(){this.state.isPaused&&!this._ffz_unpause_frame&&(this._ffz_unpause_frame=requestAnimationFrame(()=>{this._ffz_unpause_frame=null,this.state.isPaused&&!this.ffzShouldBePaused()&&this.resume()}))},t.prototype.listFooter=function(){let t,n="";if(this.state.isPaused){const i=e.pause,s=2===i?e.i18n.t("key.ctrl","Ctrl Key"):3===i?e.i18n.t("key.meta","Meta Key"):4===i?e.i18n.t("key.alt","Alt Key"):5===i?e.i18n.t("key.shift","Shift Key"):6===i?e.i18n.t("key.ctrl_mouse","Ctrl or Mouse"):7===i?e.i18n.t("key.meta_mouse","Meta or Mouse"):8===i?e.i18n.t("key.alt_mouse","Alt or Mouse"):9===i?e.i18n.t("key.shift_mouse","Shift or Mouse"):e.i18n.t("key.mouse","Mouse Movement");t=e.i18n.t("chat.paused","(Chat Paused Due to {reason})",{reason:s}),n="ffz--freeze-indicator"}else{if(this.state.isAutoScrolling)return null;t=e.i18n.t("chat.messages-below","More messages below.")}return i("div",{className:`chat-list__list-footer tw-absolute tw-align-items-center tw-border-radius-medium tw-bottom-0 tw-flex tw-full-width tw-justify-content-center tw-pd-05 ${n}`,onClick:this.ffzFastResume},i("div",null,t))},t.prototype.smoothScrollBottom=function(){this._ffz_smooth_animation&&cancelAnimationFrame(this._ffz_smooth_animation),this.ffz_is_smooth_scrolling=!0;let e=this.ffz_smooth_scroll,t=Date.now();const i=this.scroll.scrollContent;if(!i)return;const n=i.scrollHeight-i.clientHeight-i.scrollTop;n>i.clientHeight?e=n:n>200&&(e+=e*Math.floor(n/200));const smoothAnimation=()=>{if(this.state.isPaused||!this.state.isAutoScrolling)return this.ffz_is_smooth_scrolling=!1;const n=Date.now(),s=e*((n-t)/10);if(s>=1){const e=i.scrollTop,r=e+s,o=i.scrollHeight-i.clientHeight;t=n,r<o?(i.scrollTop=e+s,this._ffz_smooth_animation=requestAnimationFrame(smoothAnimation)):(i.scrollTop=o,this.ffz_is_smooth_scrolling=!1)}else this._ffz_smooth_animation=requestAnimationFrame(smoothAnimation)};smoothAnimation()};for(const e of n)this.onMount(e)}),this.ChatScroller.on("mount",this.onMount,this),this.ChatScroller.on("unmount",this.onUnmount,this)}onMount(e){e.ffzSetSmoothScroll(this.smooth_scroll),e.ffzInstallHandler()}onUnmount(e){this.off("tooltips:mousemove",e.ffzTooltipHover,e),this.off("tooltips:leave",e.ffzTooltipLeave,e),window.removeEventListener("keydown",e.ffzHandleKey),window.removeEventListener("keyup",e.ffzHandleKey)}}},function(e,t,i){"use strict";i.d(t,"a",(function(){return ChatLine}));var n=i(4),s=i(3),r=i(106),o=i(0),a=i(2),l=i(6),c=i(5),u=i(43);const h={1e3:1,2e3:2,3e3:3};class ChatLine extends s.default{constructor(...e){super(...e),this.inject("settings"),this.inject("i18n"),this.inject("chat"),this.inject("site"),this.inject("site.fine"),this.inject("site.web_munch"),this.inject(r.a),this.inject("chat.actions"),this.inject("chat.overrides"),this.ChatLine=this.fine.define("chat-line",e=>e.renderMessageBody&&e.props&&!e.onExtensionNameClick&&!Object(o.has)(e.props,"hasModPermissions"),n.a.CHAT_ROUTES),this.ExtensionLine=this.fine.define("extension-line",e=>e.renderMessageBody&&e.onExtensionNameClick,n.a.CHAT_ROUTES),this.WhisperLine=this.fine.define("whisper-line",e=>e.props&&e.props.message&&e.props.reportOutgoingWhisperRendered)}async onEnable(){this.on("chat.overrides:changed",e=>this.updateLinesByUser(e),this),this.chat.context.on("changed:chat.emoji.style",this.updateLines,this),this.chat.context.on("changed:chat.bits.stack",this.updateLines,this),this.chat.context.on("changed:chat.badges.style",this.updateLines,this),this.chat.context.on("changed:chat.badges.hidden",this.updateLines,this),this.chat.context.on("changed:chat.badges.custom-mod",this.updateLines,this),this.chat.context.on("changed:chat.rituals.show",this.updateLines,this),this.chat.context.on("changed:chat.subs.show",this.updateLines,this),this.chat.context.on("changed:chat.subs.compact",this.updateLines,this),this.chat.context.on("changed:chat.rich.enabled",this.updateLines,this),this.chat.context.on("changed:chat.rich.hide-tokens",this.updateLines,this),this.chat.context.on("changed:chat.rich.all-links",this.updateLines,this),this.chat.context.on("changed:chat.rich.minimum-level",this.updateLines,this),this.chat.context.on("changed:tooltip.link-images",this.maybeUpdateLines,this),this.chat.context.on("changed:tooltip.link-nsfw-images",this.maybeUpdateLines,this),this.chat.context.on("changed:chat.actions.inline",this.updateLines,this),this.chat.context.on("changed:chat.filtering.show-deleted",this.updateLines,this),this.chat.context.on("changed:chat.filtering.process-own",this.updateLines,this),this.chat.context.on("changed:chat.timestamp-format",this.updateLines,this),this.chat.context.on("changed:chat.filtering.highlight-basic-terms--color-regex",this.updateLines,this),this.chat.context.on("changed:chat.filtering.highlight-basic-users--color-regex",this.updateLines,this),this.chat.context.on("changed:chat.filtering.highlight-basic-badges--colors",this.updateLines,this),this.chat.context.on("changed:chat.filtering.highlight-basic-blocked--regex",this.updateLines,this),this.chat.context.on("changed:chat.filtering.highlight-basic-users-blocked--regex",this.updateLines,this),this.chat.context.on("changed:chat.filtering.highlight-basic-badges-blocked--list",this.updateLines,this);const e=this,t=await this.web_munch.findModule("react");if(!t)return;const i=t.createElement,n=this.rich_content&&this.rich_content.RichContent;this.WhisperLine.ready(t=>{const n=t.prototype.render;t.prototype.render=function(){if(this._ffz_no_scan=!0,!this.props.message||!this.props.message.content)return n.call(this);const t=e.chat.standardizeWhisper(this.props.message),s=t.is_action,r=t.user,o=e.overrides.getColor(r.id)||r.color,a=e.parent.colors.process(o),l=t.ffz_tokens=t.ffz_tokens||e.chat.tokenizeMessage(t,null,null),c=e.chat.renderTokens(l,i),u=e.overrides.getName(r.id);return i("div",{className:"thread-message__message"},i("div",{className:"tw-pd-x-1 tw-pd-y-05"},[i("span",{className:`thread-message__message--user-name notranslate${u?" ffz--name-override":""}`,style:{color:a}},u||r.displayName),i("span",null,s?" ":": "),i("span",{className:"message",style:{color:s&&a}},c)]))},setTimeout(()=>this.WhisperLine.forceUpdate())}),this.ChatLine.ready(t=>{const s=t.prototype.render;t.prototype.shouldComponentUpdate=function(e,t){const i=t&&t.alwaysShowMessage||!e.message.deleted,n=this._ffz_show;return this._ffz_show=i,i!==n||t&&this.state&&t.ffz_expanded!==this.state.ffz_expanded||e.deletedMessageDisplay!==this.props.deletedMessageDisplay||e.deletedCount!==this.props.deletedCount||e.message!==this.props.message||e.isCurrentUserModerator!==this.props.isCurrentUserModerator||e.showModerationIcons!==this.props.showModerationIcons||e.showTimestamps!==this.props.showTimestamps},t.prototype.render=function(){try{this._ffz_no_scan=!0;const t=e.parent.message_types||{},s=this.props.deletedCount,r=e.chat.context.get("chat.filtering.display-deleted"),o=e.chat.standardizeMessage(this.props.message),d=o.messageType===t.Action,f=o.user,p=e.overrides.getColor(f.id)||f.color,g=e.parent.colors.process(p);let m,_,b=this.props.deletedMessageDisplay,v=null;if(this.props.isCurrentUserModerator||"DETAILED"!=b||(b="LEGACY"),r&&(b=r),"BRIEF"===b){if(o.deleted)return null==s?null:i("div",{className:"chat-line__status"},e.i18n.t("chat.deleted-messages","{count,plural,\none {One message was deleted by a moderator.}\nother {# messages were deleted by a moderator.}\n}",{count:s}));m=!0,_=!1}else"DETAILED"===b?(m=!0,_=o.deleted):(m=this.state&&this.state.alwaysShowMessage||!o.deleted,_=!1);if(o.deleted){const t=e.chat.context.get("chat.filtering.display-mod-action");if(2===t||1===t&&"DETAILED"===b){const t=o.modActionType;"timeout"===t?v=e.i18n.t("chat.mod-action.timeout","{duration} Timeout",{duration:Object(l.print_duration)(o.duration||1)}):"ban"===t?v=e.i18n.t("chat.mod-action.ban","Banned"):"delete"!==t&&t||(v=e.i18n.t("chat.mod-action.delete","Deleted")),v&&o.modLogin&&(v=e.i18n.t("chat.mod-action.by","{action} by {login}",{login:o.modLogin,action:v})),v&&(v=i("span",{className:"tw-pd-l-05","data-test-selector":"chat-deleted-message-attribution"},`(${v})`))}}let y=o.roomLogin?o.roomLogin:o.channel?o.channel.slice(1):void 0,w=o.roomId?o.roomId:this.props.channelID;if(!y&&w){const t=e.chat.getRoom(w,null,!0);t&&t.login&&(y=o.roomLogin=t.login)}if(!w&&y){const t=e.chat.getRoom(null,w,!0);t&&t.id&&(w=o.roomId=t.id)}const k=e.site.getUser(),C={id:w,login:y};k&&(k.moderator=this.props.isCurrentUserModerator,k.staff=this.props.isCurrentUserStaff);const x=o.ffz_tokens=o.ffz_tokens||e.chat.tokenizeMessage(o,k,C),S=n&&e.chat.pluckRichContent(x,o),E=o.mentioned&&o.mention_color?e.parent.inverse_colors.process(o.mention_color):null;this.ffz_user_click_handler||(this.props.onUsernameClick?this.ffz_user_click_handler=t=>{if(this.isKeyboardEvent(t)&&t.keyCode!==a.KEYS.Space&&t.keyCode!==a.KEYS.Enter)return;const i=t.currentTarget,n=i&&i.dataset;let s=f;if(n&&n.user)try{s=JSON.parse(n.user)}catch(e){}const r=new c.FFZEvent({inst:this,event:t,message:o,user:s,room:C});e.emit("chat:user-click",r),r.defaultPrevented||this.props.onUsernameClick(s.login,"chat_message",o.id,i.getBoundingClientRect().bottom)}:this.ffz_user_click_handler=this.openViewerCard||this.usernameClickHandler);const F=[i("span",{className:"chat-author__display-name"},f.displayName),f.isIntl&&i("span",{className:"chat-author__intl-login"},` (${f.login})`)],O=e.overrides.getName(f.id);let A=`chat-line__message${_?" ffz--deleted-message":""}`,j=x.length||!o.ffz_type?[this.props.showTimestamps&&i("span",{className:"chat-line__timestamp"},e.chat.formatTime(o.timestamp)),e.actions.renderInline(o,this.props.showModerationIcons,k,C,i),i("span",{className:"chat-line__message--badges"},e.chat.badges.render(o,i)),i("span",{className:`chat-line__username notranslate${O?" ffz--name-override tw-relative tw-tooltip-wrapper":""}`,role:"button",style:{color:g},onClick:this.ffz_user_click_handler,onContextMenu:e.actions.handleUserContext},O?[i("span",{className:"chat-author__display_name"},O),i("div",{className:"tw-tooltip tw-tooltip--down tw-tooltip--align-center"},F)]:F),i("span",null,d?" ":": "),m?i("span",{className:"message",style:d?{color:g}:null},e.chat.renderTokens(x,i)):i("span",{className:"chat-line__message--deleted"},i("a",{href:"",onClick:this.alwaysShowMessage},e.i18n.t("chat.message-deleted","<message deleted>"))),m&&S&&i(n,S),v]:null;if("sub_mystery"===o.ffz_type){const t=o.mystery;t&&(o.mystery.line=this);const n=e.i18n.tList("chat.sub.gift","{user} is gifting {count,number} Tier {tier} Sub{count,en_plural} to {channel}'s community! ",{user:o.sub_anon||"ananonymousgifter"===f.username?e.i18n.t("chat.sub.anonymous-gifter","An anonymous gifter"):i("span",{role:"button",className:"chatter-name",onClick:this.ffz_user_click_handler},i("span",{className:"tw-c-text-base tw-strong"},f.userDisplayName)),count:o.sub_count,tier:h[o.sub_plan]||1,channel:o.roomLogin});1===o.sub_total?n.push(e.i18n.t("chat.sub.gift-first","It's their first time gifting a Sub in the channel!")):o.sub_total>1&&n.push(e.i18n.t("chat.sub.gift-total","They've gifted {count} Subs in the channel!",{count:o.sub_total})),this.ffz_click_expand||(this.ffz_click_expand=()=>{this.setState({ffz_expanded:!this.state.ffz_expanded})});const s=e.chat.context.get("chat.subs.merge-gifts-visibility")?!this.state.ffz_expanded:this.state.ffz_expanded;let r=null;if(s&&t&&t.recipients&&t.recipients.length>0){const e=[];for(const n of t.recipients)e.length&&e.push(", "),e.push(i("span",{role:"button",className:"ffz--giftee-name",onClick:this.ffz_user_click_handler,"data-user":JSON.stringify(n)},i("span",{className:"tw-c-text-base tw-strong"},n.displayName)));r=i("div",{className:"tw-mg-t-05 tw-border-t tw-pd-t-05 tw-c-text-alt-2"},e)}A=`ffz-notice-line user-notice-line tw-pd-y-05 ffz--subscribe-line${_?" ffz--deleted-message":""}`,j=[i("div",{className:"tw-flex tw-c-text-alt-2",onClick:this.ffz_click_expand},[e.chat.context.get("chat.subs.compact")?null:i("figure",{className:`ffz-i-star${o.sub_anon?"-empty":""} tw-mg-r-05`}),i("div",null,[j||o.sub_anon?null:e.actions.renderInline(o,this.props.showModerationIcons,k,C,i),n]),t?i("div",{className:"tw-pd-l-05 tw-font-size-4"},i("figure",{className:`ffz-i-${s?"down":"right"}-dir tw-pd-y-1`})):null]),r,j&&i("div",{className:"chat-line--inline chat-line__message","data-room-id":w,"data-room":y,"data-user-id":f.userID,"data-user":f.userLogin&&f.userLogin.toLowerCase()},j)]}else if("sub_gift"===o.ffz_type){const t=o.sub_plan||{},n=h[t.plan]||1,s=e.i18n.tList("chat.sub.mystery","{user} gifted a {plan} Sub to {recipient}! ",{user:o.sub_anon||"ananonymousgifter"===f.username?e.i18n.t("chat.sub.anonymous-gifter","An anonymous gifter"):i("span",{role:"button",className:"chatter-name",onClick:this.ffz_user_click_handler},i("span",{className:"tw-c-text-base tw-strong"},f.userDisplayName)),plan:"custom"===t.plan?"":e.i18n.t("chat.sub.gift-plan","Tier {tier}",{tier:n}),recipient:i("span",{role:"button",className:"chatter-name",onClick:this.ffz_user_click_handler,"data-user":JSON.stringify(o.sub_recipient)},i("span",{className:"tw-c-text-base tw-strong"},o.sub_recipient.displayName))});1===o.sub_total?s.push(e.i18n.t("chat.sub.gift-first","It's their first time gifting a Sub in the channel!")):o.sub_total>1&&s.push(e.i18n.t("chat.sub.gift-total","They've gifted {count,number} Subs in the channel!",{count:o.sub_total})),A=`ffz-notice-line user-notice-line tw-pd-y-05 tw-pd-r-2 ffz--subscribe-line${_?" ffz--deleted-message":""}`,j=[i("div",{className:"tw-flex tw-c-text-alt-2"},[e.chat.context.get("chat.subs.compact")?null:i("figure",{className:"ffz-i-star tw-mg-r-05"}),i("div",null,[j||o.sub_anon?null:e.actions.renderInline(o,this.props.showModerationIcons,k,C,i),s])]),j&&i("div",{className:"chat-line--inline chat-line__message","data-room-id":w,"data-room":y,"data-user-id":f.userID,"data-user":f.userLogin&&f.userLogin.toLowerCase()},j)]}else if("resub"===o.ffz_type){const t=o.sub_cumulative||o.sub_months,n=e.chat.context.get("chat.subs.show");if(3===n||1===n&&j&&t>1||2===n&&t>1){const n=o.sub_plan||{},s=h[n.plan]||1,r=e.i18n.tList("chat.sub.main","{user} subscribed {plan}. ",{user:i("span",{role:"button",className:"chatter-name",onClick:this.ffz_user_click_handler},i("span",{className:"tw-c-text-base tw-strong"},f.userDisplayName)),plan:n.prime?e.i18n.t("chat.sub.twitch-prime","with Twitch Prime"):e.i18n.t("chat.sub.plan","at Tier {tier}",{tier:s})});o.sub_share_streak&&o.sub_streak>1?r.push(e.i18n.t("chat.sub.cumulative-months","They've subscribed for {cumulative,number} months, currently on a {streak,number} month streak!",{cumulative:o.sub_cumulative,streak:o.sub_streak})):t>1&&r.push(e.i18n.t("chat.sub.months","They've subscribed for {count,number} months!",{count:t})),A=`ffz-notice-line user-notice-line tw-pd-y-05 tw-pd-r-2 ffz--subscribe-line${_?" ffz--deleted-message":""}`,j=[i("div",{className:"tw-flex tw-c-text-alt-2"},[e.chat.context.get("chat.subs.compact")?null:i("figure",{className:`ffz-i-${n.prime?"crown":"star"} tw-mg-r-05`}),i("div",null,[j?null:e.actions.renderInline(o,this.props.showModerationIcons,k,C,i),r])]),j&&i("div",{className:"chat-line--inline chat-line__message","data-room-id":w,"data-room":y,"data-user-id":f.userID,"data-user":f.userLogin&&f.userLogin.toLowerCase()},j)]}}else if("ritual"===o.ffz_type&&e.chat.context.get("chat.rituals.show")){let t;"new_chatter"===o.ritual&&(t=i("div",{className:"tw-c-text-alt-2"},[e.i18n.tList("chat.ritual","{user} is new here. Say hello!",{user:i("span",{role:"button",className:"chatter-name",onClick:this.ffz_user_click_handler},i("span",{className:"tw-c-text-base tw-strong"},f.userDisplayName))})])),t&&(A=`ffz-notice-line user-notice-line tw-pd-y-05 tw-pd-r-2 ffz--ritual-line${_?" ffz--deleted-message":""}`,j=[t,j&&i("div",{className:"chat-line--inline chat-line__message","data-room-id":w,"data-room":y,"data-user-id":f.userID,"data-user":f.userLogin&&f.userLogin.toLowerCase()},j)])}else if("points"===o.ffz_type&&o.ffz_reward){const t=i("span",{className:"ffz--points-reward"},Object(u.b)(o.ffz_reward,e.i18n)),n=i("span",{className:"ffz--points-cost"},[i("span",{className:"ffz--points-icon"}),e.i18n.formatNumber(Object(u.a)(o.ffz_reward))]);A=`ffz-notice-line ffz--points-line tw-pd-l-1 tw-pd-y-05 tw-pd-r-2${Object(u.c)(o.ffz_reward)?" ffz--points-highlight":""}${_?" ffz--deleted-message":""}`,j=[i("div",{className:"tw-c-text-alt-2"},[j?null:e.actions.renderInline(o,this.props.showModerationIcons,k,C,i),j?e.i18n.tList("chat.points.redeemed","Redeemed {reward} {cost}",{reward:t,cost:n}):e.i18n.tList("chat.points.user-redeemed","{user} redeemed {reward} {cost}",{reward:t,cost:n,user:i("span",{role:"button",className:"chatter-name",onClick:this.ffz_user_click_handler},i("span",{className:"tw-c-text-base tw-strong"},f.userDisplayName))})]),j&&i("div",{className:"chat-line--inline chat-line__message","data-room-id":w,"data-room":y,"data-user-id":f.userID,"data-user":f.userLogin&&f.userLogin.toLowerCase()},j)]}return j?i("div",{className:`${A}${o.mentioned?" ffz-mentioned":""}${E?" ffz-custom-color":""}`,style:{backgroundColor:E},"data-room-id":w,"data-room":y,"data-user-id":f.userID,"data-user":f.userLogin&&f.userLogin.toLowerCase()},j):null}catch(t){return e.log.info(t),e.log.capture(t,{extra:{props:this.props}}),s.call(this)}},setTimeout(()=>this.ChatLine.forceUpdate())}),this.ExtensionLine.ready(t=>{const s=t.prototype.render;t.prototype.render=function(){try{if(this._ffz_no_scan=!0,!this.props.installedExtensions)return null;const t=e.chat.standardizeMessage(this.props.message),s=t&&t.extension;if(!s)return null;if(!this.props.installedExtensions.some(e=>{const t=e.extension;return t&&(t.clientId||t.clientID)===(s.clientId||s.clientID)&&t.version===s.version}))return null;const r=e.parent.colors.process(s.chatColor);let o=t.roomLogin?t.roomLogin:t.channel?t.channel.slice(1):void 0;if(!o&&this.props.channelID){const i=e.chat.getRoom(this.props.channelID,null,!0);i&&i.login&&(o=t.roomLogin=i.login)}const a=e.site.getUser(),l={id:this.props.channelID,login:o},c=t.ffz_tokens=t.ffz_tokens||e.chat.tokenizeMessage(t,a,l),u=n&&e.chat.pluckRichContent(c,t),h=t.mentioned&&t.mention_color?e.parent.inverse_colors.process(t.mention_color):null;return c.length?i("div",{className:`chat-line__message${t.mentioned?" ffz-mentioned":""}${h?" ffz-custom-color":""}`,style:{backgroundColor:h},"data-room-id":l.id,"data-room":l.login,"data-extension":s.clientID},[this.props.showTimestamps&&i("span",{className:"chat-line__timestamp"},e.chat.formatTime(t.timestamp)),i("span",{className:"chat-line__message--badges"},e.chat.badges.render(t,i)),i("span",{className:"chat-line__username notranslate",role:"button",style:{color:r},onClick:this.onExtensionNameClick},i("span",{className:"chat-author__display-name"},s.displayName)),i("span",null,": "),i("span",{className:"message"},e.chat.renderTokens(c,i)),u&&i(n,u)]):null}catch(t){return e.log.info(t),e.log.capture(t,{extra:{props:this.props}}),s.call(this)}},setTimeout(()=>this.ExtensionLine.forceUpdate())})}updateLinesByUser(e,t){for(const i of this.ChatLine.instances){const n=i.props.message,s=null==n?void 0:n.user;(s&&e&&e==s.id||t&&t==s.login)&&i.forceUpdate()}for(const n of this.WhisperLine.instances){var i;const s=null===(i=n.props.message)||void 0===i?void 0:i._ffz_message,r=null==s?void 0:s.user;(r&&e&&e==r.id||t&&t==r.login)&&n.forceUpdate()}}maybeUpdateLines(){this.chat.context.get("chat.rich.all-links")&&this.updateLines()}updateLines(){for(const e of this.ChatLine.instances){const t=e.props.message;t&&(t.ffz_tokens=null,t.mentioned=t.mention_color=null)}for(const e of this.ExtensionLine.instances){const t=e.props.message;t&&(t.ffz_tokens=null,t.mentioned=t.mention_color=null)}for(const e of this.WhisperLine.instances){const t=e.props.message;t&&t._ffz_message&&(t._ffz_message=null)}this.ChatLine.forceUpdate(),this.ExtensionLine.forceUpdate(),this.WhisperLine.forceUpdate(),this.emit("chat:updated-lines")}}},function(e,t,i){"use strict";i.d(t,"a",(function(){return RichContent}));var n=i(3),s=i(0);const r="https://static-cdn.jtvnw.net/emoticons/v1/58765/2.0";class RichContent extends n.default{constructor(...e){super(...e),this.inject("i18n"),this.inject("site.web_munch"),this.RichContent=null}async onEnable(){const e=this,t=await this.web_munch.findModule("react");if(!t)return;const i=t.createElement;this.RichContent=class RichContent extends t.Component{constructor(e){super(e),this.state={loaded:!1,error:!1}}async componentDidMount(){try{let t=this.props.getData();if(t instanceof Promise){const e=Object(s.has)(this.props,"timeout")?this.props.timeout:1e3;t=e?await Object(s.timeout)(t,e):await t}t||(t={error:!0,title:e.i18n.t("card.error","An error occurred."),desc_1:e.i18n.t("card.empty","No data was returned.")}),this.setState(Object.assign({loaded:!0,url:this.props.url},t))}catch(t){"timeout"!==t.message&&e.log.capture(t),this.setState({loaded:!0,error:!0,url:this.props.url,title:e.i18n.t("card.error","An error occurred."),desc_1:String(t)})}}renderCardImage(){return i("div",{class:"chat-card__preview-img tw-align-items-center tw-c-background-alt-2 tw-flex tw-flex-shrink-0 tw-justify-content-center"},this.state.error?i("img",{class:"chat-card__error-img",src:r}):i("div",{class:"tw-card-img tw-flex-shrink-0 tw-overflow-hidden"},i("div",{class:"tw-aspect tw-aspect--align-top"},i("div",{class:"tw-aspect__spacer",style:{paddingTop:"56.25%"}}),this.state.loaded&&this.state.image?i("img",{class:"tw-image",src:this.state.image,alt:this.state.title}):null)))}renderCardDescription(){let t=this.state.title,n=this.state.desc_1,s=this.state.desc_2;return this.state.loaded||(n=e.i18n.t("card.loading","Loading..."),s="",t=""),i("div",{class:`ffz--card-text tw-overflow-hidden tw-align-items-center tw-flex${s?" ffz--two-line":""}`},i("div",{class:"tw-full-width tw-pd-l-1"},i("div",{class:"chat-card__title tw-ellipsis"},i("span",{class:"tw-font-size-5","data-test-selector":"chat-card-title",title:t},t)),i("div",{class:"tw-ellipsis"},i("span",{class:"tw-c-text-alt-2 tw-font-size-6","data-test-selector":"chat-card-description",title:n},n)),s&&i("div",{class:"tw-ellipsis"},i("span",{class:"tw-c-text-alt-2 tw-font-size-6","data-test-selector":"chat-card-description",title:s},s))))}renderCardBody(){return this.props.renderBody?this.props.renderBody(this.state,this,i):this.state.html?i("div",{dangerouslySetInnerHTML:{__html:this.state.html}}):[this.renderCardImage(),this.renderCardDescription()]}renderCard(){return i("div",{class:"ffz--chat-card tw-elevation-1 tw-mg-t"},i("div",{class:"tw-c-background-base tw-flex tw-flex-nowrap tw-pd-05"},this.renderCardBody()))}render(){if(!this.state.url)return this.renderCard();const e=this.props.card_tooltip;return i("a",{class:`${e?"ffz-tooltip ":""} chat-card__link`,"data-tooltip-type":"link","data-url":this.state.url,"data-is-mail":!1,target:"_blank",rel:"noreferrer noopener",href:this.state.url},this.renderCard())}}}}},function(e,t,i){"use strict";i.d(t,"a",(function(){return SettingsMenu}));var n=i(4),s=i(3),r=i(0);class SettingsMenu extends s.default{constructor(...e){super(...e),this.inject("settings"),this.inject("i18n"),this.inject("chat"),this.inject("site.fine"),this.inject("site.web_munch"),this.SettingsMenu=this.fine.define("chat-settings",e=>e.renderUniversalOptions&&e.onBadgesChanged,n.a.CHAT_ROUTES),this.ModSettingsMenu=this.fine.define("chat-mod-settings",e=>e.renderModerationSettingsLink&&e.onChatClear,n.a.CHAT_ROUTES)}async onEnable(){this.on("i18n:update",()=>this.SettingsMenu.forceUpdate()),this.chat.context.on("changed:chat.scroller.freeze",()=>this.SettingsMenu.forceUpdate());const e=this,t=await this.web_munch.findModule("react");if(!t)return;const i=t.createElement;this.SettingsMenu.ready(t=>{const n=t.prototype.render,s=t.prototype.renderUniversalOptions;t.prototype.renderUniversalOptions=function(){const t=s.call(this);this.ffzSettingsClick||(this.ffzSettingsClick=t=>e.click(this,t)),this.ffzPauseClick||(this.ffzPauseClick=()=>this.setState({ffzPauseMenu:!this.state.ffzPauseMenu})),t.props.children.push(i("div",{class:"tw-full-width tw-relative"},i("button",{class:"tw-block tw-border-radius-medium tw-full-width tw-interactable tw-interactable--hover-enabled tw-interactable--alpha tw-interactive",onClick:this.ffzSettingsClick},i("div",{class:"tw-align-items-center tw-flex tw-pd-05 tw-relative"},i("div",{class:"tw-flex-grow-1"},e.i18n.t("site.menu_button","FrankerFaceZ Control Center")))),e.cant_window&&i("div",{class:"tw-mg-t-05 tw-c-text-alt-2"},i("span",{class:"ffz-i-attention"},e.i18n.t("popup.error","We tried opening a pop-up window and could not. Make sure to allow pop-ups from Twitch.")))));const n=e.chat.context.get("chat.scroller.freeze"),r=2===n?e.i18n.t("key.ctrl","Ctrl Key"):3===n?e.i18n.t("key.meta","Meta Key"):4===n?e.i18n.t("key.alt","Alt Key"):5===n?e.i18n.t("key.shift","Shift Key"):6===n?e.i18n.t("key.ctrl_mouse","Ctrl or Mouse"):7===n?e.i18n.t("key.meta_mouse","Meta or Mouse"):8===n?e.i18n.t("key.alt_mouse","Alt or Mouse"):9===n?e.i18n.t("key.shift_mouse","Shift or Mouse"):e.i18n.t("key.hover","Hover");return t.props.children.push(i("div",{class:"tw-full-width tw-relative"},i("button",{class:"tw-block tw-border-radius-medium tw-full-width tw-interactable tw-interactable--hover-enabled tw-interactable--alpha tw-interactive",onClick:this.ffzPauseClick},i("div",{class:"tw-align-items-center tw-flex tw-pd-05 tw-relative"},i("div",{class:"tw-flex-grow-1"},e.i18n.t("chat.settings.pause","Pause Chat")),i("div",{class:"tw-mg-l-1 tw-pd-x-05"},r),i("figure",{class:"tw-svg ffz-i-right-dir"}))))),t},t.prototype.render=function(){try{if(this.state.ffzPauseMenu)return this.ffzSettingsClick||(this.ffzSettingsClick=t=>e.click(this,t)),this.ffzPauseClick||(this.ffzPauseClick=()=>this.setState({ffzPauseMenu:!this.state.ffzPauseMenu})),i("div",{class:"tw-absolute tw-balloon tw-balloon--auto tw-balloon--right tw-balloon--up tw-block","data-a-target":"chat-settings-balloon",style:{marginRight:"-5.3rem"}},i("div",{class:"tw-border-radius-large tw-c-background-base tw-c-text-inherit tw-elevation-2"},i("div",{class:"chat-settings__popover"},i("div",{class:"chat-settings__header tw-align-items-center tw-c-background-base tw-flex tw-pd-x-1 tw-relative"},i("div",{class:"chat-settings__back-icon-container tw-left-0 tw-mg-r-05"},i("button",{class:"tw-align-items-center tw-align-middle tw-border-bottom-left-radius-medium tw-border-bottom-right-radius-medium tw-border-top-left-radius-medium tw-border-top-right-radius-medium tw-button-icon tw-core-button tw-core-button--border tw-inline-flex tw-interactive tw-justify-content-center tw-overflow-hidden tw-relative","data-test-selector":"chat-settings-back-button","aria-label":e.i18n.t("chat.settings.back","Back"),onClick:this.ffzPauseClick},i("div",{class:"tw-align-items-center tw-flex tw-flex-grow-0"},i("span",{class:"tw-button-icon__icon"},i("figure",{class:"ffz-i-left-open"}))))),i("div",{class:"tw-align-center tw-align-items-center tw-flex tw-flex-grow-1 tw-justify-content-center"},i("p",{class:"tw-c-text-alt tw-font-size-5 tw-semibold"},e.i18n.t("chat.settings.pause","Pause Chat")))),i("div",{class:"chat-settings scrollable-area scrollable-area--suppress-scroll-x","data-simplebar":!0},i("div",{class:"chat-settings__content tw-border-bottom-left-radius-medium tw-border-bottom-right-radius-medium tw-c-background-base tw-c-text-base tw-pd-1"},i("div",{class:"tw-pd-x-05"},i("div",{class:"tw-border-b tw-mg-b-1 tw-pd-b-1"},i("p",{class:"tw-c-text-alt-2"},e.i18n.t("chat.settings.pause-explain","FrankerFaceZ overrides the behavior of Pause Chat entirely. Please use FFZ's Scrolling settings within the FFZ Control Center under Chat > Behavior."))),i("button",{class:"tw-block tw-border-radius-medium tw-full-width tw-interactable tw-interactable--hover-enabled tw-interactable--alpha tw-interactive","data-page":"chat.behavior",onClick:this.ffzSettingsClick},i("div",{class:"tw-align-items-center tw-flex tw-pd-05 tw-relative"},i("div",{class:"tw-flex-grow-1"},e.i18n.t("chat.settings.open-settings","Open Control Center"))))))))))}catch(t){e.log.error("Error rendering chat settings menu.",t)}return n.call(this)},this.SettingsMenu.forceUpdate()}),this.ModSettingsMenu.ready(e=>{const t=e.prototype.render;e.prototype.render=function(){var e,i,n,s;const o=t.call(this),a=null==o?void 0:null===(e=o.props)||void 0===e?void 0:null===(i=e.children)||void 0===i?void 0:null===(n=i[0])||void 0===n?void 0:null===(s=n.props)||void 0===s?void 0:s.children;if(Array.isArray(a)){let e=a.length;for(;e--;){const t=a[e];if(t&&t.props&&Object(r.has)(t.props,"chatPauseSetting")){a.splice(e,1);break}}}return o},this.ModSettingsMenu.forceUpdate()}),this.SettingsMenu.on("unmount",e=>{e.ffzSettingsClick=null})}closeMenu(e){const t=this.fine.searchParent(e,e=>e.setChatInputRef&&e.setAutocompleteInputRef,100),i=t&&this.fine.searchTree(t,e=>e.props&&e.props.isSettingsOpen&&e.onClickSettings);i&&i.onClickSettings()}click(e,t){const i=this.resolve("site.layout");if(i&&i.is_minimal||t&&(t.ctrlKey||t.shiftKey)){const e=window.open("https://twitch.tv/popout/frankerfacez/chat?ffz-settings","_blank","resizable=yes,scrollbars=yes,width=850,height=600");if(!e)return this.cant_window=!0,void this.SettingsMenu.forceUpdate();e.focus()}else{const e=t.currentTarget,i=e&&e.dataset&&e.dataset.page,n=this.resolve("main_menu");if(n&&(i&&n.requestPage(i),n.showing))return;this.emit("site.menu_button:clicked")}this.closeMenu(e)}}},function(e,t,i){"use strict";i.d(t,"a",(function(){return EmoteMenu}));var n,s,r=i(0),o=i(2),a=i(1),l=i(4),c=i(3),u=i(93),h=i.n(u);const d={1e3:"Tier 1",2e3:"Tier 2",3e3:"Tier 3"},f=["the_horns","raised_back_of_hand","ok_hand","+1","clap","fist"];function maybe_date(e){if(!e)return e;try{return new Date(e)}catch(e){return null}}const p=(null===(n=window)||void 0===n?void 0:null===(s=n.Intl)||void 0===s?void 0:s.Collator)&&new Intl.Collator(void 0,{numeric:!0}),g=[function id_asc(e,t){return p?p.compare(e.id,t.id):e.id<t.id?-1:e.id>t.id?1:0},function id_desc(e,t){return p?p.compare(t.id,e.id):e.id>t.id?-1:e.id<t.id?1:0},function name_asc(e,t){const i=e.name.toLowerCase(),n=t.name.toLowerCase();return i<n?-1:i>n?1:p?p.compare(e.id,t.id):e.id<t.id?-1:e.id>t.id?1:0},function name_desc(e,t){const i=e.name.toLowerCase(),n=t.name.toLowerCase();return i>n?-1:i<n?1:p?p.compare(t.id,e.id):e.id>t.id?-1:e.id<t.id?1:0}];function sort_sets(e,t){const i=e.sort_key,n=t.sort_key;if(i<n)return-1;if(n<i)return 1;const s=e.title.toLowerCase(),r=t.title.toLowerCase();return s<r?-1:r<s?1:0}class EmoteMenu extends c.default{constructor(...e){super(...e),this.inject("settings"),this.inject("i18n"),this.inject("chat"),this.inject("chat.badges"),this.inject("chat.emotes"),this.inject("chat.emoji"),this.inject("site"),this.inject("site.fine"),this.inject("site.apollo"),this.inject("site.web_munch"),this.inject("site.css_tweaks"),this.SUB_STATUS=h.a,this.settings.add("chat.emote-menu.enabled",{default:!0,ui:{path:"Chat > Emote Menu >> General",title:"Use the FrankerFaceZ Emote Menu.",description:"The FFZ emote menu replaces the built-in Twitch emote menu and provides enhanced functionality.",component:"setting-check-box"},changed:()=>this.EmoteMenu.forceUpdate()}),this.settings.add("chat.emote-menu.icon",{requires:["chat.emote-menu.enabled"],default:!1,process:(e,t)=>!!e.get("chat.emote-menu.enabled")&&t,ui:{path:"Chat > Emote Menu >> Appearance",title:"Replace the emote menu icon with the FFZ icon for that classic feel.",component:"setting-check-box"}}),this.settings.add("chat.emote-menu.show-heading",{default:1,ui:{path:"Chat > Emote Menu >> Appearance",title:"Show Headers",component:"setting-select-box",data:[{value:0,title:"Never"},{value:1,title:"Always"},{value:2,title:"When Not Searching"}]}}),this.settings.add("chat.emote-menu.show-search",{default:!0,ui:{path:"Chat > Emote Menu >> Appearance",title:"Show the search box.",component:"setting-check-box"}}),this.settings.add("chat.emote-menu.reduced-padding",{default:!1,ui:{path:"Chat > Emote Menu >> Appearance",title:"Use reduced padding.",component:"setting-check-box"}}),this.settings.add("chat.emote-menu.default-tab",{default:"channel",ui:{path:"Chat > Emote Menu >> General",title:"Default Tab",component:"setting-select-box",data:[{value:"fav",title:"Favorites"},{value:"channel",title:"Channel"},{value:"all",title:"My Emotes"},{value:"emoji",title:"Emoji"}]}}),this.settings.add("chat.emote-menu.combine-tabs",{default:!1,ui:{path:"Chat > Emote Menu >> General",title:"Display all emotes on one tab.",component:"setting-check-box"}}),this.settings.add("chat.emote-menu.sort-emotes",{default:0,ui:{path:"Chat > Emote Menu >> Sorting",title:"Sort Emotes By",component:"setting-select-box",data:[{value:0,title:"Order Added (ID), Ascending"},{value:1,title:"Order Added (ID), Descending"},{value:2,title:"Name, Ascending"},{value:3,title:"Name, Descending"}]}}),this.settings.add("chat.emote-menu.sort-tiers-last",{default:!0,ui:{path:"Chat > Emote Menu >> Sorting",title:"List emotes from higher sub tiers last.",component:"setting-check-box"}}),this.EmoteMenu=this.fine.define("chat-emote-menu",e=>e.subscriptionProductHasEmotes,l.a.CHAT_ROUTES),this.MenuWrapper=this.fine.wrap("ffz-emote-menu")}async onEnable(){this.on("i18n:update",()=>this.EmoteMenu.forceUpdate()),this.on("chat.emotes:update-default-sets",this.maybeUpdate,this),this.on("chat.emotes:update-user-sets",this.maybeUpdate,this),this.on("chat.emotes:update-room-sets",this.maybeUpdate,this),this.on("chat.emotes:change-favorite",this.maybeUpdate,this),this.on("chat.emoji:populated",this.maybeUpdate,this),this.chat.context.on("changed:chat.emote-menu.enabled",()=>this.EmoteMenu.forceUpdate());const fup=()=>this.MenuWrapper.forceUpdate(),rebuild=()=>{for(const e of this.MenuWrapper.instances)e.rebuildData()};this.chat.context.on("changed:chat.fix-bad-emotes",rebuild),this.chat.context.on("changed:chat.emote-menu.sort-emotes",rebuild),this.chat.context.on("changed:chat.emote-menu.sort-tiers-last",rebuild),this.chat.context.on("changed:chat.emote-menu.show-heading",fup),this.chat.context.on("changed:chat.emote-menu.show-search",fup),this.chat.context.on("changed:chat.emote-menu.reduced-padding",fup),this.chat.context.on("changed:chat.emote-menu.combine-tabs",fup),this.chat.context.on("changed:chat.emoji.style",this.updateEmojiVariables,this),this.chat.context.on("changed:chat.emote-menu.icon",e=>this.css_tweaks.toggle("emote-menu",e)),this.css_tweaks.toggle("emote-menu",this.chat.context.get("chat.emote-menu.icon")),this.updateEmojiVariables(),this.css_tweaks.setVariable("emoji-menu--sheet","//cdn.frankerfacez.com/static/emoji/sheet_twitter_32.png"),this.css_tweaks.setVariable("emoji-menu--count",52),this.css_tweaks.setVariable("emoji-menu--size",20);const e=this,t=await this.web_munch.findModule("react"),i=t&&t.createElement;if(!i)return e.log.warn("Unable to get React.");this.defineClasses(),this.EmoteMenu.ready(t=>{const n=t.prototype.render;t.prototype.render=function(){return this.props&&Object(r.has)(this.props,"channelOwnerID")&&e.chat.context.get("chat.emote-menu.enabled")?(this._ffz_no_scan=!0,i(e.MenuErrorWrapper,{visible:this.props.visible},i(e.MenuComponent,{visible:this.props.visible,toggleVisibility:this.props.toggleVisibility,channel_data:this.props.channelData,emote_data:this.props.emoteSetsData,user_id:this.props.currentUserID,channel_id:this.props.channelOwnerID,loading:this.state.gqlLoading,error:this.state.gqlError,onClickEmote:this.props.onClickEmote}))):(this._ffz_no_scan=!1,n.call(this))},this.EmoteMenu.forceUpdate()})}updateEmojiVariables(){const e=`//cdn.frankerfacez.com/static/emoji/sheet_${this.chat.context.get("chat.emoji.style")||"twitter"}_`,t=this.emoji_size=20,i=this.emoji_sheet_count=52,n=this.emoji_sheet_size=i*(t+2),s=this.emoji_sheet_pct=100*n/t;this.emoji_sheet_remain=n-t,this.css_tweaks.set("emoji-menu",`.ffz--emoji-tone-picker__emoji,.emote-picker__emoji .emote-picker__emote-figure {\n\tbackground-size: ${s}% ${s}%;\n\tbackground-image: url("${e}20.png");\n\tbackground-image: ${o.WEBKIT_CSS}image-set(\n\t\turl("${e}20.png") 1x,\n\t\turl("${e}32.png") 1.6x,\n\t\turl("${e}64.png") 3.2x\n\t);\n}`)}maybeUpdate(){if(this.chat.context.get("chat.emote-menu.enabled"))for(const e of this.MenuWrapper.instances)e.rebuildData()}defineClasses(){const e=this,t=this.settings.provider,i=this.web_munch.getModule("react"),n=i&&i.createElement;this.EmojiTonePicker=class FFZEmojiTonePicker extends i.Component{constructor(e){super(e),this.onClick=()=>this.setState({open:!this.state.open}),this.onMouseEnter=()=>this.state.open||this.setState({emoji:this.pickRandomEmoji()}),this.onClickOutside=()=>this.state.open&&this.setState({open:!1}),this.clickTone=e=>{this.props.pickTone(e.currentTarget.dataset.tone),this.setState({open:!1})},this.element=null,this.saveRef=e=>this.element=e,this.state={open:!1,emoji:this.pickRandomEmoji(),tone:null}}componentDidMount(){this.element&&(this._clicker=new a.ClickOutside(this.element,this.onClickOutside))}componentWillUnmount(){this._clicker&&(this._clicker.destroy(),this._clicker=null)}pickRandomEmoji(){const e=this.props.choices;return e[Math.floor(Math.random()*e.length)]}renderTone(e,t){return e?n("button",{key:e.code,"data-tone":t,class:"tw-interactive tw-block tw-full-width tw-interactable tw-interactable--hover-enabled tw-interactable--inverted tw-interactive tw-pd-y-05 tw-pd-x-2",onClick:this.clickTone},this.renderEmoji(e)):null}renderToneMenu(){if(!this.state.open)return null;const e=this.state.emoji;if(!e||!e.variants)return null;const t=Object.entries(e.variants).map(([e,t])=>this.renderTone(t,e));return n("div",{class:"tw-absolute tw-balloon tw-balloon--up tw-balloon--right tw-balloon tw-block"},n("div",{class:"tw-border-b tw-border-l tw-border-r tw-border-t tw-border-radius-medium tw-c-background-base tw-elevation-1"},this.renderTone(e,null),t))}renderEmoji(t){if(!t)return null;const i=t.sheet_x*(e.emoji_size+2)+1,s=t.sheet_y*(e.emoji_size+2)+1,r=100*i/e.emoji_sheet_remain,o=100*s/e.emoji_sheet_remain;return n("figure",{class:"ffz--emoji-tone-picker__emoji",style:{backgroundPosition:`${r}% ${o}%`}})}render(){const e=this.state.emoji,t=this.props.tone,i=t&&e.variants[t];return n("div",{ref:this.saveRef,class:"ffz--emoji-tone-picker tw-relative tw-mg-l-1"},n("button",{class:"tw-interactive tw-button tw-button--dropmenu ffz-button--hollow",onClick:this.onClick,onMouseEnter:this.onMouseEnter},n("span",{class:"tw-button__text"},this.renderEmoji(i||e)),n("span",{class:"tw-button__icon tw-button__icon--right"},n("figure",{class:"ffz-i-down-dir"}))),this.renderToneMenu())}},this.MenuSection=class FFZMenuSection extends i.Component{constructor(e){super(e),this.ref=null,this.saveRef=e=>{this.ref&&this.props.stopObserving(this.ref),this.ref=e,e&&this.props.startObserving(this.ref,this)};const i=t.get("emote-menu.collapsed")||[];this.state={collapsed:e.data&&i.includes(e.data.key),intersecting:!window.IntersectionObserver},this.clickHeading=this.clickHeading.bind(this),this.clickEmote=this.clickEmote.bind(this),this.mouseEnter=()=>this.state.intersecting||this.setState({intersecting:!0}),this.onMouseEnter=this.onMouseEnter.bind(this),this.onMouseLeave=this.onMouseLeave.bind(this)}componentDidMount(){this.ref&&this.props.startObserving(this.ref,this)}componentWillUnmount(){this.ref&&this.props.stopObserving(this.ref)}clickEmote(t){e.emotes.handleClick(t)||this.props.onClickEmote(t.currentTarget.dataset.name)}clickHeading(){if(this.props.filtered)return;const e=t.get("emote-menu.collapsed")||[],i=!this.state.collapsed,n=this.props.data.key,s=e.indexOf(n);if(this.setState({collapsed:i}),i&&-1===s)e.push(n);else{if(i||-1===s)return;e.splice(s,1)}t.set("emote-menu.collapsed",e)}onMouseEnter(e){const t=e.currentTarget.dataset.setId;this.setState({unlocked:t})}onMouseLeave(){this.setState({unlocked:null})}render(){const t=this.props.data,i=this.props.filtered;let s=!(t.is_favorites&&!e.chat.context.get("chat.emote-menu.combine-tabs"))&&e.chat.context.get("chat.emote-menu.show-heading");s=2===s?!i:!!s;const r=s&&!i&&this.state.collapsed;if(!t)return null;let o,a;o=t.image?n("img",{class:`ffz--menu-badge${t.image_large?" ffz--menu-badge__large":""}`,src:t.image,srcSet:t.image_set}):n("figure",{class:`ffz--menu-badge ffz-i-${t.icon||"zreknarf"}`});const l=t.renews&&t.renews-new Date,c=t.ends&&t.ends-new Date;if(l>0)a={icon:"calendar",message:e.i18n.t("emote-menu.sub-renews","This sub renews in {seconds,humantime}.",{seconds:l/1e3})};else if(c){const i=c/1e3;a=t.prime?{icon:"crown",message:e.i18n.t("emote-menu.sub-prime","This is your free sub with Twitch Prime.\nIt ends in {seconds,humantime}.",{seconds:i})}:t.gift?{icon:"gift",message:e.i18n.t("emote-menu.sub-gift-ends","This gifted sub ends in {seconds,humantime}.",{seconds:i})}:{icon:"calendar-empty",message:e.i18n.t("emote-menu.sub-ends","This sub ends in {seconds,humantime}.",{seconds:i})}}let u=t.source_i18n?e.i18n.t(t.source_i18n,t.source):t.source;return null==u&&(u="FrankerFaceZ"),n("section",{ref:this.saveRef,"data-key":t.key,class:i?"filtered":"",onMouseEnter:this.mouseEnter},s?n("heading",{class:"tw-pd-1 tw-border-b tw-flex tw-flex-nowrap",onClick:this.clickHeading},o,n("div",{class:"tw-pd-l-05"},(t.i18n?e.i18n.t(t.i18n,t.title):t.title)||e.i18n.t("emote-menu.unknown","Unknown Source"),a&&n("span",{class:`tw-mg-x-05 ffz--expiry-info ffz-tooltip ffz-i-${a.icon}`,"data-tooltip-type":"html","data-title":a.message})),n("div",{class:"tw-flex-grow-1"}),u,i?"":n("figure",{class:`tw-pd-l-05 ffz-i-${r?"left":"down"}-dir`})):null,r||this.renderBody(s))}renderBody(t){const i=this.props.data,s=this.props.filtered,r=i.locks&&i.locks[this.state.unlocked],o=i.filtered_emotes&&i.filtered_emotes.map(n=>{if(s&&n.locked)return;const o=n.locked&&(!r||!r.emotes.has(n.id)),a=o&&i.locks&&i.locks[n.set_id],l=a?i.all_locked?e.i18n.t("emote-menu.emote-sub","Subscribe for {price} to unlock this emote.",a):e.i18n.t("emote-menu.emote-up","Upgrade your sub to {price} to unlock this emote.",a):"";return this.renderEmote(n,o,t,l)});return n("div",{class:"tw-pd-1 tw-border-b tw-c-background-alt tw-align-center"},o,!s&&this.renderSellout())}renderEmote(e,t,i,s){return this.state.intersecting?n("button",{key:e.id,class:`ffz-tooltip emote-picker__emote-link${t?" locked":""}`,"data-tooltip-type":"emote","data-provider":e.provider,"data-id":e.id,"data-set":e.set_id,"data-code":e.code,"data-variant":e.variant,"data-no-source":i,"data-name":e.name,"aria-label":e.name,"data-locked":e.locked,"data-sellout":s,onClick:!e.locked&&this.clickEmote},n("figure",{class:"emote-picker__emote-figure"},n("img",{class:`emote-picker__emote-image${e.emoji?" ffz-emoji":""}`,src:e.src,srcSet:e.srcSet,alt:e.name,height:e.height?`${e.height}px`:null,width:e.width?`${e.width}px`:null})),e.favorite&&n("figure",{class:"ffz--favorite ffz-i-star"}),t&&n("figure",{class:"ffz-i-lock"})):n("span",{key:e.id,class:"emote-picker__placeholder",style:{width:`${e.width||28}px`,height:`${e.height||28}px`}})}renderSellout(){const t=this.props.data;if(!t.all_locked||!t.locks)return null;const i=t.locks[this.state.unlocked];return n("div",{class:"tw-mg-1 tw-border-t tw-pd-t-1 tw-mg-b-0"},i?e.i18n.t("emote-menu.sub-unlock","Subscribe for {price} to unlock {count,number} emote{count,en_plural}",{price:i.price,count:i.emotes.size}):e.i18n.t("emote-menu.sub-basic","Subscribe to unlock some emotes"),n("div",{class:"ffz--sub-buttons tw-mg-t-05"},Object.values(t.locks).map(e=>n("a",{key:e.price,class:"tw-button tw-border-radius-none",href:e.url,target:"_blank",rel:"noopener noreferrer","data-set-id":e.set_id,onMouseEnter:this.onMouseEnter,onMouseLeave:this.onMouseLeave},n("span",{class:"tw-button__text"},e.price)))))}},this.fine.wrap("ffz-menu-section",this.MenuSection),this.EmojiSection=class FFZMenuEmojiSection extends this.MenuSection{renderEmote(t,i,s,r){const o=t.x*(e.emoji_size+2)+1,a=t.y*(e.emoji_size+2)+1,l=100*o/e.emoji_sheet_remain,c=100*a/e.emoji_sheet_remain;return n("button",{key:t.id,class:`ffz-tooltip emote-picker__emote-link${i?" locked":""}${t.emoji?" emote-picker__emoji":""}`,"data-tooltip-type":"emote","data-provider":t.provider,"data-id":t.id,"data-set":t.set_id,"data-code":t.code,"data-variant":t.variant,"data-no-source":s,"data-name":t.name,"aria-label":t.name,"data-locked":t.locked,"data-sellout":r,onClick:!t.locked&&this.clickEmote},n("figure",{class:"emote-picker__emote-figure",style:{backgroundPosition:`${l}% ${c}%`}}),t.favorite&&n("figure",{class:"ffz--favorite ffz-i-star"}),i&&n("figure",{class:"ffz-i-lock"}))}};const doClear=()=>requestAnimationFrame(()=>this.emit("tooltips:cleanup")),clearTooltips=()=>{clearTimeout(void 0),setTimeout(doClear,100)};this.MenuErrorWrapper=class FFZEmoteMenuErrorWrapper extends i.Component{constructor(e){super(e),this.state={errored:!1,error:null}}static getDerivedStateFromError(e){return{errored:!0,error:e}}componentDidCatch(t){e.log.capture(t),e.log.error("Error rendering the FFZ Emote Menu."),this.setState({errored:!0,error:t})}render(){if(this.state.errored){if(!this.props.visible)return null;const t=e.chat.context.get("chat.emote-menu.reduced-padding");return n("div",{class:`tw-balloon tw-balloon--md tw-balloon--up tw-balloon--right tw-block tw-absolute ffz--emote-picker${t?" reduced-padding":""}`,"data-a-target":"emote-picker"},n("div",{class:"tw-border tw-elevation-1 tw-border-radius-small tw-c-background-base"},n("div",{class:"emote-picker__tab-content scrollable-area","data-test-selector":"scrollable-area-wrapper","data-simplebar":!0},n("div",{class:"tw-align-center tw-pd-1"},n("div",{class:"tw-mg-b-1"},n("div",{class:"tw-mg-2"},n("img",{src:"//cdn.frankerfacez.com/emoticon/26608/2",srcSet:"//cdn.frankerfacez.com/emoticon/26608/2 1x, //cdn.frankerfacez.com/emoticon/26608/4 2x"})),e.i18n.t("emote-menu.error","There was an error rendering this menu."),n("br",null),e.settings.get("reports.error.enable")?e.i18n.t("emote-menu.error-report","An error report has been automatically submitted."):"",n("div",{class:"tw-mg-t-05 tw-border-t-1 tw-pd-t-05"},e.i18n.t("emote-menu.disable","As a temporary workaround, try disabling the FFZ Emote Menu in the FFZ Control Center.")))))))}return this.props.children}},this.MenuComponent=class FFZEmoteMenuComponent extends i.Component{constructor(t){super(t),this.ref=null,this.saveScrollRef=e=>{this.ref=e,this.createObserver()},this.state={tab:null,tone:e.settings.provider.get("emoji-tone",null)},t.visible&&this.loadData(),this.rebuildData(),this.observing=new Map,this.startObserving=this.startObserving.bind(this),this.stopObserving=this.stopObserving.bind(this),this.handleObserve=this.handleObserve.bind(this),this.pickTone=this.pickTone.bind(this),this.clickTab=this.clickTab.bind(this),this.handleFilterChange=this.handleFilterChange.bind(this),this.handleKeyDown=this.handleKeyDown.bind(this)}createObserver(){if(this.observer){if(this._observed===this.ref)return;this.observer.disconnect(),this.observer=this._observed=null}if(this.ref&&window.IntersectionObserver){this._observed=this.ref,this.observer=new IntersectionObserver(this.handleObserve,{root:this.ref,rootMargin:"50px 0px",threshold:.01});for(const e of this.observing.keys())this.observer.observe(e);this.observeSoon()}}observeSoon(){requestAnimationFrame(()=>{this.observer&&this.handleObserve(this.observer.takeRecords())})}destroyObserver(){this.observer&&(this.observer.disconnect(),this.observer=this._observed=null)}handleObserve(e){let t=!1;for(const i of e){const e=this.observing.get(i.target);e&&e.state.intersecting!==i.isIntersecting&&(t=!0,e.setState({intersecting:i.isIntersecting}))}t&&requestAnimationFrame(clearTooltips)}startObserving(e,t){const i=this.observing.get(e);t!==i&&(i&&this.stopObserving(e),this.observing.set(e,t),this.observer&&this.observer.observe(e),this.observeSoon())}stopObserving(e){this.observing.has(e)&&(this.observing.delete(e),this.observer&&this.observer.unobserve(e))}componentDidMount(){this.ref&&this.createObserver(),window.ffz_menu=this}componentWillUnmount(){this.destroyObserver(),window.ffz_menu===this&&(window.ffz_menu=null)}pickTone(t){t=t||null,e.settings.provider.set("emoji-tone",t),this.setState(this.filterState(this.state.filter,this.buildEmoji(Object.assign({},this.state,{tone:t}))))}clickTab(t){const i=t.currentTarget.dataset.tab;if(e.chat.context.get("chat.emote-menu.combine-tabs")){var n,s;let e;switch(i){case"fav":e=this.state.filtered_fav_sets;break;case"channel":e=this.state.filtered_channel_sets;break;case"emoji":e=this.state.filtered_emoji_sets;break;case"all":default:e=this.state.filtered_all_sets}const t=e&&e[0],r=t&&(null===(n=this.ref)||void 0===n?void 0:null===(s=n.querySelector)||void 0===s?void 0:s.call(n,`section[data-key="${t.key}"]`));r&&r.scrollIntoView()}else this.setState({tab:i})}clickSettings(t){const i=e.resolve("site.layout");if(i&&i.is_minimal||t&&(t.ctrlKey||t.shiftKey)){const e=window.open("https://twitch.tv/popout/frankerfacez/chat?ffz-settings","_blank","resizable=yes,scrollbars=yes,width=850,height=600");e&&e.focus()}else{const t=e.resolve("main_menu");if(t&&(t.requestPage("chat.emote_menu"),t.showing))return;e.emit("site.menu_button:clicked")}}handleFilterChange(e){this.setState(this.filterState(e.target.value,this.state))}handleKeyDown(e){27===e.keyCode&&this.props.toggleVisibility()}loadData(t=!1,i,n){if(!(n=n||this.state))return!1;const s=(i=i||this.props).emote_data&&i.emote_data.emoteSets,o=Array.isArray(s)?new Set(s.map(e=>e.id)):new Set;return t=t||n.set_data&&!Object(r.set_equals)(n.set_sets,o),!(n.set_data&&!t)&&(this.setState({loading:!0},()=>{e.getData(o,t).then(e=>{this.setState(this.filterState(this.state.filter,this.buildState(this.props,Object.assign({},this.state,{set_sets:o,set_data:e,loading:!1}))))})}),!0)}filterState(e,t){const i=Object.assign({},t);return i.filter=e,i.filtered=e&&e.length>0&&":"!==e||!1,i.filtered_channel_sets=this.filterSets(e,i.channel_sets),i.filtered_all_sets=this.filterSets(e,i.all_sets),i.filtered_fav_sets=this.filterSets(e,i.fav_sets),i.filtered_emoji_sets=this.filterSets(e,i.emoji_sets),i}filterSets(e,t){const i=[];if(!t||!t.length)return i;const n=e&&e.length>0&&":"!==e;for(const s of t){(s.filtered_emotes=s.emotes.filter(t=>!n||!t.locked&&this.doesEmoteMatch(e,t))).length&&i.push(s)}return i}doesEmoteMatch(e,t){if(!e||!e.length)return!0;const i=t.search||t.name,n=i.toLowerCase(),s=e.toLowerCase();if(!e.startsWith(":"))return n.includes(s);if(n.startsWith(s.slice(1)))return!0;const r=i.indexOf(e.charAt(1).toUpperCase());return-1!==r?n.slice(r+1).startsWith(s.slice(2)):void 0}buildEmoji(t){const i=Object.assign({},t),n=i.emoji_sets=[],s=e.emotes.getFavorites("emoji"),r=e.chat.context.get("chat.emoji.style")||"twitter",o=i.favorites=(i.favorites||[]).filter(e=>!e.emoji),a=i.tone=i.tone||null,l=i.tone_emoji=[],c={};for(const t of Object.values(e.emoji.emoji)){if(!t||!t.has[r]||"Skin Tones"===t.category)continue;if(t.variants)for(const e of t.names)if(f.includes(e)){l.push(t);break}const i=s.includes(t.code),u=t.variants&&t.variants[a],h=u&&u.has[r],d=h?u:t;let p=c[t.category];p||(p=c[t.category]=[],n.push({key:`emoji-${t.category}`,emoji:!0,image:e.emoji.getFullImage(d.image),i18n:`emoji.category.${t.category.toSnakeCase()}`,title:t.category,source:"Emoji",source_i18n:"emote-menu.emoji",emotes:p}));const g={provider:"emoji",emoji:!0,code:t.code,name:d.raw,variant:h&&a,search:t.names[0],height:18,width:18,x:d.sheet_x,y:d.sheet_y,favorite:i,src:e.emoji.getFullImage(d.image),srcSet:e.emoji.getFullImageSet(d.image)};p.push(g),i&&o.push(g)}return i.has_emoji_tab=n.length>0,i.fav_sets=[{key:"favorites",title:"Favorites",i18n:"emote-menu.favorites",icon:"star",source:"",is_favorites:!0,emotes:o}],o.sort(this.getSorter()),i}getSorter(){return g[e.chat.context.get("chat.emote-menu.sort-emotes")]||g[0]||(()=>0)}buildState(t,i){const n=Object.assign({},i),s=n.set_data||{},a=n.channel_sets=[],l=n.all_sets=[],c=n.favorites=[];if(t.loading||t.error||n.loading)return n;if(n.set_data&&this.loadData(!1,t,n))return n;const u=this.getSorter(),h=e.chat.context.get("chat.emote-menu.sort-tiers-last"),sort_emotes=(e,t)=>{if(e.misc||t.misc)return u(e,t);if(!e.locked&&t.locked)return-1;if(e.locked&&!t.locked)return 1;if(h||e.locked||t.locked){if(e.set_id<t.set_id)return-1;if(e.set_id>t.set_id)return 1}return u(e,t)},f=t.emote_data&&t.emote_data.emoteSets,p=t.emote_data&&t.emote_data.emoteMap,g=e.emotes.getFavorites("twitch"),m=new Set,_={},b=new Set;if(Array.isArray(f))for(const t of f){if(!t||!Array.isArray(t.emotes))continue;const i=t.id,n=parseInt(i,10),r=t.owner,a=parseInt(t.id,10)>5e8,u=o.TWITCH_POINTS_SETS.includes(n)||"channel_points"===(null==r?void 0:r.login),h=u?null:r,d=s[i];b.add(i);let f,v,y=`twitch-set-${i}`,w=0,k="twitch",C=h&&(h.displayName||h.login);C?(y=`twitch-${null==h?void 0:h.id}`,a?e.emotes.setTwitchSetChannel(i,{id:i,type:o.EmoteTypes.BitsTier,owner:{id:h.id,login:h.login,displayName:h.displayName}}):e.emotes.setTwitchSetChannel(i,{id:i,type:o.EmoteTypes.Subscription,owner:{id:h.id,login:h.login,displayName:h.displayName}})):h?C=e.i18n.t("emote-menu.unknown-set","Set #{set_id}",{set_id:i}):u?(C=e.i18n.t("emote-menu.points","Unlocked with Points"),y="twitch-points",k="channel-points",w=45):o.TWITCH_GLOBAL_SETS.includes(n)?(C=e.i18n.t("emote-menu.global","Global Emotes"),y="twitch-global",w=100,e.emotes.setTwitchSetChannel(i,{id:i,type:o.EmoteTypes.Global,owner:null})):o.TWITCH_PRIME_SETS.includes(n)?(C=e.i18n.t("emote_menu.prime","Prime"),y="twitch-prime",k="crown",w=75,e.emotes.setTwitchSetChannel(i,{id:i,type:o.EmoteTypes.Prime,owner:null})):(C=e.i18n.t("emote-menu.misc","Miscellaneous"),y="twitch-misc",k="inventory",w=50),_[y]?(f=_[y],v=f.emotes,d&&f.bad&&(f.bad=!1,f.renews=d.renews,f.ends=d.ends,f.prime=d.prime,f.gift=d.gift)):(v=[],f=_[y]={sort_key:w,key:y,image:null==h?void 0:h.profileImageURL,image_large:!0,icon:k,title:C,source:e.i18n.t("emote-menu.twitch","Twitch"),emotes:v,renews:null==d?void 0:d.renews,ends:null==d?void 0:d.ends,prime:null==d?void 0:d.prime,gift:null==d?void 0:d.gift},d||(f.bad=!0));for(const n of t.emotes){if(!n||!n.id||!n.token)continue;const t=n.id,s=o.KNOWN_CODES[n.token]||n.token,r=p&&p[s],a=r&&r.id!=t,l=o.REPLACEMENTS[t],d=g.includes(t);let f,_;if(l&&e.chat.context.get("chat.fix-bad-emotes"))f=`${o.REPLACEMENT_BASE}${l}`;else{const e=`${o.TWITCH_EMOTE_BASE}${t}`;f=`${e}/1.0`,_=`${f} 1x, ${e}/2.0 2x`}const b={provider:"twitch",id:t,set_id:i,name:s,src:f,srcSet:_,overridden:a?r.id:null,misc:!h,favorite:d};u||e.emotes.setTwitchEmoteSet(t,i),v.push(b),d&&!m.has(t)&&c.push(b),m.add(t)}v.length&&(v.sort(sort_emotes),l.includes(f)||l.push(f))}const v=t.channel_data&&t.channel_data.user,y=v&&v.subscriptionProducts;if(Array.isArray(y)){const t=e.badges.getTwitchBadge("subscriber","0",v.id,v.login),i=[],n={},r={sort_key:-10,key:"twitch-current-channel",image:t&&t.image1x,image_set:t&&`${t.image1x} 1x, ${t.image2x} 2x, ${t.image4x} 4x`,icon:"twitch",title:e.i18n.t("emote-menu.sub-set","Subscriber Emotes"),source:e.i18n.t("emote-menu.twitch","Twitch"),emotes:i,locks:n,all_locked:!0};for(const e of y){if(!e||!Array.isArray(e.emotes))continue;const t=e.emoteSetID,a=s[t],l=!b.has(t);let u;a&&(r.renews=a.renews,r.ends=a.ends,r.prime=a.prime,r.gift=a.gift&&a.gift.isGift),l?n[t]={set_id:t,id:e.id,price:e.price||d[e.tier],url:e.url,emotes:u=new Set(i.map(e=>e.id))}:r.all_locked=!1;for(const n of e.emotes){if(!n||!n.id||!n.token)continue;const e=n.id,s=`${o.TWITCH_EMOTE_BASE}${e}`,r=o.KNOWN_CODES[n.token]||n.token,a=m.has(e),h=g.includes(e),d={provider:"twitch",id:e,set_id:t,name:r,locked:l&&!a,src:`${s}/1.0`,srcSet:`${s}/1.0 1x, ${s}/2.0 2x`,favorite:h};i.push(d),l||!h||a||c.push(d),m.add(e),u&&u.add(e)}}i.length&&(i.sort(sort_emotes),a.push(r))}const w=e.site.getUser();if(w){const i=e.emotes.getRoomSetsWithSources(w.id,w.login,t.channel_id,null),n=e.emotes.getGlobalSetsWithSources(w.id,w.login),s={};let o={};for(const[e,t]of i){const i=this.processFFZSet(e,t,c,s,o);i&&(i.emotes.sort(sort_emotes),a.includes(i)||a.push(i))}o={};for(const[e,i]of n){const n=this.processFFZSet(e,i,c,s,o);n&&(n.emotes.sort(sort_emotes),l.includes(n)||l.push(n),!a.includes(n)&&Object(r.maybe_call)(n.force_global,this,e,t.channel_data&&t.channel_data.user,w)&&a.push(n))}}return a.sort(sort_sets),l.sort(sort_sets),n.has_channel_tab=a.length>0,this.buildEmoji(n)}processFFZSet(t,i,n,s,r){if(!t||!t.emotes)return null;const o=t.source||"ffz",a=e.emotes.getFavorites(o),l=s[o]=s[o]||new Set,c=`${t.merge_source||o}-${t.merge_id||t.id}`,u=e.emotes.providers.get(i),h=u&&u.name?u.i18n_key?e.i18n.t(u.i18n_key,u.name,u):u.name:t.source||"FrankerFaceZ",d="main"===i?e.i18n.t("emote-menu.main-set","Channel Emotes"):t.title||e.i18n.t("emote-menu.unknown-set","Set #{set_id}",{set_id:t.id});let f,p,g=u&&u.sort_key||t.sort;null==g&&(g=t.title.toLowerCase().includes("global")?100:0),r[c]?(f=r[c],p=f.emotes,c===`${o}-${t.id}`&&Object.assign(f,{sort_key:g,image:t.icon,title:d,source:h,force_global:t.force_global})):(p=[],f=r[c]={sort_key:g,key:c,image:t.icon,icon:"zreknarf",title:d,source:h,emotes:p,force_global:t.force_global});for(const e of Object.values(t.emotes))if(!e.hidden){const i=a.includes(e.id),s={provider:"ffz",id:e.id,set_id:t.id,src:e.urls[1],srcSet:e.srcSet,name:e.name,favorite:i,height:e.height,width:e.width};p.push(s),i&&!l.has(e.id)&&(n.push(s),l.add(e.id))}return p.length?f:void 0}rebuildData(){const e=this.buildState(this.props,this.state);this.setState(this.filterState(e.filter,e))}componentDidUpdate(e){this.props.visible&&!e.visible&&this.loadData(),this.props.channel_data===e.channel_data&&this.props.emote_data===e.emote_data&&this.props.user_id===e.user_id&&this.props.channel_id===e.channel_id&&this.props.loading===e.loading&&this.props.error===e.error||this.rebuildData()}renderError(){return n("div",{class:"tw-align-center tw-pd-1"},n("div",{class:"tw-mg-b-1"},n("div",{class:"tw-mg-2"},n("img",{src:"//cdn.frankerfacez.com/emoticon/26608/2",srcSet:"//cdn.frankerfacez.com/emoticon/26608/2 1x, //cdn.frankerfacez.com/emoticon/26608/4 2x"})),e.i18n.t("emote-menu.error","There was an error rendering this menu.")),n("button",{class:"tw-button",onClick:this.forceUpdate},n("span",{class:"tw-button__text"},e.i18n.t("error.try-again","Try Again"))))}renderEmpty(){return n("div",{class:"tw-align-center tw-pd-1"},n("div",{class:"tw-mg-2"},n("img",{src:"//cdn.frankerfacez.com/emoticon/26608/2",srcSet:"//cdn.frankerfacez.com/emoticon/26608/2 1x, //cdn.frankerfacez.com/emoticon/26608/4 2x"})),this.state.filtered?e.i18n.t("emote-menu.empty-search","There are no matching emotes."):"fav"===this.state.tab?e.i18n.t("emote-menu.empty-favs","You don't have any favorite emotes. To favorite an emote, find it and {hotkey}-Click it.",{hotkey:o.IS_OSX?"":"Ctrl"}):e.i18n.t("emote-menu.empty","There's nothing here."))}renderLoading(){return n("div",{class:"tw-align-center tw-pd-1"},n("h1",{class:"tw-mg-5 ffz-i-zreknarf loading"}),e.i18n.t("emote-menu.loading","Loading..."))}render(){if(!this.props.visible)return null;const t=this.state.loading||this.props.loading,i=e.chat.context.get("chat.emote-menu.reduced-padding"),s=e.chat.context.get("chat.emote-menu.combine-tabs");let r,o,a;if(s)o=[this.state.filtered_fav_sets,this.state.filtered_channel_sets,this.state.filtered_all_sets,this.state.filtered_emoji_sets].flat();else switch(r=this.state.tab||e.chat.context.get("chat.emote-menu.default-tab"),("channel"===r&&!this.state.has_channel_tab||"emoji"===r&&!this.state.has_emoji_tab)&&(r="all"),a="emoji"===r,r){case"fav":o=this.state.filtered_fav_sets;break;case"channel":o=this.state.filtered_channel_sets;break;case"emoji":o=this.state.filtered_emoji_sets;break;case"all":default:o=this.state.filtered_all_sets}return n("div",{class:`tw-balloon tw-balloon--md tw-balloon--up tw-balloon--right tw-block tw-absolute ffz--emote-picker${i?" reduced-padding":""}`,"data-a-target":"emote-picker"},n("div",{class:"tw-border tw-elevation-1 tw-border-radius-small tw-c-background-base"},n("div",{class:"emote-picker__tab-content scrollable-area","data-test-selector":"scrollable-area-wrapper","data-simplebar":!0},n("div",{ref:this.saveScrollRef,class:"simplebar-scroll-content"},n("div",{class:"simplebar-content"},t&&this.renderLoading(),!t&&o&&o.map(t=>t&&n(t.emoji?e.EmojiSection:e.MenuSection,{key:t.key,data:t,filtered:this.state.filtered,onClickEmote:this.props.onClickEmote,startObserving:this.startObserving,stopObserving:this.stopObserving})),!t&&(!o||!o.length)&&this.renderEmpty()))),n("div",{class:"emote-picker__controls-container tw-relative"},(a||e.chat.context.get("chat.emote-menu.show-search"))&&n("div",{class:"tw-border-t tw-pd-1"},n("div",{class:"tw-flex"},n("input",{type:"text",class:"tw-block tw-border-radius-medium tw-font-size-6 tw-full-width tw-input tw-pd-x-1 tw-pd-y-05",placeholder:a?e.i18n.t("emote-menu.search-emoji","Search for Emoji"):e.i18n.t("emote-menu.search","Search for Emotes"),value:this.state.filter,autoFocus:!0,autoCapitalize:"off",autoCorrect:"off",onChange:this.handleFilterChange,onKeyDown:this.handleKeyDown}),(s||a)&&this.state.has_emoji_tab&&n(e.EmojiTonePicker,{tone:this.state.tone,choices:this.state.tone_emoji,pickTone:this.pickTone}))),n("div",{class:"emote-picker__tab-nav-container tw-flex tw-border-t tw-c-background-alt"},n("div",{class:`emote-picker-tab-item${"fav"===r?" emote-picker-tab-item--active":""} tw-relative`},n("button",{class:`ffz-tooltip tw-block tw-full-width tw-interactable tw-interactable--hover-enabled tw-interactable--inverted tw-interactive${"fav"===r?" tw-interactable--selected":""}`,id:"emote-picker__fav","data-tab":"fav","data-tooltip-type":"html","data-title":e.i18n.t("emote-menu.favorites","Favorites"),onClick:this.clickTab},n("div",{class:"tw-inline-flex tw-pd-x-1 tw-pd-y-05 tw-font-size-4"},n("figure",{class:"ffz-i-star"})))),this.state.has_channel_tab&&n("div",{class:`emote-picker-tab-item${"channel"===r?" emote-picker-tab-item--active":""} tw-relative`},n("button",{class:`ffz-tooltip tw-block tw-full-width tw-interactable tw-interactable--hover-enabled tw-interactable--inverted tw-interactive${"channel"===r?" tw-interactable--selected":""}`,id:"emote-picker__channel","data-tab":"channel","data-tooltip-type":"html","data-title":e.i18n.t("emote-menu.channel","Channel"),onClick:this.clickTab},n("div",{class:"tw-inline-flex tw-pd-x-1 tw-pd-y-05 tw-font-size-4"},n("figure",{class:"ffz-i-camera"})))),n("div",{class:`emote-picker-tab-item${"all"===r?" emote-picker-tab-item--active":""} tw-relative`},n("button",{class:`ffz-tooltip tw-block tw-full-width tw-interactable tw-interactable--hover-enabled tw-interactable--inverted tw-interactive${"all"===r?" tw-interactable--selected":""}`,id:"emote-picker__all","data-tab":"all","data-tooltip-type":"html","data-title":e.i18n.t("emote-menu.my-emotes","My Emotes"),onClick:this.clickTab},n("div",{class:"tw-inline-flex tw-pd-x-1 tw-pd-y-05 tw-font-size-4"},n("figure",{class:"ffz-i-channels"})))),this.state.has_emoji_tab&&n("div",{class:`emote-picker-tab-item${"emoji"===r?" emote-picker-tab-item--active":""} tw-relative`},n("button",{class:`ffz-tooltip tw-block tw-full-width tw-interactable tw-interactable--hover-enabled tw-interactable--inverted tw-interactive${"emoji"===r?" tw-interactable--selected":""}`,id:"emote-picker__emoji","data-tab":"emoji","data-tooltip-type":"html","data-title":e.i18n.t("emote-menu.emoji","Emoji"),onClick:this.clickTab},n("div",{class:"tw-inline-flex tw-pd-x-1 tw-pd-y-05 tw-font-size-4"},n("figure",{class:"ffz-i-smile"})))),n("div",{class:"tw-flex-grow-1"}),n("div",{class:"emote-picker-tab-item tw-relative"},n("button",{class:"ffz-tooltip tw-block tw-full-width tw-interactable tw-interactable--hover-enabled tw-interactable--inverted tw-interactive","data-tooltip-type":"html","data-title":e.i18n.t("emote-menu.settings","Open Settings"),onClick:this.clickSettings},n("div",{class:"tw-inline-flex tw-pd-x-1 tw-pd-y-05 tw-font-size-4"},n("figure",{class:"ffz-i-cog"}))))))))}},this.fine.wrap("ffz-emote-menu",this.MenuComponent)}async getData(e,t,i=null,n=[]){if(this._data){if(!t&&Object(r.set_equals)(e,this._data_sets))return this._data;this._data=null,this._data_sets=null}let s;try{s=await this.apollo.client.query({query:h.a,variables:{first:75,after:i,criteria:{filter:"ALL"}},fetchPolicy:t?"network-only":"cache-first"})}catch(e){return this.log.warn("Error fetching additional emote menu data.",e),this._data=null}const o={},a=Object(r.get)("data.currentUser.subscriptionBenefits.edges.@each.node",s),l=Object(r.get)("data.currentUser.subscriptionBenefits.pageInfo.hasNextPage",s),c=Object(r.get)("data.currentUser.subscriptionBenefits.edges.@last.cursor",s);if(n=n.concat(a),l)return this.getData(e,t,c,n);if(n&&n.length)for(const e of n){var u;const t=e.product,i=t&&t.emoteSetID;i&&(o[i]={ends:maybe_date(e.endsAt),renews:maybe_date(e.renewsAt),prime:e.purchasedWithPrime,set_id:i,type:t.type,gift:null===(u=e.gift)||void 0===u?void 0:u.isGift})}return this._data_sets=e,this._data=o}}EmoteMenu.getData=Object(r.once)(EmoteMenu.getData)},function(e,t,i){"use strict";i.d(t,"a",(function(){return Input}));var n=i(3),s=i(1),r=i(4);class Input extends n.default{constructor(...e){super(...e),this.inject("chat"),this.inject("chat.actions"),this.inject("chat.emotes"),this.inject("chat.emoji"),this.inject("i18n"),this.inject("settings"),this.inject("site.fine"),this.inject("site.web_munch"),this.settings.add("chat.mru.enabled",{default:!0,ui:{path:"Chat > Input >> Recent Messages",title:"Allow pressing up and down to recall previously sent chat messages.",component:"setting-check-box"}}),this.settings.add("chat.tab-complete.ffz-emotes",{default:!0,ui:{path:"Chat > Input >> Tab Completion",title:"Allow tab-completion of FrankerFaceZ emotes.",component:"setting-check-box"}}),this.settings.add("chat.tab-complete.emoji",{default:!0,ui:{path:"Chat > Input >> Tab Completion",title:"Allow tab-completion of emoji.",component:"setting-check-box"}}),this.settings.add("chat.tab-complete.emotes-without-colon",{default:!1,ui:{path:"Chat > Input >> Tab Completion",title:"Allow tab-completion of emotes without typing a colon. (:)",description:"This will prevent the tab-completion of usernames without the @ prefix.",component:"setting-check-box"}}),this.settings.add("chat.tab-complete.limit-results",{default:!0,ui:{path:"Chat > Input >> Tab Completion",title:"Limit tab-completion results to 25.",component:"setting-check-box"}}),this.settings.add("chat.tab-complete.prioritize-favorites",{default:!1,ui:{path:"Chat > Input >> Tab Completion",title:"Prioritize favorite emotes at the top.",component:"setting-check-box"}}),this.ChatInput=this.fine.define("chat-input",e=>e&&e.setLocalChatInputRef&&e.setLocalAutocompleteInputRef,r.a.CHAT_ROUTES),this.EmoteSuggestions=this.fine.define("tab-emote-suggestions",e=>e&&e.getMatchedEmotes,r.a.CHAT_ROUTES),this.MentionSuggestions=this.fine.define("tab-mention-suggestions",e=>e&&e.getMentions&&e.renderMention,r.a.CHAT_ROUTES),this.EmoteUsageCount={TriHard:196568036,Kappa:192158118,"4Head":155758710,PogChamp:151485090,cmonBruh:146352878,BibleThump:56472964,WutFace:45069031,Kreygasm:41387580,DansGame:38097659,SMOrc:34734484,KappaPride:34262839,VoHiYo:27886434,SwiftRage:24561900,ResidentSleeper:24438298,EleGiggle:19891526,FailFish:19118343,NotLikeThis:18802905,Keepo:18351415,BabyRage:18220906,MingLee:18026207,HeyGuys:14851569,ANELE:14648986,PJSalt:14438861}}async onEnable(){this.chat.context.on("changed:chat.actions.room",()=>this.ChatInput.forceUpdate()),this.chat.context.on("changed:chat.actions.room-above",()=>this.ChatInput.forceUpdate()),this.chat.context.on("changed:chat.tab-complete.emotes-without-colon",e=>{for(const t of this.EmoteSuggestions.instances)t.canBeTriggeredByTab=e;for(const t of this.MentionSuggestions.instances)t.canBeTriggeredByTab=!e});const e=await this.web_munch.findModule("react"),t=e&&e.createElement;if(!t)return this.log.warn("Unable to get React.");const i=this;this.ChatInput.ready((e,n)=>{const r=e.prototype.render;e.prototype.render=function(){const e=r.call(this);try{const n=i.chat.context.get("chat.actions.room-above"),r=i.chat.context.get("context.chat_state")||{},o=n?e:Object(s.findReactFragment)(e,e=>e.props&&"chat-input__buttons-container"===e.props.className);if(!o||!o.props||!o.props.children)return e;const a=this.props;if(!a||!a.channelID)return e;const l=a.sessionUser?{id:a.sessionUser.id,login:a.sessionUser.login,displayName:a.sessionUser.displayName,mod:a.isCurrentUserModerator,staff:a.isStaff}:null,c={id:a.channelID,login:a.channelLogin,displayName:a.channelDisplayName,emoteOnly:a.emoteOnlyMode,slowMode:a.slowMode,slowDuration:a.slowModeDuration,subsMode:a.subsOnlyMode,r9kMode:r.r9k,followersOnly:r.followersOnly,followersDuration:r.followersOnlyRequirement},u=i.actions.renderRoom(i.chat.context.get("context.chat.showModIcons"),l,c,n,t);n?o.props.children.unshift(u||null):o.props.children.splice(1,0,u||null)}catch(e){i.log.error(e),i.log.capture(e)}return e};for(const e of n)e.forceUpdate(),this.emit("site:dom-update","chat-input",e),this.updateEmoteCompletion(e),this.overrideChatInput(e)}),this.EmoteSuggestions.ready((e,t)=>{for(const e of t)this.overrideEmoteMatcher(e)}),this.MentionSuggestions.ready((e,t)=>{for(const e of t)this.overrideMentionMatcher(e)}),this.ChatInput.on("update",this.updateEmoteCompletion,this),this.ChatInput.on("mount",this.overrideChatInput,this),this.EmoteSuggestions.on("mount",this.overrideEmoteMatcher,this),this.MentionSuggestions.on("mount",this.overrideMentionMatcher,this),this.on("site.css_tweaks:update-chat-css",this.resizeInput,this)}resizeInput(){this._resize_waiter&&cancelAnimationFrame(this._resize_waiter),this._resize_waiter=requestAnimationFrame(()=>this._resizeInput())}_resizeInput(){this._resize_waiter=null;for(const e of this.ChatInput.instances)e.resizeInput()}updateEmoteCompletion(e,t){t||(t=this.fine.searchTree(e,"tab-emote-suggestions",50)),t&&(t._ffz_user=e.props.sessionUser,t._ffz_channel_id=e.props.channelID,t._ffz_channel_login=e.props.channelLogin)}overrideChatInput(e){if(e._ffz_override)return;const t=this,i=e.onKeyDown,n=e.onMessageSend;e.messageHistory=[],e.tempInput="",e.messageHistoryPos=-1,e.onKeyDown=function(n){try{if(e.autocompleteInputRef&&t.chat.context.get("chat.mru.enabled")&&!n.shiftKey&&!n.ctrlKey&&!n.altKey){const t=n.charCode||n.keyCode;if(38===t&&0===e.chatInputRef.selectionStart){if(!e.messageHistory.length)return;return e.chatInputRef.value&&-1===e.messageHistoryPos&&(e.tempInput=e.chatInputRef.value),void(e.messageHistoryPos<e.messageHistory.length-1&&(e.messageHistoryPos++,e.autocompleteInputRef.setValue(e.messageHistory[e.messageHistoryPos])))}if(40===t&&e.chatInputRef.selectionStart==e.chatInputRef.value.length){if(!e.messageHistory.length)return;return void(e.messageHistoryPos>0?(e.messageHistoryPos--,e.autocompleteInputRef.setValue(e.messageHistory[e.messageHistoryPos])):0===e.messageHistoryPos&&(e.autocompleteInputRef.setValue(e.tempInput),e.messageHistoryPos=-1))}}}catch(e){t.log.capture(e),t.log.error(e)}i.call(this,n)},e.onMessageSend=function(i){try{t.chat.context.get("chat.mru.enabled")&&(e.messageHistory.length&&e.messageHistory[0]===e.chatInputRef.value||(e.messageHistory.unshift(e.chatInputRef.value),e.messageHistory=e.messageHistory.slice(0,20)),e.messageHistoryPos=-1,e.tempInput="")}catch(e){t.log.capture(e),t.log.error(e)}n.call(this,i)}}overrideMentionMatcher(e){e._ffz_override||(e.canBeTriggeredByTab=!this.chat.context.get("chat.tab-complete.emotes-without-colon"))}overrideEmoteMatcher(e){if(e._ffz_override)return;const t=this;e.canBeTriggeredByTab=this.chat.context.get("chat.tab-complete.emotes-without-colon"),e.getMatches=function(t,i){return i?t.length<2?null:e.getMatchedEmotes(t):t.startsWith(":")?t.length<3?null:e.getMatchedEmotes(t):null},e.doesEmoteMatchTerm=function(e,t){const i=e.name||e.token,n=i.toLowerCase(),s=t.toLowerCase();if(n.startsWith(s))return!0;const r=i.indexOf(t.charAt(0).toUpperCase());return-1!==r?n.slice(r+1).startsWith(s.slice(1)):void 0},e.getMatchedEmotes=function(e){const i=t.chat.context.get("chat.tab-complete.limit-results");let n=t.getTwitchEmoteSuggestions(e,this);if(t.chat.context.get("chat.tab-complete.ffz-emotes")){const i=t.getEmoteSuggestions(e,this);Array.isArray(i)&&i.length&&(n=n.concat(i))}if(t.chat.context.get("chat.tab-complete.emoji")){const i=t.getEmojiSuggestions(e,this);Array.isArray(i)&&i.length&&(n=Array.isArray(n)?n.concat(i):i)}return n=t.sortFavorites(n),i&&n.length>25?n.slice(0,25):n};const i=this.web_munch.getModule("react"),n=i&&i.createElement;e.renderFFZEmojiSuggestion=function(e){return n(i.Fragment,null,n("div",{class:"tw-relative tw-flex-shrink-0 tw-pd-05",title:e.token,favorite:e.favorite},n("img",{class:"emote-autocomplete-provider__image ffz-emoji",src:e.src,srcSet:e.srcset}),e.favorite&&n("figure",{class:"ffz--favorite ffz-i-star"})),n("div",{class:"tw-ellipsis",title:e.token},e.token))},e.renderEmoteSuggestion=function(e){return n(i.Fragment,null,n("div",{class:"tw-relative tw-flex-shrink-0 tw-pd-05",title:e.token,favorite:e.favorite},n("img",{class:"emote-autocomplete-provider__image",srcSet:e.srcSet}),e.favorite&&n("figure",{class:"ffz--favorite ffz-i-star"})),n("div",{class:"tw-ellipsis",title:e.token},e.token))}}sortFavorites(e){return this.chat.context.get("chat.tab-complete.prioritize-favorites")?e.sort((e,t)=>e.favorite?t.favorite?e.replacement.localeCompare(t.replacement):-1:t.favorite?1:void e.replacement.localeCompare(t.replacement)):e}getTwitchEmoteSuggestions(e,t){const i=t.hydrateEmotes(t.props.emotes);if(!Array.isArray(i))return[];const n=[],s=[],r=[],o=this.emotes.getFavorites("twitch"),a=e.startsWith(":")?e.slice(1):e;for(const l of i)if(l&&Array.isArray(l.emotes))for(const i of l.emotes)if(t.doesEmoteMatchTerm(i,a)){const l=o.includes(i.id),c={current:e,replacement:i.token,element:t.renderEmoteSuggestion(Object.assign({},i,{favorite:l})),favorite:l};this.EmoteUsageCount[i.token]?n.push(c):i.token.toLowerCase().startsWith(a)?s.push(c):r.push(c)}return n.sort((e,t)=>this.EmoteUsageCount[t.replacement]-this.EmoteUsageCount[e.replacement]),s.sort((e,t)=>e.replacement.localeCompare(t.replacement)),r.sort((e,t)=>e.replacement.localeCompare(t.replacement)),n.concat(s).concat(r)}getEmojiSuggestions(e,t){if(!e.startsWith(":"))return[];let i=e.slice(1).toLowerCase();const n=this.chat.context.get("chat.emoji.style"),s=this.settings.provider.get("emoji-tone",null),r=this.emotes.getFavorites("emoji"),o=[],a=i.endsWith(":");a&&(i=i.slice(0,-1));for(const l in this.emoji.names)if(a?l===i:l.startsWith(i)){const i=this.emoji.emoji[this.emoji.names[l]],a=i.variants&&i.variants[s]||i;if(i&&(0===n||a.has[n])){const s=r.includes(i.code);o.push({current:e,replacement:a.raw,element:t.renderFFZEmojiSuggestion({token:`:${l}:`,id:`emoji-${i.code}`,src:this.emoji.getFullImage(a.image,n),srcSet:this.emoji.getFullImageSet(a.image,n),favorite:s}),favorite:s})}}return o}getEmoteSuggestions(e,t){const i=t._ffz_user,n=t._ffz_channel_id,s=t._ffz_channel_login;if(!s){const e=this.fine.searchParent(t,"chat-input",50);if(e&&this.updateEmoteCompletion(e,t),!s)return[]}const r=e.startsWith(":")?e.slice(1):e,o=[],a=this.emotes.getSets(i&&i.id,i&&i.login,n,s),l=new Set;for(const i of a)if(i&&i.emotes)for(const n of Object.values(i.emotes))if(t.doesEmoteMatchTerm(n,r)&&!l.has(n.name)){const s=this.emotes.isFavorite(i.source||"ffz",n.id);o.push({current:e,replacement:n.name,element:t.renderEmoteSuggestion({token:n.name,id:`${i.source}-${n.id}`,srcSet:n.srcSet,favorite:s}),favorite:s}),l.add(n.name)}return o}pasteMessage(e,t){for(const r of this.ChatInput.instances){var i,n,s;if((null==r?void 0:null===(i=r.props)||void 0===i?void 0:i.channelLogin)===e){if(!r.autocompleteInputRef||!r.state)return;r.state.value&&(t=`${r.state.value} ${t}`),r.autocompleteInputRef.setValue(t),null===(n=r.autocompleteInputRef.componentRef)||void 0===n||null===(s=n.focus)||void 0===s||s.call(n)}}}}},function(e,t,i){"use strict";i.d(t,"a",(function(){return ViewerCards}));var n=i(3);class ViewerCards extends n.default{constructor(...e){super(...e),this.inject("chat"),this.inject("settings"),this.inject("site.css_tweaks"),this.inject("site.fine"),this.last_login=null,this.settings.add("chat.viewer-cards.highlight-chat",{default:!1,ui:{path:"Chat > Viewer Cards >> Appearance",title:"Highlight messages from users with open viewer cards.",component:"setting-check-box"}}),this.settings.add("chat.viewer-cards.color",{default:"",ui:{path:"Chat > Viewer Cards >> Appearance",title:"Highlight Color",component:"setting-color-box"}}),this.settings.add("chat.viewer-cards.use-color",{requires:["chat.viewer-cards.highlight-chat","chat.viewer-cards.color"],process(e){if(e.get("chat.viewer-cards.highlight-chat"))return e.get("chat.viewer-cards.color")}}),this.ViewerCard=this.fine.define("chat-viewer-card",e=>e.toggleGiftPage&&e.onWhisperButtonClick)}onEnable(){this.chat.context.on("changed:chat.viewer-cards.highlight-chat",this.refreshStyle,this),this.chat.context.on("changed:chat.viewer-cards.color",this.refreshStyle,this),this.on("..:update-colors",this.refreshStyle,this),this.ViewerCard.on("mount",this.updateCard,this),this.ViewerCard.on("update",this.updateCard,this),this.ViewerCard.on("unmount",this.unmountCard,this)}refreshStyle(){this.updateStyle(this.last_login)}updateStyle(e){if("string"==typeof e&&(e=e.toLowerCase()),this.last_login=e,e&&this.chat.context.get("chat.viewer-cards.highlight-chat")){let t=this.chat.context.get("chat.viewer-cards.color");t=t&&t.length?this.parent.inverse_colors.process(t):this.chat.context.get("theme.is-dark")?"rgba(0,80,255,0.2)":"rgba(128,170,255,0.2)",this.css_tweaks.set("viewer-card-highlight",`body .chat-list .chat-line__message:not(.chat-line--inline):nth-child(1n+0)[data-user="${e}"] {\n\tbackground-color: ${t} !important;\n}`)}else this.css_tweaks.delete("viewer-card-highlight")}updateCard(e){this.updateStyle(e.props&&e.props.targetLogin)}unmountCard(){this.updateStyle()}}},function(e,t,i){"use strict";i.d(t,"a",(function(){return Following}));var n=i(3),s=i(1),r=i(0),o=i(27),a=i(12);class Following extends n.SiteModule{constructor(...e){super(...e),this.inject("site.fine"),this.inject("site.router"),this.inject("site.apollo"),this.inject("site.css_tweaks"),this.inject("i18n"),this.inject("settings"),this.settings.add("directory.following.group-hosts",{default:!0,ui:{path:"Directory > Following >> Hosts",title:"Group Hosts",description:"Only show a given hosted channel once in the directory.",component:"setting-check-box"},changed:()=>{this.apollo.maybeRefetch("FollowedIndex_CurrentUser"),this.apollo.maybeRefetch("FollowingHosts_CurrentUser")}}),this.settings.add("directory.following.host-menus",{default:1,ui:{path:"Directory > Following >> Hosts",title:"Hosted Channel Menus",description:"Display a menu to select which channel to visit when clicking a hosted channel in the directory.",component:"setting-select-box",data:[{value:0,title:"Disabled"},{value:1,title:"When Multiple are Hosting"},{value:2,title:"Always"}]},changed:()=>this.parent.DirectoryCard.forceUpdate()}),this.hosts=new WeakMap}modifyLiveUsers(e,t="followedLiveUsers"){const i=Object(r.get)(`data.currentUser.${t}`,e);if(i)return i.nodes?i.nodes=this.parent.processNodes(i.nodes):i.edges&&(i.edges=this.parent.processNodes(i.edges)),e}modifyLiveHosts(e){const t=this.settings.provider.get("directory.game.blocked-games",[]),i=this.settings.get("directory.following.group-hosts"),n=Object(r.get)("data.currentUser.followedHosts.nodes",e);if(!n||!n.length)return e;this.hosts=new WeakMap;const s=[];for(const e of n){if(!e)continue;const n=e.node||e,r=n.hosting,o=r&&r.stream;if(!o||o.game&&t.includes(o.game.name))continue;if(!o.viewersCount){i&&this.hosts[r.login]||s.push(e);continue}const a=o.viewersCount=new Number(o.viewersCount||0);if(a.createdAt=o.createdAt,a.title=o.title,i){const t=this.hosts[r.login];t?(t.push(n),this.hosts.set(a,t)):(this.hosts.set(a,this.hosts[r.login]=[n]),s.push(e))}else s.push(e)}return e.data.currentUser.followedHosts.nodes=s,e}ensureQueries(){}onEnable(){this.ensureQueries(),document.body.addEventListener("click",this.destroyHostMenu.bind(this))}destroyHostMenu(e){(!e||!this.hostMenu||e&&e.target&&null===e.target.closest(".ffz-channel-selector-outer")&&Date.now()>this.hostMenuBuffer)&&(this.hostMenuPopper&&this.hostMenuPopper.destroy(),this.hostMenu&&this.hostMenu.remove(),this.hostMenuPopper=this.hostMenu=void 0)}showHostMenu(e,t,i){if(0===this.settings.get("directory.following.host-menus")||1===this.settings.get("directory.following.host-menus")&&t.length<2)return;i.preventDefault(),i.stopPropagation(),this.hostMenuPopper&&this.hostMenuPopper.destroy(),this.hostMenu&&this.hostMenu.remove();const n=[];n.push(Object(s.createElement)("p",{class:"tw-pd-t-05 tw-pd-x-1 tw-c-text-alt-2"},this.i18n.t("directory.hosted","Hosted Channel"))),n.push(Object(s.createElement)("a",{class:"tw-block tw-border-radius-small tw-full-width tw-interactable tw-interactable--alpha tw-interactive",href:`/${e.props.channelLogin}`,onClick:t=>this.parent.hijackUserClick(t,e.props.channelLogin,this.destroyHostMenu.bind(this))},Object(s.createElement)("div",{class:"tw-align-items-center tw-flex tw-flex-row tw-flex-nowrap tw-mg-x-1 tw-mg-y-05"},Object(s.createElement)("div",{class:"ffz-channel-avatar"},Object(s.createElement)("img",{src:e.props.channelImageProps.src,alt:e.props.channelDisplayName})),Object(s.createElement)("p",{class:"tw-ellipsis tw-flex-grow-1 tw-mg-l-1 tw-font-size-5"},e.props.channelDisplayName)))),n.push(Object(s.createElement)("p",{class:"tw-pd-t-05 tw-pd-x-1 tw-c-text-alt-2"},this.i18n.t("directory.hosting","Hosting Channels")));for(const e of t)n.push(Object(s.createElement)("a",{class:"tw-block tw-border-radius-small tw-full-width tw-interactable tw-interactable--alpha tw-interactive",href:`/${e.login}`,onClick:t=>this.parent.hijackUserClick(t,e.login,this.destroyHostMenu.bind(this))},Object(s.createElement)("div",{class:"tw-align-items-center tw-flex tw-flex-row tw-flex-nowrap tw-mg-x-1 tw-mg-y-05"},Object(s.createElement)("div",{class:"ffz-channel-avatar"},Object(s.createElement)("img",{src:e.profileImageURL,alt:e.displayName})),Object(s.createElement)("p",{class:"tw-ellipsis tw-flex-grow-1 tw-mg-l-1 tw-font-size-5"},e.displayName))));this.hostMenu=Object(s.createElement)("div",{class:"ffz-host-menu tw-balloon tw-block"},Object(s.createElement)("div",{class:"tw-border tw-elevation-1 tw-border-radius-small tw-c-background-base tw-pd-05"},Object(s.createElement)("div",{class:"scrollable-area","data-simplebar":!0},n))),(document.body.querySelector("#root>div")||document.body).appendChild(this.hostMenu),this.hostMenuPopper=new o.default(Object(a.makeReference)(i.clientX-60,i.clientY-60),this.hostMenu,{placement:"bottom-start",modifiers:{flip:{enabled:!1}}}),this.hostMenuBuffer=Date.now()+50}updateChannelCard(e){const t=this.fine.getChildNode(e);if(!t)return;const i=e.props.channelLogin;if(e.props.channelLinkTo&&"live_host"===e.props.channelLinkTo.state.content&&this.hosts&&this.hosts[i]&&this.settings.get("directory.following.group-hosts")){const n=this.hosts[i],s=t.querySelector('a[data-test-selector="preview-card-titles__primary-link"]'),r=t.querySelector('a[data-a-target="preview-card-image-link"]');s&&s.addEventListener("click",this.showHostMenu.bind(this,e,n)),r&&r.addEventListener("click",this.showHostMenu.bind(this,e,n))}}}},function(e,t,i){"use strict";i.d(t,"a",(function(){return Game}));var n=i(3),s=i(1),r=i(0);class Game extends n.SiteModule{constructor(...e){super(...e),this.inject("site.fine"),this.inject("site.apollo"),this.inject("i18n"),this.inject("settings"),this.GameHeader=this.fine.define("game-header",e=>e.props&&e.props.data&&e.getBannerImage&&e.getFollowButton,["dir-game-index","dir-community","dir-game-videos","dir-game-clips","dir-game-details"])}modifyStreams(e){const t=Object(r.get)("data.game.streams.edges",e);return t&&t.length?(e.data.game.streams.edges=this.parent.processNodes(t,!0),e):e}onEnable(){this.GameHeader.on("mount",this.updateGameHeader,this),this.GameHeader.on("update",this.updateGameHeader,this),this.GameHeader.on("unmount",()=>{this.settings.updateContext({category:null,categoryID:null})}),this.GameHeader.ready((e,t)=>{for(const e of t)this.updateGameHeader(e)})}updateGameHeader(e){var t,i;this.updateButtons(e);const n=null==e?void 0:null===(t=e.props)||void 0===t?void 0:null===(i=t.data)||void 0===i?void 0:i.game;this.settings.updateContext({category:null==n?void 0:n.name,categoryID:null==n?void 0:n.id})}updateButtons(e){const t=this.fine.getChildNode(e);if(null==Object(r.get)("data.game",e.props)||!t||!t.querySelector)return;const i=t.querySelector(".tw-flex > .tw-flex-column");if(!i)return;const n=i.querySelector(".ffz-directory-buttons");let o,a,l,c;n&&n.remove();const u=Object(r.get)("data.game.name",e.props)||e.props.directoryName,update_block=()=>{const e=this.settings.provider.get("directory.game.blocked-games",[]).includes(u);o.classList.toggle("active",e),a.textContent=e?this.i18n.t("directory.unblock","Unblock"):this.i18n.t("directory.block","Block")},update_hidden=()=>{const e=this.settings.provider.get("directory.game.hidden-thumbnails",[]).includes(u);l.classList.toggle("active",e),c.textContent=e?this.i18n.t("directory.show-thumbnails","Show Thumbnails"):this.i18n.t("directory.hide-thumbnails","Hide Thumbnails")};o=Object(s.createElement)("button",{class:"tw-mg-r-1 tw-button ffz-directory-toggle-block",onClick:this.generateClickHandler("directory.game.blocked-games",u,update_block)},a=Object(s.createElement)("span",{class:"tw-button__text"})),update_block(),l=Object(s.createElement)("button",{class:"tw-button ffz-directory-toggle-thumbnail",onClick:this.generateClickHandler("directory.game.hidden-thumbnails",u,update_hidden)},c=Object(s.createElement)("span",{class:"tw-button__text"})),update_hidden(),i.appendChild(Object(s.createElement)("div",{class:"tw-mg-t-1 ffz-directory-buttons"},o,l))}generateClickHandler(e,t,i){return n=>{n.preventDefault();const s=this.settings.provider.get(e)||[],r=s.indexOf(t);-1===r?s.push(t):s.splice(r,1),this.settings.provider.set(e,s),this.parent.DirectoryCard.forceUpdate(),i()}}}},function(e,t){var i={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"logins"}},type:{kind:"ListType",type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"users"},arguments:[{kind:"Argument",name:{kind:"Name",value:"logins"},value:{kind:"Variable",name:{kind:"Name",value:"logins"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"login"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"displayName"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"profileImageURL"},arguments:[{kind:"Argument",name:{kind:"Name",value:"width"},value:{kind:"IntValue",value:"50"}}],directives:[]},{kind:"Field",name:{kind:"Name",value:"self"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"follower"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"disableNotifications"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"followedAt"},arguments:[],directives:[]}]}}]}}]}}]}}],loc:{start:0,end:264}};i.loc.source={body:"query($logins: [String!]) {\n    users(logins: $logins) {\n        id\n\t\tlogin\n        displayName\n        profileImageURL(width: 50)\n        self {\n            follower {\n                disableNotifications\n                followedAt\n            }\n        }\n    }\n}",name:"GraphQL request",locationOffset:{line:1,column:1}};var n={};!function extractReferences(){i.definitions.forEach((function(e){if(e.name){var t=new Set;!function collectFragmentReferences(e,t){if("FragmentSpread"===e.kind)t.add(e.name.value);else if("VariableDefinition"===e.kind){var i=e.type;"NamedType"===i.kind&&t.add(i.name.value)}e.selectionSet&&e.selectionSet.selections.forEach((function(e){collectFragmentReferences(e,t)})),e.variableDefinitions&&e.variableDefinitions.forEach((function(e){collectFragmentReferences(e,t)})),e.definitions&&e.definitions.forEach((function(e){collectFragmentReferences(e,t)}))}(e,t),n[e.name.value]=t}}))}(),e.exports=i},function(e,t){var i={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"targetID"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"unfollowUser"},arguments:[{kind:"Argument",name:{kind:"Name",value:"input"},value:{kind:"ObjectValue",fields:[{kind:"ObjectField",name:{kind:"Name",value:"targetID"},value:{kind:"Variable",name:{kind:"Name",value:"targetID"}}}]}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"follow"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"followedAt"},arguments:[],directives:[]}]}}]}}]}}],loc:{start:0,end:123}};i.loc.source={body:"mutation($targetID: ID!) {\n  unfollowUser(input: {\n    targetID: $targetID\n  }) {\n    follow {\n      followedAt\n    }\n  }\n}",name:"GraphQL request",locationOffset:{line:1,column:1}};var n={};!function extractReferences(){i.definitions.forEach((function(e){if(e.name){var t=new Set;!function collectFragmentReferences(e,t){if("FragmentSpread"===e.kind)t.add(e.name.value);else if("VariableDefinition"===e.kind){var i=e.type;"NamedType"===i.kind&&t.add(i.name.value)}e.selectionSet&&e.selectionSet.selections.forEach((function(e){collectFragmentReferences(e,t)})),e.variableDefinitions&&e.variableDefinitions.forEach((function(e){collectFragmentReferences(e,t)})),e.definitions&&e.definitions.forEach((function(e){collectFragmentReferences(e,t)}))}(e,t),n[e.name.value]=t}}))}(),e.exports=i},function(e,t,i){e.exports=i.p+"theme.ddbc2ca56b8c43283c3baefd2b3e45e1.css"},function(e,t,i){e.exports=i.p+"color_normalizer.9bcff0e4b35c13679f25421c907b8856.css"},function(e,t,i){"use strict";i.d(t,"a",(function(){return WebMunch}));var n=i(3),s=i(0);let r=0;class WebMunch extends n.default{constructor(...e){super(...e),this._id=`_ffz$${r++}`,this._rid=0,this._original_loader=null,this._known_rules={},this._require=null,this._module_names={},this._mod_cache={},this.v4=null,this.hookLoader(),this.hookRequire()}hookLoader(e=0){if(this._original_loader)return this.log.warn("Attempted to call hookLoader twice.");if(!window.webpackJsonp)return e>500?this.log.error("Unable to find webpack's loader after two minutes."):setTimeout(this.hookLoader.bind(this,e+1),250);if("function"==typeof window.webpackJsonp){this.v4=!1,this._original_loader=window.webpackJsonp;try{window.webpackJsonp=this.webpackJsonpv3.bind(this)}catch(e){return void this.log.warn("Unable to wrap webpackJsonp due to write protection.")}}else{if(!Array.isArray(window.webpackJsonp))return void this.log.error("webpackJsonp is of an unknown value. Unable to wrap.");this.v4=!0,this._original_loader=window.webpackJsonp.push;for(const e of window.webpackJsonp)e&&e[1]&&this.processModulesV4(e[1]);try{window.webpackJsonp.push=this.webpackJsonpv4.bind(this)}catch(e){return void this.log.warn("Unable to wrap webpackJsonp (v4) due to write protection.")}}this.log.info(`Found and wrapped webpack's loader after ${250*(e||0)}ms.`)}webpackJsonpv3(e,t){const i=e.map(e=>this._module_names[e]||e).join(", ");this.log.info(`Twitch Chunk Loaded: ${e} (${i})`),this.log.debug(`Modules: ${Object.keys(t)}`);const n=this._original_loader.apply(window,arguments);return this.emit(":loaded",e,i,t),n}processModulesV4(e){const t=this;for(const i in e)if(Object(s.has)(e,i)){const n=e[i];e[i]=function(e,s,r,...o){if(!t._require&&"function"==typeof r&&(t.log.info(`require() grabbed from invocation of module ${i}`),t._require=r,t._resolve_require)){try{for(const e of t._resolve_require)e(r)}catch(e){t.log.error("An error occured running require callbacks.",e)}t._resolve_require=null}return n.call(this,e,s,r,...o)}}}webpackJsonpv4(e){const t=e[0],i=e[1],n=Array.isArray(t)&&t.map(e=>this._module_names[e]||e).join(", ");this.log.info(`Twitch Chunk Loaded: ${t} (${n})`),this.log.debug(`Modules: ${Object.keys(i)}`),i&&this.processModulesV4(i);const s=this._original_loader.apply(window.webpackJsonp,arguments);return this.emit(":loaded",t,n,i),s}known(e,t){if("object"!=typeof e)this._known_rules[e]=t;else for(const t in e)Object(s.has)(e,t)&&this.known(t,e[t])}async findModule(e,t){return this._require||await this.getRequire(),this.getModule(e,t)}getModule(e,t){if("function"==typeof e&&(t=e,e=null),e&&this._mod_cache[e])return this._mod_cache[e];const i=this._require;if(!i||!i.c)return null;if(t||(t=this._known_rules[e]),!t)throw new Error(`no known predicate for locating ${e}`);for(const n in i.c)if(Object(s.has)(i.c,n)){const s=i.c[n],r=s&&s.exports;if(r&&t(r))return e&&(this._mod_cache[e]=r),r}}getRequire(e=0){return this._require?Promise.resolve(this._require):new Promise((t,i)=>{const n=this._original_loader;if(!n)return e>500&&i(new Error("unable to find webpackJsonp")),setTimeout(()=>this.getRequire(e++).then(t),250);if(this.v4)this._resolve_require?this._resolve_require.push(t):this._resolve_require=[t];else{const e=`${this._id}$${this._rid++}`;n([],{[e]:(e,i,n)=>{t(this._require=n)}},[e])}})}async hookRequire(){const e=performance.now(),t=await this.getRequire(),i=performance.now()-e;this.log.info(`require() grabbed in ${i.toFixed(5)}ms.`);const n=t.e&&t.e.toString();let s;if(n&&-1!==n.indexOf("Loading chunk")){const e=this.v4?/assets\/"\+\(({1:.*?})/.exec(n):/({0:.*?})/.exec(n);if(e)try{s=JSON.parse(e[1].replace(/(\d+):/g,'"$1":'))}catch(e){}}s?(this._module_names=s,this.log.info(`Loaded names for ${Object.keys(s).length} chunks from require().`)):this.log.warn("Unable to find chunk names in require().")}}},function(e,t,i){"use strict";i.d(t,"a",(function(){return Fine}));var n=i(5),s=i(3);class Fine extends s.default{constructor(...e){super(...e),this._wrappers=new Map,this._known_classes=new Map,this._observer=null,this._waiting=[],this._live_waiting=null}async onEnable(e=0){if(this.root_element||(this.root_element=await this.parent.awaitElement(this.selector||"body #root")),!this.root_element||!this.root_element._reactRootContainer){if(e>500)throw new Error("Unable to find React after 25 seconds");return this.root_element=null,new Promise(e=>setTimeout(e,50)).then(()=>this.onEnable(e+1))}this.react_root=this.root_element._reactRootContainer,this.react_root._internalRoot&&this.react_root._internalRoot.current&&(this.react_root=this.react_root._internalRoot),this.react=this.react_root.current.child}onDisable(){this.react_root=this.root_element=this.react=this.accessor=null}static findAccessor(e){for(const t in e)if(t.startsWith("__reactInternalInstance$"))return t}getReactInstance(e){if(this.accessor||(this.accessor=Fine.findAccessor(e)),this.accessor)return e[this.accessor]||e._reactRootContainer&&e._reactRootContainer._internalRoot&&e._reactRootContainer._internalRoot.current||e._reactRootContainer&&e._reactRootContainer.current}getOwner(e){return e._reactInternalFiber?e=e._reactInternalFiber:e instanceof Node&&(e=this.getReactInstance(e)),e?e.return:null}getParentNode(e,t=100,i=!1){return this.searchParent(e,e=>e instanceof Node,t,0,i)}getChildNode(e,t=100,i=!1){return this.searchTree(e,e=>e instanceof Node,t,0,i)}getHostNode(e,t=100){return this.getChildNode(e,t)}getParent(e){return this.getOwner(e)}getFirstChild(e){return e._reactInternalFiber?e=e._reactInternalFiber:e instanceof Node&&(e=this.getReactInstance(e)),e?e.child:null}getChildren(e){if(e._reactInternalFiber?e=e._reactInternalFiber:e instanceof Node&&(e=this.getReactInstance(e)),!e)return null;const t=[];let i=e.child;for(;i;)t.push(i),i=i.sibling;return t}searchParent(e,t,i=15,n=0,s=!0){if(e._reactInternalFiber?e=e._reactInternalFiber:e instanceof Node&&(e=this.getReactInstance(e)),!e||e._ffz_no_scan||n>i)return null;if("string"==typeof t){const e=this._wrappers.get(t);if(!e)throw new Error("invalid critera");if(!e._class)return null;t=t=>t&&t.constructor===e._class}const r=e.stateNode;if(r&&t(r))return r;if(e.return){const r=this.searchParent(e.return,t,i,n+1,s);if(r)return r}if(s&&r&&r.containerInfo){const e=r.containerInfo.parentElement,o=e&&this.getReactInstance(e);if(o){const e=this.searchParent(o,t,i,n+1,s);if(e)return e}}return null}searchTree(e,t,i=15,n=0,s=!0){if(e?e._reactInternalFiber?e=e._reactInternalFiber:e instanceof Node&&(e=this.getReactInstance(e)):e=this.react,!e||e._ffz_no_scan||n>i)return null;if("string"==typeof t){const e=this._wrappers.get(t);if(!e)throw new Error("invalid critera");if(!e._class)return null;t=t=>t&&t.constructor===e._class}const r=e.stateNode;if(r&&t(r))return r;if(e.child){let r=e.child;for(;r;){const e=this.searchTree(r,t,i,n+1,s);if(e)return e;r=r.sibling}}if(s&&r&&r.props&&r.props.root){const e=r.props.root._reactRootContainer;if(e){let r=e._internalRoot&&e._internalRoot.current||e.current;for(;r;){const e=this.searchTree(r,t,i,n+1,s);if(e)return e;r=r.sibling}}}}findAllMatching(e,t,i=15,n=!0,s=!1,r=0,o=!0){const a=new Set;let crit=e=>!a.has(e)&&t(e);for(;;){const l=s?this.searchParent(e,crit,i,r,o):this.searchTree(e,crit,i,r,o);if(!l)break;if(n&&!a.size){const e=l.constructor;crit=i=>!a.has(i)&&i instanceof e&&t(i)}a.add(l)}return a}searchAll(e,t,i=15,n=0,s,r=!0){if(e?e._reactInternalFiber?e=e._reactInternalFiber:e instanceof Node&&(e=this.getReactInstance(e)):e=this.react,s||(s={seen:new Set,classes:t.map(()=>null),out:t.map(()=>({cls:null,instances:new Set,depth:null})),max_depth:n}),!e||e._ffz_no_scan||n>i)return s.out;n>s.max_depth&&(s.max_depth=n);const o=e.stateNode;if(o){const e=o.constructor,i=s.classes.indexOf(e);if(-1!==i)s.out[i].instances.add(o);else if(!s.seen.has(e)){let i=t.length;for(;i-- >0;)if(t[i](o)){s.classes[i]=s.out[i].cls=e,s.out[i].instances.add(o),s.out[i].depth=n;break}s.seen.add(e)}}let a=e.child;for(;a;)this.searchAll(a,t,i,n+1,s,r),a=a.sibling;if(r&&o&&o.props&&o.props.root){const e=o.props.root._reactRootContainer;if(e){let o=e._internalRoot&&e._internalRoot.current||e.current;for(;o;)this.searchAll(o,t,i,n+1,s,r),o=o.sibling}}return s.out}route(e){this._route=e,this._updateLiveWaiting()}_updateLiveWaiting(){const e=this._live_waiting=[],t=this._waiting_crit=[],i=this._route;if(this._waiting)for(const n of this._waiting)i&&n.routes.length&&!n.routes.includes(i)||(e.push(n),t.push(n.criteria));this._live_waiting.length?this._waiting_timer||this._startWaiting():this._stopWaiting()}define(e,t,i){if(this._wrappers.has(e))return this._wrappers.get(e);if(!t)throw new Error("cannot find definition and no criteria provided");const n=new FineWrapper(e,t,i,this);this._wrappers.set(e,n);const s=this.searchAll(this.react,[t],1e3)[0];return s.cls?(n._set(s.cls,s.instances),this._known_classes.set(s.cls,n)):!1!==i&&(this._waiting.push(n),this._updateLiveWaiting()),n}wrap(e,t){let i;if(this._wrappers.has(e)?i=this._wrappers.get(e):(i=new FineWrapper(e,null,void 0,this),this._wrappers.set(e,i)),t){if(i._class||i.criteria)throw new Error("tried setting a class on an already initialized FineWrapper");i._set(t,new Set),this._known_classes.set(t,i)}return i}_checkWaiters(e){if(this._live_waiting){Array.isArray(e)||(e=[e]);for(let t of e){if(t?t._reactInternalFiber?t=t._reactInternalFiber:t instanceof Node&&(t=this.getReactInstance(t)):t=this.react,!t||t._ffz_no_scan||!this._live_waiting.length)continue;const e=this.searchAll(t,this._waiting_crit,1e3);let i=e.length;for(;i-- >0;)if(e[i].cls){const t=e[i],n=this._live_waiting.splice(i,1)[0];this._waiting_crit.splice(i,1);const s=this._waiting.indexOf(n);-1!==s&&this._waiting.splice(s,1),this.log.info(`Found class for "${n.name}" at depth ${t.depth}`),n._set(t.cls,t.instances)}}this._live_waiting.length||this._stopWaiting()}}_startWaiting(){this.log.info("Installing MutationObserver."),this._waiting_timer=setInterval(()=>this._checkWaiters(),500),this._observer||(this._observer=new MutationObserver(e=>this._checkWaiters(e.map(e=>e.target)))),this._observer.observe(document.body,{childList:!0,subtree:!0})}_stopWaiting(){this.log.info("Stopping MutationObserver."),this._observer&&this._observer.disconnect(),this._waiting_timer&&clearInterval(this._waiting_timer),this._live_waiting=null,this._waiting_crit=null,this._waiting_timer=null}}const r={"will-mount":"UNSAFE_componentWillMount",mount:"componentDidMount",render:"render","receive-props":"UNSAFE_componentWillReceiveProps","should-update":"shouldComponentUpdate","will-update":"UNSAFE_componentWillUpdate",update:"componentDidUpdate",unmount:"componentWillUnmount"};class FineWrapper extends n.EventEmitter{constructor(e,t,i,n){super(),this.name=e,this.criteria=t,this.fine=n,this.instances=new Set,this.routes=i||[],this._wrapped=new Set,this._class=null}get first(){return this.toArray()[0]}toArray(){return Array.from(this.instances)}check(e=null,t=1e3){if(this._class)return;const i=this.fine.findAllMatching(e,this.criteria,t);if(i.size){const e=Array.from(i);this._set(e[0].constructor,e)}}ready(e){this._class?e(this._class,this.instances):this.once("set",e)}_set(e,t){if(this._class)throw new Error("already have a class");this._class=e,this._wrapped.add("UNSAFE_componentWillMount"),this._wrapped.add("componentWillUnmount");const i=this,n=this.instances,s=e.prototype,r=s.UNSAFE_componentWillMount,o=s.componentWillUnmount,a=s.UNSAFE_componentWillMount=r?function(...e){return this._ffz_mounted=!0,n.add(this),i.emit("will-mount",this,...e),r.apply(this,e)}:function(...e){this._ffz_mounted=!0,n.add(this),i.emit("will-mount",this,...e)},l=s.componentWillUnmount=o?function(...e){return i.emit("unmount",this,...e),n.delete(this),this._ffz_mounted=!1,o.apply(this,e)}:function(...e){i.emit("unmount",this,...e),n.delete(this),this._ffz_mounted=!1};this.__UNSAFE_componentWillMount=[a,r],this.__componentWillUnmount=[l,o];for(const e of this.events())this._maybeWrap(e);if(t)for(const e of t)e._ffz_mounted=!0,n.add(e);this.emit("set",e,n)}_add(e){for(const t of e)this.instances.add(t)}_maybeWrap(e){const t=r[e];this._class&&t&&!this._wrapped.has(t)&&this._wrap(e,t)}_wrap(e,t){if(this._wrapped.has(t))return;const i=this,n=this._class.prototype,s=n[t],r=n[t]=s?function(...t){return this._ffz_mounted||(this._ffz_mounted=!0,i.instances.add(this),i.emit("late-mount",this)),i.emit(e,this,...t),s.apply(this,t)}:"shouldComponentUpdate"===t?function(...t){return this._ffz_mounted||(this._ffz_mounted=!0,i.instances.add(this),i.emit("late-mount",this)),i.emit(e,this,...t),!0}:function(...t){this._ffz_mounted||(this._ffz_mounted=!0,i.instances.add(this),i.emit("late-mount",this)),i.emit(e,this,...t)};this[`__${t}`]=[r,s]}_unwrap(e){if(!this._wrapped.has(e))return;const t=`__${e}`,i=this._class.prototype,[n,s]=this[t];if(i[e]!==n)throw new Error("unable to unwrap -- prototype modified");i[e]=s,this[t]=void 0,this._wrapped.delete(e)}forceUpdate(){for(const e of this.instances)try{e.forceUpdate(),this.fine.emit("site:dom-update",this.name,e)}catch(e){this.fine.log.capture(e,{tags:{fine_wrapper:this.name}}),this.fine.log.error(`An error occurred when calling forceUpdate on an instance of ${this.name}`,e)}}on(e,t,i){return this._maybeWrap(e),super.on(e,t,i)}prependOn(e,t,i){return this._maybeWrap(e),super.prependOn(e,t,i)}once(e,t,i){return this._maybeWrap(e),super.once(e,t,i)}prependOnce(e,t,i){return this._maybeWrap(e),super.prependOnce(e,t,i)}many(e,t,i,n){return this._maybeWrap(e),super.many(e,t,i,n)}prependMany(e,t,i,n){return this._maybeWrap(e),super.prependMany(e,t,i,n)}waitFor(e){return this._maybeWrap(e),super.waitFor(e)}}},function(e,t,i){"use strict";i.d(t,"a",(function(){return FineRouter}));var n=i(28),s=i(3),r=i(0);class FineRouter extends s.default{constructor(...e){super(...e),this.inject("..fine"),this.__routes=[],this.routes={},this.route_names={},this.current=null,this.current_name=null,this.match=null,this.location=null}onEnable(){const e=this.fine.searchTree(null,e=>e.props&&e.props.history),t=this.history=e&&e.props&&e.props.history;if(!t)return new Promise(e=>setTimeout(e,50)).then(()=>this.onEnable());t.listen(e=>{this.enabled&&this._navigateTo(e)}),this._navigateTo(t.location)}navigate(e,t,i){this.history.push(this.getURL(e,t,i))}_navigateTo(e){this.log.debug("New Location",e);const t=window.location.host,i=e.pathname;i===this.location&&t===this.domain||(this.location=i,this.domain=t,this._pickRoute())}_pickRoute(){const e=this.location,t=this.domain;for(const i of this.__routes){if(i.domain&&i.domain!==t)continue;const n=i.regex.exec(e);if(n)return this.log.debug("Matching Route",i,n),this.current=i,this.current_name=i.name,this.match=n,this.emit(":route",i,n),void this.emit(`:route:${i.name}`,...n)}this.current=this.current_name=this.match=null,this.emit(":route",null,null)}getURL(e,t,i,...n){const s=this.routes[e];if(!s)throw new Error(`unable to find route "${e}"`);if("object"!=typeof t){const e=[t,i,...n];t={};let r=0;for(const i of s.parts)if(i&&i.name&&(t[i.name]=e[r],r++,r>=e.length))break}return s.url(t,i)}getRoute(e){return this.routes[e]}getRoutes(){return this.routes}getRouteNames(){for(const e of Object.keys(this.getRoutes()))this.getRouteName(e);return this.route_names}getRouteName(e){return this.route_names[e]||(this.route_names[e]=e.replace(/^dash-([a-z])/,(e,t)=>`Dashboard: ${t.toLocaleUpperCase()}`).replace(/(^|-)([a-z])/g,(e,t,i)=>`${t?" ":""}${i.toLocaleUpperCase()}`)),this.route_names[e]}routeName(e,t,i=!0){if("object"!=typeof e)this.route_names[e]=t,i&&this.emit(":updated-route-names");else{for(const t in e)Object(r.has)(e,t)&&this.routeName(t,e[t],!1);i&&this.emit(":updated-route-names")}}route(e,t,i=null,s=!0){if("object"==typeof e){i=t;for(const t in e)Object(r.has)(e,t)&&this.route(t,e[t],i,!1);return void(s&&(this.__routes.sort((e,t)=>t.score-e.score),this.location&&this._pickRoute(),this.emit(":updated-routes")))}const o=Object(n.parse)(t),a=o.reduce((e,t)=>e+("string"==typeof t?t.split("/").length-1:0),0),l=this.routes[e]={name:e,parts:o,score:a,domain:i,regex:Object(n.tokensToRegExp)(o),url:Object(n.tokensToFunction)(o)};this.__routes.push(l),s&&(this.__routes.sort((e,t)=>t.score-e.score),this.location&&this._pickRoute(),this.emit(":updated-routes"))}}},function(e,t,i){"use strict";i.d(t,"a",(function(){return Apollo}));var n=i(3),s=i(0),r=i(91);Error;class Apollo extends n.default{constructor(...e){super(...e),this.modifiers={},this.post_modifiers={},this.inject("..web_munch"),this.inject("..fine")}async onEnable(){let e=this.client;if(!e){var t,i;const n=this.fine.react,s=n&&n.stateNode;e=this.client=(null==s?void 0:null===(t=s.props)||void 0===t?void 0:t.client)||(null==n?void 0:null===(i=n.memoizedProps)||void 0===i?void 0:i.client),n&&!e&&(e=this.fine.searchTree(null,e=>{var t,i;return null===(t=e.props)||void 0===t?void 0:null===(i=t.client)||void 0===i?void 0:i.queryManager},500))}if(!e)return new Promise(()=>this.onEnable(),50);if(this.printer=await this.web_munch.findModule("gql-printer"),this.gql_print=this.printer&&this.printer.print,!this.client.link||!this.client.queryManager||!this.client.queryManager.link)return void this.log.error("Apollo does not have a Link. We are unable to manipulate queries.");this.hooked_query_init=!1;const n=this,r=this.client.queryManager.constructor.prototype,o=r.getCurrentQueryResult;if(r.getCurrentQueryResult=function(e,t=!0){const i=o.call(this,e,t);if(i&&i.partial)try{try{const i=e.getLastResult(),n=e.options;this.dataStore.getCache().read({query:n.query,variables:n.variables,previousResult:i?i.data:void 0,optimistic:t})}catch(t){if(t.toString().includes("Can't find field")&&e.lastResult&&!e.lastResult.loading&&!e.lastError&&Date.now()-(e._ffz_last_retry||0)>=12e4){const t=Object(s.get)("options.query.definitions.0.name",e),i=t&&"Name"===t.kind?t.value:`#${e.queryId}`;n.log.info("Forcing query to refetch due to missing field:",i),e._ffz_last_retry=Date.now(),e.refetch()}}}catch(e){n.log.capture(e)}return i},this.client.queryManager.queryStore){const e=this.client.queryManager.queryStore.initQuery;this.hooked_query_init=!0,this.client.queryManager.queryStore.initQuery=function(t){const i=this.store[t.queryId];return i&&i.queryString!==t.queryString&&(i.queryString=t.queryString),e.call(this,t)}}const a=this.ApolloLink=this.client.link.constructor;this.link=new a((e,t)=>{if(!this.enabled)return t(e);let i=e.variables;Object.keys(i).length||(i=void 0);try{this.hooked_query_init&&this.apolloPreFlight(e)}catch(n){return this.log.capture(n,{tags:{operation:e.operationName},extra:{variables:i}}),this.log.error("Error running Pre-Flight",n,e),t(e)}return t(e).map(t=>{t.extensions&&t.extensions.operationName===e.operationName&&this.log.crumb({level:"info",category:"gql",message:`${e.operationName} [${t.extensions&&t.extensions.durationMilliseconds||"??"}ms]`,data:{variables:i}});try{this.apolloPostFlight(t)}catch(n){this.log.capture(n,{tags:{operation:e.operationName},extra:{variables:i}}),this.log.error("Error running Post-Flight",n,t)}return t})}),this.old_link=this.client.link,this.old_qm_link=this.client.queryManager.link,this.client.link=a.from([this.link,this.old_link]),this.client.queryManager.link=a.from([this.link,this.old_qm_link])}onDisable(){this.client=this.printer=this.gql_print=this.old_link=this.old_qm_dedup=this.old_qm_link=null}apolloPreFlight(e){const t=e.operationName,i=this.client.queryManager,n=i&&i.queryIdsByName,s=i&&i.queries,r=n&&n[t],o=Array.isArray(r)?r[0]:r,a=s&&s.get(o),l=this.modifiers[t];if(l)for(const t of l)"function"==typeof t?t(e):t[1]&&this.applyModifier(e,t[1]);this.emit(`:request.${t}`,e.query,e.variables);const c=this.client.queryManager.queryStore.store[o],u=this.gql_print&&this.gql_print(e.query);c&&(u?(c.queryString=u,e.query.loc.source.body=u,e.query.loc.end=u.length,a&&(a.document=e.query,a.observableQuery&&a.observableQuery.options&&(a.observableQuery.options.query=e.query))):(this.log.info("Unable to find GQL Print. Clearing store for query:",t),this.client.queryManager.queryStore.store[o]=null))}apolloPostFlight(e){const t=e.extensions.operationName,i=this.post_modifiers[t];if(i)for(const t of i)t(e);this.emit(`:response.${t}`,e.data)}applyModifier(e,t){e.query=Object(r.default)(e.query,t)}registerModifier(e,t,i=!0){if("function"!=typeof t){if(!i)throw new Error("post modifiers must be functions");t=[t,t]}(i?this.modifiers[e]=this.modifiers[e]||[]:this.post_modifiers[e]=this.post_modifiers[e]||[]).push(t)}unregisterModifier(e,t,i=!0){const n=i?this.modifiers[e]:this.post_modifiers[e];if(n){if("function"!=typeof t)throw new Error("graphql modifiers cannot be removed");for(let e=0;e<n.length;e++){const i=n[e];if("function"==typeof i?i===t:i[0]===t)return void n.splice(e,1)}}}getQuery(e){const t=this.client.queryManager,i=t&&t.queryIdsByName,n=t&&t.queries,s=i&&i[e],r=n&&s&&n.get(Array.isArray(s)?s[0]:s);return n||this.warn_qm||(this.log.error("Unable to find the Apollo query map. We cannot access data properly."),this.warn_qm=!0),r&&r.observableQuery}maybeRefetch(e){const t=this.getQuery(e);t&&t.lastResult&&!t.lastResult.stale&&t.refetch()}ensureQuery(e,t,i=500,n=12e4){const r=this.getQuery(e);if(r){const e=r.lastResult;let o;o=!!e&&(!!e.loading||("function"==typeof t?t(e):void 0!==Object(s.get)(t,e))),!o&&Date.now()-(r._ffz_last_retry||0)>=n&&(r._ffz_last_retry=Date.now(),r.options.query=Object.assign({},r.options.query),0===i?r.refetch():i>0&&setTimeout(()=>{r.refetch()},i))}return r}getFromQuery(e,t,i=500,n=12e4){const r=this.getQuery(e),o=r&&r.lastResult;if(!r)return;let a;return o&&(a="function"==typeof t?t(o):Object(s.get)(t,o),o.loading)?void 0:(void 0===a&&Date.now()-(r._ffz_last_retry||0)>=n&&(r._ffz_last_retry=Date.now(),r.options.query=Object.assign({},r.options.query),0===i?r.refetch():i>0&&setTimeout(()=>r.refetch(),i)),a)}}},function(e,t,i){"use strict";i.d(t,"a",(function(){return TwitchData}));var n=i(3),s=i(0);const r=/^auto___lang_(\w+)$/,o={bg:"bg-bg",cs:"cs-cz",da:"da-dk",de:"de-de",el:"el-gr",en:"en-us",es:"es-es","es-mx":"es-mx",fi:"fi-fi",fr:"fr-fr",hu:"hu-hu",it:"it-it",ja:"ja-jp",ko:"ko-kr",nl:"nl-nl",no:"no-no",pl:"pl-pl","pt-br":"pt-br",pt:"pt-pt",ro:"ro-ro",ru:"ru-ru",sk:"sk-sk",sv:"sv-se",th:"th-th",tr:"tr-tr",vi:"vi-vn","zh-cn":"zh-cn","zh-tw":"zh-tw"};class TwitchData extends n.default{constructor(...e){super(...e),this.site=this.parent,this.inject("site.apollo"),this.inject("site.web_munch"),this._waiting_stream_ids=new Map,this._waiting_stream_logins=new Map,this.tag_cache=new Map,this._waiting_tags=new Map,this._loadTags=Object(s.debounce)(this._loadTags,50),this._loadStreams=Object(s.debounce)(this._loadStreams,50)}queryApollo(e,t,i){let n;return t||i||!e.query?(n={query:e,variables:t},i&&(n=Object.assign(n,i))):n=e,this.apollo.client.query(n)}mutate(e,t,i){let n;return t||i||!e.mutation?(n={mutation:e,variables:t},i&&(n=Object.assign(n,i))):n=e,this.apollo.client.mutate(n)}get languageCode(){const e=this.site.getSession();return e&&e.languageCode||"en"}get locale(){const e=this.site.getSession();return e&&e.locale||"en-US"}get searchClient(){if(this._search)return this._search;const e=this.apollo.client,t=this.site.getCore(),i=this.web_munch.getModule("algolia-search"),n=i&&i.a;return n&&e&&t?(this._search=new n({appId:t.config.algoliaApplicationID,apiKey:t.config.algoliaAPIKey,apolloClient:e,logger:t.logger,config:t.config,stats:t.stats}),this._search):null}async getMatchingCategories(e){const t=await this.queryApollo(await i.e(139).then(i.t.bind(null,309,7)),{query:e});return{cursor:Object(s.get)("data.searchFor.games.cursor",t),items:Object(s.get)("data.searchFor.games.items",t)||[],finished:!Object(s.get)("data.searchFor.games.pageInfo.hasNextPage",t)}}async getCategory(e,t){const n=await this.queryApollo(await i.e(139).then(i.t.bind(null,310,7)),{id:e,name:t});return Object(s.get)("data.game",n)}async getMatchingUsers(e){const t=await this.queryApollo(await i.e(139).then(i.t.bind(null,311,7)),{query:e});return{cursor:Object(s.get)("data.searchFor.users.cursor",t),items:Object(s.get)("data.searchFor.users.items",t)||[],finished:!Object(s.get)("data.searchFor.users.pageInfo.hasNextPage",t)}}async getUser(e,t){const n=await this.queryApollo(await i.e(139).then(i.t.bind(null,312,7)),{id:e,login:t});return Object(s.get)("data.user",n)}async getUserSelf(e,t){const n=await this.queryApollo(await i.e(139).then(i.t.bind(null,313,7)),{id:e,login:t});return Object(s.get)("data.user.self",n)}async getLastBroadcast(e,t){const n=await this.queryApollo(await i.e(139).then(i.t.bind(null,314,7)),{id:e,login:t});return Object(s.get)("data.user.lastBroadcast",n)}async getBroadcastID(e,t){const n=await this.queryApollo({query:await i.e(139).then(i.t.bind(null,315,7)),variables:{id:e,login:t}});return Object(s.get)("data.user.stream.archiveVideo.id",n)}async getPoll(e){const t=await this.queryApollo({query:await i.e(139).then(i.t.bind(null,316,7)),variables:{id:e}});return Object(s.get)("data.poll",t)}async createPoll(e,t,n,r={}){if("string"!=typeof t)throw new TypeError("title must be string");if(!Array.isArray(n)||n.some(e=>"string"!=typeof e))throw new TypeError("choices must be array of strings");let o=r.bits||0,a=r.duration||60;("number"!=typeof o||o<0)&&(o=0),("number"!=typeof a||a<0)&&(a=60);const l=await this.mutate({mutation:await i.e(139).then(i.t.bind(null,317,7)),variables:{input:{bitsCost:o,bitsVoting:o>0,choices:n.map(e=>({title:e})),durationSeconds:a,ownedBy:`${e}`,subscriberMultiplier:r.subscriberMultiplier||!1,subscriberOnly:r.subscriberOnly||!1,title:t}}});return Object(s.get)("data.createPoll.poll",l)}async archivePoll(e){const t=await this.mutate({mutation:await i.e(139).then(i.t.bind(null,318,7)),variables:{id:e}});return Object(s.get)("data.archivePoll.poll",t)}async terminatePoll(e){const t=await this.mutate({mutation:await i.e(139).then(i.t.bind(null,319,7)),variables:{id:e}});return Object(s.get)("data.terminatePoll.poll",t)}getStreamMeta(e,t){return new Promise((i,n)=>{e?this._waiting_stream_ids.has(e)?this._waiting_stream_ids.get(e).push([i,n]):this._waiting_stream_ids.set(e,[[i,n]]):t?this._waiting_stream_logins.has(t)?this._waiting_stream_logins.get(t).push([i,n]):this._waiting_stream_logins.set(t,[[i,n]]):n("id and login cannot both be null"),this._loading_streams||this._loadStreams()})}async _loadStreams(){if(this._loading_streams)return;this._loading_streams=!0;const e=[...this._waiting_stream_ids.keys()].slice(0,50),t=50-e.length,n=t>0?[...this._waiting_stream_logins.keys()].slice(0,t):[];let r;try{const t=await this.queryApollo({query:await i.e(139).then(i.t.bind(null,320,7)),variables:{ids:e.length?e:null,logins:n.length?n:null}});r=Object(s.get)("data.users",t)}catch(t){for(const i of e){const e=this._waiting_stream_ids.get(i);this._waiting_stream_ids.delete(i);for(const i of e)i[1](t)}for(const e of n){const i=this._waiting_stream_logins.get(e);this._waiting_stream_logins.delete(e);for(const e of i)e[1](t)}return}const o=new Set(e),a=new Set(n);if(Array.isArray(r))for(const e of r){if(!e||!e.id)continue;o.delete(e.id),a.delete(e.login);let t=this._waiting_stream_ids.get(e.id);if(t){this._waiting_stream_ids.delete(e.id);for(const i of t)i[0](e.stream)}if(t=this._waiting_stream_logins.get(e.login),t){this._waiting_stream_logins.delete(e.login);for(const i of t)i[0](e.stream)}}for(const e of o){const t=this._waiting_stream_ids.get(e);if(t){this._waiting_stream_ids.delete(e);for(const e of t)e[0](null)}}for(const e of a){const t=this._waiting_stream_logins.get(e);if(t){this._waiting_stream_logins.delete(e);for(const e of t)e[0](null)}}this._loading_streams=!1,(this._waiting_stream_ids.size||this._waiting_stream_logins.size)&&this._loadStreams()}memorizeTag(e,t=!0){if(!(e&&e.id&&e.tagName&&e.localizedName))return;let i=null;this.tag_cache.has(e.id)&&(i=this.tag_cache.get(i));const n=e.isLanguageTag&&r.exec(e.tagName),s=n&&n[1]||null,o={id:e.id,value:e.id,is_language:e.isLanguageTag,language:s,name:e.tagName,label:e.localizedName};e.localizedDescription&&(o.description=e.localizedDescription);const a=i?Object.assign(i,o):o;if(this.tag_cache.set(a.id,a),t&&a.description&&this._waiting_tags.has(a.id)){const e=this._waiting_tags.get(a.id);this._waiting_tags.delete(a.id);for(const t of e)t[0](a)}return a}async _loadTags(){if(this._loading_tags)return;this._loading_tags=!0;const e=[...this._waiting_tags.keys()].slice(0,50);let t;try{const n=await this.queryApollo(await i.e(139).then(i.t.bind(null,321,7)),{ids:e});t=Object(s.get)("data.contentTags",n)}catch(t){for(const i of e){const e=this._waiting_tags.get(i);this._waiting_tags.delete(i);for(const i of e)i[1](t)}return}const n=new Set(e);if(Array.isArray(t))for(const e of t){const t=this.memorizeTag(e,!1),i=this._waiting_tags.get(t.id);if(this._waiting_tags.delete(t.id),n.delete(t.id),i)for(const e of i)e[0](t)}for(const e of n){const t=this._waiting_tags.get(e);this._waiting_tags.delete(e);for(const e of t)e[0](null)}this._loading_tags=!1,this._waiting_tags.size&&this._loadTags()}getTag(e,t=!1){if(e&&e.id&&(e=e.id),this.tag_cache.has(e)){const i=this.tag_cache.get(e);if(i&&(i.description||!t))return Promise.resolve(i)}return new Promise((t,i)=>{this._waiting_tags.has(e)?this._waiting_tags.get(e).push([t,i]):(this._waiting_tags.set(e,[[t,i]]),this._loading_tags||this._loadTags())})}getTagImmediate(e,t,i=!1){e&&e.id&&(e=e.id);let n=null;if(this.tag_cache.has(e)&&(n=this.tag_cache.get(e)),i&&(!n||!n.description)||!n&&t){const n=this.getTag(e,i);t&&n.then(i=>t(e,i)).catch(i=>t(e,null,i))}return n}async getTopTags(e=50){const t=await this.queryApollo(await i.e(139).then(i.t.bind(null,322,7)),{limit:e}),n=Object(s.get)("data.topTags",t);if(!Array.isArray(n))return[];const r=[],o=new Set;for(const e of n)e&&!o.has(e.id)&&(o.add(e.id),r.push(this.memorizeTag(e)));return r}getLanguagesFromTags(e,t){const i=[],n=t?Object(s.debounce)(()=>{this.getLanguagesFromTags(e,t)},16):null;if(Array.isArray(e))for(const t of e){const e=this.getTagImmediate(t,n);if(e&&e.is_language){const t=r.exec(e.name);t&&i.push(t[1])}}return i}async getMatchingTags(e,t,i=null){let n;if(t||(t=this.locale),t=function getAlgoliaLanguage(e){return e?(e=e.toLowerCase(),o[e]?o[e]:(e=e.split("-")[0],o[e]||o.en)):o.en}(t),i){const r=await this.searchClient.queryForType("stream_tag",e,Object(s.generateUUID)(),{hitsPerPage:100,faceFilters:[`category_id:${i}`],restrictSearchableAttributes:[`localizations.${t}`,"tag_name"]});n=Object(s.get)("streamTags.hits",r)}else{const i=await this.searchClient.queryForType("tag",e,Object(s.generateUUID)(),{hitsPerPage:100,facetFilters:[["tag_scope:SCOPE_ALL","tag_scope:SCOPE_CATEGORY"]],restrictSearchableAttributes:[`localizations.${t}`,"tag_name"]});n=Object(s.get)("tags.hits",i)}if(!Array.isArray(n))return[];const a=[],l=new Set;for(const e of n){const i=e.tag_id||e.objectID;if(e&&!l.has(i))if(l.add(i),this.tag_cache.has(i)){const n=this.tag_cache.get(i);if(!n.description&&e.description_localizations){const i=e.description_localizations[t]||e.description_localizations["en-us"];i&&(n.description=i,this.tag_cache.set(n.id,n))}a.push(n)}else{const n=e.tag_name&&r.exec(e.tag_name),s=n&&n[1]||null,o={id:i,value:i,is_language:null!=s,language:s,label:e.localizations&&(e.localizations[t]||e.localizations["en-us"])||e.tag_name};if(e.description_localizations){const i=e.description_localizations[t]||e.description_localizations["en-us"];i&&(o.description=i)}this.tag_cache.set(o.id,o),a.push(o)}}return a}}},function(e,t,i){"use strict";i.d(t,"a",(function(){return Switchboard}));var n=i(3),s=i(28),r=i.n(s);class Switchboard extends n.default{constructor(...e){super(...e),this.inject("site.web_munch"),this.inject("site.fine"),this.inject("site.router")}awaitRouter(){const e=this.fine.searchTree(null,e=>e.logger&&"default-root-router"===e.logger.category||e.onHistoryChange&&e.reportInteractive||e.onHistoryChange&&e.props&&e.props.location,100);return e?Promise.resolve(e):new Promise(e=>setTimeout(e,50)).then(()=>this.awaitRouter())}awaitRoute(e=0){const t=this.fine.searchTree(null,e=>e.props&&e.props.component&&e.props.path,100);return t?Promise.resolve(t):e>50?Promise.resolve(null):new Promise(e=>setTimeout(e,50)).then(()=>this.awaitRoute(e+1))}async onEnable(){if(await this.parent.awaitElement(".twilight-minimal-root,.twilight-root,#root>div"),this.web_munch._require||!1===this.web_munch.v4)return;const e=await this.awaitRoute(),t=e&&this.fine.searchParent(e,e=>e.props&&e.props.children);if(!t)return new Promise(e=>setTimeout(e,50)).then(()=>this.onEnable());const i=await this.awaitRouter();this.log.info(`Found Route and Switch with ${t.props.children.length} routes.`);const n=i.props.location.pathname;for(const e of t.props.children){if(!e.props||!e.props.component)continue;try{const t=r()(e.props.path);if(!t.exec||t.exec(n))continue}catch(e){continue}this.log.info("Found Non-Matching Route",e.props.path);const t=e.props.component;let i;if(t.Preload){try{i=t.Preload()}catch(e){this.log.warn("Error instantiating preloader for forced chunk loading.",e),i=null}if(!i||!i.props||!i.props.loader)continue;try{i.props.loader().then(()=>{this.log.info("Successfully forced a chunk to load using route",e.props.path)})}catch(e){this.log.warn("Unexpected result trying to use component pre-loader to force loading of another chunk.")}}else{try{i=new e.props.component}catch(e){this.log.warn("Error instantiating component for forced chunk loading.",e),i=null}if(!(i&&i.props&&i.props.children&&i.props.children.props&&i.props.children.props.loader))continue;try{i.props.children.props.loader().then(()=>{this.log.info("Successfully forced a chunk to load using route",e.props.path)})}catch(e){this.log.warn("Unexpected result trying to use component loader to force loading of another chunk.")}}break}}}},function(e,t,i){e.exports=i.p+"main.01cd7d1dbb37f65fe69d0f117c7b0ec7.css"},function(e,t,i){"use strict";var n=i(3),s=i(0);i(2);class Vue extends n.default{constructor(...e){super(...e),this._components={},this.inject("i18n")}async onLoad(){const e=window.ffzVue=this.Vue=(await i.e(142).then(i.bind(null,323))).default,t=this._components,[n,r,o]=await Promise.all([i.e(142).then(i.bind(null,324)),i.e(142).then(i.t.bind(null,325,7)),i.e(142).then(i.bind(null,327))]);this.component(o.default),e.use(n),e.mixin(r.mixin);for(const i in t)Object(s.has)(t,i)&&e.component(i,t[i]);this._components=null,e.use(this)}component(e,t){if("function"==typeof e)for(const t of e.keys())this.component(t.slice(2,t.length-4),e(t).default);else if("object"==typeof e)for(const t in e)Object(s.has)(e,t)&&this.component(t,e[t]);else this.Vue?this.Vue.component(e,t):this._components[e]=t}install(e){const t=this;this._vue_i18n||(this._vue_i18n=new this.Vue({data:()=>({locale:t.i18n.locale,phrases:{}}),methods:{t_(e,i,n){return this.locale&&this.phrases[e],t.i18n.t(e,i,n)},tList_(e,i,n){return this.locale&&this.phrases[e],t.i18n.tList(e,i,n)},tNode_(e,i){return this.locale,t.i18n.formatNode(e,i)},setLocale(e){t.i18n.locale=e}}}),this.on("i18n:transform",()=>{this._vue_i18n.locale=this.i18n.locale,this._vue_i18n.phrases={}}),this.on("i18n:changed",()=>{this._vue_i18n.locale=this.i18n.locale,this._vue_i18n.phrases={}}),this.on("i18n:loaded",e=>{const t=this._vue_i18n,i=t.phrases;for(const n of e)t.$set(i,n,(i[n]||0)+1)}),e.prototype.$i18n=this._vue_i18n),e.component("t-list",{props:{tag:{required:!1},phrase:{type:String,required:!0},default:{type:String,required:!0},data:{type:Object,required:!1}},render(e){return e(this.tag||"span",this.$i18n.tList_(this.phrase,this.default,Object.assign({},this.data,this.$scopedSlots)).map(e=>"function"==typeof e?e():e))}}),e.mixin({methods:{reactNavigate(e,i){const n=t.resolve("site.router");n&&n.history&&(i&&(i.preventDefault(),i.stopPropagation()),n.history.push(e))},getReactURL:(e,i,n,...s)=>t.resolve("site.router").getURL(e,i,n,...s),t(e,t,i){return this.$i18n.t_(e,t,i)},tList(e,t,i){return this.$i18n.tList_(e,t,i)},tNode(e,t){return this.$i18n.tNode_(e,t)}}})}}t.a=Vue},function(e,t,i){e.exports=i.p+"font-awesome.8a43fc70c767c23a66969397057ef9e8.css"},function(e,t,i){"use strict";i.d(t,"a",(function(){return Badges}));var n=i(2),s=i(1),r=i(0),o=i(3),a=i(9);const l={1:{staff:{1:{color:"#200f33",svg:!0,trans:{color:"#6441a5"}}},admin:{1:{color:"#faaf19",svg:!0}},global_mod:{1:{color:"#0c6f20",svg:!0}},broadcaster:{1:{color:"#e71818",svg:!0}},moderator:{1:{color:"#34ae0a",svg:!0}},twitchbot:{1:{color:"#34ae0a"}},partner:{1:{color:"transparent",trans:{image:!0,color:"#6441a5"}}},"clip-champ":{1:{color:"#6441a5"}},vip:{1:{color:"#b33ff0",trans:{color:"transparent",invert:!1}}},turbo:{1:{color:"#6441a5",svg:!0}},premium:{1:{color:"#009cdc"}},subscriber:{0:{color:"#6441a5"},1:{color:"#6441a5"}}},2:{staff:{1:{color:"#000"}},admin:{1:{color:"#DB7600"}},broadcaster:{1:{color:"#E91916"}},moderator:{1:{color:"#00AD03"}},global_mod:{1:{color:"#006441"}},twitchbot:{1:{color:"#00AD03"}},partner:{1:{color:"#9146FF"}},subscriber:{0:{color:"#8205B4"},1:{color:"#8205B4"}},vip:{1:{color:"#E005B9"}},turbo:{1:{color:"#59399A"}},premium:{1:{color:"#00A0D6"}},"anonymous-cheerer":{1:{color:"#4B367C"}},"clip-champ":{1:{color:"#9146FF"}}}},c={broadcaster:0,staff:0,admin:0,global_mod:0,mod:1,moderator:1,twitchbot:1,vip:2,subscriber:25},u="background-repeat:no-repeat;background-position:center;",h=`${n.SERVER}/static/badges/twitch/`,d=n.IS_WEBKIT?"webkitMaskImage":"maskImage",f={0:e=>`background:${e.image} ${e.color};background-size:${1.8*e.scale}rem;${e.svg?"":`background-image:${e.image_set};`}${u}`,1:e=>`${f[0](e)}border-radius:${.2*e.scale}rem;`,2:e=>`${f[0](e)}border-radius:${.9*e.scale}rem;background-size:${1.6*e.scale}rem;`,3:e=>`background:${e.color};border-radius:${.9*e.scale}rem;`,4:e=>`${f[3](e)}height:${e.scale}rem;min-width:${e.scale}rem;`,5:e=>`background:${e.image};background-size:${1.8*e.scale}rem;${e.svg?"":`background-image:${e.image_set};`}${u}`,6:e=>`background:linear-gradient(${e.color},${e.color});${n.WEBKIT_CSS}mask-image:${e.image};${n.WEBKIT_CSS}mask-size:${1.8*e.scale}rem ${1.8*e.scale}rem;${e.svg?"":`${n.WEBKIT_CSS}mask-image:${e.image_set};`}`};function generateOverrideCSS(e,t){const i=e.urls||{1:e.image},s=`url("${i[1]}")`,r=`${n.WEBKIT_CSS}image-set(${s} 1x${i[2]?`, url("${i[2]}") 2x`:""}${i[4]?`, url("${i[4]}") 4x`:""})`;return 3===t||4===t?"":6===t?`${n.WEBKIT_CSS}mask-image:${s} !important;${n.WEBKIT_CSS}mask-image:${r} !important;`:`background-image:${s} !important;background-image:${r} !important;`}function generateBadgeCSS(e,t,i,s,o,a=2,l,c=1){let u,d,p,g=i.color||"transparent",m=i.image||`${h}${a}/${e}${i.svg?".svg":`/${t}/`}`,_=!1,b=!1;if(s>4){const e=i.trans||{};g=e.color||g,e.image&&(_=!0,!0!==e.image&&(m=e.image)),b=Object(r.has)(e,"invert")?e.invert&&!o:5===s&&!o}return 3!==s&&4!==s||"transparent"===g&&i.trans&&(g=i.trans.color||g),"transparent"===g&&(s=0),3!==s&&4!==s&&(u=m.endsWith(".svg"),d=i.urls?`url("${i.urls[c]}")`:`url("${u?m:`${m}${c}${_?"_trans":""}.png`}")`,i.urls&&1===c?p=`${n.WEBKIT_CSS}image-set(${d} 1x${i.urls[2]?`, url("${i.urls[2]}") 2x`:""}${i.urls[4]?`, url("${i.urls[4]}") 4x`:""})`:!u&&c<4?1===c?p=`${n.WEBKIT_CSS}image-set(${d} 1x, url("${m}2${_?"_trans":""}.png") 2x, url("${m}4${_?"_trans":""}.png") 4x)`:2===c&&(p=`${n.WEBKIT_CSS}image-set(${d} 1x, url("${m}4${_?"_trans":""}.png") 2x)`):p=d),l&&g&&"transparent"!==g&&(g=l.process(g)||g),`${i.__click_url?"cursor:pointer;":""}${b?"filter:invert(100%);":""}${f[s]({scale:1,color:g,image:d,image_set:p,svg:u})}`}class Badges extends o.default{constructor(...e){super(...e),this.inject("i18n"),this.inject("settings"),this.inject("socket"),this.inject("tooltips"),this.inject("experiments"),this.style=new s.ManagedStyle("badges"),this.badges={},this.twitch_badges={},n.IS_FIREFOX&&this.settings.add("chat.badges.media-queries",{default:!0,ui:{path:"Chat > Badges >> tabs ~> Appearance",title:"Use @media queries to support High-DPI Badge images in Mozilla Firefox.",description:"This is required to see high-DPI badges on Firefox because Firefox still has yet to support `image-set()` after more than five years. It may be less reliable.",component:"setting-check-box"}}),this.settings.add("chat.badges.version",{default:2,ui:{path:"Chat > Badges >> tabs ~> Appearance",title:"Version",component:"setting-select-box",data:[{value:1,title:"1 (Pre December 2019)"},{value:2,title:"2 (Current)"}]}}),this.settings.add("chat.badges.fix-colors",{default:!0,ui:{path:"Chat > Badges >> tabs ~> Appearance",title:"Adjust badge colors for visibility.",description:"Ensures that badges are visible against the current background.\n\n**Note:** Only affects badges with custom rendering. Subscriber badges, bit badges, etc. are not affected.",component:"setting-check-box"}}),this.settings.add("chat.badges.hidden",{default:{},type:"object_merge",ui:{path:"Chat > Badges >> tabs ~> Visibility",title:"Visibility",component:"badge-visibility",data:()=>this.getSettingsBadges(!0)}}),this.settings.add("chat.badges.custom-mod",{default:!0,ui:{path:"Chat > Badges >> tabs ~> Appearance",title:"Use custom moderator badges where available.",component:"setting-check-box"}}),this.settings.add("chat.badges.style",{default:1,ui:{path:"Chat > Badges >> tabs ~> Appearance",title:"Style",component:"setting-select-box",data:[{value:0,title:"Square"},{value:1,title:"Rounded"},{value:2,title:"Circular"},{value:3,title:"Circular (Color Only)"},{value:4,title:"Circular (Color Only, Small)"},{value:5,title:"Transparent"},{value:6,title:"Transparent (Colored)"}]}})}getSettingsBadges(e){const t=[],i=[],n=[],s=[];for(const e in this.twitch_badges)if(Object(r.has)(this.twitch_badges,e)){const n=this.twitch_badges[e],s=[];let o=n&&(n[1]||n[0]);for(const e in n)if(Object(r.has)(n,e)){const t=n[e];o||(o=t),t&&t.image1x&&s.push({version:e,name:t.title,image:t.image1x,styleImage:`url("${t.image1x}")`})}o&&(n.__game?i:t).push({id:e,provider:"twitch",name:o.title,color:"transparent",image:o.image2x,versions:s,styleImage:`url("${o.image2x}")`})}if(e)for(const e in this.badges)if(Object(r.has)(this.badges,e)){const t=this.badges[e],i=t.urls?t.urls[2]||t.urls[1]:t.image;(t.addon?s:n).push({id:e,provider:"ffz",name:t.title,color:t.color||"transparent",image:i,styleImage:`url("${i}")`})}return[{title:"Twitch",id:"m-twitch",badges:t},{title:"Twitch: Game",id:"m-game",key:"game",badges:i},{title:"FrankerFaceZ",id:"m-ffz",badges:n},{title:"Add-on",id:"m-addon",badges:s}]}onEnable(){this.parent.context.on("changed:chat.badges.custom-mod",this.rebuildAllCSS,this),this.parent.context.on("changed:chat.badges.style",this.rebuildAllCSS,this),this.parent.context.on("changed:theme.is-dark",this.rebuildAllCSS,this),this.parent.context.on("changed:theme.tooltips-dark",this.rebuildAllCSS,this),this.parent.context.on("changed:chat.badges.version",this.rebuildAllCSS,this),this.parent.context.on("changed:chat.badges.media-queries",this.rebuildAllCSS,this),this.parent.context.on("changed:chat.badges.fix-colors",this.rebuildColoredBadges,this),this.rebuildAllCSS(),this.loadGlobalBadges(),this.tooltips.types.badge=(e,t)=>{t.add_class="ffz__tooltip--badges";const i=this.parent.context.get("tooltip.badge-images"),n=e.parentElement.parentElement,r=n.dataset.roomId,o=n.dataset.room,a=JSON.parse(e.dataset.badgeData),l=[];if(null==a)return l;for(const e of a){const t=e.provider;if("twitch"===t){const t=this.getTwitchBadge(e.badge,e.version,r,o),n=this.getTwitchBadge(e.badge,e.version,null,null,!0)||{};if(!t)continue;let a=t.title||n.title;e.data&&("subscriber"===e.badge?a=this.i18n.t("badges.subscriber.months","{title} ({count,number} Month{count,en_plural})",{title:a,count:e.data}):"founder"===e.badge&&(a=this.i18n.t("badges.founder.months","{title}\n(Subscribed for {count,number} Month{count,en_plural})",{title:a,count:e.data}))),l.push(Object(s.createElement)("div",{class:"ffz-badge-tip"},i&&Object(s.createElement)("img",{class:"preview-image ffz-badge",src:t.image4x}),a))}else"ffz"===t&&l.push(Object(s.createElement)("div",{class:"ffz-badge-tip"},i&&Object(s.createElement)("div",{class:"preview-image ffz-badge",style:{backgroundColor:e.color,backgroundImage:`url("${e.image}")`}}),e.title))}return l}}render(e,t){const i=this.parent.context.get("chat.badges.hidden")||{},s=this.parent.context.get("chat.badges.style"),o=this.parent.context.get("chat.badges.custom-mod"),a=s>5,l=5!==s,u=3!==s&&4!==s,h=i["m-twitch"],f=i["m-game"],p=i["m-ffz"],g=i["m-addon"],m=[],_={},b=e.badges||{},v=e.badgeDynamicData||{},y=e.user||{},w=y.id,k=y.login,C=e.roomID,x=e.roomLogin,S=this.parent.getRoom(C,x,!0),E=this.getBadges(w,k,C,x);let F,O=50;for(const e in b)if(Object(r.has)(b,e)){const t=b[e],n=i[e],s=e.endsWith("_1");if(n||null==n&&(s?f:h))continue;F=Object(r.has)(c,e)?c[e]:O++;const a=v[e]||"founder"===e&&v.subscriber,l="moderator"===e&&o&&S&&S.data&&S.data.mod_urls,u=[];if(l){const i=this.getTwitchBadge(e,t,C,x);u.push({provider:"ffz",image:l[4]||l[2]||l[1],color:"#34ae0a",title:i?i.title:"Moderator",data:a})}else u.push({provider:"twitch",badge:e,version:t,data:a});_[F]={id:e,props:{"data-provider":"twitch","data-badge":e,"data-version":t,style:{}},badges:u}}for(const e of E)if(e&&null!=e.id){const t=this.badges[e.id]||{},s=i[e.id];if(s||null==s&&(t.addon?g:p))continue;const o=Object(r.has)(e,"slot")?e.slot:t.slot,c=_[o],h=e.urls||(e.image?{1:e.image}:null),f=e.color||t.color||"transparent",m=e.no_invert,b="transparent"!==f&&a,v=h||t.urls||{1:t.image},y={provider:"ffz",image:v[4]||v[2]||v[1],color:e.color||t.color,title:e.title||t.title};let w;if(c){c.badges.push(y);const i=Object(r.has)(e,"replaces")?e.replaces:t.replaces,n=e.replaces_type||t.replaces_type;if(!i||n&&n!==c.id)continue;c.replaced=e.id,w=c.props.style}else{if(null==o)continue;{w={};const t={className:"ffz-tooltip ffz-badge","data-tooltip-type":"badge","data-provider":"ffz","data-badge":e.id,style:w};_[o]={id:e.id,props:t,badges:[y]}}}if(m&&(_[o].full_size=!0,_[o].no_invert=!0,w.background="unset",w.backgroundSize="unset",w[d]="unset"),(u||"transparent"===f)&&h){const e=`url("${h[1]}")`;let t;(h[2]||h[4])&&(t=`${n.WEBKIT_CSS}image-set(${e} 1x${h[2]?`, url("${h[2]}") 2x`:""}${h[4]?`, url("${h[4]}") 4x`:""})`),w[b&&!m?d:"backgroundImage"]=e,t&&(w[b&&!m?d:"backgroundImage"]=t)}l&&e.color&&(b&&!m?w.backgroundImage=`linear-gradient(${e.color},${e.color})`:w.backgroundColor=e.color)}for(const e in _)if(Object(r.has)(_,e)){const i=_[e],n=i.props;n.className=`ffz-tooltip ffz-badge${i.full_size?" ffz-full-size":""}${i.no_invert?" ffz-no-invert":""}`,n.key=`${n["data-provider"]}-${n["data-badge"]}`,n["data-tooltip-type"]="badge",n["data-badge-data"]=JSON.stringify(i.badges),i.replaced&&(n["data-replaced"]=i.replaced),m.push(t("span",n))}return m}rebuildColor(){this.parent.context.get("chat.badges.fix-colors")?this.color_fixer=new a.ColorAdjuster(this.parent.context.get("theme.is-dark")?"#181818":"#FFFFFF",1,2.5):this.color_fixer=null}rebuildColoredBadges(){this.rebuildColor(),this.buildBadgeCSS(),this.buildTwitchCSSBadgeCSS()}rebuildAllCSS(){this.rebuildColor();for(const e of this.parent.iterateRooms())e.buildBadgeCSS(),e.buildModBadgeCSS();this.buildBadgeCSS(),this.buildTwitchBadgeCSS(),this.buildTwitchCSSBadgeCSS()}getBadges(e,t,i,n){const s=this.parent.getRoom(i,n,!0),r=this.parent.getUser(e,t,!0),o=s&&s.getUser(e,t,!0);return(r?r.badges._cache:[]).concat(o?o.badges._cache:[])}async loadGlobalBadges(e=0){let t,i;if(this.experiments.getAssignment("api_load"))try{fetch(`${n.NEW_API}/v1/badges`).catch(()=>{})}catch(e){}try{t=await fetch(`${n.API_SERVER}/v1/badges`)}catch(t){return++e<10?setTimeout(()=>this.loadGlobalBadges(e),500*e):(this.log.error("Error loading global badge data.",t),!1)}if(!t.ok)return!1;try{i=await t.json()}catch(e){return this.log.error("Error parsing global badge data.",e),!1}let s=0,o=0;if(i.badges)for(const e of i.badges)e&&e.id&&(this.loadBadgeData(e.id,e,!1),s++);if(i.users)for(const e in i.users)if(Object(r.has)(i.users,e)){const t=this.badges[e];let n=0;for(const t of i.users[e]){this.parent.getUser(void 0,t).addBadge("ffz-global",e)&&(n++,o++)}n>0&&this.log.info(`Added "${t?t.name:`#${e}`}" to ${n} users.`)}this.log.info(`Loaded ${s} badges and assigned them to ${o} users.`),this.buildBadgeCSS()}loadBadgeData(e,t,i=!0){this.badges[e]=t,void 0===t.addon&&(t.addon=/^addon/.test(e)),t.replaces&&!t.replaces_type&&(t.replaces_type=t.replaces,t.replaces=!0),"developer"!==t.name&&"supporter"!==t.name||(t.click_url="https://www.frankerfacez.com/donate"),i&&this.buildBadgeCSS()}buildBadgeCSS(){const e=this.parent.context.get("chat.badges.style"),t=this.parent.context.get("theme.is-dark"),i=n.IS_FIREFOX&&this.parent.context.get("chat.badges.media-queries"),s=[];for(const n in this.badges)if(Object(r.has)(this.badges,n)){const r=this.badges[n],o=`.ffz-badge[data-badge="${n}"]`;s.push(`.ffz-badge[data-replaced="${n}"]{${generateOverrideCSS(r,e)}}`),i?(s.push(`@media (max-resolution: 99dpi) {${o}{${generateBadgeCSS(n,0,r,e,t,0,this.color_fixer,1)}}}`),s.push(`@media (min-resolution: 100dpi) and (max-resolution:199dpi) {${o}{${generateBadgeCSS(n,0,r,e,t,0,this.color_fixer,2)}}}`),s.push(`@media (min-resolution: 200dpi) {${o}{${generateBadgeCSS(n,0,r,e,t,0,this.color_fixer,4)}}}`)):s.push(`${o}{${generateBadgeCSS(n,0,r,e,t,0,this.color_fixer)}}`)}this.style.set("ext-badges",s.join("\n"))}getTwitchBadge(e,t,i,n,s=!1){const r=this.parent.getRoom(i,n,!0);let o;if(r){const i=r.badges&&r.badges[e];o=i&&i[t]}if(!o){const i=this.twitch_badges&&this.twitch_badges[e];o=i&&i[t]}if(!o&&!s){const e=this.resolve("site.chat");e&&e.tryUpdateBadges&&e.tryUpdateBadges()}return o}getTwitchBadgeCount(){return this.twitch_badge_count||0}updateTwitchBadges(e){if(this.twitch_badge_count=0,Array.isArray(e)){let t=null;if(e.length){t={};for(const i of e){const e=i.setID,n=t[e]=t[e]||{__game:/_\d+$/.test(e)&&!e.includes("overwatch")};this.twitch_badge_count++,n[i.version]=i}}this.twitch_badges=t}else this.twitch_badges=e;this.buildTwitchBadgeCSS()}buildTwitchCSSBadgeCSS(){const e=this.parent.context.get("chat.badges.style"),t=this.parent.context.get("theme.is-dark"),i=n.IS_FIREFOX&&this.parent.context.get("chat.badges.media-queries"),s=this.parent.context.get("chat.badges.version"),o=l[s]||{},a=[];for(const n in o)if(Object(r.has)(o,n)){const l=o[n];for(const o in l)if(Object(r.has)(l,o)){const r=l[o],c=`.ffz-badge[data-badge="${n}"][data-version="${o}"]`;i?(a.push(`@media (max-resolution: 99dpi) {${c}{${generateBadgeCSS(n,o,r,e,t,s,this.color_fixer,1)}}}`),a.push(`@media (min-resolution: 100dpi) and (max-resolution:199dpi) {${c}{${generateBadgeCSS(n,o,r,e,t,s,this.color_fixer,2)}}}`),a.push(`@media (min-resolution: 200dpi) {${c}{${generateBadgeCSS(n,o,r,e,t,s,this.color_fixer,4)}}}`)):a.push(`${c}{${generateBadgeCSS(n,o,r,e,t,s,this.color_fixer)}}`)}}this.style.set("css-badges",a.join("\n"))}buildTwitchBadgeCSS(){this.twitch_badges||this.style.delete("twitch-badges");const e=this.parent.context.get("chat.badges.version"),t=n.IS_FIREFOX&&this.parent.context.get("chat.badges.media-queries"),i=l[e]||{},s=[];for(const e in this.twitch_badges)if(Object(r.has)(this.twitch_badges,e)){if(Object(r.has)(i,e))continue;const o=this.twitch_badges[e];for(const i in o)if(Object(r.has)(o,i)){const r=o[i],a=`.ffz-badge[data-badge="${e}"][data-version="${i}"]`;s.push(`${a} {\n\t\t\tbackground-color: transparent;\n\t\t\tfilter: none;\n\t\t\t${n.WEBKIT_CSS}mask-image: none;\n\t\t\tbackground-size: 1.8rem;\n\t\t\tbackground-image: url("${r.image1x}");\n\t\t\tbackground-image: ${n.WEBKIT_CSS}image-set(\n\t\t\t\turl("${r.image1x}") 1x,\n\t\t\t\turl("${r.image2x}") 2x,\n\t\t\t\turl("${r.image4x}") 4x\n\t\t\t);\n\t\t}`),t&&(s.push(`@media (min-resolution: 100dpi) and (max-resolution:199dpi) { ${a} {\n\t\t\t\t\t\t\t\tbackground-image: url("${r.image2x}");\n\t\t\t\t\t\t\t}}`),s.push(`@media (min-resolution: 200dpi) { ${a} {\n\t\t\t\t\t\t\t\tbackground-image: url("${r.image4x}");\n\t\t\t\t\t\t\t}}`))}}s.length?this.style.set("twitch-badges",s.join("\n")):this.style.delete("twitch-badges")}}},function(e,t,i){"use strict";i.d(t,"a",(function(){return Emotes}));var n=i(3),s=i(1),r=i(0),o=i(2),a=i(95),l=i.n(a),c=i(128),u=i.n(c);const h=o.IS_OSX?"metaKey":"ctrlKey",d={59847:{modifier_offset:"0 15px 15px 0",modifier:!0},70852:{modifier:!0,modifier_offset:"0 5px 20px 0",extra_width:5,shrink_to_fit:!0},70854:{modifier:!0,modifier_offset:"30px 0 0"},147049:{modifier:!0,modifier_offset:"4px 1px 0 3px"},147011:{modifier:!0,modifier_offset:"0"},70864:{modifier:!0,modifier_offset:"0"},147038:{modifier:!0,modifier_offset:"0"}};class Emotes extends n.default{constructor(...e){super(...e),this.EmoteTypes=o.EmoteTypes,this.inject("socket"),this.inject("settings"),this.inject("experiments"),this.twitch_inventory_sets=new Set,this.__twitch_emote_to_set={},this.__twitch_set_to_channel={},this.default_sets=new r.SourcedSet,this.global_sets=new r.SourcedSet,this.providers=new Map,this.providers.set("featured",{name:"Featured",i18n_key:"emote-menu.featured",sort_key:75}),this.emote_sets={},this._set_refs={},this._set_timers={},this.settings.add("chat.fix-bad-emotes",{default:!0,ui:{path:"Chat > Appearance >> Emotes",title:"Fix Bad Twitch Global Emotes",description:"Clean up the images for bad Twitch global emotes, removing white borders and solid backgrounds.",component:"setting-check-box"}}),this.settings.add("chat.click-emotes",{default:!0,ui:{path:"Chat > Behavior >> General",title:"Open emote information pages by Shift-Clicking them.",component:"setting-check-box"}}),this.settings.add("chat.sub-emotes",{default:!0,ui:{path:"Chat > Behavior >> General",title:"Open Twitch subscription pages by Shift-Clicking emotes when relevant.",component:"setting-check-box"}}),this.settings.add("chat.emote-dialogs",{default:!0,ui:{path:"Chat > Behavior >> General",title:"Open emote information cards for Twitch emotes by clicking them.",component:"setting-check-box"}}),this.handleClick=this.handleClick.bind(this)}onEnable(){this.style=new s.ManagedStyle("emotes");const e=this.getFavorites("twitch");let t=!1;for(let i=0;i<e.length;i++)"number"==typeof e[i]&&(t=!0,e[i]=`${e[i]}`);if(t&&this.setFavorites("twitch",e),Object.keys(this.emote_sets).length){this.log.info("Generating CSS for existing emote sets.");for(const e in this.emote_sets)if(Object(r.has)(this.emote_sets,e)){const t=this.emote_sets[e];t&&t.pending_css&&(this.style.set(`es--${e}`,t.pending_css+(t.css||"")),t.pending_css=null)}}this.socket.on(":command:follow_sets",this.updateFollowSets,this),this.loadGlobalSets()}updateFollowSets(e){for(const t in e)if(Object(r.has)(e,t)){const i=this.parent.getRoom(null,t,!0);if(!i||i.destroyed)continue;const n=e[t]||[],s=i.emote_sets,r=s&&s._sources;if(r&&r.has("featured"))for(const e of r.get("featured")){const t=n.indexOf(e);-1===t?i.removeSet("featured",e):n.splice(t,1)}for(const e of n)i.addSet("featured",e),this.emote_sets[e]||this.loadSet(e)}}toggleFavorite(e,t,i=null){const n=`favorite-emotes.${e}`,s=this.settings.provider,r=s.get(n)||[],o=r.indexOf(t);if(null===i&&(i=-1===o),i&&-1===o)r.push(t);else{if(i||-1===o)return;r.splice(o,1)}r.length?s.set(n,r):s.delete(n),this.emit(":change-favorite",e,t,i)}isFavorite(e,t){const i=this.settings.provider.get(`favorite-emotes.${e}`);return i&&i.includes(t)}getFavorites(e){return this.settings.provider.get(`favorite-emotes.${e}`)||[]}setFavorites(e,t){const i=`favorite-emotes.${e}`;Array.isArray(t)&&t.length?this.settings.provider.set(i,t):this.settings.provider.delete(i)}handleClick(e){const t=e.target,i=t&&t.dataset;if(!i)return;const n=i.provider,s=this.parent.context.get("chat.click-emotes"),o=this.parent.context.get("chat.sub-emotes");if(e.shiftKey&&(s||o)){let e;if("twitch"===n){if(e=`https://twitchemotes.com/emotes/${i.id}`,o){const t=this.resolve("site.apollo");if(t)return t.client.query({query:l.a,variables:{id:i.id}}).then(t=>{const i=Object(r.get)("data.emote.subscriptionProduct",t);if(i&&"ACTIVE"===i.state&&i.owner&&i.owner.login)e=`https://www.twitch.tv/subs/${i.owner.login}`;else if(!s)return!1;if(e){const t=window.open();t&&(t.opener=null,t.location=e)}}),!0}}else if("ffz"===n){const t=this.emote_sets[i.set],n=t&&t.emotes[i.id];if(!n)return;n.click_url?e=n.click_url:t.source||(e=`https://www.frankerfacez.com/emoticons/${n.id}`)}if(!s)return!1;if(e){const t=window.open();t&&(t.opener=null,t.location=e)}return!0}if(e[h]){let e,s;if("twitch"===n)e="twitch",s=i.id;else if("ffz"===n){const t=this.emote_sets[i.set],n=t&&t.emotes[i.id];if(!n)return;e=t.source||"ffz",s=n.id}else{if("emoji"!==n)return;e="emoji",s=i.code}this.toggleFavorite(e,s);const r=t._ffz_tooltip$0;return r&&r.visible&&(r.hide(),setTimeout(()=>document.contains(t)&&r.show(),0)),!0}if("twitch"===n&&this.parent.context.get("chat.emote-dialogs")){const e=this.resolve("site.fine");if(!e)return;const n=e.searchParent(t,e=>e.props&&e.props.onEmoteClick);if(!n||!n.props||!n.props.message)return;const s=n.props;return s.onEmoteClick({channelID:s.channelID||"",channelLogin:s.channelLogin||"",emoteID:i.id,emoteCode:t.alt,sourceID:"chat",referrerID:"",initialTopOffset:t.getBoundingClientRect().bottom}),!0}}getSetIDs(e,t,i,n){const s=this.parent.getRoom(i,n,!0),r=s&&s.getUser(e,t,!0),o=this.parent.getUser(e,t,!0);return(o?o.emote_sets._cache:[]).concat(r?r.emote_sets._cache:[],s?s.emote_sets._cache:[],this.default_sets._cache)}getSets(e,t,i,n){return this.getSetIDs(e,t,i,n).map(e=>this.emote_sets[e])}_withSources(e,t,i){if(i._sources){for(const[n,s]of i._sources)for(const i of s)t.has(i)||(e.push([i,n]),t.add(i));return e}}getRoomSetIDsWithSources(e,t,i,n){const s=this.parent.getRoom(i,n,!0),r=s&&s.getUser(e,t,!0);if(!s)return[];const o=[],a=new Set;return this._withSources(o,a,s.emote_sets),r&&this._withSources(o,a,r),o}getRoomSetsWithSources(e,t,i,n){return this.getRoomSetIDsWithSources(e,t,i,n).map(([e,t])=>[this.emote_sets[e],t])}getRoomSetIDs(e,t,i,n){const s=this.parent.getRoom(i,n,!0),r=s&&s.getUser(e,t,!0);return s?r?r.emote_sets._cache.concat(s.emote_sets._cache):s.emote_sets._cache:[]}getRoomSets(e,t,i,n){return this.getRoomSetIDs(e,t,i,n).map(e=>this.emote_sets[e])}getGlobalSetIDsWithSources(e,t){const i=this.parent.getUser(e,t,!0),n=[],s=new Set;return this._withSources(n,s,this.default_sets),i&&this._withSources(n,s,i.emote_sets),n}getGlobalSetsWithSources(e,t){return this.getGlobalSetIDsWithSources(e,t).map(([e,t])=>[this.emote_sets[e],t])}getGlobalSetIDs(e,t){const i=this.parent.getUser(e,t,!0);return i?i.emote_sets._cache.concat(this.default_sets._cache):this.default_sets._cache}getGlobalSets(e,t){return this.getGlobalSetIDs(e,t).map(e=>this.emote_sets[e])}getEmotes(e,t,i,n){const s={};for(const o of this.getSets(e,t,i,n))if(o&&o.emotes)for(const e of Object.values(o.emotes))e&&!Object(r.has)(s,e.name)&&(s[e.name]=e);return s}addDefaultSet(e,t,i){let n=!1;this.default_sets.sourceIncludes(e,t)||(this.default_sets.push(e,t),this.refSet(t),n=!0),i&&this.loadSetData(t,i),n&&this.emit(":update-default-sets",e,t,!0)}removeDefaultSet(e,t){let i=!1;this.default_sets.sourceIncludes(e,t)&&(this.default_sets.remove(e,t),this.unrefSet(t),i=!0),i&&this.emit(":update-default-sets",e,t,!1)}refSet(e){this._set_refs[e]=(this._set_refs[e]||0)+1,this._set_timers[e]&&(clearTimeout(this._set_timers[e]),this._set_timers[e]=null)}unrefSet(e){(this._set_refs[e]=(this._set_refs[e]||1)-1)<=0&&!this._set_timers[e]&&(this._set_timers[e]=setTimeout(()=>this.unloadSet(e),5e3))}async loadGlobalSets(e=0){let t,i;if(this.experiments.getAssignment("api_load"))try{fetch(`${o.NEW_API}/v1/set/global`).catch(()=>{})}catch(e){}try{t=await fetch(`${o.API_SERVER}/v1/set/global`)}catch(t){return++e<10?setTimeout(()=>this.loadGlobalSets(e),500*e):(this.log.error("Error loading global emote sets.",t),!1)}if(!t.ok)return!1;try{i=await t.json()}catch(e){return this.log.error("Error parsing global emote data.",e),!1}const n=i.sets||{};for(const e of i.default_sets)this.addDefaultSet("ffz-global",e);for(const e in n)Object(r.has)(n,e)&&this.loadSetData(e,n[e]);return i.users&&this.loadSetUsers(i.users),!0}async loadSet(e,t=!1,i=0){let n,s;if(this.experiments.getAssignment("api_load"))try{fetch(`${o.NEW_API}/v1/set/${e}`).catch(()=>{})}catch(e){}try{n=await fetch(`${o.API_SERVER}/v1/set/${e}`)}catch(t){return++i<10?setTimeout(()=>this.loadGlobalSets(i),500*i):(this.log.error(`Error loading data for set "${e}".`,t),!1)}if(!n.ok)return!1;try{s=await n.json()}catch(t){return this.log.error(`Error parsing data for set "${e}".`,t),!1}const r=s.set;return r&&this.loadSetData(r.id,r,t),s.users&&this.loadSetUsers(s.users),!0}loadSetUsers(e,t=!1){for(const i in e)if(Object(r.has)(e,i)){const n=this.emote_sets[i],s=e[i];for(const e of s)this.parent.getUser(void 0,e).addSet("ffz-global",i);t||this.log.info(`Added "${n?n.title:i}" emote set to ${s.length} users.`)}}loadSetData(e,t,i=!1){const n=this.emote_sets[e];if(!t)return void(n&&(this.emote_sets[e]=null));this.emote_sets[e]=t;let s=0;const o=t.emotes||t.emoticons,a=t.emotes={},l=[];t.id=e,t.emoticons=void 0;const c=[];for(const t of o){if(!t.id||!t.name||!t.urls){c.push(t);continue}t.set_id=e,t.srcSet=`${t.urls[1]} 1x`,t.urls[2]&&(t.srcSet+=`, ${t.urls[2]} 2x`),t.urls[4]&&(t.srcSet+=`, ${t.urls[4]} 4x`),t.token={type:"emote",id:t.id,set:e,provider:"ffz",src:t.urls[1],srcSet:t.srcSet,text:t.hidden?"???":t.name,length:t.name.length},Object(r.has)(d,t.id)&&Object.assign(t,d[t.id]);const i=this.generateEmoteCSS(t);i&&l.push(i),s++,a[t.id]=t}c.length&&this.log.warn(`Bad Emote Data for Set #${e}`,c),t.count=s,this.style&&(l.length||t.css)?this.style.set(`es--${e}`,l.join("")+(t.css||"")):l.length&&(t.pending_css=l.join("")),i||this.log.info(`Loaded emote set #${e}: ${t.title} (${s} emotes)`),this.emit(":loaded",e,t)}unloadSet(e,t=!1,i=!1){const n=this.emote_sets[e],s=this._set_refs[e]||0;if(n){if(s>0){if(!t)return this.log.warn(`Attempted to unload emote set #${e} with ${s} users.`);this.log.warn(`Unloading emote set ${e} with ${s} users.`)}i||this.log.info(`Unloaded emote set #${e}: ${n.title}`),this.emit(":unloaded",e,n),this.emote_sets[e]=null}}generateEmoteCSS(e){if(!(e.margins||e.modifier&&(e.modifier_offset||e.extra_width||e.shrink_to_fit)||e.css))return"";let t="";if(e.modifier&&(e.modifier_offset||e.margins||e.extra_width||e.shrink_to_fit)){let i=e.modifier_offset||e.margins||"0";i=i.split(/\s+/).map(e=>parseInt(e,10)),3===i.length&&i.push(i[1]);const n=i.length,s=i[0%n],r=i[1%n],o=i[2%n],a=i[3%n];t=`.modified-emote span .ffz-emote[data-id="${e.id}"] {\n\tpadding: ${s}px ${r}px ${o}px ${a}px;\n\t${e.shrink_to_fit?`max-width: calc(100% - ${40-a-r-(e.extra_width||0)}px);`:""}\n\tmargin: 0 !important;\n}`}return`${t}.ffz-emote[data-id="${e.id}"] {\n\t${e.margins&&!e.modifier?`margin: ${e.margins} !important;`:""}\n\t${e.css||""}\n}`}setTwitchEmoteSet(e,t){if("number"==typeof e){if(isNaN(e)||!isFinite(e))return;e=`${e}`}if("number"==typeof t){if(isNaN(t)||!isFinite(t))return;t=`${t}`}this.__twitch_emote_to_set[e]=t}setTwitchSetChannel(e,t){if("number"==typeof e){if(isNaN(e)||!isFinite(e))return;e=`${e}`}this.__twitch_set_to_channel[e]=t}_getTwitchEmoteSet(e){const t=this.__twitch_emote_to_set,i=this.__twitch_set_to_channel;if("number"==typeof e){if(isNaN(e)||!isFinite(e))return Promise.resolve(null);e=`${e}`}if(Object(r.has)(t,e)){const i=t[e];return Array.isArray(i)?new Promise(e=>i.push(e)):Promise.resolve(i)}const n=this.resolve("site.apollo");return(null==n?void 0:n.client)?new Promise(s=>{const a=[s];t[e]=a,Object(r.timeout)(n.client.query({query:l.a,variables:{id:`${e}`}}),2e3).then(n=>{var s;const l=null==n?void 0:null===(s=n.data)||void 0===s?void 0:s.emote;let c=null;if(l&&(c=l.setID,c&&!Object(r.has)(i,c))){var u;const e=function determineEmoteType(e){const t=e.subscriptionProduct;if(t){if(12658==t.id)return o.EmoteTypes.Prime;if(324==t.id)return o.EmoteTypes.Turbo;const e=t.owner;if(e)return 139075904==e.id||"INACTIVE"===t.state?o.EmoteTypes.LimitedTime:o.EmoteTypes.Subscription}if(300238151==e.setID)return o.EmoteTypes.ChannelPoints;const i=parseInt(e.setID,10);return!isNaN(i)&&isFinite(i)&&i>=5e8?o.EmoteTypes.BitsTier:o.EmoteTypes.Global}(l);i[c]={id:c,type:e,owner:(null==l?void 0:null===(u=l.subscriptionProduct)||void 0===u?void 0:u.owner)||(null==l?void 0:l.owner)}}t[e]=c;for(const e of a)e(c)}).catch(()=>{t[e]=null;for(const e of a)e(null)})}):Promise.resolve(null)}getTwitchEmoteSet(e,t){const i=this._getTwitchEmoteSet(e);if(!t)return i;i.then(t)}_getTwitchSetChannel(e){const t=this.__twitch_set_to_channel;if("number"==typeof e){if(isNaN(e)||!isFinite(e))return Promise.resolve(null);e=`${e}`}if(Object(r.has)(t,e)){const i=t[e];return Array.isArray(i)?new Promise(e=>i.push(e)):Promise.resolve(i)}const i=this.resolve("site.apollo");return(null==i?void 0:i.client)?new Promise(n=>{const s=[n];t[e]=s,Object(r.timeout)(i.client.query({query:u.a,variables:{id:`${e}`}}),2e3).then(i=>{var n;const r=null==i?void 0:null===(n=i.data)||void 0===n?void 0:n.emoteSet;let o=null;r&&(o={id:e,type:determineSetType(r),owner:r.owner?{id:r.owner.id,login:r.owner.login,displayName:r.owner.displayName}:null}),t[e]=o;for(const e of s)e(o)}).catch(()=>{t[e]=null;for(const e of s)e(null)})}):Promise.resolve(null)}getTwitchSetChannel(e,t){const i=this._getTwitchSetChannel(e);if(!t)return i;i.then(t)}}function determineSetType(e){const t=parseInt(e.id,10);if(o.TWITCH_GLOBAL_SETS.includes(t))return o.EmoteTypes.Global;if(o.TWITCH_POINTS_SETS.includes(t))return o.EmoteTypes.ChannelPoints;if(o.TWITCH_PRIME_SETS.includes(t))return o.EmoteTypes.Prime;const i=e.owner;if(i){if(139075904==i.id)return o.EmoteTypes.LimitedTime;let t;if(Array.isArray(i.subscriptionProducts))for(const n of i.subscriptionProducts)if(e.id==n.emoteSetID){t=n;break}if(t){if(12658==t.id)return o.EmoteTypes.Prime;if(324==t.id)return o.EmoteTypes.Turbo;if("INACTIVE"===t.state)return o.EmoteTypes.LimitedTime}return o.EmoteTypes.Subscription}return t>=5e8?o.EmoteTypes.BitsTier:o.EmoteTypes.Global}},function(e,t){var i={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"FFZ_GetEmoteSetInfo"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"id"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"emoteSet"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"id"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"owner"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"login"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"displayName"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"subscriptionProducts"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"emoteSetID"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"state"},arguments:[],directives:[]}]}}]}}]}}]}}],loc:{start:0,end:175}};i.loc.source={body:"query FFZ_GetEmoteSetInfo($id: ID!) {\n\temoteSet(id: $id) {\n\t\tid\n\t\towner {\n\t\t\tid\n\t\t\tlogin\n\t\t\tdisplayName\n\t\t\tsubscriptionProducts {\n\t\t\t\tid\n\t\t\t\temoteSetID\n\t\t\t\tstate\n\t\t\t}\n\t\t}\n\t}\n}",name:"GraphQL request",locationOffset:{line:1,column:1}};var n={};function findOperation(e,t){for(var i=0;i<e.definitions.length;i++){var n=e.definitions[i];if(n.name&&n.name.value==t)return n}}!function extractReferences(){i.definitions.forEach((function(e){if(e.name){var t=new Set;!function collectFragmentReferences(e,t){if("FragmentSpread"===e.kind)t.add(e.name.value);else if("VariableDefinition"===e.kind){var i=e.type;"NamedType"===i.kind&&t.add(i.name.value)}e.selectionSet&&e.selectionSet.selections.forEach((function(e){collectFragmentReferences(e,t)})),e.variableDefinitions&&e.variableDefinitions.forEach((function(e){collectFragmentReferences(e,t)})),e.definitions&&e.definitions.forEach((function(e){collectFragmentReferences(e,t)}))}(e,t),n[e.name.value]=t}}))}(),e.exports=i,e.exports.FFZ_GetEmoteSetInfo=function oneQuery(e,t){var i={kind:e.kind,definitions:[findOperation(e,t)]};e.hasOwnProperty("loc")&&(i.loc=e.loc);var s=n[t]||new Set,r=new Set,o=new Set;for(s.forEach((function(e){o.add(e)}));o.size>0;){var a=o;o=new Set,a.forEach((function(e){r.has(e)||(r.add(e),(n[e]||new Set).forEach((function(e){o.add(e)})))}))}return r.forEach((function(t){var n=findOperation(e,t);n&&i.definitions.push(n)})),i}(i,"FFZ_GetEmoteSetInfo")},function(e,t,i){"use strict";i.d(t,"a",(function(){return Emoji}));var n=i(3),s=i(2),r=i(0),o=i(6),a=i(130),l=i.n(a);const c={apple:[64,160],emojione:[64],facebook:[64,96],google:[64,136],messenger:[64,128],twitter:[64,72]};function codepoint_to_emoji(e){let t="number"==typeof e?e:parseInt(e,16);return t<65536?String.fromCharCode(t):(t-=65536,String.fromCharCode(55296+(t>>10),56320+(1023&t)))}class Emoji extends n.default{constructor(...e){super(...e),this.inject("..emotes"),this.inject("settings"),this.settings.add("chat.emoji.style",{default:"twitter",ui:{path:"Chat > Appearance >> Emoji",title:"Emoji Style",component:"setting-select-box",data:[{value:0,title:"Native"},{value:"twitter",title:"Twitter"},{value:"google",title:"Google"},{value:"emojione",title:"EmojiOne"}]}}),this.splitter=l()(),this.emoji={},this.names={},this.chars=new Map}onEnable(){this.loadEmojiData()}async loadEmojiData(e=0){let t;try{t=await fetch(`${s.SERVER}/script/emoji/v2-.json?_${Object(o.getBuster)(60)}`).then(e=>e.ok?e.json():null)}catch(t){return++e<10?setTimeout(()=>this.loadEmojiData(e),500*e):(this.log.error("Error loading emoji data.",t),!1)}if(!t)return!1;const i=t.c,n={},r={},a=new Map;for(const e of t.e){const t=Object.assign(hydrate_emoji(e.slice(4)),{category:i[e[0]],sort:e[1],names:e[2],name:e[3]});Array.isArray(t.names)||(t.names=[t.names]),t.name||(t.name=t.names[0].replace(/_/g," ")),n[t.code]=t,a.set(t.raw,[t.code,null]);for(const e of t.names)r[e]=t.code;if(e[7]){const i=t.variants={};for(const n of e[7]){const e=Object.assign(hydrate_emoji(n),{key:n[3].toLowerCase()});i[e.key]=e,a.set(e.raw,[t.code,e.key])}}}return this.emoji=n,this.names=r,this.chars=a,this.log.info(`Loaded data about ${Object.keys(n).length} emoji.`),this.emit(":populated"),!0}getFullImage(e,t){return t||(t=this.parent.context.get("chat.emoji.style")),Object(r.has)(c,t)||(t="twitter"),`${s.SERVER}/static/emoji/img-${t}-${c[t][0]}/${e}`}getFullImageSet(e,t){return t||(t=this.parent.context.get("chat.emoji.style")),Object(r.has)(c,t)||(t="twitter"),c[t].map(i=>`${s.SERVER}/static/emoji/img-${t}-${i}/${e} ${i}w`).join(", ")}}function hydrate_emoji(e){return{code:e[0],image:`${e[0]}.png`,raw:e[0].split("-").map(codepoint_to_emoji).join(""),sheet_x:e[1][0],sheet_y:e[1][1],has:{apple:!!(32&e[2]),google:!!(16&e[2]),twitter:!!(8&e[2]),emojione:!!(4&e[2]),facebook:!!(2&e[2]),messenger:!!(1&e[2])}}}},function(e,t,i){"use strict";e.exports=()=>/\u{1F3F4}\u{E0067}\u{E0062}(?:\u{E0065}\u{E006E}\u{E0067}|\u{E0073}\u{E0063}\u{E0074}|\u{E0077}\u{E006C}\u{E0073})\u{E007F}|\u{1F468}(?:\u{1F3FC}\u200D(?:\u{1F91D}\u200D\u{1F468}\u{1F3FB}|[\u{1F33E}\u{1F373}\u{1F393}\u{1F3A4}\u{1F3A8}\u{1F3EB}\u{1F3ED}\u{1F4BB}\u{1F4BC}\u{1F527}\u{1F52C}\u{1F680}\u{1F692}\u{1F9AF}-\u{1F9B3}\u{1F9BC}\u{1F9BD}])|\u{1F3FF}\u200D(?:\u{1F91D}\u200D\u{1F468}[\u{1F3FB}-\u{1F3FE}]|[\u{1F33E}\u{1F373}\u{1F393}\u{1F3A4}\u{1F3A8}\u{1F3EB}\u{1F3ED}\u{1F4BB}\u{1F4BC}\u{1F527}\u{1F52C}\u{1F680}\u{1F692}\u{1F9AF}-\u{1F9B3}\u{1F9BC}\u{1F9BD}])|\u{1F3FE}\u200D(?:\u{1F91D}\u200D\u{1F468}[\u{1F3FB}-\u{1F3FD}]|[\u{1F33E}\u{1F373}\u{1F393}\u{1F3A4}\u{1F3A8}\u{1F3EB}\u{1F3ED}\u{1F4BB}\u{1F4BC}\u{1F527}\u{1F52C}\u{1F680}\u{1F692}\u{1F9AF}-\u{1F9B3}\u{1F9BC}\u{1F9BD}])|\u{1F3FD}\u200D(?:\u{1F91D}\u200D\u{1F468}[\u{1F3FB}\u{1F3FC}]|[\u{1F33E}\u{1F373}\u{1F393}\u{1F3A4}\u{1F3A8}\u{1F3EB}\u{1F3ED}\u{1F4BB}\u{1F4BC}\u{1F527}\u{1F52C}\u{1F680}\u{1F692}\u{1F9AF}-\u{1F9B3}\u{1F9BC}\u{1F9BD}])|\u200D(?:\u2764\uFE0F\u200D(?:\u{1F48B}\u200D)?\u{1F468}|[\u{1F468}\u{1F469}]\u200D(?:\u{1F466}\u200D\u{1F466}|\u{1F467}\u200D[\u{1F466}\u{1F467}])|\u{1F466}\u200D\u{1F466}|\u{1F467}\u200D[\u{1F466}\u{1F467}]|[\u{1F468}\u{1F469}]\u200D[\u{1F466}\u{1F467}]|[\u2695\u2696\u2708]\uFE0F|[\u{1F466}\u{1F467}]|[\u{1F33E}\u{1F373}\u{1F393}\u{1F3A4}\u{1F3A8}\u{1F3EB}\u{1F3ED}\u{1F4BB}\u{1F4BC}\u{1F527}\u{1F52C}\u{1F680}\u{1F692}\u{1F9AF}-\u{1F9B3}\u{1F9BC}\u{1F9BD}])|(?:\u{1F3FB}\u200D[\u2695\u2696\u2708]|\u{1F3FF}\u200D[\u2695\u2696\u2708]|\u{1F3FE}\u200D[\u2695\u2696\u2708]|\u{1F3FD}\u200D[\u2695\u2696\u2708]|\u{1F3FC}\u200D[\u2695\u2696\u2708])\uFE0F|\u{1F3FB}\u200D[\u{1F33E}\u{1F373}\u{1F393}\u{1F3A4}\u{1F3A8}\u{1F3EB}\u{1F3ED}\u{1F4BB}\u{1F4BC}\u{1F527}\u{1F52C}\u{1F680}\u{1F692}\u{1F9AF}-\u{1F9B3}\u{1F9BC}\u{1F9BD}]|[\u{1F3FB}-\u{1F3FF}])|(?:\u{1F9D1}\u{1F3FB}\u200D\u{1F91D}\u200D\u{1F9D1}|\u{1F469}\u{1F3FC}\u200D\u{1F91D}\u200D\u{1F469})\u{1F3FB}|\u{1F9D1}(?:\u{1F3FF}\u200D\u{1F91D}\u200D\u{1F9D1}[\u{1F3FB}-\u{1F3FF}]|\u200D\u{1F91D}\u200D\u{1F9D1})|(?:\u{1F9D1}\u{1F3FE}\u200D\u{1F91D}\u200D\u{1F9D1}|\u{1F469}\u{1F3FF}\u200D\u{1F91D}\u200D[\u{1F468}\u{1F469}])[\u{1F3FB}-\u{1F3FE}]|(?:\u{1F9D1}\u{1F3FC}\u200D\u{1F91D}\u200D\u{1F9D1}|\u{1F469}\u{1F3FD}\u200D\u{1F91D}\u200D\u{1F469})[\u{1F3FB}\u{1F3FC}]|\u{1F469}(?:\u{1F3FE}\u200D(?:\u{1F91D}\u200D\u{1F468}[\u{1F3FB}-\u{1F3FD}\u{1F3FF}]|[\u{1F33E}\u{1F373}\u{1F393}\u{1F3A4}\u{1F3A8}\u{1F3EB}\u{1F3ED}\u{1F4BB}\u{1F4BC}\u{1F527}\u{1F52C}\u{1F680}\u{1F692}\u{1F9AF}-\u{1F9B3}\u{1F9BC}\u{1F9BD}])|\u{1F3FC}\u200D(?:\u{1F91D}\u200D\u{1F468}[\u{1F3FB}\u{1F3FD}-\u{1F3FF}]|[\u{1F33E}\u{1F373}\u{1F393}\u{1F3A4}\u{1F3A8}\u{1F3EB}\u{1F3ED}\u{1F4BB}\u{1F4BC}\u{1F527}\u{1F52C}\u{1F680}\u{1F692}\u{1F9AF}-\u{1F9B3}\u{1F9BC}\u{1F9BD}])|\u{1F3FB}\u200D(?:\u{1F91D}\u200D\u{1F468}[\u{1F3FC}-\u{1F3FF}]|[\u{1F33E}\u{1F373}\u{1F393}\u{1F3A4}\u{1F3A8}\u{1F3EB}\u{1F3ED}\u{1F4BB}\u{1F4BC}\u{1F527}\u{1F52C}\u{1F680}\u{1F692}\u{1F9AF}-\u{1F9B3}\u{1F9BC}\u{1F9BD}])|\u{1F3FD}\u200D(?:\u{1F91D}\u200D\u{1F468}[\u{1F3FB}\u{1F3FC}\u{1F3FE}\u{1F3FF}]|[\u{1F33E}\u{1F373}\u{1F393}\u{1F3A4}\u{1F3A8}\u{1F3EB}\u{1F3ED}\u{1F4BB}\u{1F4BC}\u{1F527}\u{1F52C}\u{1F680}\u{1F692}\u{1F9AF}-\u{1F9B3}\u{1F9BC}\u{1F9BD}])|\u200D(?:\u2764\uFE0F\u200D(?:\u{1F48B}\u200D[\u{1F468}\u{1F469}]|[\u{1F468}\u{1F469}])|[\u{1F33E}\u{1F373}\u{1F393}\u{1F3A4}\u{1F3A8}\u{1F3EB}\u{1F3ED}\u{1F4BB}\u{1F4BC}\u{1F527}\u{1F52C}\u{1F680}\u{1F692}\u{1F9AF}-\u{1F9B3}\u{1F9BC}\u{1F9BD}])|\u{1F3FF}\u200D[\u{1F33E}\u{1F373}\u{1F393}\u{1F3A4}\u{1F3A8}\u{1F3EB}\u{1F3ED}\u{1F4BB}\u{1F4BC}\u{1F527}\u{1F52C}\u{1F680}\u{1F692}\u{1F9AF}-\u{1F9B3}\u{1F9BC}\u{1F9BD}])|\u{1F469}\u200D\u{1F469}\u200D(?:\u{1F466}\u200D\u{1F466}|\u{1F467}\u200D[\u{1F466}\u{1F467}])|(?:\u{1F9D1}\u{1F3FD}\u200D\u{1F91D}\u200D\u{1F9D1}|\u{1F469}\u{1F3FE}\u200D\u{1F91D}\u200D\u{1F469})[\u{1F3FB}-\u{1F3FD}]|\u{1F469}\u200D\u{1F466}\u200D\u{1F466}|\u{1F469}\u200D\u{1F469}\u200D[\u{1F466}\u{1F467}]|(?:\u{1F441}\uFE0F\u200D\u{1F5E8}|\u{1F469}(?:\u{1F3FF}\u200D[\u2695\u2696\u2708]|\u{1F3FE}\u200D[\u2695\u2696\u2708]|\u{1F3FC}\u200D[\u2695\u2696\u2708]|\u{1F3FB}\u200D[\u2695\u2696\u2708]|\u{1F3FD}\u200D[\u2695\u2696\u2708]|\u200D[\u2695\u2696\u2708])|(?:[\u26F9\u{1F3CB}\u{1F3CC}\u{1F575}]\uFE0F|[\u{1F46F}\u{1F93C}\u{1F9DE}\u{1F9DF}])\u200D[\u2640\u2642]|[\u26F9\u{1F3CB}\u{1F3CC}\u{1F575}][\u{1F3FB}-\u{1F3FF}]\u200D[\u2640\u2642]|[\u{1F3C3}\u{1F3C4}\u{1F3CA}\u{1F46E}\u{1F471}\u{1F473}\u{1F477}\u{1F481}\u{1F482}\u{1F486}\u{1F487}\u{1F645}-\u{1F647}\u{1F64B}\u{1F64D}\u{1F64E}\u{1F6A3}\u{1F6B4}-\u{1F6B6}\u{1F926}\u{1F937}-\u{1F939}\u{1F93D}\u{1F93E}\u{1F9B8}\u{1F9B9}\u{1F9CD}-\u{1F9CF}\u{1F9D6}-\u{1F9DD}](?:[\u{1F3FB}-\u{1F3FF}]\u200D[\u2640\u2642]|\u200D[\u2640\u2642])|\u{1F3F4}\u200D\u2620)\uFE0F|\u{1F469}\u200D\u{1F467}\u200D[\u{1F466}\u{1F467}]|\u{1F3F3}\uFE0F\u200D\u{1F308}|\u{1F415}\u200D\u{1F9BA}|\u{1F469}\u200D\u{1F466}|\u{1F469}\u200D\u{1F467}|\u{1F1FD}\u{1F1F0}|\u{1F1F4}\u{1F1F2}|\u{1F1F6}\u{1F1E6}|[#\*0-9]\uFE0F\u20E3|\u{1F1E7}[\u{1F1E6}\u{1F1E7}\u{1F1E9}-\u{1F1EF}\u{1F1F1}-\u{1F1F4}\u{1F1F6}-\u{1F1F9}\u{1F1FB}\u{1F1FC}\u{1F1FE}\u{1F1FF}]|\u{1F1F9}[\u{1F1E6}\u{1F1E8}\u{1F1E9}\u{1F1EB}-\u{1F1ED}\u{1F1EF}-\u{1F1F4}\u{1F1F7}\u{1F1F9}\u{1F1FB}\u{1F1FC}\u{1F1FF}]|\u{1F1EA}[\u{1F1E6}\u{1F1E8}\u{1F1EA}\u{1F1EC}\u{1F1ED}\u{1F1F7}-\u{1F1FA}]|\u{1F9D1}[\u{1F3FB}-\u{1F3FF}]|\u{1F1F7}[\u{1F1EA}\u{1F1F4}\u{1F1F8}\u{1F1FA}\u{1F1FC}]|\u{1F469}[\u{1F3FB}-\u{1F3FF}]|\u{1F1F2}[\u{1F1E6}\u{1F1E8}-\u{1F1ED}\u{1F1F0}-\u{1F1FF}]|\u{1F1E6}[\u{1F1E8}-\u{1F1EC}\u{1F1EE}\u{1F1F1}\u{1F1F2}\u{1F1F4}\u{1F1F6}-\u{1F1FA}\u{1F1FC}\u{1F1FD}\u{1F1FF}]|\u{1F1F0}[\u{1F1EA}\u{1F1EC}-\u{1F1EE}\u{1F1F2}\u{1F1F3}\u{1F1F5}\u{1F1F7}\u{1F1FC}\u{1F1FE}\u{1F1FF}]|\u{1F1ED}[\u{1F1F0}\u{1F1F2}\u{1F1F3}\u{1F1F7}\u{1F1F9}\u{1F1FA}]|\u{1F1E9}[\u{1F1EA}\u{1F1EC}\u{1F1EF}\u{1F1F0}\u{1F1F2}\u{1F1F4}\u{1F1FF}]|\u{1F1FE}[\u{1F1EA}\u{1F1F9}]|\u{1F1EC}[\u{1F1E6}\u{1F1E7}\u{1F1E9}-\u{1F1EE}\u{1F1F1}-\u{1F1F3}\u{1F1F5}-\u{1F1FA}\u{1F1FC}\u{1F1FE}]|\u{1F1F8}[\u{1F1E6}-\u{1F1EA}\u{1F1EC}-\u{1F1F4}\u{1F1F7}-\u{1F1F9}\u{1F1FB}\u{1F1FD}-\u{1F1FF}]|\u{1F1EB}[\u{1F1EE}-\u{1F1F0}\u{1F1F2}\u{1F1F4}\u{1F1F7}]|\u{1F1F5}[\u{1F1E6}\u{1F1EA}-\u{1F1ED}\u{1F1F0}-\u{1F1F3}\u{1F1F7}-\u{1F1F9}\u{1F1FC}\u{1F1FE}]|\u{1F1FB}[\u{1F1E6}\u{1F1E8}\u{1F1EA}\u{1F1EC}\u{1F1EE}\u{1F1F3}\u{1F1FA}]|\u{1F1F3}[\u{1F1E6}\u{1F1E8}\u{1F1EA}-\u{1F1EC}\u{1F1EE}\u{1F1F1}\u{1F1F4}\u{1F1F5}\u{1F1F7}\u{1F1FA}\u{1F1FF}]|\u{1F1E8}[\u{1F1E6}\u{1F1E8}\u{1F1E9}\u{1F1EB}-\u{1F1EE}\u{1F1F0}-\u{1F1F5}\u{1F1F7}\u{1F1FA}-\u{1F1FF}]|\u{1F1F1}[\u{1F1E6}-\u{1F1E8}\u{1F1EE}\u{1F1F0}\u{1F1F7}-\u{1F1FB}\u{1F1FE}]|\u{1F1FF}[\u{1F1E6}\u{1F1F2}\u{1F1FC}]|\u{1F1FC}[\u{1F1EB}\u{1F1F8}]|\u{1F1FA}[\u{1F1E6}\u{1F1EC}\u{1F1F2}\u{1F1F3}\u{1F1F8}\u{1F1FE}\u{1F1FF}]|\u{1F1EE}[\u{1F1E8}-\u{1F1EA}\u{1F1F1}-\u{1F1F4}\u{1F1F6}-\u{1F1F9}]|\u{1F1EF}[\u{1F1EA}\u{1F1F2}\u{1F1F4}\u{1F1F5}]|[\u{1F3C3}\u{1F3C4}\u{1F3CA}\u{1F46E}\u{1F471}\u{1F473}\u{1F477}\u{1F481}\u{1F482}\u{1F486}\u{1F487}\u{1F645}-\u{1F647}\u{1F64B}\u{1F64D}\u{1F64E}\u{1F6A3}\u{1F6B4}-\u{1F6B6}\u{1F926}\u{1F937}-\u{1F939}\u{1F93D}\u{1F93E}\u{1F9B8}\u{1F9B9}\u{1F9CD}-\u{1F9CF}\u{1F9D6}-\u{1F9DD}][\u{1F3FB}-\u{1F3FF}]|[\u26F9\u{1F3CB}\u{1F3CC}\u{1F575}][\u{1F3FB}-\u{1F3FF}]|[\u261D\u270A-\u270D\u{1F385}\u{1F3C2}\u{1F3C7}\u{1F442}\u{1F443}\u{1F446}-\u{1F450}\u{1F466}\u{1F467}\u{1F46B}-\u{1F46D}\u{1F470}\u{1F472}\u{1F474}-\u{1F476}\u{1F478}\u{1F47C}\u{1F483}\u{1F485}\u{1F4AA}\u{1F574}\u{1F57A}\u{1F590}\u{1F595}\u{1F596}\u{1F64C}\u{1F64F}\u{1F6C0}\u{1F6CC}\u{1F90F}\u{1F918}-\u{1F91C}\u{1F91E}\u{1F91F}\u{1F930}-\u{1F936}\u{1F9B5}\u{1F9B6}\u{1F9BB}\u{1F9D2}-\u{1F9D5}][\u{1F3FB}-\u{1F3FF}]|[\u231A\u231B\u23E9-\u23EC\u23F0\u23F3\u25FD\u25FE\u2614\u2615\u2648-\u2653\u267F\u2693\u26A1\u26AA\u26AB\u26BD\u26BE\u26C4\u26C5\u26CE\u26D4\u26EA\u26F2\u26F3\u26F5\u26FA\u26FD\u2705\u270A\u270B\u2728\u274C\u274E\u2753-\u2755\u2757\u2795-\u2797\u27B0\u27BF\u2B1B\u2B1C\u2B50\u2B55\u{1F004}\u{1F0CF}\u{1F18E}\u{1F191}-\u{1F19A}\u{1F1E6}-\u{1F1FF}\u{1F201}\u{1F21A}\u{1F22F}\u{1F232}-\u{1F236}\u{1F238}-\u{1F23A}\u{1F250}\u{1F251}\u{1F300}-\u{1F320}\u{1F32D}-\u{1F335}\u{1F337}-\u{1F37C}\u{1F37E}-\u{1F393}\u{1F3A0}-\u{1F3CA}\u{1F3CF}-\u{1F3D3}\u{1F3E0}-\u{1F3F0}\u{1F3F4}\u{1F3F8}-\u{1F43E}\u{1F440}\u{1F442}-\u{1F4FC}\u{1F4FF}-\u{1F53D}\u{1F54B}-\u{1F54E}\u{1F550}-\u{1F567}\u{1F57A}\u{1F595}\u{1F596}\u{1F5A4}\u{1F5FB}-\u{1F64F}\u{1F680}-\u{1F6C5}\u{1F6CC}\u{1F6D0}-\u{1F6D2}\u{1F6D5}\u{1F6EB}\u{1F6EC}\u{1F6F4}-\u{1F6FA}\u{1F7E0}-\u{1F7EB}\u{1F90D}-\u{1F93A}\u{1F93C}-\u{1F945}\u{1F947}-\u{1F971}\u{1F973}-\u{1F976}\u{1F97A}-\u{1F9A2}\u{1F9A5}-\u{1F9AA}\u{1F9AE}-\u{1F9CA}\u{1F9CD}-\u{1F9FF}\u{1FA70}-\u{1FA73}\u{1FA78}-\u{1FA7A}\u{1FA80}-\u{1FA82}\u{1FA90}-\u{1FA95}]|[#\*0-9\xA9\xAE\u203C\u2049\u2122\u2139\u2194-\u2199\u21A9\u21AA\u231A\u231B\u2328\u23CF\u23E9-\u23F3\u23F8-\u23FA\u24C2\u25AA\u25AB\u25B6\u25C0\u25FB-\u25FE\u2600-\u2604\u260E\u2611\u2614\u2615\u2618\u261D\u2620\u2622\u2623\u2626\u262A\u262E\u262F\u2638-\u263A\u2640\u2642\u2648-\u2653\u265F\u2660\u2663\u2665\u2666\u2668\u267B\u267E\u267F\u2692-\u2697\u2699\u269B\u269C\u26A0\u26A1\u26AA\u26AB\u26B0\u26B1\u26BD\u26BE\u26C4\u26C5\u26C8\u26CE\u26CF\u26D1\u26D3\u26D4\u26E9\u26EA\u26F0-\u26F5\u26F7-\u26FA\u26FD\u2702\u2705\u2708-\u270D\u270F\u2712\u2714\u2716\u271D\u2721\u2728\u2733\u2734\u2744\u2747\u274C\u274E\u2753-\u2755\u2757\u2763\u2764\u2795-\u2797\u27A1\u27B0\u27BF\u2934\u2935\u2B05-\u2B07\u2B1B\u2B1C\u2B50\u2B55\u3030\u303D\u3297\u3299\u{1F004}\u{1F0CF}\u{1F170}\u{1F171}\u{1F17E}\u{1F17F}\u{1F18E}\u{1F191}-\u{1F19A}\u{1F1E6}-\u{1F1FF}\u{1F201}\u{1F202}\u{1F21A}\u{1F22F}\u{1F232}-\u{1F23A}\u{1F250}\u{1F251}\u{1F300}-\u{1F321}\u{1F324}-\u{1F393}\u{1F396}\u{1F397}\u{1F399}-\u{1F39B}\u{1F39E}-\u{1F3F0}\u{1F3F3}-\u{1F3F5}\u{1F3F7}-\u{1F4FD}\u{1F4FF}-\u{1F53D}\u{1F549}-\u{1F54E}\u{1F550}-\u{1F567}\u{1F56F}\u{1F570}\u{1F573}-\u{1F57A}\u{1F587}\u{1F58A}-\u{1F58D}\u{1F590}\u{1F595}\u{1F596}\u{1F5A4}\u{1F5A5}\u{1F5A8}\u{1F5B1}\u{1F5B2}\u{1F5BC}\u{1F5C2}-\u{1F5C4}\u{1F5D1}-\u{1F5D3}\u{1F5DC}-\u{1F5DE}\u{1F5E1}\u{1F5E3}\u{1F5E8}\u{1F5EF}\u{1F5F3}\u{1F5FA}-\u{1F64F}\u{1F680}-\u{1F6C5}\u{1F6CB}-\u{1F6D2}\u{1F6D5}\u{1F6E0}-\u{1F6E5}\u{1F6E9}\u{1F6EB}\u{1F6EC}\u{1F6F0}\u{1F6F3}-\u{1F6FA}\u{1F7E0}-\u{1F7EB}\u{1F90D}-\u{1F93A}\u{1F93C}-\u{1F945}\u{1F947}-\u{1F971}\u{1F973}-\u{1F976}\u{1F97A}-\u{1F9A2}\u{1F9A5}-\u{1F9AA}\u{1F9AE}-\u{1F9CA}\u{1F9CD}-\u{1F9FF}\u{1FA70}-\u{1FA73}\u{1FA78}-\u{1FA7A}\u{1FA80}-\u{1FA82}\u{1FA90}-\u{1FA95}]\uFE0F|[\u261D\u26F9\u270A-\u270D\u{1F385}\u{1F3C2}-\u{1F3C4}\u{1F3C7}\u{1F3CA}-\u{1F3CC}\u{1F442}\u{1F443}\u{1F446}-\u{1F450}\u{1F466}-\u{1F478}\u{1F47C}\u{1F481}-\u{1F483}\u{1F485}-\u{1F487}\u{1F48F}\u{1F491}\u{1F4AA}\u{1F574}\u{1F575}\u{1F57A}\u{1F590}\u{1F595}\u{1F596}\u{1F645}-\u{1F647}\u{1F64B}-\u{1F64F}\u{1F6A3}\u{1F6B4}-\u{1F6B6}\u{1F6C0}\u{1F6CC}\u{1F90F}\u{1F918}-\u{1F91F}\u{1F926}\u{1F930}-\u{1F939}\u{1F93C}-\u{1F93E}\u{1F9B5}\u{1F9B6}\u{1F9B8}\u{1F9B9}\u{1F9BB}\u{1F9CD}-\u{1F9CF}\u{1F9D1}-\u{1F9DD}]/gu},function(e,t,i){"use strict";i.d(t,"a",(function(){return Overrides}));var n=i(3);class Overrides extends n.default{constructor(...e){super(...e),this.inject("settings"),this.color_cache=null,this.name_cache=null}onEnable(){this.settings.provider.on("changed",this.onProviderChange,this)}onProviderChange(e){"overrides.colors"===e?this.loadColors():"overrides.names"===e&&this.loadNames()}get colors(){return this.color_cache||this.loadColors(),this.color_cache}get names(){return this.name_cache||this.loadNames(),this.name_cache}loadColors(){let e,t=!0;this.color_cache?e=new Set(Object.keys(this.color_cache)):(t=!1,this.color_cache={},e=new Set);for(const[i,n]of Object.entries(this.settings.provider.get("overrides.colors",{})))e.delete(i),this.color_cache[i]!==n&&(this.color_cache[i]=n,t&&this.emit(":changed",i,"color",n));for(const i of e)this.color_cache[i]=void 0,t&&this.emit(":changed",i,"color",void 0)}loadNames(){let e,t=!0;this.name_cache?e=new Set(Object.keys(this.name_cache)):(t=!1,this.name_cache={},e=new Set);for(const[i,n]of Object.entries(this.settings.provider.get("overrides.names",{})))e.delete(i),this.name_cache[i]!==n&&(this.name_cache[i]=n,t&&this.emit(":changed",i,"name",n));for(const i of e)this.name_cache[i]=void 0,t&&this.emit(":changed",i,"name",void 0)}getColor(e){return null!=this.colors[e]?this.colors[e]:null}getName(e){return null!=this.names[e]?this.names[e]:null}setColor(e,t){this.colors[e]!==t&&(this.colors[e]=t,this.settings.provider.set("overrides.colors",this.colors),this.emit(":changed",e,"color",t))}setName(e,t){this.names[e]!==t&&(this.names[e]=t,this.settings.provider.set("overrides.names",this.names),this.emit(":changed",e,"name",t))}deleteColor(e){this.setColor(e,void 0)}deleteName(e){this.setName(e,void 0)}}},function(e,t,i){"use strict";i.d(t,"a",(function(){return Room}));var n=i(42),s=i(2),r=i(1),o=i(0);class Room{constructor(e,t,i){this._destroy_timer=null,this.refs=new Set,this.style=new r.ManagedStyle(`room--${i}`),this.emote_sets=new o.SourcedSet,this.badges=null,this.users={},this.user_ids={},this.manager=e,this._id=t,this.login=i,t&&(this.manager.room_ids[t]=this),this.manager.emit(":room-add",this),this.load_data()}destroy(){if(clearTimeout(this._destroy_timer),this._destroy_timer=null,this.destroyed=!0,this.manager.emit(":room-remove",this),this.users)for(const e of Object.values(this.users))e&&e.destroy();if(this.user_ids)for(const e of Object.values(this.user_ids))e&&e.destroy();if(this.refs=null,this.users=null,this.user_ids=null,this.style&&(this.style.destroy(),this.style=null),this.emote_sets){for(const e of this.emote_sets._cache)this.manager.emotes.unrefSet(e);this.emote_sets=null}this._login&&(this.manager.rooms[this._login]===this&&(this.manager.rooms[this._login]=null),this.manager.socket.unsubscribe(this,`room.${this.login}`)),this.manager.room_ids[this._id]===this&&(this.manager.room_ids[this._id]=null)}merge(e){if(!this.login&&e.login&&(this.login=e.login),e.refs)for(const t of e.refs)this.ref(t);if(e.emote_sets&&e.emote_sets._sources)for(const[t,i]of e.emote_sets._sources.entries())for(const e of i)this.addSet(t,e);e.data&&!this.data&&(this.data=e.data,this.data.css?this.style.set("css",this.data.css):this.style.delete("css"),this.buildModBadgeCSS()),e.badges&&!this.badges&&(this.badges=e.badges,this.buildBadgeCSS()),e.bitsConfig&&!this.bitsConfig&&(this.bitsConfig=e.bitsConfig,this.buildBitsCSS());const t=new Set;if(e.users)for(const i of Object.values(e.users))i.destroyed||t.has(i)||(this.getUser(i.id,i.login).merge(i),t.add(i));if(e.user_ids)for(const i of Object.values(e.user_ids))i.destroyed||t.has(i)||(this.getUser(i.id,i.login).merge(i),t.add(i))}get id(){return this._id}get login(){return this._login}set login(e){if(this._login===e)return;if(this._login){this.manager.rooms[this._login]===this&&(this.manager.rooms[this._login]=null,this.manager.socket.unsubscribe(this,`room.${this.login}`))}if(this._login=e,!e)return;const t=this.manager.rooms[e];t&&t!==this&&(t.login=null),this._login=e,this.manager.rooms[e]=this,this.manager.socket.subscribe(this,`room.${e}`),this.manager.emit(":room-update-login",this,e)}getUser(e,t,i,s,r=!1){if(this.destroyed)return null;let o;if(e&&"number"==typeof e&&(e=`${e}`),e&&this.user_ids[e]?o=this.user_ids[e]:t&&this.users[t]&&!s&&(o=this.users[t]),o&&o.destroyed&&(o=null),!o){if(i)return null;o=new n.a(this.manager,this,e,t)}if(e&&e!==o.id){if(o.id){if(this.manager.log.warn(`Data mismatch for user #${e} -- Stored ID: ${o.id} -- Login: ${t} -- Stored Login: ${o.login}`),r)throw new Error("id mismatch");this.user_ids[o.id]===o&&(this.user_ids[o.id]=null)}o._id=e,this.user_ids[e]=o}if(t){const e=this.users[t];e?e===o||s||(e.id?this.users[t]=o:(o.merge(e),e.destroy())):this.users[t]=o}return o}async load_data(e=0){if(this.destroyed)return;if(this.manager.experiments.getAssignment("api_load"))try{fetch(`${s.NEW_API}/v1/room/${this.id?`id/${this.id}`:this.login}`).catch(()=>{})}catch(e){}let t,i;try{t=await fetch(`${s.API_SERVER}/v1/room/${this.id?`id/${this.id}`:this.login}`)}catch(t){return++e<10?setTimeout(()=>this.load_data(e),500*e):(this.manager.log.error(`Error loading room data for ${this.id}:${this.login}`,t),!1)}if(!t.ok)return!1;try{i=await t.json()}catch(e){return this.manager.log.error(`Error parsing room data for ${this.id}:${this.login}`,e),!1}const n=i.room,r=`${n.twitch_id}`;if(this._id){if(this._id!==r)return this.manager.log.warn(`Received data for ${this.id}:${this.login} with the wrong ID: ${r}`),!1}else this._id=r,this.manager.room_ids[r]=this;if(this.login?this.login!==n.id&&this.manager.log.warn(`Login mismatch for room ${this.id}:${this.login}. Got "${n.id}" from FFZ's API.`):this.login=n.id,this.data=n,n.set?this.emote_sets.set("main",n.set):this.emote_sets.delete("main"),i.sets)for(const e in i.sets)Object(o.has)(i.sets,e)&&this.manager.emotes.loadSetData(e,i.sets[e]);const a=i.user_badges;if(a)for(const e in a)if(Object(o.has)(a,e))for(const t of a[e])this.getUser(void 0,t).addBadge("ffz",e);return i.css?this.style.set("css",i.css):this.style.delete("css"),this.buildModBadgeCSS(),!0}addSet(e,t,i){if(this.destroyed)return;let n=!1;this.emote_sets.sourceIncludes(e,t)||(this.emote_sets.push(e,t),this.manager.emotes.refSet(t),n=!0),i&&this.manager.emotes.loadSetData(t,i),n&&this.manager.emotes.emit(":update-room-sets",this,e,t,!0)}removeSet(e,t){this.destroyed||this.emote_sets.sourceIncludes(e,t)&&(this.emote_sets.remove(e,t),this.manager.emotes.unrefSet(t),this.manager.emotes.emit(":update-room-sets",this,e,t,!1))}ref(e){if(!this.refs)throw new Error("Attempting to use destroyed Room");clearTimeout(this._destroy_timer),this._destroy_timer=null,this.refs.add(e)}unref(e){this.refs&&(this.refs.delete(e),this.refs.size||this._destroy_timer||(this._destroy_timer=setTimeout(()=>this.destroy(),5e3)))}badgeCount(){return this.badge_count||0}updateBadges(e){if(this.badge_count=0,Array.isArray(e)){const t={};for(const i of e){const e=i.setID;(t[e]=t[e]||{})[i.version]=i,this.badge_count++}this.badges=t}else this.badges=e;this.buildBadgeCSS()}buildModBadgeCSS(){if(this.destroyed)return;if(!this.data||!this.data.mod_urls||!this.manager.context.get("chat.badges.custom-mod"))return this.style.delete("mod-badge");const e=this.manager.context.get("chat.badges.style"),t=e>5?`${s.WEBKIT_CSS}mask`:"background";if(!(3!==e&&4!==e))return this.style.delete("mod-badge");const i=this.data.mod_urls,n=`url("${i[1]}")`;let r;(i[2]||i[4])&&(r=`${s.WEBKIT_CSS}image-set(${n} 1x${i[2]?`, url("${i[2]}") 2x`:""}${i[4]?`, url("${i[4]}") 4x`:""})`),this.style.set("mod-badge",`[data-room-id="${this.id}"] .ffz-badge[data-badge="moderator"] {\n\t\t\t${t}-image: ${n};\n\t\t\t${r?`${t}-image: ${r};`:""}\n\t\t}`)}buildBadgeCSS(){if(this.destroyed)return;if(!this.badges)return this.style.delete("badges");const e=s.IS_FIREFOX&&this.manager.context.get("chat.badges.media-queries"),t=[],i=this.id;for(const n in this.badges)if(Object(o.has)(this.badges,n)){const r=this.badges[n];for(const a in r)if(Object(o.has)(r,a)){const o=r[a],l=`[data-room-id="${i}"] .ffz-badge[data-badge="${n}"][data-version="${a}"]`;t.push(`${l} {\n\t\t\tbackground-color: transparent;\n\t\t\tfilter: none;\n\t\t\t${s.WEBKIT_CSS}mask-image: none;\n\t\t\theight: 1.8rem;\n\t\t\twidth: 1.8rem;\n\t\t\tbackground-size: 1.8rem;\n\t\t\tbackground-image: url("${o.image1x}");\n\t\t\tbackground-image: ${s.WEBKIT_CSS}image-set(\n\t\t\t\turl("${o.image1x}") 1x,\n\t\t\t\turl("${o.image2x}") 2x,\n\t\t\t\turl("${o.image4x}") 4x\n\t\t\t);\n\t\t}`),e&&(t.push(`@media (min-resolution: 100dpi) and (max-resolution:199dpi) { ${l} {\n\t\t\t\t\t\t\t\tbackground-image: url("${o.image2x}");\n\t\t\t\t\t\t\t}}`),t.push(`@media (min-resolution: 200dpi) { ${l} {\n\t\t\t\t\t\t\t\tbackground-image: url("${o.image4x}");\n\t\t\t\t\t\t\t}}`))}}this.style.set("badges",t.join("\n"))}updateBitsConfig(e,t){if(!t&&this.bitsConfig&&e){const t=new Set(Object.keys(this.bitsConfig)),i=new Set(Object.keys(e));if(Object(o.set_equals)(t,i))return}this.bitsConfig=e,this.buildBitsCSS()}buildBitsCSS(){if(this.destroyed)return;if(!this.bitsConfig)return this.style.delete("bits");const e=this.manager.context.get("chat.bits.animated")?"animated":"static",t=this.manager.context.get("theme.is-dark")?"DARK":"LIGHT",i=this.manager.context.get("theme.tooltips-dark")?"DARK":"LIGHT",n=[];for(const r in this.bitsConfig)if(Object(o.has)(this.bitsConfig,r)){const o=this.bitsConfig[r],a=o.prefix.toLowerCase(),l=o.tiers,c=l.length;for(let r=0;r<c;r++){const o=l[r].images[t][e],c=l[r].images[i][e];n.push(`.ffz-cheer[data-prefix="${a}"][data-tier="${r}"] {\n\tcolor: ${l[r].color};\n\tbackground-image: url("${o[1]}");\n\tbackground-image: ${s.WEBKIT_CSS}image-set(\n\t\turl("${o[1]}") 1x,\n\t\turl("${o[2]}") 2x,\n\t\turl("${o[4]}") 4x\n\t);\n}\n.ffz__tooltip .ffz-cheer[data-prefix="${a}"][data-tier="${r}"] {\n\tbackground-image: url("${c[1]}");\n\tbackground-image: ${s.WEBKIT_CSS}image-set(\n\t\turl("${c[1]}") 1x,\n\t\turl("${c[2]}") 2x,\n\t\turl("${c[4]}") 4x\n\t);\n}\n.ffz-cheer-preview[data-prefix="${a}"][data-tier="${r}"] {\n\tbackground-image: url("${c[4]}");\n}`)}}this.style.set("bits",n.join("\n"))}}},function(e,t){var i={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"FFZ_GetClipInfo"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"slug"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"clip"},arguments:[{kind:"Argument",name:{kind:"Name",value:"slug"},value:{kind:"Variable",name:{kind:"Name",value:"slug"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"curator"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"displayName"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"broadcaster"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"displayName"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"game"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"displayName"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"title"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"thumbnailURL"},arguments:[{kind:"Argument",name:{kind:"Name",value:"width"},value:{kind:"IntValue",value:"86"}},{kind:"Argument",name:{kind:"Name",value:"height"},value:{kind:"IntValue",value:"45"}}],directives:[]},{kind:"Field",name:{kind:"Name",value:"viewCount"},arguments:[],directives:[]}]}}]}}],loc:{start:0,end:236}};i.loc.source={body:"query FFZ_GetClipInfo($slug: ID!) {\n\tclip(slug: $slug) {\n\t\tid\n\t\tcurator {\n\t\t\tid\n\t\t\tdisplayName\n\t\t}\n\t\tbroadcaster {\n\t\t\tid\n\t\t\tdisplayName\n\t\t}\n\t\tgame {\n\t\t\tid\n\t\t\tdisplayName\n\t\t}\n\t\ttitle\n\t\tthumbnailURL(width: 86, height: 45)\n\t\tviewCount\n\t}\n}",name:"GraphQL request",locationOffset:{line:1,column:1}};var n={};function findOperation(e,t){for(var i=0;i<e.definitions.length;i++){var n=e.definitions[i];if(n.name&&n.name.value==t)return n}}!function extractReferences(){i.definitions.forEach((function(e){if(e.name){var t=new Set;!function collectFragmentReferences(e,t){if("FragmentSpread"===e.kind)t.add(e.name.value);else if("VariableDefinition"===e.kind){var i=e.type;"NamedType"===i.kind&&t.add(i.name.value)}e.selectionSet&&e.selectionSet.selections.forEach((function(e){collectFragmentReferences(e,t)})),e.variableDefinitions&&e.variableDefinitions.forEach((function(e){collectFragmentReferences(e,t)})),e.definitions&&e.definitions.forEach((function(e){collectFragmentReferences(e,t)}))}(e,t),n[e.name.value]=t}}))}(),e.exports=i,e.exports.FFZ_GetClipInfo=function oneQuery(e,t){var i={kind:e.kind,definitions:[findOperation(e,t)]};e.hasOwnProperty("loc")&&(i.loc=e.loc);var s=n[t]||new Set,r=new Set,o=new Set;for(s.forEach((function(e){o.add(e)}));o.size>0;){var a=o;o=new Set,a.forEach((function(e){r.has(e)||(r.add(e),(n[e]||new Set).forEach((function(e){o.add(e)})))}))}return r.forEach((function(t){var n=findOperation(e,t);n&&i.definitions.push(n)})),i}(i,"FFZ_GetClipInfo")},function(e,t){var i={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"FFZ_GetVideoInfo"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"id"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"video"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"id"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"title"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"previewThumbnailURL"},arguments:[{kind:"Argument",name:{kind:"Name",value:"width"},value:{kind:"IntValue",value:"86"}},{kind:"Argument",name:{kind:"Name",value:"height"},value:{kind:"IntValue",value:"45"}}],directives:[]},{kind:"Field",name:{kind:"Name",value:"lengthSeconds"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"publishedAt"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"viewCount"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"game"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"displayName"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"owner"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"displayName"},arguments:[],directives:[]}]}}]}}]}}],loc:{start:0,end:226}};i.loc.source={body:"query FFZ_GetVideoInfo($id: ID!) {\n\tvideo(id: $id) {\n\t\tid\n\t\ttitle\n\t\tpreviewThumbnailURL(width: 86, height: 45)\n\t\tlengthSeconds\n\t\tpublishedAt\n\t\tviewCount\n\t\tgame {\n\t\t\tid\n\t\t\tdisplayName\n\t\t}\n\t\towner {\n\t\t\tid\n\t\t\tdisplayName\n\t\t}\n\t}\n}",name:"GraphQL request",locationOffset:{line:1,column:1}};var n={};function findOperation(e,t){for(var i=0;i<e.definitions.length;i++){var n=e.definitions[i];if(n.name&&n.name.value==t)return n}}!function extractReferences(){i.definitions.forEach((function(e){if(e.name){var t=new Set;!function collectFragmentReferences(e,t){if("FragmentSpread"===e.kind)t.add(e.name.value);else if("VariableDefinition"===e.kind){var i=e.type;"NamedType"===i.kind&&t.add(i.name.value)}e.selectionSet&&e.selectionSet.selections.forEach((function(e){collectFragmentReferences(e,t)})),e.variableDefinitions&&e.variableDefinitions.forEach((function(e){collectFragmentReferences(e,t)})),e.definitions&&e.definitions.forEach((function(e){collectFragmentReferences(e,t)}))}(e,t),n[e.name.value]=t}}))}(),e.exports=i,e.exports.FFZ_GetVideoInfo=function oneQuery(e,t){var i={kind:e.kind,definitions:[findOperation(e,t)]};e.hasOwnProperty("loc")&&(i.loc=e.loc);var s=n[t]||new Set,r=new Set,o=new Set;for(s.forEach((function(e){o.add(e)}));o.size>0;){var a=o;o=new Set,a.forEach((function(e){r.has(e)||(r.add(e),(n[e]||new Set).forEach((function(e){o.add(e)})))}))}return r.forEach((function(t){var n=findOperation(e,t);n&&i.definitions.push(n)})),i}(i,"FFZ_GetVideoInfo")},,,,,,,,function(e,t,i){"use strict";i.r(t);var n,s=i(8),r=i.n(s),o=i(36),a=i(16),l=i(3),c=i(0),u=i(2),h=i(22),d=i(97),f=i(98),p=i(41),g=i(102),m=i(4),_=i(124);class FrankerFaceZ extends l.default{constructor(){super();const e=performance.now(),t=FrankerFaceZ.version_info;FrankerFaceZ.instance=this,this.name="frankerfacez",this.__state=0,this.__modules.core=this,this.inject("raven",o.a),this.log=new a.default(null,null,null,this.raven),this.log.init=!0,this.core_log=this.log.get("core"),this.log.info(`FrankerFaceZ v${t} (build ${t.build}${t.commit?` - commit ${t.commit}`:""})`),this.inject("settings",h.a),this.inject("experiments",f.a),this.inject("i18n",p.a),this.inject("socket",g.a),this.inject("site",m.a),this.inject("addons",d.a),this.register("vue",_.a),this.discoverModules(),this.enable().then(()=>this.enableInitialModules()).then(()=>{const t=performance.now()-e;this.core_log.info(`Initialization complete in ${t.toFixed(5)}ms.`),this.log.init=!1}).catch(e=>{this.core_log.error("An error occurred during initialization.",e),this.log.init=!1})}static get(){return FrankerFaceZ.instance}async generateLog(){const e=[];for(const t in this.__modules){const i=this.__modules[t];i instanceof l.default&&i.generateLog&&i!=this&&e.push((async()=>{try{return[t,await Object(c.timeout)(Promise.resolve(i.generateLog()),5e3)]}catch(e){return[t,`Error: ${e}`]}})())}const t=await Promise.all(e);if(this.log.captured_init&&this.log.captured_init.length>0){const e=[];for(const t of this.log.captured_init){const i=r()(t.time).locale("en").format("H:mm:ss");e.push(`[${i}] ${t.level} | ${t.category||"core"}: ${t.message}`)}t.unshift(["initialization",e.join("\n")])}return t.map(e=>`${e[0]}\n-------------------------------------------------------------------------------\n${"string"==typeof e[1]?e[1]:JSON.stringify(e[1],null,4)}`).join("\n\n")}discoverModules(){const e=i(163),t=this.populate(e,this.core_log);this.core_log.info(`Loaded descriptions of ${Object.keys(t).length} modules.`)}async enableInitialModules(){const e=[];for(const t in this.__modules){const i=this.__modules[t];i instanceof l.default&&i.should_enable&&e.push(i.enable())}await Promise.all(e)}}FrankerFaceZ.Logger=a.default;const b=FrankerFaceZ.version_info={major:4,minor:17,revision:13,extra:(null===(n=Object({}))||void 0===n?void 0:n.length)&&Object({})[0],commit:"3cbe4ee2fc110a051c90aab08d4c3974b8003b53",build:i.h,toString:()=>`${b.major}.${b.minor}.${b.revision}${b.extra||""}${u.DEBUG?"-dev":""}`};FrankerFaceZ.utilities={addon:i(169),color:i(9),constants:i(2),dialog:i(26),dom:i(1),events:i(5),fontAwesome:i(40),graphql:i(91),logging:i(16),module:i(3),object:i(0),time:i(6),tooltip:i(12),i18n:i(89),dayjs:i(8),popper:i(27).default},window.FrankerFaceZ=FrankerFaceZ,window.ffz=new FrankerFaceZ},function(e,t,i){var n;e.exports=(n=n||function(e,t){var i=Object.create||function(){function F(){}return function(e){var t;return F.prototype=e,t=new F,F.prototype=null,t}}(),n={},s=n.lib={},r=s.Base={extend:function(e){var t=i(this);return e&&t.mixIn(e),t.hasOwnProperty("init")&&this.init!==t.init||(t.init=function(){t.$super.init.apply(this,arguments)}),t.init.prototype=t,t.$super=this,t},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}},o=s.WordArray=r.extend({init:function(e,t){e=this.words=e||[],this.sigBytes=null!=t?t:4*e.length},toString:function(e){return(e||l).stringify(this)},concat:function(e){var t=this.words,i=e.words,n=this.sigBytes,s=e.sigBytes;if(this.clamp(),n%4)for(var r=0;r<s;r++){var o=i[r>>>2]>>>24-r%4*8&255;t[n+r>>>2]|=o<<24-(n+r)%4*8}else for(r=0;r<s;r+=4)t[n+r>>>2]=i[r>>>2];return this.sigBytes+=s,this},clamp:function(){var t=this.words,i=this.sigBytes;t[i>>>2]&=4294967295<<32-i%4*8,t.length=e.ceil(i/4)},clone:function(){var e=r.clone.call(this);return e.words=this.words.slice(0),e},random:function(t){for(var i,n=[],r=function(t){t=t;var i=987654321,n=4294967295;return function(){var s=((i=36969*(65535&i)+(i>>16)&n)<<16)+(t=18e3*(65535&t)+(t>>16)&n)&n;return s/=4294967296,(s+=.5)*(e.random()>.5?1:-1)}},s=0;s<t;s+=4){var a=r(4294967296*(i||e.random()));i=987654071*a(),n.push(4294967296*a()|0)}return new o.init(n,t)}}),a=n.enc={},l=a.Hex={stringify:function(e){for(var t=e.words,i=e.sigBytes,n=[],s=0;s<i;s++){var r=t[s>>>2]>>>24-s%4*8&255;n.push((r>>>4).toString(16)),n.push((15&r).toString(16))}return n.join("")},parse:function(e){for(var t=e.length,i=[],n=0;n<t;n+=2)i[n>>>3]|=parseInt(e.substr(n,2),16)<<24-n%8*4;return new o.init(i,t/2)}},c=a.Latin1={stringify:function(e){for(var t=e.words,i=e.sigBytes,n=[],s=0;s<i;s++){var r=t[s>>>2]>>>24-s%4*8&255;n.push(String.fromCharCode(r))}return n.join("")},parse:function(e){for(var t=e.length,i=[],n=0;n<t;n++)i[n>>>2]|=(255&e.charCodeAt(n))<<24-n%4*8;return new o.init(i,t)}},u=a.Utf8={stringify:function(e){try{return decodeURIComponent(escape(c.stringify(e)))}catch(e){throw new Error("Malformed UTF-8 data")}},parse:function(e){return c.parse(unescape(encodeURIComponent(e)))}},h=s.BufferedBlockAlgorithm=r.extend({reset:function(){this._data=new o.init,this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=u.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(t){var i=this._data,n=i.words,s=i.sigBytes,r=this.blockSize,a=s/(4*r),l=(a=t?e.ceil(a):e.max((0|a)-this._minBufferSize,0))*r,c=e.min(4*l,s);if(l){for(var u=0;u<l;u+=r)this._doProcessBlock(n,u);var h=n.splice(0,l);i.sigBytes-=c}return new o.init(h,c)},clone:function(){var e=r.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0}),d=(s.Hasher=h.extend({cfg:r.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){h.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){return e&&this._append(e),this._doFinalize()},blockSize:16,_createHelper:function(e){return function(t,i){return new e.init(i).finalize(t)}},_createHmacHelper:function(e){return function(t,i){return new d.HMAC.init(e,i).finalize(t)}}}),n.algo={});return n}(Math),n)},function(e,t,i){var n={"./af.js":[177,5],"./ar-dz.js":[178,6],"./ar-kw.js":[179,46],"./ar-ly.js":[180,57],"./ar-ma.js":[181,68],"./ar-sa.js":[182,79],"./ar-tn.js":[183,90],"./ar.js":[184,101],"./az.js":[185,112],"./be.js":[186,123],"./bg.js":[187,7],"./bm.js":[188,18],"./bn.js":[189,29],"./bo.js":[190,39],"./br.js":[191,40],"./bs.js":[192,41],"./ca.js":[193,42],"./cs.js":[194,43],"./cv.js":[195,44],"./cy.js":[196,45],"./da.js":[197,47],"./de-at.js":[198,48],"./de-ch.js":[199,49],"./de.js":[200,50],"./dv.js":[201,51],"./el.js":[202,52],"./en-SG.js":[203,53],"./en-au.js":[204,54],"./en-ca.js":[205,55],"./en-gb.js":[206,56],"./en-ie.js":[207,58],"./en-il.js":[208,59],"./en-nz.js":[209,60],"./en.js":[210,61],"./eo.js":[211,62],"./es-do.js":[212,63],"./es-us.js":[213,64],"./es.js":[214,65],"./et.js":[215,66],"./eu.js":[216,67],"./fa.js":[217,69],"./fi.js":[218,70],"./fo.js":[219,71],"./fr-ca.js":[220,72],"./fr-ch.js":[221,73],"./fr.js":[222,74],"./fy.js":[223,75],"./ga.js":[224,76],"./gd.js":[225,77],"./gl.js":[226,78],"./gom-latn.js":[227,80],"./gu.js":[228,81],"./he.js":[229,82],"./hi.js":[230,83],"./hr.js":[231,84],"./hu.js":[232,85],"./hy-am.js":[233,86],"./id.js":[234,87],"./is.js":[235,88],"./it-ch.js":[236,89],"./it.js":[237,91],"./ja.js":[238,92],"./jv.js":[239,93],"./ka.js":[240,94],"./kk.js":[241,95],"./km.js":[242,96],"./kn.js":[243,97],"./ko.js":[244,98],"./ku.js":[245,99],"./ky.js":[246,100],"./lb.js":[247,102],"./lo.js":[248,103],"./lt.js":[249,104],"./lv.js":[250,105],"./me.js":[251,106],"./mi.js":[252,107],"./mk.js":[253,108],"./ml.js":[254,109],"./mn.js":[255,110],"./mr.js":[256,111],"./ms-my.js":[257,113],"./ms.js":[258,114],"./mt.js":[259,115],"./my.js":[260,116],"./nb.js":[261,117],"./ne.js":[262,118],"./nl-be.js":[263,119],"./nl.js":[264,120],"./nn.js":[265,121],"./oc-lnc.js":[266,122],"./pa-in.js":[267,124],"./pl.js":[268,125],"./pt-br.js":[269,126],"./pt.js":[270,127],"./ro.js":[271,128],"./ru.js":[272,129],"./sd.js":[273,130],"./se.js":[274,131],"./si.js":[275,132],"./sk.js":[276,133],"./sl.js":[277,8],"./sq.js":[278,9],"./sr-cyrl.js":[279,10],"./sr.js":[280,11],"./ss.js":[281,12],"./sv.js":[282,13],"./sw.js":[283,14],"./ta.js":[284,15],"./te.js":[285,16],"./tet.js":[286,17],"./tg.js":[287,19],"./th.js":[288,20],"./tl-ph.js":[289,21],"./tlh.js":[290,22],"./tr.js":[291,23],"./tzl.js":[292,24],"./tzm-latn.js":[293,25],"./tzm.js":[294,26],"./ug-cn.js":[295,27],"./uk.js":[296,28],"./ur.js":[297,30],"./uz-latn.js":[298,31],"./uz.js":[299,32],"./vi.js":[300,33],"./x-pseudo.js":[301,34],"./yo.js":[302,35],"./zh-cn.js":[303,36],"./zh-hk.js":[304,37],"./zh-tw.js":[305,38]};function webpackAsyncContext(e){if(!i.o(n,e))return Promise.resolve().then((function(){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}));var t=n[e],s=t[0];return i.e(t[1]).then((function(){return i.t(s,7)}))}webpackAsyncContext.keys=function webpackAsyncContextKeys(){return Object.keys(n)},webpackAsyncContext.id=144,e.exports=webpackAsyncContext},function(e,t,i){var n={"./bits_button.js":146,"./bttv_compat.js":147,"./channel.js":148,"./channel_bar.jsx":149,"./chat/index.js":90,"./compat_emote_menu.js":150,"./css_tweaks/index.js":151,"./dashboard.js":152,"./directory/index.jsx":153,"./featured_follow.js":154,"./host_button.js":155,"./layout.js":156,"./menu_button.jsx":157,"./player.jsx":158,"./settings_sync.js":159,"./sub_button.jsx":160,"./theme/index.js":161,"./video_chat/index.jsx":162};function webpackContext(e){var t=webpackContextResolve(e);return i(t)}function webpackContextResolve(e){if(!i.o(n,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return n[e]}webpackContext.keys=function webpackContextKeys(){return Object.keys(n)},webpackContext.resolve=webpackContextResolve,e.exports=webpackContext,webpackContext.id=145},function(e,t,i){"use strict";i.r(t),i.d(t,"default",(function(){return BitsButton}));var n=i(3);class BitsButton extends n.default{constructor(...e){super(...e),this.should_enable=!0,this.inject("settings"),this.inject("site.fine"),this.settings.add("layout.display-bits-button",{requires:["chat.bits.show"],default:null,process:(e,t)=>null!=t?t:e.get("chat.bits.show"),ui:{path:"Appearance > Layout >> Top Navigation",title:"Show the Get Bits button.",description:"By default, this inherits its value from Chat > Bits and Cheering > Display Bits",component:"setting-check-box"},changed:()=>this.BitsButton.forceUpdate()}),this.BitsButton=this.fine.define("bits-button",e=>e.toggleBalloon&&e.toggleShowTutorial)}onEnable(){this.BitsButton.ready(e=>{const t=this,i=e.prototype.render;e.prototype.render=function(){return t.settings.get("layout.display-bits-button")?i.call(this):null},this.BitsButton.forceUpdate()})}}},function(e,t,i){"use strict";i.r(t),i.d(t,"default",(function(){return BTTVCompat}));var n=i(3);const s=["chat-input"];class BTTVCompat extends n.default{constructor(...e){super(...e),this.should_enable=!0}onEnable(){this.on("core:dom-update",this.handleDomUpdate,this)}handleDomUpdate(e){var t,i;if((null===(t=window.BetterTTV)||void 0===t?void 0:null===(i=t.watcher)||void 0===i?void 0:i.emitLoad)&&s.includes(e)){this.log.info("Sending chat reload event to BetterTTV.");try{window.BetterTTV.watcher.emitLoad("chat")}catch(e){this.log.error("An error occurred with BetterTTV:",e)}}}}},function(e,t,i){"use strict";i.r(t),i.d(t,"default",(function(){return Channel}));var n=i(3),s=i(0),r=i(4),o=i(9);class Channel extends n.default{constructor(...e){super(...e),this.should_enable=!0,this.inject("settings"),this.inject("site.fine"),this.inject("site.css_tweaks"),this.joined_raids=new Set,this.settings.add("channel.hosting.enable",{default:!0,ui:{path:"Channel > Behavior >> Hosting",title:"Enable Channel Hosting",component:"setting-check-box"},changed:e=>this.updateChannelHosting(e)}),this.settings.add("channel.raids.no-autojoin",{default:!1,ui:{path:"Channel > Behavior >> Raids",title:"Do not automatically join raids.",component:"setting-check-box"}}),this.ChannelPage=this.fine.define("channel-page",e=>e.updateHost&&e.updateChannel&&e.state&&Object(s.has)(e.state,"hostedChannel")||e.getHostedChannelLogin&&e.handleHostingChange||e.onChatHostingChange&&e.state&&Object(s.has)(e.state,"hostMode"),["user","video","user-video","user-clip","user-videos","user-clips","user-collections","user-events","user-followers","user-following"]),this.RaidController=this.fine.define("raid-controller",e=>e.handleLeaveRaid&&e.handleJoinRaid,r.a.CHAT_ROUTES),this.ChannelContext=this.fine.define("channel-context",e=>e.resetPrivateVariables&&e.fetchChannel&&e.clearBroadcastSettingsUpdateInterval,["popout","embed-chat"])}updateChannelColor(e){let t=e&&o.Color.RGBA.fromHex(e);t||(t=o.Color.RGBA.fromHex("9147FF")),t?(this.css_tweaks.setVariable("channel-color",t.toCSS()),this.css_tweaks.setVariable("channel-color-20",t._a(.2).toCSS()),this.css_tweaks.setVariable("channel-color-30",t._a(.3).toCSS())):(this.css_tweaks.deleteVariable("channel-color"),this.css_tweaks.deleteVariable("channel-color-20"),this.css_tweaks.deleteVariable("channel-color-30"))}onEnable(){this.ChannelPage.on("mount",this.wrapChannelPage,this),this.RaidController.on("mount",this.wrapRaidController,this),this.RaidController.on("update",this.noAutoRaids,this),this.ChannelContext.on("mount",this.onChannelContext,this),this.ChannelContext.on("update",this.onChannelContext,this),this.ChannelContext.on("unmount",this.offChannelContext,this),this.ChannelContext.ready((e,t)=>{for(const e of t)this.onChannelContext(e)}),this.RaidController.ready((e,t)=>{for(const e of t)this.wrapRaidController(e)}),this.ChannelPage.on("mount",this.onChannelMounted,this),this.ChannelPage.on("unmount",()=>{this.updateChannelColor(null),this.settings.updateContext({channel:null,channelID:null,channelColor:null,category:null,categoryID:null,title:null})}),this.ChannelPage.on("update",e=>{const t=Object(s.get)("state.video.game",e)||Object(s.get)("state.clip.game",e)||Object(s.get)("state.channel.stream.game",e)||Object(s.get)("state.channel.broadcastSettings.game",e),i=Object(s.get)("state.video.title",e)||Object(s.get)("state.clip.title",e)||Object(s.get)("state.channel.stream.title",e)||Object(s.get)("state.channel.broadcastSettings.title",e),n=Object(s.get)("state.primaryColorHex",e);this.updateChannelColor(n),this.settings.updateContext({channel:Object(s.get)("state.channel.login",e),channelID:Object(s.get)("state.channel.id",e),channelColor:n,category:null==t?void 0:t.name,categoryID:null==t?void 0:t.id,title:i}),this.settings.get("channel.hosting.enable")||Object(s.has)(e.state,"hostMode")||Object(s.has)(e.state,"hostedChannel")||setTimeout(()=>{const t=e.props.data&&e.props.data.variables&&e.props.data.variables.currentChannelLogin;t&&t!==e.state.videoPlayerSource&&(e.ffzExpectedHost=e.state.videoPlayerSource,e.ffzOldHostHandler(null))})}),this.ChannelPage.ready((e,t)=>{for(const e of t)this.onChannelMounted(e)})}onChannelContext(e){var t,i,n,s,r,o,a;if(!e.state||e.state.loading)return;const l=e.state.channel,c=e.state.clip,u=e.state.video,h=(null==u?void 0:u.game)||(null==c?void 0:c.game)||(null==l?void 0:null===(t=l.stream)||void 0===t?void 0:t.game)||(null==l?void 0:null===(i=l.broadcastSettings)||void 0===i?void 0:i.game),d=(null==u?void 0:u.title)||(null==c?void 0:c.title)||(null==l?void 0:null===(n=l.stream)||void 0===n?void 0:n.title)||(null==l?void 0:null===(s=l.broadcastSettings)||void 0===s?void 0:s.title)||null,f=null===(r=e.state)||void 0===r?void 0:r.primaryColorHex;this.updateChannelColor(f),this.settings.updateContext({channel:null===(o=e.state.channel)||void 0===o?void 0:o.login,channelID:null===(a=e.state.channel)||void 0===a?void 0:a.id,channelColor:f,category:null==h?void 0:h.name,categoryID:null==h?void 0:h.id,title:d})}offChannelContext(){this.updateChannelColor(null),this.settings.updateContext({channel:null,channelID:null,category:null,categoryID:null,channelColor:null,title:null})}onChannelMounted(e){this.wrapChannelPage(e);const t=Object(s.get)("state.video.game",e)||Object(s.get)("state.clip.game",e)||Object(s.get)("state.channel.stream.game",e)||Object(s.get)("state.channel.broadcastSettings.game",e),i=Object(s.get)("state.video.title",e)||Object(s.get)("state.clip.title",e)||Object(s.get)("state.channel.stream.title",e)||Object(s.get)("state.channel.broadcastSettings.title",e)||null,n=Object(s.get)("state.primaryColorHex",e);this.updateChannelColor(n),this.settings.updateContext({channel:Object(s.get)("state.channel.login",e),channelID:Object(s.get)("state.channel.id",e),channelColor:n,category:null==t?void 0:t.name,categoryID:null==t?void 0:t.id,title:i})}wrapRaidController(e){if(e._ffz_wrapped)return this.noAutoRaids(e);e._ffz_wrapped=!0;const t=this,i=e.handleJoinRaid;e.handleJoinRaid=function(n,...s){const r=e.props&&e.props.raid&&e.props.raid.id;return n&&n.type&&r&&t.joined_raids.add(r),i.call(this,n,...s)},this.noAutoRaids(e)}noAutoSquads(e){this.settings.get("channel.squads.no-autojoin")&&setTimeout(()=>{e.isValidSquad()&&e.state&&e.state.hasJoined&&(this.log.info("Automatically opting out of Squad Stream."),e.handleLeaveSquad())})}noAutoRaids(e){this.settings.get("channel.raids.no-autojoin")&&setTimeout(()=>{if(e.props&&e.props.raid&&!e.isRaidCreator&&e.hasJoinedCurrentRaid){const t=e.props.raid.id;if(this.joined_raids.has(t))return;this.log.info("Automatically leaving raid:",t),e.handleLeaveRaid()}})}wrapChannelPage(e){if(e._ffz_hosting_wrapped)return;const t=this,i=e.updateChannel&&Object(s.has)(e.state,"hostedChannel"),n=!i&&!e.handleHostingChange||Object(s.has)(e.state,"hostMode");if(e.ffzGetChannel=()=>{const t=e.props.match.params;return t?t.channelName||t.channelLogin:Object(s.get)("props.data.variables.currentChannelLogin",e)},e.ffzOldSetState=e.setState,e.setState=function(r,...o){try{if(i){const i=e.ffzGetChannel();Object(s.has)(r,"hostedChannel")?(e.ffzExpectedHost=r.hostedChannel,r.hostedChannel&&!t.settings.get("channel.hosting.enable")&&(r.hostedChannel=null,r.videoPlayerSource=i),t.settings.updateContext({hosting:!!r.hostedChannel})):Object(s.has)(r,"videoPlayerSource")&&(r.videoPlayerSource===i||t.settings.get("channel.hosting.enable")||(r.videoPlayerSource=i))}else if(n){const i=e.ffzGetChannel();Object(s.has)(r,"hostMode")?(e.ffzExpectedHost=r.hostMode,r.hostMode&&!t.settings.get("channel.hosting.enable")&&(r.hostMode=null,r.videoPlayerSource=i),t.settings.updateContext({hosting:!!r.hostMode})):Object(s.has)(r,"videoPlayerSource")&&(r.videoPlayerSource===i||t.settings.get("channel.hosting.enable")||(r.videoPlayerSource=i))}else t.settings.get("channel.hosting.enable")||(Object(s.has)(r,"isHosting")&&(r.isHosting=!1),Object(s.has)(r,"videoPlayerSource")&&(r.videoPlayerSource=e.ffzGetChannel())),Object(s.has)(r,"isHosting")&&t.settings.updateContext({hosting:r.isHosting})}catch(i){t.log.capture(i,{extra:{props:e.props,state:r}})}return e.ffzOldSetState(r,...o)},e._ffz_hosting_wrapped=!0,i){const t=e.ffzExpectedHost=e.state.hostedChannel;this.settings.updateContext({hosting:this.settings.get("channel.hosting.enable")&&!!t}),t&&!this.settings.get("channel.hosting.enable")&&e.ffzOldSetState({hostedChannel:null,videoPlayerSource:e.ffzGetChannel()})}else if(n){const t=e.ffzExpectedHost=e.state.hostMode;this.settings.updateContext({hosting:this.settings.get("channel.hosting.enable")&&!!e.state.hostMode}),t&&!this.settings.get("channel.hosting.enable")&&e.ffzOldSetState({hostMode:null,videoPlayerSource:e.ffzGetChannel()})}else e.ffzOldGetHostedLogin=()=>Object(s.get)("props.data.user.hosting.login",e)||null,e.getHostedChannelLogin=function(){return t.settings.get("channel.hosting.enable")?e.ffzOldGetHostedLogin():null},e.ffzOldHostHandler=e.handleHostingChange,e.handleHostingChange=function(i){if(e.ffzExpectedHost=i,t.settings.get("channel.hosting.enable"))return e.ffzOldHostHandler(i)},e.ffzExpectedHost=e.state.isHosting?e.state.videoPlayerSource:null,this.settings.updateContext({hosting:this.settings.get("channel.hosting.enable")&&e.state.isHosting}),this.settings.get("channel.hosting.enable")||e.ffzOldHostHandler(null);e.forceUpdate(),this.emit("site:dom-update","channel-page",e)}updateChannelHosting(e){void 0===e&&(e=this.settings.get("channel.hosting.enable"));let t=e;for(const i of this.ChannelPage.instances)if(i.ffzExpectedHost||(t=!1),Object(s.has)(i.state,"hostedChannel")){const t=e?i.ffzExpectedHost:null,n=t&&t.login||i.ffzGetChannel();i.ffzOldSetState({hostedChannel:t,videoPlayerSource:n})}else if(Object(s.has)(i.state,"hostMode")){const t=e?i.ffzExpectedHost:null,n=t&&t.hostedChannel&&t.hostedChannel.login||i.ffzGetChannel();i.ffzOldSetState({hostMode:t,videoPlayerSource:n})}else i.ffzOldHostHandler(e?i.ffzExpectedHost:null);this.settings.updateContext({hosting:t})}}},function(e,t,i){"use strict";i.r(t),i.d(t,"default",(function(){return ChannelBar}));var n=i(3),s=i(0);class ChannelBar extends n.default{constructor(...e){super(...e),this.should_enable=!0,this.inject("i18n"),this.inject("settings"),this.inject("site.css_tweaks"),this.inject("site.fine"),this.inject("site.web_munch"),this.inject("site.apollo"),this.inject("site.twitch_data"),this.inject("metadata"),this.inject("socket"),this.settings.add("channel.metadata.force-above",{default:!1,ui:{path:"Channel > Metadata >> Appearance",title:"Force metadata and tags to the top of the channel information bar.",component:"setting-check-box"},changed:e=>this.css_tweaks.toggle("channel-metadata-top",e)}),this.VideoBar=this.fine.define("video-bar",e=>e.props&&e.props.getLastVideoOffset&&e.renderTrackedHighlightButton,["video","user-video"]),this.ChannelBar=this.fine.define("channel-bar",e=>e.getTitle&&e.getGame&&e.renderGame,["user"])}onEnable(){this.css_tweaks.toggle("channel-metadata-top",this.settings.get("channel.metadata.force-above")),this.on("i18n:update",()=>{for(const e of this.VideoBar.instances)this.updateVideoBar(e)}),this.ChannelBar.on("unmount",this.unmountChannelBar,this),this.ChannelBar.on("mount",this.updateChannelBar,this),this.ChannelBar.on("update",this.updateChannelBar,this),this.ChannelBar.ready((e,t)=>{for(const e of t)this.updateChannelBar(e)}),this.VideoBar.on("mount",this.updateVideoBar,this),this.VideoBar.on("update",this.updateVideoBar,this),this.VideoBar.ready((e,t)=>{for(const e of t)this.updateVideoBar(e)})}updateVideoBar(e){const t=this.fine.getChildNode(e),i=t&&t.querySelector('[data-test-selector="date"]');if(!i)return;const n=Object(s.get)("props.video.publishedAt",e);n?(i.classList.toggle("ffz-tooltip",!0),i.dataset.title=this.i18n.t("video.published-on","Published on: {date,date}",{date:n})):i.classList.toggle("ffz-tooltip",!1)}updateChannelBar(e){const t=Object(s.get)("props.channel.login",e);t!==e._ffz_old_login&&(e._ffz_old_login&&this.socket.unsubscribe(e,`channel.${e._ffz_old_login}`),t&&this.socket.subscribe(e,`channel.${t}`),e._ffz_old_login=t),this.updateUptime(e),this.updateMetadata(e)}unmountChannelBar(e){e._ffz_old_login&&(this.socket.unsubscribe(e,`channel.${e._ffz_old_login}`),e._ffz_old_login=null);const t=e._ffz_meta_timers;if(t)for(const e in t)t[e]&&clearTimeout(t[e]);e._ffz_meta_timers=null}getBroadcastID(e){var t,i,n;const s=null===(t=e.props)||void 0===t?void 0:null===(i=t.channel)||void 0===i?void 0:null===(n=i.stream)||void 0===n?void 0:n.id;return s===e._ffz_stream_id&&Date.now()-e._ffz_broadcast_saved<6e4?Promise.resolve(e._ffz_broadcast_id):new Promise(async(t,i)=>{var n,r,o;if(e._ffz_broadcast_updating)return e._ffz_broadcast_updating.push([t,i]);let a,l;e._ffz_broadcast_updating=[[t,i]];try{a=await this.twitch_data.getBroadcastID(e.props.channel.id)}catch(e){a=null,l=e}const c=e._ffz_broadcast_updating;if(e._ffz_broadcast_updating=null,s===(null===(n=e.props)||void 0===n?void 0:null===(r=n.channel)||void 0===r?void 0:null===(o=r.stream)||void 0===o?void 0:o.id))if(e._ffz_broadcast_id=a,e._ffz_broadcast_saved=Date.now(),e._ffz_stream_id=s,l)for(const e of c)e[1](l);else for(const e of c)e[0](a);else{l=new Error("Outdated"),e._ffz_stream_id=null,e._ffz_broadcast_saved=0,e._ffz_broadcast_id=null;for(const e of c)e[1](l)}})}async updateUptime(e){var t,i;const n=null==e?void 0:null===(t=e.props)||void 0===t?void 0:null===(i=t.channel)||void 0===i?void 0:i.id;if(!(n===e._ffz_uptime_id&&Date.now()-e._ffz_uptime_saved<6e4||e._ffz_uptime_updating)){if(e._ffz_uptime_updating=!0,e._ffz_uptime_id=n,n)try{var s,r;e._ffz_meta=await this.twitch_data.getStreamMeta(n,null==e?void 0:null===(s=e.props)||void 0===s?void 0:null===(r=s.channel)||void 0===r?void 0:r.login)}catch(t){this.log.capture(t),this.log.error("Error fetching uptime:",t),e._ffz_meta=null}else e._ffz_meta=null;e._ffz_uptime_saved=Date.now(),e._ffz_uptime_updating=!1,this.updateMetadata(e)}}updateMetadata(e,t){var i;const n=this.fine.getChildNode(e),s=null==n?void 0:null===(i=n.querySelector)||void 0===i?void 0:i.call(n,".channel-info-bar__viewers-count-wrapper > .tw-flex:last-child");if(!e._ffz_mounted||!s)return;t?Array.isArray(t)||(t=[t]):t=this.metadata.keys;const r=e._ffz_meta_timers=e._ffz_meta_timers||{},refresh_func=t=>this.updateMetadata(e,t),o={channel:e.props.channel,meta:e._ffz_meta,hosting:!1,legacy:!0,_inst:e,getBroadcastID:()=>this.getBroadcastID(e)};for(const e of t)this.metadata.renderLegacy(e,o,s,r,refresh_func)}}},function(e,t,i){"use strict";i.r(t),i.d(t,"default",(function(){return CompatEmoteMenu}));var n=i(3),s=i(0);class CompatEmoteMenu extends n.default{constructor(...e){super(...e),this.should_enable=!0,this.inject("site.chat"),this.inject("chat.emotes")}onEnable(){this.hookEmoteMenu()}async hookEmoteMenu(){const e=await this.findEmoteMenu();if(!e)return this.log.info("Emote Menu for Twitch was not found after 60 seconds.");e.registerEmoteGetter("FrankerFaceZ",()=>{const e=this.chat.ChatContainer.first,t=e&&e.props;if(!t)return;const i=this.emotes.getSets(t.userID,t.currentUserLogin,t.channelID,t.channelLogin),n=[];for(const e of i)if(e&&e.emotes)for(const t in e.emotes)if(Object(s.has)(e.emotes,t)){const i=e.emotes[t];if(i.hidden)continue;n.push({text:i.name,url:i.urls[1],channel:`${e.source||"FrankerFaceZ"} ${e.title}`,badge:e.icon||"//cdn.frankerfacez.com/script/devicon.png"})}return n})}async findEmoteMenu(e=0){return window.emoteMenu&&emoteMenu.registerEmoteGetter?emoteMenu:e>=6e4?null:(await Object(s.sleep)(100),this.findEmoteMenu(e+100))}}},function(e,t,i){"use strict";i.r(t),i.d(t,"default",(function(){return CSSTweaks}));var n=i(3),s=i(1),r=i(0);const o=document.createElement("span"),a={"top-discover":'.navigation-link[data-a-target="discover-link"]',"side-nav":".side-nav","side-rec-channels":".side-nav .recommended-channels","side-rec-friends":".side-nav .recommended-friends","side-friends":".side-nav .online-friends","side-closed-friends":".side-nav--collapsed .online-friends","side-closed-rec-channels":".side-nav--collapsed .recommended-channels","side-offline-channels":'.side-nav-card__link[href*="/videos/"],.side-nav-card[href*="/videos/"]',"side-rerun-channels":".side-nav .ffz--side-nav-card-rerun","community-highlights":".community-highlight-stack__card","prime-offers":".top-nav__prime","player-ext":".video-player .extension-taskbar,.video-player .extension-container,.video-player .extensions-dock__layout,.video-player .extensions-notifications,.video-player .extensions-video-overlay-size-container,.video-player .extensions-dock__layout","player-ext-hover":'.video-player__overlay[data-controls="false"] .extension-taskbar,.video-player__overlay[data-controls="false"] .extension-container,.video-player__overlay[data-controls="false"] .extensions-dock__layout,.video-player__overlay[data-controls="false"] .extensions-notifications,.video-player__overlay[data-controls="false"] .extensions-video-overlay-size-container',"player-event-bar":".channel-root .live-event-banner-ui__header","player-rerun-bar":'.channel-root__player-container div.tw-c-text-overlay:not([data-a-target="hosting-ui-header"])',"pinned-cheer":".pinned-cheer,.pinned-cheer-v2,.channel-leaderboard",whispers:"body .whispers","dir-live-ind":'.preview-card[data-ffz-type="live"] .tw-channel-status-text-indicator,.live-channel-card:not([data-a-target*="host"]) .stream-type-indicator.stream-type-indicator--live,.stream-thumbnail__card .stream-type-indicator.stream-type-indicator--live,.preview-card .stream-type-indicator.stream-type-indicator--live,.preview-card .preview-card-stat.preview-card-stat--live',"profile-hover":".preview-card .tw-relative:hover .ffz-channel-avatar","not-live-bar":'div[data-test-selector="non-live-video-banner-layout"]',"channel-live-ind":".channel-header__user .tw-channel-status-text-indicator"};class CSSTweaks extends n.default{constructor(...e){super(...e),this.should_enable=!0,this.inject("settings"),this.inject("site.chat"),this.inject("site.theme"),this.style=new s.ManagedStyle,this.chunks={},this.chunks_loaded=!1,this.settings.add("layout.side-nav.show",{default:!0,ui:{sort:-1,path:"Appearance > Layout >> Side Navigation",title:"Display Side Navigation",component:"setting-check-box"},changed:e=>this.toggle("hide-side-nav",!e)}),this.settings.add("layout.side-nav.show-avatars",{default:!0,ui:{path:"Appearance > Layout >> Side Navigation",title:"Display Channel Avatars",component:"setting-check-box"},changed:e=>this.toggle("hide-side-nav-avatars",!e)}),this.settings.add("layout.side-nav.show-rec-channels",{default:1,ui:{path:"Appearance > Layout >> Side Navigation",title:"Display Recommended / Popular Channels",component:"setting-select-box",data:[{value:0,title:"Never"},{value:1,title:"Always"},{value:2,title:"When Side Navigation is Open"}]},changed:e=>{this.toggleHide("side-rec-channels",0===e),this.toggleHide("side-closed-rec-channels",2===e)}}),this.settings.add("layout.side-nav.show-friends",{default:1,ui:{path:"Appearance > Layout >> Side Navigation",title:"Display Online Friends",component:"setting-select-box",data:[{value:0,title:"Never"},{value:1,title:"Always"},{value:2,title:"When Side Navigation is Open"}]},changed:e=>{this.toggleHide("side-friends",0===e),this.toggleHide("side-closed-friends",2===e)}}),this.settings.add("layout.side-nav.show-rec-friends",{default:!0,ui:{path:"Appearance > Layout >> Side Navigation",title:"Display Recommended Friends",component:"setting-check-box"},changed:e=>this.toggleHide("side-rec-friends",!e)}),this.settings.add("layout.side-nav.hide-offline",{default:!1,ui:{path:"Appearance > Layout >> Side Navigation",title:"Hide Offline Channels",component:"setting-check-box"},changed:e=>this.toggleHide("side-offline-channels",e)}),this.settings.add("layout.side-nav.rerun-style",{default:1,ui:{path:"Appearance > Layout >> Side Navigation",title:"Display Reruns",component:"setting-select-box",data:[{value:0,title:"Do Not Display"},{value:1,title:"Normally"},{value:2,title:"Faded (33% Opacity)"}]},changed:e=>{this.toggleHide("side-rerun-channels",0===e),this.toggle("side-rerun-opacity",2===e)}}),this.settings.add("layout.swap-sidebars",{default:!1,ui:{path:"Appearance > Layout >> Side Navigation",title:"Swap Sidebars",description:"Swap navigation and chat to the opposite sides of the window.",component:"setting-check-box"},changed:e=>this.toggle("swap-sidebars",e)}),this.settings.add("layout.minimal-navigation",{requires:["layout.theatre-navigation"],default:!1,process:(e,t)=>!!e.get("layout.theatre-navigation")||t,ui:{path:"Appearance > Layout >> Top Navigation",title:"Minimize Navigation",description:"Slide the site navigation bar up out of view when it isn't in use.",component:"setting-check-box"},changed:e=>this.toggle("minimal-navigation",e)}),this.settings.add("layout.theatre-navigation",{requires:["context.ui.theatreModeEnabled"],default:!1,process:(e,t)=>!!e.get("context.ui.theatreModeEnabled")&&t,ui:{path:"Appearance > Layout >> Top Navigation",title:"Show the minimized navigation bar when in theatre mode.",component:"setting-check-box"},changed:e=>this.toggle("theatre-nav",e)}),this.settings.add("layout.discover",{default:!0,ui:{path:"Appearance > Layout >> Top Navigation",title:"Show Discover link.",component:"setting-check-box"},changed:e=>{this.toggleHide("top-discover",!e),this.updateTopNav()}}),this.settings.add("layout.prime-offers",{default:!0,ui:{path:"Appearance > Layout >> Top Navigation",title:"Show Twitch Prime offers.",component:"setting-check-box"},changed:e=>this.toggleHide("prime-offers",!e)}),this.settings.add("whispers.show",{default:!0,ui:{path:"Chat > Whispers >> General",title:"Display Whispers",component:"setting-check-box"},changed:e=>this.toggleHide("whispers",!e)}),this.settings.add("chat.bits.show",{default:!0,ui:{order:-1,path:"Chat > Bits and Cheering >> Appearance",title:"Display Bits",description:"Display UI associated with bits. Note: This will not hide cheering in chat messages.",component:"setting-check-box"},changed:e=>this.toggle("hide-bits",!e)}),this.settings.add("layout.theme.global-font",{default:"",ui:{path:"Appearance > Theme >> Fonts",title:"Font Family",description:'Override the font used for the entire Twitch website. The old default font was: `"Helvetica Neue",Helvetica,Arial,sans-serif`',component:"setting-text-box"},changed:()=>this.updateFont()}),this.settings.add("channel.hide-live-indicator",{requires:["context.route.name"],process:(e,t)=>"user"===e.get("context.route.name")&&t,default:!1,ui:{path:"Channel > Appearance >> General",title:'Hide the "LIVE" indicator on live channel pages.',component:"setting-check-box"},changed:e=>this.toggleHide("channel-live-ind",e)}),this.settings.add("channel.round-avatars",{default:!0,ui:{path:"Channel > Appearance >> General",title:"Allow avatar images to be rounded.",component:"setting-check-box"},changed:e=>this.toggle("square-avatars",!e)}),this.settings.add("channel.hide-not-live-bar",{default:!1,ui:{path:"Channel > Appearance >> General",title:'Hide the "Not Live" bar.',description:"Hide the bar which appears beneath clips and videos when the streamer is live, telling you they are live.",component:"setting-check-box"},changed:e=>this.toggleHide("not-live-bar",e)})}onEnable(){this.toggle("swap-sidebars",this.settings.get("layout.swap-sidebars")),this.toggle("minimal-navigation",this.settings.get("layout.minimal-navigation")),this.toggle("theatre-nav",this.settings.get("layout.theatre-navigation")),this.toggle("hide-side-nav-avatars",!this.settings.get("layout.side-nav.show-avatars")),this.toggle("hide-side-nav",!this.settings.get("layout.side-nav.show")),this.toggleHide("side-rec-friends",!this.settings.get("layout.side-nav.show-rec-friends")),this.toggleHide("side-offline-channels",this.settings.get("layout.side-nav.hide-offline")),this.toggleHide("prime-offers",!this.settings.get("layout.prime-offers")),this.toggleHide("top-discover",!this.settings.get("layout.discover")),this.toggle("square-avatars",!this.settings.get("channel.round-avatars")),this.toggleHide("not-live-bar",this.settings.get("channel.hide-not-live-bar")),this.toggleHide("channel-live-ind",this.settings.get("channel.hide-live-indicator"));const e=this.settings.get("layout.side-nav.rerun-style");this.toggleHide("side-rerun-channels",0===e),this.toggle("side-rerun-opacity",2===e);const t=this.settings.get("layout.side-nav.show-rec-channels");this.toggleHide("side-rec-channels",0===t),this.toggleHide("side-closed-rec-channels",2===t);const i=this.settings.get("layout.side-nav.show-friends");this.toggleHide("side-friends",0===i),this.toggleHide("side-closed-friends",2===i),this.toggleHide("whispers",!this.settings.get("whispers.show")),this.updateFont(),this.updateTopNav()}updateTopNav(){requestAnimationFrame(()=>this.emit("site.layout:update-nav"))}updateFont(){let e=this.settings.get("layout.theme.global-font");if(e&&e.length&&(-1!==e.indexOf(" ")&&-1===e.indexOf(",")&&-1===e.indexOf('"')&&-1===e.indexOf("'")&&(e=`"${e}"`),o.style.fontFamily="",o.style.fontFamily=e,o.style.fontFamily))return this.setVariable("global-font",e),void this.toggle("global-font",!0);this.toggle("global-font",!1),this.deleteVariable("global-font")}toggleHide(e,t){const i=`hide--${e}`;if(t){if(!Object(r.has)(a,e))throw new Error(`cannot find class for "${e}"`);this.style.set(i,`${a[e]} { display: none !important }`)}else this.style.delete(i)}async toggle(e,t){if(t){if(this.chunks_loaded||await this.populate(),!Object(r.has)(this.chunks,e))throw new Error(`cannot find chunk "${e}"`);this.style.set(e,this.chunks[e])}else this.style.delete(e)}set(e,t){return this.style.set(e,t)}delete(e){return this.style.delete(e)}setVariable(e,t,i="body"){this.style.set(`var--${e}`,`${i} { --ffz-${e}: ${t}; }`)}deleteVariable(e){this.style.delete(`var--${e}`)}populate(){if(!this.chunks_loaded)return new Promise(async e=>{const t=(await i.e(140).then(i.bind(null,306))).default;for(const e of t.keys()){const i=e.slice(2,e.length-(e.endsWith(".scss")?5:4));this.chunks[i]=t(e).default}this.chunks_loaded=!0,e()})}}},function(e,t,i){"use strict";i.r(t),i.d(t,"default",(function(){return Dashboard}));var n=i(3),s=i(0),r=i(4);class Dashboard extends n.default{constructor(...e){super(...e),this.should_enable=!0,this.inject("settings"),this.inject("site.fine"),this.inject("site.channel"),this.HostBar=this.fine.define("sunlight-host-bar",e=>e.props&&e.props.channel&&void 0!==e.props.hostedChannel,r.a.SUNLIGHT_ROUTES),this.Dashboard=this.fine.define("sunlight-dash",e=>e.getIsChannelEditor&&e.getIsChannelModerator&&e.getIsAdsEnabled&&e.getIsSquadStreamsEnabled,r.a.SUNLIGHT_ROUTES)}onEnable(){this.Dashboard.on("mount",this.onDashUpdate,this),this.Dashboard.on("update",this.onDashUpdate,this),this.Dashboard.on("unmount",this.onDashUnmount,this),this.HostBar.on("mount",this.onHostBarUpdate,this),this.HostBar.on("update",this.onHostBarUpdate,this),this.HostBar.on("unmount",this.onHostBarUnmount,this),this.Dashboard.ready((e,t)=>{for(const e of t)this.onDashUpdate(e)}),this.HostBar.ready((e,t)=>{for(const e of t)this.onHostBarUpdate(e)})}onDashUpdate(e){this.settings.updateContext({channel:Object(s.get)("props.channelLogin",e),channelID:Object(s.get)("props.channelID",e)})}onDashUnmount(){this.settings.updateContext({channel:null,channelID:null})}onHostBarUpdate(e){var t,i;const n=null===(t=e.props)||void 0===t?void 0:t.channel,s=(null==n?void 0:n.stream)||(null==n?void 0:n.broadcastSettings),r=null==s?void 0:s.game,o=(null==s?void 0:s.title)||null,a=(null==n?void 0:n.primaryColorHex)||null;this.channel.updateChannelColor(a),this.settings.updateContext({category:null==r?void 0:r.name,categoryID:null==r?void 0:r.id,title:o,channelColor:a,hosting:!!(null===(i=e.props)||void 0===i?void 0:i.hostedChannel)})}onHostBarUnmount(){this.settings.updateContext({channelColor:null,category:null,categoryID:null,title:null,hosting:!1})}}},function(e,t,i){"use strict";i.r(t),i.d(t,"CARD_CONTEXTS",(function(){return c})),i.d(t,"default",(function(){return Directory}));var n=i(3),s=i(6),r=i(1),o=i(0),a=i(111),l=i(112);const c=((e={})=>(e[e.SingleGameList=1]="SingleGameList",e[e.SingleChannelList=2]="SingleChannelList",e[e.MixedGameAndChannelList=3]="MixedGameAndChannelList",e))(),u=488191,h=["dir","dir-community","dir-community-index","dir-creative","dir-following","dir-game-index","dir-game-clips","dir-game-videos","dir-all","dir-category","user-videos","user-clips"];class Directory extends n.SiteModule{constructor(...e){super(...e),this.should_enable=!0,this.inject("site.fine"),this.inject("site.router"),this.inject("site.apollo"),this.inject("site.css_tweaks"),this.inject("site.web_munch"),this.inject("site.twitch_data"),this.inject("i18n"),this.inject("settings"),this.inject(a.a),this.inject(l.a),this.DirectoryCard=this.fine.define("directory-card",e=>e.renderTitles&&e.renderIconicImage,h),this.DirectoryShelf=this.fine.define("directory-shelf",e=>e.shouldRenderNode&&e.props&&e.props.shelf,h),this.DirectorySuggestedVideos=this.fine.define("directory-suggested-videos",e=>e.props&&e.props.directoryWidth&&e.props.data&&e.render&&e.render.toString().includes("SuggestedVideos"),h),this.DirectoryLatestVideos=this.fine.define("directory-latest-videos",e=>e.props&&"LatestVideosFromFollowedCarousel"===e.props.component,h),this.settings.add("directory.uptime",{default:1,ui:{path:"Directory > Channels >> Appearance",title:"Stream Uptime",description:"Display the stream uptime on the channel cards.",component:"setting-select-box",data:[{value:0,title:"Disabled"},{value:1,title:"Enabled"},{value:2,title:"Enabled (with Seconds)"}]},changed:()=>this.DirectoryCard.forceUpdate()}),this.settings.add("directory.show-channel-avatars",{default:!0,ui:{path:"Directory > Channels >> Appearance",title:"Display channel avatars.",component:"setting-check-box"},changed:()=>this.DirectoryCard.forceUpdate()}),this.settings.add("directory.hide-live",{default:!1,ui:{path:"Directory > Channels >> Appearance",title:"Do not show the Live indicator on channels that are live.",component:"setting-check-box"},changed:e=>this.css_tweaks.toggleHide("dir-live-ind",e)}),this.settings.add("directory.hide-vodcasts",{default:!1,ui:{path:"Directory > Channels >> Appearance",title:"Do not show reruns in the directory.",component:"setting-check-box"},changed:()=>{for(const e of this.DirectoryCard.instances)this.updateCard(e)}}),this.settings.add("directory.hide-recommended",{default:!1,ui:{path:"Directory > Following >> Categories",title:"Do not show `Recommended Live Channels` in the Following Directory.",component:"setting-check-box"},changed:()=>this.DirectoryShelf.forceUpdate()}),this.settings.add("directory.hide-viewing-history",{default:!1,ui:{path:"Directory > Following >> Categories",title:"Do not show `Based on your viewing history` in the Following Directory.",component:"setting-check-box"},changed:()=>this.DirectorySuggestedVideos.forceUpdate()}),this.settings.add("directory.hide-latest-videos",{default:!1,ui:{path:"Directory > Following >> Categories",title:"Do not show `Latest Videos` in the Following Directory.",component:"setting-check-box"},changed:()=>this.DirectoryLatestVideos.forceUpdate()}),this.routeClick=this.routeClick.bind(this)}async onEnable(){this.css_tweaks.toggleHide("profile-hover",2===this.settings.get("directory.show-channel-avatars")),this.css_tweaks.toggleHide("dir-live-ind",this.settings.get("directory.hide-live")),this.on("i18n:update",()=>this.DirectoryCard.forceUpdate());const e=this,t=await this.web_munch.findModule("react"),i=t&&t.createElement;this.DirectoryShelf.ready(t=>{const i=t.prototype.render;t.prototype.render=function(){try{if(e.settings.get("directory.hide-recommended")){if("live_recs_following"===Object(o.get)("props.shelf.title.key",this))return null}}catch(t){e.log.capture(t)}return i.call(this)},this.DirectoryShelf.forceUpdate()}),this.DirectorySuggestedVideos.ready(t=>{const i=t.prototype.render;t.prototype.render=function(){try{if(e.settings.get("directory.hide-viewing-history"))return null}catch(t){e.log.capture(t)}return i.call(this)},this.DirectorySuggestedVideos.forceUpdate()}),this.DirectoryLatestVideos.ready(t=>{const i=t.prototype.render;t.prototype.render=function(){if(!this.props||"LatestVideosFromFollowedCarousel"!==this.props.component)return i.call(this);try{if(e.settings.get("directory.hide-latest-videos"))return null}catch(t){e.log.capture(t)}return i.call(this)},this.DirectoryLatestVideos.forceUpdate()}),this.DirectoryCard.ready((t,n)=>{const s=t.prototype.renderIconicImage,r=t.prototype.renderTitles;t.prototype.renderIconicImage=function(){if(this.props.context===c.SingleChannelList||e.settings.get("directory.show-channel-avatars"))return s.call(this)},t.prototype.renderTitles=function(){const t=Object(o.get)(Object(o.get)("props.channelLogin",this),e.following.hosts);if(null==this.props.hostedByChannelLogin||!t||!t.length)return r.call(this);const n=t[0].hosting,s=n.stream,a=s&&s.game,l=`/${n.login}`,c=a&&`/directory/game/${s.game.name}`,h=i("a",{href:l,"data-href":l,title:n.displayName,class:"tw-link tw-link--inherit",onClick:e.routeClick},n.displayName),d=a&&i("a",{href:c,"data-href":c,title:a.name,class:"tw-link tw-link--inherit",onClick:e.routeClick},a.name);return i("div",null,i("a",{href:l,"data-href":l,class:"tw-link tw-link--inherit","data-test-selector":"preview-card-titles__primary-link",onClick:e.routeClick},i("h3",{class:"tw-ellipsis tw-font-size-5 tw-strong",title:s.title},s.title)),i("div",{class:"preview-card-titles__subtitle-wrapper"},i("div",{"data-test-selector":"preview-card-titles__subtitle"},i("p",{class:"tw-c-text-alt tw-ellipsis"},a?a.id==u?e.i18n.tList("directory.user-creative","{user} being {game}",{user:h,game:d}):e.i18n.tList("directory.user-playing","{user} playing {game}",{user:h,game:d}):h)),i("div",{"data-test-selector":"preview-card-titles__subtitle"},i("p",{class:"tw-c-text-alt tw-ellipsis"},t.length>1?e.i18n.t("directory.hosted.by-many","Hosted by {count,number} channel{count,en_plural}",t.length):e.i18n.tList("directory.hosted.by-one","Hosted by {user}",{user:i("a",{href:`/${t[0].login}`,"data-href":`/${t[0].login}`,title:t[0].displayName,class:"tw-link tw-link--inherit",onClick:e.routeClick},t[0].displayName)})))))},this.DirectoryCard.forceUpdate();for(const e of n)this.updateCard(e)}),this.DirectoryCard.on("update",this.updateCard,this),this.DirectoryCard.on("mount",this.updateCard,this),this.DirectoryCard.on("unmount",this.clearCard,this)}updateCard(e){const t=this.fine.getChildNode(e);if(!t)return;const i=e.props,n=i.gameTitle||i.playerMetadataGame||i.trackingProps&&i.trackingProps.categoryName;t.classList.toggle("ffz-hide-thumbnail",this.settings.provider.get("directory.game.hidden-thumbnails",[]).includes(n)),t.dataset.ffzType=i.streamType;const s="rerun"===i.streamType&&this.settings.get("directory.hide-vodcasts")||i.context!==c.SingleGameList&&this.settings.provider.get("directory.game.blocked-games",[]).includes(n);let r=t.closest('.stream-thumbnail,[style*="order:"]');r||(r=t.closest(".tw-mg-b-2")),r||(r=t),r.querySelectorAll(".preview-card").length<2&&r.classList.toggle("tw-hide",s),this.updateUptime(e,"props.currentViewerCount.createdAt"),this.updateAvatar(e),this.following.updateChannelCard(e)}clearCard(e){this.clearUptime(e)}processNodes(e,t=!1,i){const n=[];Array.isArray(i)||(i=this.settings.provider.get("directory.game.blocked-games",[]));for(const s of e){if(!s)continue;const e=s.node||s,r=e.stream||e;if(r.viewersCount){const e=r.viewersCount=new Number(r.viewersCount||0);e.createdAt=r.createdAt,e.title=r.title}(t||!r.game||r.game&&!i.includes(r.game.name))&&n.push(s)}return n}clearUptime(e){e.ffz_update_timer&&(clearInterval(e.ffz_update_timer),e.ffz_update_timer=null),e.ffz_uptime_el&&(e.ffz_uptime_el.remove(),e.ffz_uptime_el=null,e.ffz_uptime_span=null,e.ffz_uptime_tt=null,e.ffz_last_created_at=null)}updateUptime(e,t){const i=this.fine.getChildNode(e),n=i&&i.querySelector&&i.querySelector(".preview-card-overlay"),a=this.settings.get("directory.uptime");if(!n||0===a||!e.props||e.props.viewCount||e.props.animatedImageProps)return this.clearUptime(e);let l=e.props.createdAt||Object(o.get)(t,e);if(l||(void 0===e.ffz_stream_meta&&(e.ffz_stream_meta=null,this.twitch_data.getStreamMeta(e.props.channelId,e.props.channelLogin).then(i=>{e.ffz_stream_meta=i,this.updateUptime(e,t)})),e.ffz_stream_meta&&(l=e.ffz_stream_meta.createdAt)),!l)return this.clearUptime(e);const c=l&&new Date(l),u=c&&Math.floor((Date.now()-c)/1e3)||0;if(u<1)return this.clearUptime(e);const h=Object(s.duration_to_string)(u,!1,!1,!1,1===a);e.ffz_uptime_el||(e.ffz_uptime_el=n.querySelector(".ffz-uptime-element"),e.ffz_uptime_el||n.appendChild(e.ffz_uptime_el=Object(r.createElement)("div",{class:"ffz-uptime-element tw-absolute tw-right-0 tw-top-0 tw-mg-1"},Object(r.createElement)("div",{class:"tw-relative tw-tooltip-wrapper"},Object(r.createElement)("div",{class:"preview-card-stat tw-align-items-center tw-border-radi-us-small tw-c-background-overlay tw-c-text-overlay tw-flex tw-font-size-6 tw-justify-content-center"},Object(r.createElement)("div",{class:"tw-flex tw-c-text-live"},Object(r.createElement)("figure",{class:"ffz-i-clock"})),e.ffz_uptime_span=Object(r.createElement)("p",null)),Object(r.createElement)("div",{class:"tw-tooltip tw-tooltip--down tw-tooltip--align-right"},this.i18n.t("metadata.uptime.tooltip","Stream Uptime"),e.ffz_uptime_tt=Object(r.createElement)("div",{class:"tw-pd-t-05"})))))),e.ffz_update_timer||(e.ffz_update_timer=setInterval(this.updateUptime.bind(this,e,t),1e3)),e.ffz_uptime_span.textContent=h,e.ffz_last_created_at!==l&&(e.ffz_uptime_tt.textContent=this.i18n.t("metadata.uptime.since","(since {since,datetime})",{since:c}),e.ffz_last_created_at=l)}updateAvatar(e){const t=this.fine.getChildNode(e),i=t&&t.querySelector&&t.querySelector(".preview-card-overlay"),n=this.settings.get("directory.show-channel-avatars");if(!i)return;const s=e.props,o=null!=s.durationInSeconds,a=s.channelImageProps&&s.channelImageProps.src,l=i.querySelector(".ffz-channel-avatar");if(!a||n<2||s.context===c.SingleChannelList)return void(l&&l.remove());if(n===e.ffz_av_setting&&s.channelLogin===e.ffz_av_login&&a===e.ffz_av_src)return;l&&l.remove(),e.ffz_av_setting=n,e.ffz_av_login=s.channelLogin,e.ffz_av_src=a;const u=s.channelLinkTo&&s.channelLinkTo.pathname;i.appendChild(Object(r.createElement)("a",{class:"ffz-channel-avatar",href:u,onClick:e=>this.routeClick(e,u)},Object(r.createElement)("div",{class:`tw-absolute tw-right-0 tw-border-l tw-c-background-base ${o?"tw-top-0 tw-border-b":"tw-bottom-0 tw-border-t"}`},Object(r.createElement)("figure",{class:"tw-aspect tw-aspect--align-top"},Object(r.createElement)("img",{src:a,title:s.channelDisplayName})))))}routeClick(e,t){if(e.preventDefault(),e.stopPropagation(),!t){const i=e.currentTarget;if(i){const e=i.dataset;e&&e.href?t=e.href:i.href&&(t=i.href)}}t&&this.router.history.push(t)}hijackUserClick(e,t,i=null){e.preventDefault(),e.stopPropagation(),i&&i(e,t),this.router.navigate("user",{userName:t})}}},function(e,t,i){"use strict";i.r(t),i.d(t,"default",(function(){return FeaturedFollow}));var n=i(3),s=i(1),r=i(0),o=i(113),a=i.n(o),l=i(94),c=i.n(l),u=i(114),h=i.n(u);class FeaturedFollow extends n.default{constructor(...e){super(...e),this.should_enable=!0,this.inject("site"),this.inject("site.fine"),this.inject("site.apollo"),this.inject("i18n"),this.inject("metadata"),this.inject("settings"),this.inject("socket"),this.inject("site.router"),this.inject("chat"),this.settings.add("metadata.featured-follow",{default:!0,ui:{path:"Channel > Metadata >> Player",title:"Featured Follow",description:"Show a featured follow button with the currently featured users.",component:"setting-check-box"},changed:()=>{this.metadata.updateMetadata("following")}}),this.metadata.definitions.following={order:150,button:!0,popup:async(e,t,n,s)=>{const r=this.resolve("vue"),o=i.e(3).then(i.bind(null,307)),a=this.getFollowsForLogin(e.channel.login),[,l,c]=await Promise.all([r.enable(),o,a]);return this._featured_follow_tip=t,t.element.classList.remove("tw-pd-1"),t.element.classList.add("tw-balloon--lg"),r.component("featured-follow",l.default),this.buildFeaturedFollowMenu(r,e.channel.login,c,s)},label:e=>{if(!(this.settings.get("metadata.featured-follow")&&e&&e.channel&&e.channel.login))return null;const t=this.follow_data[e.channel.login];return t&&Object.keys(t).length||this.vueFeaturedFollow&&this.vueFeaturedFollow.data.hasUpdate?this.i18n.t("metadata.featured-follow.button.featured","Featured"):null},icon:"ffz-i-heart"},this.follow_data={},this.socket.on(":command:follow_buttons",e=>{for(const t in e)Object(r.has)(e,t)&&(this.follow_data[t]=e[t]);this.vueFeaturedFollow&&(this.vueFeaturedFollow.data.hasUpdate=!0),this.metadata.updateMetadata("following")})}async getFollowsForLogin(e){const t=this.follow_data&&this.follow_data[e];if(!t||!t.length)return[];const i=await this.apollo.client.query({query:a.a,variables:{logins:t}}),n={};for(const e of i.data.users){var s,r;e&&e.id&&(n[e.id]={loading:!1,error:!1,id:e.id,login:e.login,displayName:e.displayName,avatar:e.profileImageURL,following:null!=(null===(s=e.self.follower)||void 0===s?void 0:s.followedAt),disableNotifications:null===(r=e.self.follower)||void 0===r?void 0:r.disableNotifications})}return n}buildFeaturedFollowMenu(e,t,i,n){const r=new e.Vue({el:Object(s.createElement)("div"),render:e=>this.vueFeaturedFollow=e("featured-follow",{login:t,follows:i,hasUpdate:!1,followUser:e=>this.followUser(i,e),unfollowUser:e=>this.unfollowUser(i,e),updateNotificationStatus:(e,t)=>this.updateNotificationStatus(i,e,t),refresh:async()=>{this.vueFeaturedFollow&&this.vueFeaturedFollow.data.hasUpdate&&(this.vueFeaturedFollow.data.follows=await this.getFollowsForLogin(t),this.vueFeaturedFollow.data.hasUpdate=!1,this._featured_follow_tip.update(),0===this.vueFeaturedFollow.data.follows.length&&this.metadata.updateMetadata("following"))},route:e=>this.route(e)})});return n(()=>{this.vueFeaturedFollow=null}),r.$el}async followUser(e,t){const i=e[t];i.loading=!0;try{const e=(await this.apollo.client.mutate({mutation:c.a,variables:{targetID:t,disableNotifications:!1}})).data.followUser.follow;i.loading=!1,i.following=null!=e.followedAt,i.disableNotifications=e.disableNotifications}catch(e){this.log.warn("There was a problem following.",e),i.error=!0}}async updateNotificationStatus(e,t,i){const n=e[t];n.loading=!0,n.disableNotifications=!i;try{const e=(await this.apollo.client.mutate({mutation:c.a,variables:{targetID:t,disableNotifications:!i}})).data.followUser.follow;n.loading=!1,n.following=null!=e.followedAt,n.disableNotifications=e.disableNotifications}catch(e){this.log.warn("There was a problem updating notification status.",e),n.error=!0}}async unfollowUser(e,t){const i=e[t];i.loading=!0;try{await this.apollo.client.mutate({mutation:h.a,variables:{targetID:t}}),i.loading=!1,i.following=!1,i.disableNotifications=!1}catch(e){this.log.warn("There was a problem unfollowing.",e),i.error=!0}}route(e){this.router.navigate("user",{userName:e})}}},function(e,t,i){"use strict";i.r(t),i.d(t,"default",(function(){return HostButton}));var n=i(3),s=i(1);const r={COMMAND_EXECUTION:{key:"command-execution",text:"There was an error executing the host command. Please try again later."},CHAT_CONNECTION:{key:"chat-connection",text:"There was an issue connecting to chat. Please try again later."}};class HostButton extends n.default{constructor(...e){super(...e),this.should_enable=!0,this.inject("site"),this.inject("site.fine"),this.inject("site.chat"),this.inject("i18n"),this.inject("metadata"),this.inject("settings"),this.settings.add("metadata.host-button",{default:!0,ui:{path:"Channel > Metadata >> Player",title:"Host Button",description:"Show a host button with the current hosted channel in the tooltip.",component:"setting-check-box"},changed:()=>{const e=this.site.getUser(),t=e&&e.login;t&&this.joinChannel(t),this.metadata.updateMetadata("host")}}),this.metadata.definitions.host={order:150,border:!0,button:!0,fade_in:!0,disabled:()=>this._host_updating||this._host_error,click:e=>{e.channel&&this.sendHostUnhostCommand(e.channel.login)},popup:async(e,t)=>{const n=this.resolve("vue"),s=i.e(4).then(i.bind(null,308)),r=this.fetchAutoHosts(),o=this.fetchAutoHostSettings(),[,a,l,c]=await Promise.all([n.enable(),s,r,o]);return this._auto_host_tip=t,t.element.classList.remove("tw-pd-1"),t.element.classList.add("tw-balloon--lg"),n.component("host-options",a.default),this.buildAutoHostMenu(n,l,c,e.channel)},label:e=>{const t=this.site.getUser();if(this.settings.get("metadata.host-button")&&t&&e.channel&&e.channel.login!==t.login)return this._host_updating?this.i18n.t("metadata.host-button.updating","Updating..."):this._last_hosted_channel&&this.isChannelHosted(e.channel&&e.channel.login)?this.i18n.t("metadata.host-button.unhost","Unhost"):this.i18n.t("metadata.host-button.host","Host")},tooltip:()=>this._host_error?this.i18n.t(`metadata.host-button.tooltip.error.${this._host_error.key}`,this._host_error.text):this.i18n.t("metadata.host-button.tooltip","Currently hosting: {channel}",{channel:this._last_hosted_channel||this.i18n.t("metadata.host-button.tooltip.none","None")})}}isChannelHosted(e){return this._last_hosted_channel===e}sendHostUnhostCommand(e){if(!this._chat_con)return this._host_error=r.CHAT_CONNECTION,void(this._host_updating=!1);const t=this.site.getUser(),i={channel:t&&t.login,username:e};this._host_updating=!0,this.metadata.updateMetadata("host"),this._host_feedback=setTimeout(()=>{null===this._last_hosted_channel&&(this._host_error=r.COMMAND_EXECUTION,this._host_updating=!1,this.metadata.updateMetadata("host"))},3e3),this.isChannelHosted(e)?this._chat_con.commands.unhost.execute(i):this._chat_con.commands.host.execute(i)}joinChannel(e){this._chat_con&&this.settings.get("metadata.host-button")&&!this._chat_con.session.channelstate[`#${e}`]&&this._chat_con.joinChannel(e)}hookIntoChatConnection(e){const t=e.props.currentUserLogin;if(this._chat_con)return void this.joinChannel(t);this.on("tmi:host",e=>{e.channel.substring(1)===t&&(clearTimeout(this._host_feedback),this._host_error=!1,this._last_hosted_channel=e.target,this._host_updating=!1,this.metadata.updateMetadata("host"))}),this.on("tmi:unhost",e=>{e.channel.substring(1)===t&&(clearTimeout(this._host_feedback),this._host_error=!1,this._last_hosted_channel=null,this._host_updating=!1,this.metadata.updateMetadata("host"))});const i=e.client;this._chat_con=i,this.settings.get("metadata.host-button")&&this.joinChannel(t)}onEnable(){this.on("i18n:update",()=>this.metadata.updateMetadata("host")),this.metadata.updateMetadata("host"),this.chat.ChatService.ready((e,t)=>{for(const e of t)this.hookIntoChatConnection(e)}),this.chat.ChatService.on("mount",this.hookIntoChatConnection,this)}buildAutoHostMenu(e,t,i,n){return this._current_channel_id=n.id,this.activeTab=this.activeTab||"auto-host",new e.Vue({el:Object(s.createElement)("div"),render:e=>this.vueHostMenu=e("host-options",{hosts:t,autoHostSettings:i,activeTab:this.activeTab,addedToHosts:this.currentRoomInHosts(),addToAutoHosts:()=>this.addCurrentRoomToHosts(),rearrangeHosts:e=>this.rearrangeHosts(e.oldIndex,e.newIndex),removeFromHosts:e=>this.removeUserFromHosts(e),setActiveTab:e=>{this.vueHostMenu.data.activeTab=this.activeTab=e},updatePopper:()=>{this._auto_host_tip&&this._auto_host_tip.update()},updateCheckbox:e=>{const t=e.target,i=t.dataset.setting;let n=t.checked;"strategy"===i?n=n?"random":"ordered":"deprioritize_vodcast"===i&&(n=!n),this.updateAutoHostSetting(i,n)}})}).$el}async fetchAutoHosts(){const e=this.site.getUser();if(!e)return;let t;try{t=await fetch("https://api.twitch.tv/kraken/autohost/list",{headers:{Accept:"application/vnd.twitchtv.v4+json",Authorization:`OAuth ${e.authToken}`}}).then(e=>{if(e.ok)return e.json();throw e.status})}catch(e){return void this.log.error("Error loading auto host list.",e)}return this.autoHosts=t.targets}async fetchAutoHostSettings(){const e=this.site.getUser();if(!e)return;let t;try{t=await fetch("https://api.twitch.tv/kraken/autohost/settings",{headers:{Accept:"application/vnd.twitchtv.v4+json",Authorization:`OAuth ${e.authToken}`}}).then(e=>{if(e.ok)return e.json();throw e.status})}catch(e){return void this.log.error("Error loading auto host settings.",e)}return this.autoHostSettings=t.settings}queueHostUpdate(){this._host_update_timer&&clearTimeout(this._host_update_timer),this._host_update_timer=setTimeout(()=>{this._host_update_timer=void 0,this.updateAutoHosts(this.autoHosts)},1e3)}rearrangeHosts(e,t){const i=this.autoHosts.splice(e,1)[0];this.autoHosts.splice(t,0,i),this.queueHostUpdate()}currentRoomInHosts(){return this.getAutoHostIDs(this.autoHosts).includes(parseInt(this._current_channel_id,10))}addCurrentRoomToHosts(){const e=this.autoHosts.slice(0);e.push({_id:parseInt(this._current_channel_id,10)}),this.updateAutoHosts(e)}removeUserFromHosts(e){const t=e.target.closest(".ffz--host-user").dataset.id,i=[];for(let e=0;e<this.autoHosts.length;e++)this.autoHosts[e]._id!=t&&i.push(this.autoHosts[e]);this.updateAutoHosts(i)}getAutoHostIDs(e){const t=[];if(e)for(let i=0;i<e.length;i++)t.push(e[i]._id);return t}async updateAutoHosts(e){const t=this.site.getUser();if(!t)return;let i;try{const n=new URLSearchParams,s=this.getAutoHostIDs(e);n.append("targets",s.join(",")),i=await fetch("https://api.twitch.tv/kraken/autohost/list",{headers:{Accept:"application/vnd.twitchtv.v4+json",Authorization:`OAuth ${t.authToken}`},method:s.length?"PUT":"DELETE",body:s.length?n:void 0}).then(e=>{if(e.ok)return e.json();throw e.status})}catch(e){return void this.log.error("Error updating auto host list.",e)}this.autoHosts=i.targets,this.vueHostMenu&&(this.vueHostMenu.data.hosts=this.autoHosts,this.vueHostMenu.data.addedToHosts=this.currentRoomInHosts())}async updateAutoHostSetting(e,t){const i=this.site.getUser();if(!i)return;let n;try{const s=new URLSearchParams;s.append(e,t),n=await fetch("https://api.twitch.tv/kraken/autohost/settings",{headers:{Accept:"application/vnd.twitchtv.v4+json",Authorization:`OAuth ${i.authToken}`},method:"PUT",body:s}).then(e=>{if(e.ok)return e.json();throw e.status})}catch(e){return void this.log.error("Error updating auto host setting.",e)}this.autoHostSettings=n.settings,this.vueHostMenu&&(this.vueHostMenu.data.autoHostSettings=this.autoHostSettings)}}},function(e,t,i){"use strict";i.r(t),i.d(t,"default",(function(){return Layout}));var n=i(3),s=i(0);const r=["user","video","user-video","user-clip","user-videos","user-clips","user-collections","user-events","user-followers","user-following"],o=["popout","embed-chat","dash-chat"];class Layout extends n.default{constructor(...e){super(...e),this.should_enable=!0,this.inject("settings"),this.inject("site.fine"),this.inject("site.css_tweaks"),this.SideBarChannels=this.fine.define("nav-cards",e=>e.getCardSlideInContent&&e.props&&Object(s.has)(e.props,"tooltipContent")),this.settings.add("layout.portrait",{default:!1,ui:{path:"Appearance > Layout >> Channel",title:"Enable Portrait Mode",description:"In Portrait Mode, chat will be displayed beneath the player when the window is taller than it is wide.",component:"setting-check-box"}}),this.settings.add("layout.portrait-invert",{default:!1,ui:{path:"Appearance > Layout >> Channel",title:"When in portrait mode, place chat at the top.",component:"setting-check-box"},changed:e=>document.body.classList.toggle("ffz--portrait-invert",e)}),this.settings.add("layout.portrait-threshold",{default:1.25,ui:{path:"Appearance > Layout >> Channel",title:"Portrait Mode Threshold",description:"This is the Width to Height ratio at which point Portrait Mode will begin to activate.",component:"setting-text-box",process:e=>(e=parseFloat(e,10),isNaN(e)||!isFinite(e)||e<=0?1.25:e)}}),this.settings.add("layout.use-portrait",{requires:["layout.portrait","layout.portrait-threshold","context.route.name","context.size"],process(e){const t=e.get("context.size");return!!(t&&e.get("layout.portrait")&&r.includes(e.get("context.route.name")))&&t.width/t.height<=e.get("layout.portrait-threshold")},changed:()=>this.updatePortraitMode()}),this.settings.add("layout.inject-portrait",{requires:["layout.use-portrait","context.ui.rightColumnExpanded"],process:e=>e.get("layout.use-portrait")&&e.get("context.ui.rightColumnExpanded"),changed:e=>this.css_tweaks.toggle("portrait",e)}),this.settings.add("layout.use-portrait-swapped",{requires:["layout.inject-portrait","layout.swap-sidebars"],process:e=>e.get("layout.inject-portrait")&&e.get("layout.swap-sidebars"),changed:e=>this.css_tweaks.toggle("portrait-swapped",e)}),this.settings.add("layout.use-portrait-meta",{requires:["layout.inject-portrait","player.theatre.metadata"],process:e=>e.get("layout.inject-portrait")&&e.get("player.theatre.metadata"),changed:e=>this.css_tweaks.toggle("portrait-metadata",e)}),this.settings.add("layout.use-portrait-meta-top",{requires:["layout.use-portrait-meta","layout.portrait-invert"],process:e=>e.get("layout.use-portrait-meta")&&!e.get("layout.portrait-invert"),changed:e=>this.css_tweaks.toggle("portrait-metadata-top",e)}),this.settings.add("layout.show-portrait-chat",{requires:["layout.use-portrait","layout.portrait-extra-height","layout.portrait-extra-width"],process:()=>!0,changed:()=>this.updatePortraitMode()}),this.settings.add("layout.portrait-extra-height",{requires:["context.new_channel","context.squad_bar","context.hosting","context.ui.theatreModeEnabled","player.theatre.no-whispers","whispers.show","layout.minimal-navigation"],process(e){let t=0;return e.get("context.ui.theatreModeEnabled")?(e.get("layout.minimal-navigation")&&(t+=1),e.get("whispers.show")&&!e.get("player.theatre.no-whispers")&&(t+=4)):(t=e.get("layout.minimal-navigation")?1:5,e.get("whispers.show")&&(t+=4),e.get("context.squad_bar")&&(t+=6),t+=e.get("context.new_channel")?1:5,e.get("context.hosting")&&(t+=4)),t},changed:e=>this.css_tweaks.setVariable("portrait-extra-height",`${e}rem`)}),this.settings.add("layout.portrait-extra-width",{require:["layout.side-nav.show","context.ui.theatreModeEnabled","context.ui.sideNavExpanded"],process:e=>!e.get("layout.side-nav.show")||e.get("context.ui.theatreModeEnabled")?0:e.get("context.ui.sideNavExpanded")?24:5,changed:e=>this.css_tweaks.setVariable("portrait-extra-width",`${e}rem`)}),this.settings.add("layout.is-minimal",{require:["context.route.name"],process:e=>o.includes(e.get("context.route.name"))})}onEnable(){document.body.classList.toggle("ffz--portrait-invert",this.settings.get("layout.portrait-invert")),this.on(":update-nav",this.updateNavLinks,this),this.css_tweaks.toggle("portrait",this.settings.get("layout.inject-portrait")),this.css_tweaks.toggle("portrait-swapped",this.settings.get("layout.use-portrait-swapped")),this.css_tweaks.toggle("portrait-metadata",this.settings.get("layout.use-portrait-meta")),this.css_tweaks.toggle("portrait-metadata-top",this.settings.get("layout.use-portrait-meta-top")),this.css_tweaks.setVariable("portrait-extra-width",`${this.settings.get("layout.portrait-extra-width")}rem`),this.css_tweaks.setVariable("portrait-extra-height",`${this.settings.get("layout.portrait-extra-height")}rem`),this.SideBarChannels.ready((e,t)=>{for(const e of t)this.updateCardClass(e)}),this.SideBarChannels.on("mount",this.updateCardClass,this),this.SideBarChannels.on("update",this.updateCardClass,this)}get is_minimal(){return this.settings.get("layout.is-minimal")}updateCardClass(e){var t,i,n;const s=this.fine.getChildNode(e);s&&s.classList.toggle("ffz--side-nav-card-rerun","rerun"===(null===(t=e.props)||void 0===t?void 0:null===(i=t.tooltipContent)||void 0===i?void 0:null===(n=i.props)||void 0===n?void 0:n.streamType))}updateNavLinks(){}updatePortraitMode(){}}},function(e,t,i){"use strict";i.r(t),i.d(t,"default",(function(){return MenuButton}));var n=i(2),s=i(3),r=i(1),o=i(4);class MenuButton extends s.SiteModule{constructor(...e){super(...e),this.inject("i18n"),this.inject("settings"),this.inject("site.fine"),this.should_enable=!0,this._pill_content=null,this._has_update=!1,this._important_update=!1,this._new_settings=0,this._error=null,this._loading=!1,this.settings.add("ffz.show-new-settings",{default:!0,ui:{path:"Appearance > Layout >> Top Navigation",title:"Display an indicator on the FFZ Control Center button whenever there are new settings added to FrankerFaceZ.",component:"setting-check-box"},changed:()=>this.update()}),this.SunlightDash=this.fine.define("sunlight-dash",e=>e.getIsChannelEditor&&e.getIsChannelModerator&&e.getIsAdsEnabled&&e.getIsSquadStreamsEnabled,o.a.SUNLIGHT_ROUTES),this.NavBar=this.fine.define("nav-bar",e=>e.renderOnsiteNotifications&&e.renderTwitchPrimeCrown),this.SquadBar=this.fine.define("squad-nav-bar",e=>e.exitSquadMode&&e.props&&e.props.squadID,["squad"]),this.MultiController=this.fine.define("multi-controller",e=>e.handleAddStream&&e.handleRemoveStream&&e.getInitialStreamLayout,["command-center"])}get loading(){return this._loading}set loading(e){e!==this._loading&&(this._loading=e,this.update())}get has_error(){return null!=this._error}get error(){return this._error}set error(e){e!==this._error&&(this._error=e,this.update())}get new_settings(){return this._new_settings}set new_settings(e){e!==this._new_settings&&(this._new_settings=e,this.update())}get has_new(){return this.settings.get("ffz.show-new-settings")&&this._new_settings>0}get important_update(){return this._important_update}set important_update(e){this._important_update=!1,this.update()}get has_update(){return this._has_update}get has_strings(){return this.i18n.new_strings>0||this.i18n.changed_strings>0}set has_update(e){e&&!this._has_update&&(this._important_update=!0),this._has_update=e,this.update()}get pill(){return this._pill_content}set pill(e){this._pill_content=e,this.update()}formatPill(){const e=this._pill_content;return"number"==typeof e?this.i18n.formatNumber(e):null==e&&this.has_new?this.i18n.formatNumber(this._new_settings):e}formatExtraPill(){if(this.has_update)return null;if(this.has_strings)return this.i18n.formatNumber(this.i18n.new_strings+this.i18n.changed_strings);const e=this.resolve("addons");return n.DEBUG&&e.has_dev?this.i18n.t("site.menu_button.dev","dev"):n.DEBUG&&!e.has_dev?this.i18n.t("site.menu_button.main-dev","m-dev"):!n.DEBUG&&e.has_dev?this.i18n.t("site.menu_button.addon-dev","a-dev"):null}update(){requestAnimationFrame(()=>this._update())}_update(){for(const e of this.NavBar.instances)this.updateButton(e);for(const e of this.SquadBar.instances)this.updateButton(e);for(const e of this.MultiController.instances)this.updateButton(e);for(const e of this.SunlightDash.instances)this.updateButton(e)}onEnable(){this.NavBar.ready(()=>this.update()),this.NavBar.on("mount",this.updateButton,this),this.NavBar.on("update",this.updateButton,this),this.SquadBar.ready(()=>this.update()),this.SquadBar.on("mount",this.updateButton,this),this.SquadBar.on("update",this.updateButton,this),this.MultiController.ready(()=>this.update()),this.MultiController.on("mount",this.updateButton,this),this.MultiController.on("update",this.updateButton,this),this.SunlightDash.ready(()=>this.update()),this.SunlightDash.on("mount",this.updateButton,this),this.SunlightDash.on("update",this.updateButton,this),this.on(":clicked",()=>this.important_update=!1),this.once(":clicked",this.loadMenu),this.on("i18n:new-strings",this.update),this.on("i18n:changed-strings",this.update),this.on("i18n:update",this.update),this.on("addons:data-loaded",this.update)}updateButton(e){const t=this.fine.getChildNode(e);let i=!1,s=!1,o=t&&t.querySelector(".top-nav__menu");if(o||(o=t&&t.classList.contains("squad-stream-top-bar__container")?t:t&&t.querySelector(".squad-stream-top-bar__container"),o&&(i=!0)),!o&&e.handleAddStream&&(o=this.fine.searchTree(e,e=>e.classList&&e.classList.contains("multiview-stream-page__header")),o&&(i=!0)),!o&&e.getIsAdsEnabled&&(o=t&&t.querySelector(".sunlight-top-nav > .tw-flex"),o&&(s=!0)),!o)return;if(!i){let e=null;try{e=o.querySelector(":scope > .tw-justify-content-end:last-child")}catch(e){}o=e||o.lastElementChild}let a,l=o.querySelector(".ffz-top-nav");l&&l.remove();const c=this.resolve("addons"),u=this.formatPill(),h=this.formatExtraPill();l=Object(r.createElement)("div",{class:`ffz-top-nav tw-align-self-center tw-flex-grow-0 tw-flex-nowrap tw-flex-shrink-0 tw-relative ${s?"tw-mg-l-05 tw-mg-r-2":"tw-mg-x-05"}`},Object(r.createElement)("div",{class:"tw-inline-flex tw-relative tw-tooltip-wrapper"},a=Object(r.createElement)("button",{class:`tw-align-items-center tw-align-middle tw-border-bottom-left-radius-medium tw-border-bottom-right-radius-medium tw-border-top-left-radius-medium tw-border-top-right-radius-medium tw-button-icon tw-core-button tw-core-button--border tw-inline-flex tw-interactive tw-justify-content-center tw-overflow-hidden tw-relative${this.loading?" loading":""}`,onClick:e=>this.handleClick(e,a),onContextMenu:e=>this.renderContext(e,a)},Object(r.createElement)("div",{class:"tw-align-items-center tw-flex tw-flex-grow-0"},Object(r.createElement)("span",{class:"tw-button-icon__icon"},Object(r.createElement)("figure",{class:"ffz-i-zreknarf"})))),this.has_error&&Object(r.createElement)("div",{class:"tw-absolute tw-balloon tw-balloon--down tw-balloon--lg tw-balloon--right tw-block"},Object(r.createElement)("div",{class:"tw-border-radius-large tw-c-background-base tw-c-text-inherit tw-elevation-4 tw-pd-1"},Object(r.createElement)("div",{class:"tw-flex tw-align-items-center"},Object(r.createElement)("div",{class:"tw-flex-grow-1"},this.error.i18n?this.i18n.t(this.error.i18n,this.error.text):this.error.text),Object(r.createElement)("button",{class:"tw-button-icon tw-mg-l-05 tw-relative tw-tooltip-wrapper",onClick:()=>this.error=null},Object(r.createElement)("span",{class:"tw-button-icon__icon"},Object(r.createElement)("figure",{class:"ffz-i-cancel"})))))),!this.has_error&&Object(r.createElement)("div",{class:"tw-tooltip tw-tooltip--down tw-tooltip--align-right"},this.i18n.t("site.menu_button","FrankerFaceZ Control Center"),this.has_update&&Object(r.createElement)("div",{class:"tw-mg-t-1"},this.i18n.t("site.menu_button.update-desc","There is an update available. Please refresh your page.")),this._new_settings>0&&Object(r.createElement)("div",{class:"tw-mg-t-1"},this.i18n.t("site.menu_button.new-desc","There {count,plural,one {is one new setting} other {are # new settings}}.",{count:this._new_settings})),this.has_strings&&Object(r.createElement)("div",{class:"tw-mg-t-1"},this.i18n.t("site.menu_button.strings","There {added,plural,one {is # new string} other {are # new strings}} and {changed,plural,one {# changed string} other {# changed strings}}.",{added:this.i18n.new_strings,changed:this.i18n.changed_strings})),n.DEBUG&&Object(r.createElement)("div",{class:"tw-mg-t-1"},this.i18n.t("site.menu_button.main-dev-desc","You are running a developer build of FrankerFaceZ.")),c.has_dev&&Object(r.createElement)("div",{class:"tw-mg-t-1"},this.i18n.t("site.menu_button.addon-dev-desc","You have loaded add-on data from a local development server.")))),this.has_update&&Object(r.createElement)("div",{class:"ffz-menu__extra-pill tw-absolute"},Object(r.createElement)("div",{class:`tw-pill ${this.important_update?"tw-pill--notification":""}`},Object(r.createElement)("figure",{class:"ffz-i-arrows-cw"}))),h&&Object(r.createElement)("div",{class:"ffz-menu__extra-pill tw-absolute"},Object(r.createElement)("div",{class:"tw-pill"},h)),u&&Object(r.createElement)("div",{class:"ffz-menu__pill tw-absolute"},Object(r.createElement)("div",{class:"tw-pill"},u))),o.insertBefore(l,o.lastElementChild),this._ctx_open&&this.renderContext(null,a)}handleClick(e,t){if(e.shiftKey)return n.DEBUG&&e.ctrlKey?requestAnimationFrame(()=>this.i18n.openUI()):this.resolve("main_menu").openPopout();this.emit(":clicked",e,t)}renderButtonIcon(e){const t=this.settings.main_context.hasProfile(e);return Object(r.createElement)("figure",{class:`ffz--profile__icon ${t?"ffz-i-ok":e.toggled?"ffz-i-minus":"ffz-i-cancel"}`})}renderButtonTip(e){return e.toggled?this.settings.main_context.hasProfile(e)?this.i18n.t("setting.profiles.active","This profile is enabled and active."):this.i18n.t("setting.profiles.disabled.rules","This profile is enabled, but inactive due to its rules."):this.i18n.t("setting.profiles.disabled","This profile is disabled.")}renderContext(e,t){if(e){if(e.shiftKey||e.ctrlKey)return;e.preventDefault()}const i=t.parentElement.parentElement;let n=i.querySelector(".ffz--menu-context");if(n){if(!n._ffz_destroy)return;n._ffz_destroy()}const destroy=()=>{this._ctx_open=!1,n._ffz_outside&&n._ffz_outside.destroy(),n.remove()},s=[];for(const e of this.settings.__profiles){const t=Object(r.createElement)("button",{class:"tw-flex-shrink-0 tw-mg-r-1 tw-align-items-center tw-align-middle tw-border-radius-medium tw-button-icon tw-button-icon--secondary tw-core-button tw-core-button--border tw-inline-flex tw-interactive tw-justify-content-center tw-relative ffz-tooltip ffz-tooltip--no-mouse","data-title":this.renderButtonTip(e),onClick:i=>{var n;e.toggled=!e.toggled,Object(r.setChildren)(t,this.renderButtonIcon(e)),t.dataset.title=this.renderButtonTip(e),(null===(n=t._ffz_tooltip$0)||void 0===n?void 0:n.rerender)&&t._ffz_tooltip$0.rerender(),this.emit("tooltips:cleanup"),i.preventDefault(),i.stopPropagation()}},this.renderButtonIcon(e)),i=e.desc_i18n_key||e.i18n_key&&`${e.i18n_key}.description`;s.push(Object(r.createElement)("div",{class:"tw-relative tw-border-b tw-pd-y-05 tw-pd-l-1 tw-flex"},t,Object(r.createElement)("div",null,Object(r.createElement)("h4",null,e.i18n_key?this.i18n.t(e.i18n_key,e.name,e):e.name),e.description&&Object(r.createElement)("div",{class:"description"},i?this.i18n.t(i,e.description,e):e.description))))}n=Object(r.createElement)("div",{class:"tw-absolute tw-balloon tw-balloon--down tw-balloon--lg tw-balloon--right tw-block ffz--menu-context"},Object(r.createElement)("div",{class:"tw-border-radius-large tw-c-background-base tw-c-text-inherit tw-elevation-4"},Object(r.createElement)("div",{class:"tw-c-text-base tw-elevation-1 tw-flex tw-flex-shrink-0 tw-pd-x-1 tw-pd-y-05 tw-popover-header"},Object(r.createElement)("div",{class:"tw-flex tw-flex-column tw-justify-content-center tw-mg-l-05 tw-popover-header__icon-slot--left"},Object(r.createElement)("div",{class:"tw-inline-flex tw-relative tw-tooltip-wrapper"},Object(r.createElement)("button",{class:"tw-align-items-center tw-align-middle tw-border-radius-medium tw-button-icon tw-button-icon--secondary tw-core-button tw-core-button--border tw-inline-flex tw-interactive tw-justify-content-center tw-overflow-hidden",onDblClick:()=>{this.emit("site.player:reset"),destroy()}},Object(r.createElement)("span",{class:"tw-button-icon__icon"},Object(r.createElement)("figure",{class:"ffz-i-t-reset"}))),Object(r.createElement)("div",{class:"tw-tooltip tw-tooltip--down tw-tooltip--align-left"},this.i18n.t("player.reset_button.all","Reset All Players (Double-Click)")))),Object(r.createElement)("div",{class:"tw-align-items-center tw-flex tw-flex-column tw-flex-grow-1 tw-justify-content-center"},Object(r.createElement)("h5",{class:"tw-align-center tw-c-text-alt tw-semibold"},this.i18n.t("site.menu_button.profiles","Profiles"))),Object(r.createElement)("div",{class:"tw-flex tw-flex-column tw-justify-content-center tw-mg-l-05 tw-popover-header__icon-slot--right"},Object(r.createElement)("div",{class:"tw-inline-flex tw-relative tw-tooltip-wrapper"},Object(r.createElement)("button",{class:"tw-align-items-center tw-align-middle tw-border-radius-medium tw-button-icon tw-button-icon--secondary tw-core-button tw-core-button--border tw-inline-flex tw-interactive tw-justify-content-center tw-overflow-hidden",onClick:e=>{this.openSettings(e,t),destroy()}},Object(r.createElement)("span",{class:"tw-button-icon__icon"},Object(r.createElement)("figure",{class:"ffz-i-cog"}))),Object(r.createElement)("div",{class:"tw-tooltip tw-tooltip--down tw-tooltip--align-center"},this.i18n.t("setting.profiles.configure","Configure")))),Object(r.createElement)("div",{class:"tw-flex tw-flex-column tw-justify-content-center tw-mg-l-05 tw-popover-header__icon-slot--right"},Object(r.createElement)("button",{class:"tw-align-items-center tw-align-middle tw-border-radius-medium tw-button-icon tw-button-icon--secondary tw-core-button tw-core-button--border tw-inline-flex tw-interactive tw-justify-content-center tw-overflow-hidden tw-relative",onClick:destroy},Object(r.createElement)("span",{class:"tw-button-icon__icon"},Object(r.createElement)("figure",{class:"ffz-i-cancel"}))))),Object(r.createElement)("div",{class:"center-window__long-scrollable-area scrollable-area scrollable-area--suppress-scroll-x","data-simplebar":!0},s))),n._ffz_destroy=destroy,n._ffz_outside=new r.ClickOutside(n,destroy),i.appendChild(n),this._ctx_open=!0}openSettings(e,t){const i=this.resolve("main_menu");i&&(i.requestPage("data_management.profiles"),i.showing||this.emit(":clicked",e,t))}loadMenu(e,t,i){const n=this.resolve("main_menu");n&&(i&&n.requestPage(i),n.showing||(this.loading=!0,n.enable(e).then(()=>{this.loading=!1}).catch(e=>{this.log.capture(e),this.log.error("Error enabling main menu.",e),this.error={i18n:"site.menu_button.error",text:"There was an error loading the FFZ Control Center. Please refresh and try again."},this.loading=!1,this.once(":clicked",this.loadMenu)})))}onDisable(){this.off("i18n:update",this.update),this.off(":clicked",this.loadMenu)}}},function(e,i,n){"use strict";n.r(i),n.d(i,"PLAYER_ROUTES",(function(){return o})),n.d(i,"default",(function(){return Player}));var s=n(3),r=n(1);const o=["front-page","user","video","user-video","user-clip","user-videos","user-clips","user-collections","user-events","user-followers","user-following","dash"],a=Object(r.createElement)("span");function rotateButton(e){const t=e.currentTarget,i=t&&t.querySelector("figure");i&&!i.classList.contains("ffz-i-t-reset-clicked")&&(i.classList.toggle("ffz-i-t-reset",!1),i.classList.toggle("ffz-i-t-reset-clicked",!0),setTimeout(()=>{i.classList.toggle("ffz-i-t-reset",!0),i.classList.toggle("ffz-i-t-reset-clicked",!1)},500))}class Player extends s.default{constructor(...e){super(...e),this.should_enable=!0,this.inject("i18n"),this.inject("settings"),this.inject("site.fine"),this.inject("site.web_munch"),this.inject("site.css_tweaks"),this.inject("site.router"),this.SquadStreamBar=this.fine.define("squad-stream-bar",e=>e.shouldRenderSquadBanner&&e.props&&e.props.triggerPlayerReposition,o),this.Player=this.fine.define("highwind-player",e=>{var t,i;return e.setPlayerActive&&(null===(t=e.props)||void 0===t?void 0:t.playerEvents)&&(null===(i=e.props)||void 0===i?void 0:i.mediaPlayerInstance)},o),this.TheatreHost=this.fine.define("theatre-host",e=>e.toggleTheatreMode&&e.props&&e.props.onTheatreModeEnabled,["user","video","user-video","user-clip"]),this.PlayerSource=this.fine.define("player-source",e=>e.setSrc&&e.setInitialPlaybackSettings,!1),this.settings.add("player.allow-catchup",{default:!0,ui:{path:"Player > General >> General",title:"Allow the player to speed up to reduce delay.",description:"Twitch, by default, will apply a minor speed up to live video when you have a large delay to the broadcaster in order to catch back up with the live broadcast. This may result in audio distortion. Disable this to prevent the automatic speed changes.",component:"setting-check-box"},changed:e=>{for(const t of this.Player.instances)this.updateAutoPlaybackRate(t,e)}}),this.settings.add("player.volume-scroll",{default:!1,ui:{path:"Player > General >> Volume",title:"Adjust volume by scrolling with the mouse wheel.",description:"*This setting will not work properly on streams with visible extensions when mouse interaction with extensions is allowed.*",component:"setting-check-box"}}),this.settings.add("player.button.reset",{default:!0,ui:{path:"Player > General >> General",title:"Add a `Reset Player` button to the player controls.",description:"Double-clicking the Reset Player button attempts to reset the Twitch player's internal state, fixing playback issues without a full page refresh.",component:"setting-check-box"},changed:()=>{for(const e of this.Player.instances)this.addResetButton(e)}}),document.pictureInPictureEnabled&&this.settings.add("player.button.pip",{default:!0,ui:{path:"Player > General >> General",title:"Add a `Picture-in-Picture` button to the player controls.",description:"Clicking the PiP button attempts to toggle Picture-in-Picture mode for the player's video.",component:"setting-check-box"},changed:()=>{for(const e of this.Player.instances)this.addPiPButton(e)}}),this.settings.add("player.volume-scroll-steps",{default:.1,ui:{path:"Player > General >> Volume",title:"Volume scroll amount",description:"How much the volume level is changed per individual scroll input.",component:"setting-select-box",data:[{value:.1,title:"10%"},{value:.05,title:"5%"},{value:.02,title:"2%"},{value:.01,title:"1%"}]}}),this.settings.add("player.captions.font-size",{default:"",ui:{path:"Player > Closed Captioning >> Font",title:"Font Size",description:"How large should captions be. This can be a percentage, such as `10%`, or a pixel value, such as `50px`.",component:"setting-text-box"},changed:()=>this.updateCaptionsCSS()}),this.settings.add("player.captions.font-family",{default:"",ui:{path:"Player > Closed Captioning >> Font",title:"Font Family",description:"Override the font used for displaying Closed Captions.",component:"setting-text-box"},changed:()=>this.updateCaptionsCSS()}),this.settings.add("player.theatre.no-whispers",{default:!1,requires:["whispers.show"],process:(e,t)=>!e.get("whispers.show")||t,ui:{path:"Player > General >> Theatre Mode",title:"Hide whispers when Theatre Mode is enabled.",component:"setting-check-box"},changed:e=>this.css_tweaks.toggle("theatre-no-whispers",e)}),this.settings.add("player.theatre.metadata",{default:!1,ui:{path:"Player > General >> Theatre Mode",title:"Show metadata when mousing over the player.",component:"setting-check-box"},changed:e=>this.css_tweaks.toggle("theatre-metadata",e)}),this.settings.add("player.theatre.auto-enter",{default:!1,ui:{path:"Player > General >> Theatre Mode",title:"Automatically open Theatre Mode when visiting a channel.",component:"setting-check-box"}}),this.settings.add("player.ext-hide",{default:0,ui:{path:"Player > General >> Extensions",title:"Show Overlay Extensions",component:"setting-select-box",data:[{value:2,title:"Never"},{value:1,title:"With Controls"},{value:0,title:"Always"}]},changed:e=>this.updateHideExtensions(e)}),this.settings.add("player.ext-interaction",{default:!0,ui:{path:"Player > General >> Extensions",title:"Allow mouse interaction with overlay extensions.",component:"setting-check-box"},changed:e=>this.css_tweaks.toggle("player-ext-mouse",!e)}),this.settings.add("player.home.autoplay",{default:!0,ui:{path:"Player > General >> Playback",title:"Auto-play featured broadcasters on the front page.",component:"setting-check-box"}}),this.settings.add("player.no-autoplay",{default:!1,ui:{path:"Player > General >> Playback",title:"Do not automatically start playing videos or streams.",description:"Note: This feature does not apply when navigating directly from channel to channel.",component:"setting-check-box"}}),this.settings.add("player.vod.autoplay",{default:!0,ui:{path:"Player > General >> Playback",title:"Auto-play the next recommended video after a video finishes.",component:"setting-check-box"}}),this.settings.add("player.volume-always-shown",{default:!1,ui:{path:"Player > General >> Volume",title:"Keep the volume slider expanded at all times.",component:"setting-check-box"},changed:e=>this.css_tweaks.toggle("player-volume",e)}),this.settings.add("player.hide-event-bar",{default:!1,ui:{path:"Channel > Appearance >> General",title:"Hide the Event Bar",description:"Hide the Event Bar which appears above the player when there is an ongoing event for the current channel.",component:"setting-check-box"},changed:e=>{this.css_tweaks.toggleHide("player-event-bar",e),this.repositionPlayer()}}),this.settings.add("player.hide-rerun-bar",{default:!1,ui:{path:"Channel > Appearance >> General",title:"Hide the Rerun Bar",description:"Hide the Rerun Bar which appears above the player when the current channel is playing a video rather than live content.",component:"setting-check-box"},changed:e=>{this.css_tweaks.toggleHide("player-rerun-bar",e),this.repositionPlayer()}}),this.settings.add("player.hide-squad-banner",{default:!1,ui:{path:"Channel > Appearance >> General",title:"Hide the Squad Streaming Bar",component:"setting-check-box"},changed:()=>this.SquadStreamBar.forceUpdate()}),this.settings.add("player.hide-mouse",{default:!0,ui:{path:"Player > General >> General",title:"Hide mouse when controls aren't visible.",component:"setting-check-box"},changed:e=>this.css_tweaks.toggle("player-hide-mouse",e)})}onEnable(){this.css_tweaks.toggle("player-volume",this.settings.get("player.volume-always-shown")),this.css_tweaks.toggle("player-ext-mouse",!this.settings.get("player.ext-interaction")),this.css_tweaks.toggle("theatre-no-whispers",this.settings.get("player.theatre.no-whispers")),this.css_tweaks.toggle("theatre-metadata",this.settings.get("player.theatre.metadata")),this.css_tweaks.toggle("player-hide-mouse",this.settings.get("player.hide-mouse")),this.css_tweaks.toggleHide("player-event-bar",this.settings.get("player.hide-event-bar")),this.css_tweaks.toggleHide("player-rerun-bar",this.settings.get("player.hide-rerun-bar")),this.updateCaptionsCSS(),this.updateHideExtensions(),this.installVisibilityHook(),this.on(":reset",()=>this.resetPlayer());const e=this;this.SquadStreamBar.ready(t=>{const i=t.prototype.shouldRenderSquadBanner;t.prototype.shouldRenderSquadBanner=function(...t){return!e.settings.get("player.hide-squad-banner")&&i.call(this,...t)},this.SquadStreamBar.forceUpdate(),this.updateSquadContext()}),this.SquadStreamBar.on("mount",this.updateSquadContext,this),this.SquadStreamBar.on("update",this.updateSquadContext,this),this.SquadStreamBar.on("unmount",this.updateSquadContext,this),this.Player.ready((t,i)=>{const n=t.prototype.maybeAttachDomEventListeners;t.prototype.ffzInstall=function(){if(this._ffz_installed)return;this._ffz_installed=!0,this._ffzUpdateState||(this._ffzUpdateState=this.ffzUpdateState.bind(this)),this._ffzErrorReset||(this._ffzErrorReset=e.addErrorResetButton.bind(e,this)),this._ffzReady||(this._ffzReady=this.ffzReady.bind(this));const t=this,i=this.setPlayerActive,n=this.setPlayerInactive;this.setPlayerActive=function(){return t.ffzScheduleState(),i.call(t)},this.setPlayerInactive=function(){return t.ffzScheduleState(),n.call(t)},this.ffzOnEnded=()=>{e.settings.get("player.vod.autoplay")||e.parent.awaitElement(".autoplay-vod__content-container button",this.props.containerRef||e.fine.getChildNode(this),1e3).then(e=>e.click())};const s=this.props.playerEvents;s&&(Object(r.on)(s,"Playing",this._ffzUpdateState),Object(r.on)(s,"PlayerError",this._ffzUpdateState),Object(r.on)(s,"PlayerError",this._ffzErrorReset),Object(r.on)(s,"Ended",this._ffzUpdateState),Object(r.on)(s,"Ended",this.ffzOnEnded),Object(r.on)(s,"Ready",this._ffzReady),Object(r.on)(s,"Idle",this._ffzUpdateState)),this.ffzStopAutoplay()},t.prototype.ffzUninstall=function(){this._ffz_state_raf&&cancelAnimationFrame(this._ffz_state_raf);const e=this.props.playerEvents;e&&this._ffzUpdateState&&(Object(r.off)(e,"Playing",this._ffzUpdateState),Object(r.off)(e,"PlayerError",this._ffzUpdateState),Object(r.off)(e,"PlayerError",this._ffzErrorReset),Object(r.off)(e,"Ended",this._ffzUpdateState),Object(r.off)(e,"Ended",this.ffzOnEnded),Object(r.off)(e,"Ready",this._ffzReady),Object(r.off)(e,"Idle",this._ffzUpdateState)),this.ffzRemoveListeners(),this._ffz_state_raf=null,this._ffzUpdateState=null,this._ffzErrorReset=null,this._ffzReady=null,this.ffzOnEnded=null},t.prototype.ffzReady=function(){const e=this.props.containerRef;e&&requestAnimationFrame(()=>{const t=e.querySelectorAll(".ffz--player-reset figure");for(const e of t)e._ffz_unspin&&clearTimeout(e._ffz_unspin),e.classList.toggle("loading",!1)})},t.prototype.ffzStopAutoplay=function(){if(e.settings.get("player.no-autoplay")||!e.settings.get("player.home.autoplay")&&"front-page"===e.router.current.name){var t;const i=this.props.mediaPlayerInstance,n=this.props.playerEvents;if(i&&i.pause&&"Playing"===(null===(t=i.getPlayerState)||void 0===t?void 0:t.call(i)))i.pause();else if(n){const immediatePause=()=>{var e;(null===(e=this.props.mediaPlayerInstance)||void 0===e?void 0:e.pause)&&(this.props.mediaPlayerInstance.pause(),Object(r.off)(n,"Playing",immediatePause))};e.log.info("Unable to immediately pause. Listening for playing event."),Object(r.on)(n,"Playing",immediatePause)}}},t.prototype.ffzScheduleState=function(){this._ffzUpdateState||(this._ffzUpdateState=this.ffzUpdateState.bind(this)),this._ffz_state_raf||(this._ffz_state_raf=requestAnimationFrame(this._ffzUpdateState))},t.prototype.ffzUpdateState=function(){var e,t,i;this._ffz_state_raf=null;const n=this.props.containerRef,s=this.props.mediaPlayerInstance;if(!n)return;const r=n.dataset;r.controls=(null===(e=this.state)||void 0===e?void 0:e.active)||!1,r.ended="Ended"===(null==s?void 0:null===(t=s.state)||void 0===t?void 0:t.playerState),r.paused="Idle"===(null==s?void 0:null===(i=s.state)||void 0===i?void 0:i.playerState)},t.prototype.ffzAttachListeners=function(){const e=this.props.containerRef;e&&!this._ffz_listeners&&(this._ffz_listeners=!0,this._ffz_scroll_handler||(this._ffz_scroll_handler=this.ffzScrollHandler.bind(this)),Object(r.on)(e,"wheel",this._ffz_scroll_handler))},t.prototype.ffzRemoveListeners=function(){const e=this.props.containerRef;e&&this._ffz_listeners&&(this._ffz_scroll_handler&&(Object(r.off)(e,"wheel",this._ffz_scroll_handler),this._ffz_scroll_handler=null),this._ffz_listeners=!1)},t.prototype.ffzScrollHandler=function(t){var i;if(!e.settings.get("player.volume-scroll"))return;const n=t.wheelDelta||-(t.deltaY||t.detail||0),s=null===(i=this.props)||void 0===i?void 0:i.mediaPlayerInstance;if(!(null==s?void 0:s.getVolume))return;const r=e.settings.get("player.volume-scroll-steps"),o=Math.max(0,Math.min(1,s.getVolume()+(n>0?r:-r)));return s.setVolume(o),0!==o&&s.setMuted(!1),t.preventDefault(),!1},t.prototype.ffzMaybeRemoveNativeListeners=function(){const e=this.props.containerRef;e&&this.listenersAttached&&(Object(r.off)(e,"mouseleave",this.setPlayerInactive),Object(r.off)(e,"mouseenter",this.setPlayerActive),Object(r.off)(e,"mousemove",this.onMouseMove),this.listenersAttached=!1)},t.prototype.maybeAttachDomEventListeners=function(){try{this.ffzInstall(),this.ffzAttachListeners()}catch(t){e.log.error("Error attaching event listener.",t)}return n.call(this)};for(const e of i){var s;const t=null===(s=e.props)||void 0===s?void 0:s.playerEvents;t&&(Object(r.off)(t,"Playing",e.setPlayerActive),Object(r.off)(t,"PlayerSeekCompleted",e.setPlayerActive)),e.ffzMaybeRemoveNativeListeners(),e.maybeAttachDomEventListeners(),e.ffzScheduleState(),t&&(Object(r.on)(t,"Playing",e.setPlayerActive),Object(r.on)(t,"PlayerSeekCompleted",e.setPlayerActive)),this.updateGUI(e)}}),this.Player.on("mount",this.updateGUI,this),this.Player.on("update",this.updateGUI,this),this.Player.on("unmount",e=>{e.ffzUninstall()}),this.TheatreHost.on("mount",this.tryTheatreMode,this),this.TheatreHost.ready((e,t)=>{for(const e of t)this.tryTheatreMode(e)}),this.on("i18n:update",()=>{for(const e of this.Player.instances)this.updateGUI(e)})}updateAutoPlaybackRate(e,t){var i;const n=null===(i=e.props)||void 0===i?void 0:i.mediaPlayerInstance;n&&(null==t&&(t=this.settings.get("player.allow-catchup")),n.setLiveSpeedUpRate&&n.setLiveSpeedUpRate(t?1.05:1))}updateHideExtensions(e){void 0===e&&(e=this.settings.get("player.ext-hide")),this.css_tweaks.toggleHide("player-ext-hover",1===e),this.css_tweaks.toggleHide("player-ext",2===e)}updateCaptionsCSS(){const e=this.settings.get("player.captions.font-size");let t=this.settings.get("player.captions.font-family");-1!==t.indexOf(" ")&&-1===t.indexOf(",")&&-1===t.indexOf('"')&&-1===t.indexOf("'")&&(t=`"${t}"`),a.style.fontSize="",a.style.fontFamily="",a.style.fontSize=e,a.style.fontFamily=t;const i=[];a.style.fontFamily&&i.push(`font-family: ${a.style.fontFamily} !important;`),a.style.fontSize&&i.push(`font-size: ${a.style.fontSize} !important;`),i.length?this.css_tweaks.set("captions-font",`.player-captions-container__caption-line {\n\t${i.join("\n\t")}\n}`):this.css_tweaks.delete("captions-font")}installVisibilityHook(){if(document.pictureInPictureEnabled)try{Object.defineProperty(document,"hidden",{configurable:!0,get:()=>null==document.pictureInPictureElement&&"hidden"===document.visibilityState})}catch(e){this.log.warn("Unable to install document visibility hook.",e)}else this.log.info("Skipping visibility hook. Picture-in-Picture is not available.")}updateGUI(e){var t;this.addPiPButton(e),this.addResetButton(e);const i=null==e?void 0:null===(t=e.props)||void 0===t?void 0:t.mediaPlayerInstance;i&&!this.settings.get("player.allow-catchup")&&i.setLiveSpeedUpRate&&i.setLiveSpeedUpRate(1)}addPiPButton(e,t=0){const i=e.props.containerRef||this.fine.getChildNode(e),n=i&&i.querySelector(".player-controls__right-control-group"),s=document.pictureInPictureEnabled&&this.settings.get("player.button.pip");if(!n){if(!s)return;return t<5?setTimeout(this.addPiPButton.bind(this,e,(t||0)+1),250):void 0}let o,a,l,c=n.querySelector(".ffz--player-pip");if(!s)return void(c&&c.remove());if(c)o=c.querySelector("figure"),l=c.querySelector("button"),a=c.querySelector(".tw-tooltip");else{c=Object(r.createElement)("div",{class:"ffz--player-pip tw-inline-flex tw-relative tw-tooltip-wrapper"},l=Object(r.createElement)("button",{class:"tw-align-items-center tw-align-middle tw-border-bottom-left-radius-medium tw-border-bottom-right-radius-medium tw-border-top-left-radius-medium tw-border-top-right-radius-medium tw-button-icon tw-button-icon--overlay tw-core-button tw-core-button--border tw-core-button--overlay tw-inline-flex tw-interactive tw-justify-content-center tw-overflow-hidden tw-relative",type:"button","data-a-target":"ffz-player-pip-button",onClick:this.pipPlayer.bind(this,e)},Object(r.createElement)("div",{class:"tw-align-items-center tw-flex tw-flex-grow-0"},Object(r.createElement)("div",{class:"tw-button-icon__icon"},o=Object(r.createElement)("figure",{class:"ffz-player-icon"})))),a=Object(r.createElement)("div",{class:"tw-tooltip tw-tooltip--align-right tw-tooltip--up",role:"tooltip"}));const t=n.querySelector('button[data-a-target="player-theatre-mode-button"]');t?n.insertBefore(c,t.parentElement):n.appendChild(c)}const u=!!document.pictureInPictureElement,h=u?this.i18n.t("player.pip_button.off","Exit Picture-in-Picture"):this.i18n.t("player.pip_button","Picture-in-Picture");o.classList.toggle("ffz-i-t-pip-inactive",!u),o.classList.toggle("ffz-i-t-pip-active",u),l.setAttribute("aria-label",h),a.textContent=h}pipPlayer(e,t){var i,n;const s=null===(i=e.props.mediaPlayerInstance)||void 0===i?void 0:null===(n=i.mediaSinkManager)||void 0===n?void 0:n.video;s&&document.pictureInPictureEnabled&&(t&&t.preventDefault(),s._ffz_pip_enter||(s.addEventListener("enterpictureinpicture",s._ffz_pip_enter=()=>{this.addPiPButton(e)}),s.addEventListener("leavepictureinpicture",s._ffz_pip_exit=()=>{this.addPiPButton(e)})),document.pictureInPictureElement?document.exitPictureInPicture():s.requestPictureInPicture())}addResetButton(e,t=0){const i=e.props.containerRef||this.fine.getChildNode(e),n=i&&i.querySelector(".player-controls__right-control-group"),s=this.settings.get("player.button.reset");if(!n){if(!s)return;return t<5?setTimeout(this.addResetButton.bind(this,e,(t||0)+1),250):void 0}let o,a,l=n.querySelector(".ffz--player-reset");if(s){if(l)a=l.querySelector("button"),o=l.querySelector(".tw-tooltip");else{l=Object(r.createElement)("div",{class:"ffz--player-reset tw-inline-flex tw-relative tw-tooltip-wrapper"},a=Object(r.createElement)("button",{class:"tw-align-items-center tw-align-middle tw-border-bottom-left-radius-medium tw-border-bottom-right-radius-medium tw-border-top-left-radius-medium tw-border-top-right-radius-medium tw-button-icon tw-button-icon--overlay tw-core-button tw-core-button--border tw-core-button--overlay tw-inline-flex tw-interactive tw-justify-content-center tw-overflow-hidden tw-relative",type:"button","data-a-target":"ffz-player-reset-button",onClick:rotateButton,onDblClick:this.resetPlayer.bind(this,e)},Object(r.createElement)("div",{class:"tw-align-items-center tw-flex tw-flex-grow-0"},Object(r.createElement)("div",{class:"tw-button-icon__icon"},Object(r.createElement)("figure",{class:"ffz-player-icon ffz-i-t-reset"})))),o=Object(r.createElement)("div",{class:"tw-tooltip tw-tooltip--align-right tw-tooltip--up",role:"tooltip"}));const t=n.querySelector(".ffz--player-pip button")||n.querySelector('button[data-a-target="player-theatre-mode-button"]');t?n.insertBefore(l,t.parentElement):n.appendChild(l)}a.setAttribute("aria-label",o.textContent=this.i18n.t("player.reset_button","Reset Player (Double-Click)"))}else l&&l.remove()}addErrorResetButton(e,i=0){const n=e.props.containerRef||this.fine.getChildNode(e),s=n&&n.querySelector(".content-overlay-gate"),o=this.settings.get("player.button.reset");if(!s){if(!o)return;return void(i<2&&this.parent.awaitElement(".autoplay-vod__content-container button",this.props.containerRef||t.fine.getChildNode(this),1e3).then(()=>{this.addErrorResetButton(e,(i||0)+1)}).catch(()=>{this.log.warn("Unable to find container element for Error Reset button.")}))}let a,l,c=s.querySelector(".ffz--player-reset");o?(c?(l=c.querySelector("button"),a=c.querySelector(".tw-tooltip")):(c=Object(r.createElement)("div",{class:"ffz--player-reset tw-absolute tw-bottom-0 tw-right-0 tw-tooltip-wrapper tw-mg-1"},l=Object(r.createElement)("button",{class:"tw-align-items-center tw-align-middle tw-border-bottom-left-radius-medium tw-border-bottom-right-radius-medium tw-border-top-left-radius-medium tw-border-top-right-radius-medium tw-button-icon tw-button-icon--overlay tw-core-button tw-core-button--border tw-core-button--overlay tw-inline-flex tw-interactive tw-justify-content-center tw-overflow-hidden tw-relative",type:"button","data-a-target":"ffz-player-reset-button",onClick:rotateButton,onDblClick:this.resetPlayer.bind(this,e)},Object(r.createElement)("div",{class:"tw-align-items-center tw-flex tw-flex-grow-0"},Object(r.createElement)("div",{class:"tw-button-icon__icon"},Object(r.createElement)("figure",{class:"ffz-player-icon ffz-i-t-reset"})))),a=Object(r.createElement)("div",{class:"tw-tooltip tw-tooltip--align-right tw-tooltip--up",role:"tooltip"})),s.appendChild(c)),l.setAttribute("aria-label",a.textContent=this.i18n.t("player.reset_button","Double-Click to Reset Player"))):c&&c.remove()}resetPlayer(e,t){var i;const n=e?e.mediaSinkManager?e:null==e?void 0:null===(i=e.props)||void 0===i?void 0:i.mediaPlayerInstance:null;if(t){t.preventDefault();const e=t.currentTarget,i=e&&e.querySelector("figure");if(i){if(i.classList.contains("loading"))return;i.classList.toggle("ffz-i-t-reset",!0),i.classList.toggle("ffz-i-t-reset-clicked",!1),i.classList.toggle("loading",!0),i._ffz_unspin=setTimeout(()=>{i._ffz_unspin=null,i.classList.toggle("loading",!1)},1e4)}}this.PlayerSource.check();for(const e of this.PlayerSource.instances){var s;n&&n!==(null===(s=e.props)||void 0===s?void 0:s.mediaPlayerInstance)||e.setSrc({isNewMediaPlayerInstance:!1})}}tryTheatreMode(e){var t;this.settings.get("player.theatre.auto-enter")&&(null==e?void 0:null===(t=e.props)||void 0===t?void 0:t.onTheatreModeEnabled)&&e.props.onTheatreModeEnabled()}repositionPlayer(){for(const t of this.SquadStreamBar.instances){var e;if(null==t?void 0:null===(e=t.props)||void 0===e?void 0:e.triggerPlayerReposition)return void t.props.triggerPlayerReposition()}}updateSquadContext(){this.settings.updateContext({squad_bar:this.hasSquadBar})}get hasSquadBar(){const e=this.SquadStreamBar.first;return!!e&&e.shouldRenderSquadBanner(e.props)}get playerUI(){var e;const t=this.fine.searchTree(this.Player.first,e=>e.props&&e.props.uiContext,150);return null==t?void 0:null===(e=t.props)||void 0===e?void 0:e.uiContext}get current(){for(const t of this.Player.instances){var e;if(null==t?void 0:null===(e=t.props)||void 0===e?void 0:e.mediaPlayerInstance)return t.props.mediaPlayerInstance}return null}}},function(e,t,i){"use strict";i.r(t),i.d(t,"default",(function(){return SettingsSync}));var n=i(3),s=i(1);class SettingsSync extends n.default{constructor(...e){super(...e),this.should_enable="www.twitch.tv"!==window.location.host,this.inject("settings")}onEnable(){const e=this.frame=Object(s.createElement)("iframe");e.src="//www.twitch.tv/p/ffz_bridge/",e.id="ffz-settings-bridge",e.style.width=0,e.style.height=0,this.settings.provider.on("set",this.onProviderSet,this),window.addEventListener("message",this.onMessage.bind(this)),document.body.appendChild(e)}send(e){try{this.frame.contentWindow.postMessage(e,"*")}catch(e){this.log.error("send error",e)}}onMessage(e){const t=e.data;t&&t.ffz_type&&("ready"===t.ffz_type?this.send({ffz_type:"load"}):"loaded"===t.ffz_type?this.onLoad(t.data):"change"===t.ffz_type?this.onChange(t):this.log.info("Unknown Message",t.ffz_type,t))}onLoad(e){if(!e)return;const t=this.settings.provider,i=new Set(t.keys());this.skip=!0;for(const[n,s]of Object.entries(e))i.delete(n),t.get(n)!==s&&(t.set(n,s),t.emit("changed",n,s,!1));for(const e of i)t.delete(e),t.emit("changed",e,void 0,!0);this.skip=!1}onProviderSet(e,t,i){this.skip||this.send({ffz_type:"change",key:e,value:t,deleted:i})}onChange(e){const t=e.key,i=e.value,n=e.deleted;this.skip=!0,n?this.settings.provider.delete(t):this.settings.provider.set(t,i),this.skip=!1,this.settings.provider.emit("changed",t,i,n,!0)}}},function(e,t,i){"use strict";i.r(t),i.d(t,"default",(function(){return SubButton}));var n=i(3),s=i(1);class SubButton extends n.default{constructor(...e){super(...e),this.should_enable=!0,this.inject("i18n"),this.inject("settings"),this.inject("site.fine"),this.settings.add("sub-button.prime-notice",{default:!0,ui:{path:"Channel > Metadata >> Subscription",title:"Show Prime Reminder",description:"Display a crown on subscription buttons when your free channel sub with Prime is available.",component:"setting-check-box"},changed:()=>this.SubButton.forceUpdate()}),this.SubButton=this.fine.define("sub-button",e=>e.handleSubMenuAction&&e.isUserDataReady,["user","user-video","user-clip","video","user-videos","user-clips","user-collections","user-events","user-followers","user-following"])}onEnable(){this.settings.on(":changed:layout.swap-sidebars",()=>this.SubButton.forceUpdate()),this.SubButton.ready((e,t)=>{const i=this,n=e.prototype.render;e.prototype.render=function(){try{const e=this.props.balloonDirection;if(void 0!==e){const t=i.settings.get("layout.swap-sidebars"),n=e.includes("--left");t&&!n?this.props.balloonDirection=e.replace("--right","--left"):!t&&n&&(this.props.balloonDirection=e.replace("--left","--right"))}}catch(e){}return n.call(this)};for(const e of t)this.updateSubButton(e);this.SubButton.forceUpdate()}),this.SubButton.on("mount",this.updateSubButton,this),this.SubButton.on("update",this.updateSubButton,this)}updateSubButton(e){const t=this.fine.getChildNode(e),i=t&&t.querySelector('button[data-a-target="subscribe-button"]');if(!i)return;const n=e.props,r=n.data&&n.data.user,o=r&&r.self,a=this.settings.get("sub-button.prime-notice")&&o&&o.canPrimeSubscribe&&!o.subscriptionBenefit,l=i.querySelector(".ffz--can-prime");if(a&&!l)i.insertBefore(Object(s.createElement)("span",{class:"tw-button__icon tw-button__icon--left ffz--can-prime"},Object(s.createElement)("figure",{class:"ffz-i-crown ffz-tooltip","data-title":this.i18n.t("sub-button.prime","Your free channel sub with Prime is available.")})),i.firstElementChild),i.appendChild(Object(s.createElement)("span",{class:"ffz--post-prime"}));else if(!a&&l){l.remove();const e=i.querySelector(".ffz--post-prime");e&&e.remove()}}}},function(e,t,i){"use strict";i.r(t),i.d(t,"default",(function(){return ThemeEngine}));var n=i(3),s=i(1),r=i(9),o=i(115),a=i.n(o),l=i(116),c=i.n(l);const u=["product","prime","turbo"];class ThemeEngine extends n.default{constructor(...e){super(...e),this.inject("settings"),this.inject("site"),this.inject("site.fine"),this.inject("site.css_tweaks"),this.inject("site.router"),this.should_enable=!0,this.settings.add("theme.color.background",{default:"",ui:{path:'Appearance > Theme >> Colors @{"description": "This is a quick preview of a new system coming soon to FrankerFaceZ. Expect heavy changes here, including separate Basic and Advanced modes, and better color selection."}',title:"Background",description:"Try `#0E0C13` for something close to the old dark theme, or `#0E0E0E` for a nice dark gray. Transparent colors not allowed.",component:"setting-color-box",alpha:!1},changed:()=>this.updateCSS()}),this.settings.add("theme.color.text",{default:"",ui:{path:"Appearance > Theme >> Colors",title:"Text",description:"If not set, this will automatically be set to white or black based on the brightness of the background.",component:"setting-color-box"},changed:()=>this.updateCSS()}),this.settings.add("theme.dark",{requires:["theme.is-dark"],default:!1,process:(e,t)=>!!e.get("theme.is-dark")&&t,ui:{path:'Appearance @{"description": "Personalize the appearance of Twitch. Change the color scheme and fonts and tune the layout to optimize your experience."} > Theme >> Legacy',title:"Gray (no Purple)",description:"*Requires Dark Theme to be Enabled.*\n\nThis setting will be going away very soon, as the new theme system matures.\nThe CSS loaded by this setting is far too heavy and can cause performance issues.",component:"setting-check-box"},changed:e=>this.updateSetting(e)}),this.settings.add("theme.can-dark",{requires:["context.route.name"],process:e=>!u.includes(e.get("context.route.name"))}),this.settings.add("theme.is-dark",{requires:["theme.can-dark","context.ui.theme","context.ui.theatreModeEnabled","context.route.name","context.location.search"],process:e=>"embed-chat"===e.get("context.route.name")?(e.get("context.location.search")||"").includes("dark"):e.get("context.ui.theatreModeEnabled")||e.get("theme.can-dark")&&1===e.get("context.ui.theme"),changed:()=>this.updateCSS()}),this.settings.add("theme.tooltips-dark",{requires:["theme.is-dark"],process:e=>!e.get("theme.is-dark")}),this._style=null,this._normalizer=null}updateOldCSS(){const e=this.settings.get("theme.is-dark"),t=this.settings.get("theme.dark");document.body.classList.toggle("tw-root--theme-ffz",t),this.css_tweaks.setVariable("border-color",e?t?"#2a2a2a":"#2c2541":"#dad8de")}updateCSS(){if(this.updateOldCSS(),!this.settings.get("theme.can-dark"))return this.toggleNormalizer(!1),void this.css_tweaks.delete("colors");let e=this.settings.get("theme.is-dark");const t=[],i=r.Color.RGBA.fromCSS(this.settings.get("theme.color.background"));if(i){i.a=1,t.push(`--color-background-body: ${i.toCSS()};`);const n=i.toHSLA(),s=n.l;e=s<.5;try{const t=this.resolve("site").store,i=t.getState().ui.theme,n=e?1:0;i!==n&&t.dispatch({type:"core.ui.THEME_CHANGED",theme:n})}catch(e){this.log.warning("Unable to automatically set the Twitch Dark Theme state.",e)}t.push(`--color-background-input-focus: ${i.toCSS()};`),t.push(`--color-background-base: ${n._l(s+(e?.05:-.05)).toCSS()};`),t.push(`--color-background-alt: ${n._l(s+(e?.1:-.1)).toCSS()};`),t.push(`--color-background-alt-2: ${n._l(s+(e?.15:-.15)).toCSS()};`)}let n=r.Color.RGBA.fromCSS(this.settings.get("theme.color.text"));if(!n&&i&&(n=r.Color.RGBA.fromCSS(e?"#FFF":"#000")),n){t.push(`--color-text-base: ${n.toCSS()};`);const e=n.toHSLA(),i=e.a;t.push(`--color-text-label: ${n.toCSS()};`),t.push(`--color-text-label-optional: ${e._a(i-.4).toCSS()};`),t.push(`--color-text-alt: ${e._a(i-.2).toCSS()};`),t.push(`--color-text-alt-2: ${e._a(i-.4).toCSS()};`)}t.length?(this.css_tweaks.set("colors",`body {${t.join("\n")}}`),this.toggleNormalizer(!0)):(this.css_tweaks.delete("colors"),this.toggleNormalizer(!1))}toggleNormalizer(e){if(this._normalizer){if(!e)return void this._normalizer.remove()}else{if(!e)return;this._normalizer=Object(s.createElement)("link",{rel:"stylesheet",type:"text/css",href:c.a})}document.head.contains(this._normalizer)||document.head.appendChild(this._normalizer)}toggleStyle(e){if(this._style){if(!e)return void this._style.remove()}else{if(!e)return;this._style=Object(s.createElement)("link",{rel:"stylesheet",type:"text/css",href:a.a})}document.head.appendChild(this._style)}updateSetting(e){this.toggleStyle(e),this.updateCSS()}onEnable(){this.updateSetting(this.settings.get("theme.dark")),this.updateCSS()}}},function(e,t,i){"use strict";i.r(t),i.d(t,"default",(function(){return VideoChatHook}));var n=i(0),s=i(6),r=i(90),o=i(3);class VideoChatHook extends o.default{constructor(...e){super(...e),this.should_enable=!0,this.inject("i18n"),this.inject("settings"),this.inject("site"),this.inject("site.router"),this.inject("site.fine"),this.inject("site.web_munch"),this.inject("chat"),this.injectAs("site_chat","site.chat"),this.inject("site.chat.chat_line.rich_content"),this.VideoChatController=this.fine.define("video-chat-controller",e=>e.onMessageScrollAreaMount&&e.createReply,["user-video","user-clip","video"]),this.VideoChatMenu=this.fine.define("video-chat-menu",e=>e.onToggleMenu&&e.getContent&&e.props&&Object(n.has)(e.props,"isExpandedLayout"),["user-video","user-clip","video"]),this.VideoChatLine=this.fine.define("video-chat-line",e=>e.onReplyClickHandler&&e.shouldFocusMessage,["user-video","user-clip","video"]),this.settings.add("chat.video-chat.enabled",{default:!0,ui:{path:'Chat > Chat on Videos @{"description": "This feature is currently in beta. As such, you may experience issues when using FFZ features with Chat on Videos."} >> General',title:"Enable FrankerFaceZ features for Chat on Videos.",description:"Display FFZ badges, emotes, and other features in Chat on Videos. Moderation features may be unavailable when this is enabled.",component:"setting-check-box"}})}async onEnable(){this.chat.context.on("changed:chat.video-chat.enabled",this.updateLines,this),this.on("chat:updated-lines",this.updateLines,this),this.VideoChatController.on("mount",this.chatMounted,this),this.VideoChatController.on("unmount",this.chatUnmounted,this),this.VideoChatController.on("receive-props",this.chatUpdated,this),this.VideoChatController.ready((e,t)=>{for(const e of t)this.chatMounted(e)});const e=this,t=await this.web_munch.findModule("react");if(!t)return;const i=t.createElement,n=this.rich_content&&this.rich_content.RichContent;this.MenuContainer=class FFZMenuContainer extends t.Component{constructor(e){super(e),this.onBanUser=()=>{this.props.onBanUserClick({bannedUser:this.props.context.comment.commenter,targetChannel:this.props.context.comment.channelId,comment:this.props.context.comment})},this.onDeleteComment=()=>{this.props.onDeleteCommentClick(this.props.context.comment)},this.onOpen=()=>{this.props.onDisableSync(),this.setState({force:!0})},this.onClose=()=>{this.setState({force:!1})},this.state={force:!1}}render(){return e.VideoChatMenu._class?i("div",{class:`tw-flex-shrink-0 video-chat__message-menu${this.state.force?" video-chat__message-menu--force-visible":""}`},i(e.VideoChatMenu._class,{context:this.props.context,isCurrentUserModerator:this.props.isCurrentUserModerator,isExpandedLayout:this.props.isExpandedLayout,onBanUserClick:this.onBanUser,onClose:this.onClose,onDeleteCommentClick:this.onDeleteComment,onOpen:this.onOpen,onReplyClick:this.props.onReplyClick})):null}},this.VideoChatLine.ready(t=>{const r=t.prototype.render;t.prototype.ffzRenderMessage=function(t,s){const r=t.is_action,o=t.user,a=e.site_chat.colors.process(o.color),l=e.site.getUser();l&&(l.moderator=this.props.isCurrentUserModerator,l.staff=l.roles&&l.roles.isStaff);const c=t.ffz_tokens=t.ffz_tokens||e.chat.tokenizeMessage(t,l),u=n&&e.chat.pluckRichContent(c,t);return i("div",{class:"tw-align-items-start tw-flex tw-flex-nowrap tw-c-text-base"},i("div",{class:"tw-flex-grow-1","data-room-id":t.roomID,"data-room":t.roomLogin,"data-user-id":o.id,"data-user":o.login},i("span",{class:"chat-line__message--badges"},e.chat.badges.render(t,i)),i("a",{class:"video-chat__message-author notranslate","data-test-selector":"comment-author-selector",href:`/${o.login}`,rel:"noopener noreferrer",target:"_blank",style:{color:a}},i("span",{class:"chat-author__display-name","data-a-target":"chat-message-username","data-a-user":o.login,"data-test-selector":"message-username"},o.displayName),o.isIntl&&i("span",{class:"chat-author__intl-login","data-test-selector":"message-username-canonical"}," (",o.login,")")),i("div",{"data-test-selector":"comment-message-selector",class:"tw-inline video-chat__message"},i("span",null,r?" ":": "),i("span",{class:"message",style:{color:r?a:null}},e.chat.renderTokens(c,i)),u&&i(n,u))),s?i(e.MenuContainer,{context:s,isCurrentUserModerator:this.props.isCurrentUserModerator,isExpandedLayout:this.props.isExpandedLayout,onBanUserClick:this.props.onBanUserClick,onDeleteCommentClick:this.props.onDeleteCommentClick,onDisableSync:this.props.onDisableSync,onReplyClick:this.onReplyClickHandler}):null)},t.prototype.ffzRenderExpanded=function(t){return t._reply_handler||(t._reply_handler=()=>this.onReplyClickHandler(t.user.login)),i("div",{class:"tw-align-items-center tw-flex tw-pd-t-05"},i("button",{class:"tw-button tw-button--text","data-test-selector":"parent-reply-button",onClick:t._reply_handler},i("span",{class:"tw-button__text tw-pd-0"},e.i18n.t("video-chat.reply","Reply"))),i("span",{class:"tw-c-text-alt-2 tw-font-size-7 tw-mg-l-05 tw-relative tw-tooltip-wrapper"}," ",e.i18n.t("video-chat.time","{time,humantime} ago",{time:t.timestamp}),i("div",{class:"tw-tooltip tw-tooltip--align-center tw-tooltip--up",role:"tooltip"},e.i18n.formatDateTime(t.timestamp,"full"))))},t.prototype.render=function(){try{if(this._ffz_no_scan=!0,this.state.showReplyForm||!e.chat.context.get("chat.video-chat.enabled"))return r.call(this);const t=this.props.messageContext,n=e.standardizeMessage(t.comment,t.author),o=this.ffzRenderMessage(n,t),a=n.mentioned&&n.mention_color?e.site_chat.inverse_colors.process(n.mention_color):null;return n.ffz_removed?null:i("div",{"data-test-selector":"message-layout",class:`tw-align-items-start tw-flex tw-flex-nowrap tw-full-width tw-pd-l-05 tw-pd-y-05 vod-message${n.highlight?" ffz-notice-line ffz--points-line ffz--points-highlight ffz-custom-color":""}${n.mentioned?" ffz-mentioned":""}${a?" ffz-custom-color":""}`,style:{backgroundColor:a}},this.props.hideTimestamp||i("div",{"data-test-selector":"message-timestamp",class:"tw-align-right tw-flex tw-flex-shrink-0 vod-message__header"},i("div",{class:"tw-mg-r-05"},i("div",{class:"tw-inline-flex tw-relative tw-tooltip-wrapper"},i("button",{class:"tw-block tw-full-width tw-interactable tw-interactable--hover-enabled tw-interactable--inverted tw-interactive",onClick:this.onTimestampClickHandler},i("div",{class:"tw-pd-x-05"},i("p",{class:"tw-font-size-7"},Object(s.print_duration)(t.comment.contentOffset)))),i("div",{class:"tw-tooltip tw-tooltip--align-left tw-tooltip--up",role:"tooltip"},e.i18n.t("video-chat.jump","Jump to Video"))))),i("div",{class:"tw-full-width"},o,this.props.isExpandedLayout&&this.ffzRenderExpanded(n),t.replies.length>0&&i("div",{class:"qa-vod-chat-reply tw-mg-l-05 tw-mg-y-05 vod-message__reply"},t.comment.moreReplies&&i("div",{class:"tw-inline-block vod-message__show-more-replies"},i("button",{class:"tw-interactive tw-button tw-button--text",onClick:this.onLoadMoreRepliesClickHandler},i("span",{class:"tw-button__text","data-a-target":"tw-button-text"},e.i18n.t("video-chat.show-more","Show more replies...")))),i("ul",null,t.replies.map(t=>i("li",{key:t.comment&&t.comment.id,class:"tw-mg-l-05"},this.ffzRenderMessage(e.standardizeMessage(t.comment,t.author),t),this.props.isExpandedLayout&&this.ffzRenderExpanded(n)))))))}catch(t){return e.log.error("Problem rendering Chat",t),r.call(this)}},setTimeout(()=>this.VideoChatLine.forceUpdate())})}updateLines(){for(const e of this.VideoChatLine.instances){const t=e.props.messageContext;if(t.comment&&(t.comment._ffz_message=null,Array.isArray(t.replies)))for(const e of t.replies)e.comment&&(e.comment._ffz_message=null)}this.VideoChatLine.forceUpdate()}standardizeMessage(e,t){var i;if(e._ffz_message)return e._ffz_message;const n=this.chat.getRoom(e.channelId,null,!0,!0),s=e._ffz_message={user:{color:e.message.userColor,id:t.id,login:t.name,displayName:t.displayName,isIntl:t.name&&t.displayName&&t.displayName.trim().toLowerCase()!==t.name,type:t.type},roomLogin:n&&n.login,roomID:n&&n.id,badges:e.userBadges,messageParts:e.message.tokens,is_action:e.message.isAction,more_replies:e.moreReplies,timestamp:e.createdAt,highlight:"highlighted-message"===(null===(i=e.message.userNoticeParams)||void 0===i?void 0:i["msg-id"])};return this.chat.detokenizeMessage(s),s}addRoom(e,t){t||(t=e.props);const i=Object(n.get)("data.video.owner",t);if(!i||!i.id)return null;const s=e._ffz_room=this.chat.getRoom(i.id,i.login&&i.login.toLowerCase(),!1,!0);return s.ref(e),s}removeRoom(e){e._ffz_room&&(e._ffz_room.unref(e),e._ffz_room=null)}chatMounted(e,t){t||(t=e.props),this.addRoom(e,t)&&(this.chat.badges.updateTwitchBadges(Object(n.get)("data.badges",t)),this.updateRoomBadges(e,Object(n.get)("data.video.owner.broadcastBadges",t)),this.updateRoomBitsConfig(e,t.bitsConfig))}chatUpdated(e,t){if(Object(n.get)("data.video.owner.id",t)!==Object(n.get)("data.video.owner.id",e.props))return this.removeRoom(e),void this.chatMounted(e,t);const i=Object(n.get)("data.badges",t),s=Object(n.get)("data.badges",e.props),r=Object(n.get)("data.video.owner.broadcastBadges",t),o=Object(n.get)("data.video.owner.broadcastBadges",e.props);i!==s&&this.chat.badges.updateTwitchBadges(i),r!==o&&this.updateRoomBadges(e,r),t.bitsConfig!==e.props.bitsConfig&&this.updateRoomBitsConfig(e,t.bitsConfig);const a=Object(n.get)("data.video.owner",t);this.settings.updateContext({moderator:t.isCurrentUserModerator}),this.chat.context.updateContext({moderator:t.isCurrentUserModerator,channel:a?a.login:null,channelID:a?a.id:null})}chatUnmounted(e){this.removeRoom(e)}updateRoomBadges(e,t){const i=e._ffz_room;i&&i.updateBadges(t)}updateRoomBitsConfig(e,t){const i=e._ffz_room;i&&i.updateBitsConfig(Object(r.formatBitsConfig)(t))}}},function(e,t,i){var n={"./chat/actions/index.jsx":92,"./chat/index.js":164,"./main_menu/index.js":165,"./metadata.jsx":166,"./tooltips.js":167,"./translation_ui/index.js":168};function webpackContext(e){var t=webpackContextResolve(e);return i(t)}function webpackContextResolve(e){if(!i.o(n,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return n[e]}webpackContext.keys=function webpackContextKeys(){return Object.keys(n)},webpackContext.resolve=webpackContextResolve,e.exports=webpackContext,webpackContext.id=163},function(e,t,i){"use strict";i.r(t),i.d(t,"SEPARATORS",(function(){return _})),i.d(t,"default",(function(){return Chat}));var n=i(8),s=i.n(n),r=i(3),o=i(1),a=i(0),l=i(126),c=i(127),u=i(129),h=i(131),d=i(132),f=i(42),p=i(46),g=i(47),m=i(92);const _="[\\s`~<>!-#%-\\x2A,-/:;\\x3F@\\x5B-\\x5D_\\x7B}\\u00A1\\u00A7\\u00AB\\u00B6\\u00B7\\u00BB\\u00BF\\u037E\\u0387\\u055A-\\u055F\\u0589\\u058A\\u05BE\\u05C0\\u05C3\\u05C6\\u05F3\\u05F4\\u0609\\u060A\\u060C\\u060D\\u061B\\u061E\\u061F\\u066A-\\u066D\\u06D4\\u0700-\\u070D\\u07F7-\\u07F9\\u0830-\\u083E\\u085E\\u0964\\u0965\\u0970\\u0AF0\\u0DF4\\u0E4F\\u0E5A\\u0E5B\\u0F04-\\u0F12\\u0F14\\u0F3A-\\u0F3D\\u0F85\\u0FD0-\\u0FD4\\u0FD9\\u0FDA\\u104A-\\u104F\\u10FB\\u1360-\\u1368\\u1400\\u166D\\u166E\\u169B\\u169C\\u16EB-\\u16ED\\u1735\\u1736\\u17D4-\\u17D6\\u17D8-\\u17DA\\u1800-\\u180A\\u1944\\u1945\\u1A1E\\u1A1F\\u1AA0-\\u1AA6\\u1AA8-\\u1AAD\\u1B5A-\\u1B60\\u1BFC-\\u1BFF\\u1C3B-\\u1C3F\\u1C7E\\u1C7F\\u1CC0-\\u1CC7\\u1CD3\\u2010-\\u2027\\u2030-\\u2043\\u2045-\\u2051\\u2053-\\u205E\\u207D\\u207E\\u208D\\u208E\\u2329\\u232A\\u2768-\\u2775\\u27C5\\u27C6\\u27E6-\\u27EF\\u2983-\\u2998\\u29D8-\\u29DB\\u29FC\\u29FD\\u2CF9-\\u2CFC\\u2CFE\\u2CFF\\u2D70\\u2E00-\\u2E2E\\u2E30-\\u2E3B\\u3001-\\u3003\\u3008-\\u3011\\u3014-\\u301F\\u3030\\u303D\\u30A0\\u30FB\\uA4FE\\uA4FF\\uA60D-\\uA60F\\uA673\\uA67E\\uA6F2-\\uA6F7\\uA874-\\uA877\\uA8CE\\uA8CF\\uA8F8-\\uA8FA\\uA92E\\uA92F\\uA95F\\uA9C1-\\uA9CD\\uA9DE\\uA9DF\\uAA5C-\\uAA5F\\uAADE\\uAADF\\uAAF0\\uAAF1\\uABEB\\uFD3E\\uFD3F\\uFE10-\\uFE19\\uFE30-\\uFE52\\uFE54-\\uFE61\\uFE63\\uFE68\\uFE6A\\uFE6B\\uFF01-\\uFF03\\uFF05-\\uFF0A\\uFF0C-\\uFF0F\\uFF1A\\uFF1B\\uFF1F\\uFF20\\uFF3B-\\uFF3D\\uFF3F\\uFF5B\\uFF5D\\uFF5F-\\uFF65]";class Chat extends r.default{constructor(...e){super(...e),this.should_enable=!0,this.inject("settings"),this.inject("i18n"),this.inject("tooltips"),this.inject("socket"),this.inject("experiments"),this.inject(l.a),this.inject(c.a),this.inject(u.a),this.inject(m.default),this.inject(h.a),this._link_info={},this.clickToReveal=this.clickToReveal.bind(this),this.handleMentionClick=this.handleMentionClick.bind(this),this.style=new o.ManagedStyle,this.context=this.settings.context({}),this.rooms={},this.users={},this.room_ids={},this.user_ids={},this.tokenizers={},this.__tokenizers=[],this.rich_providers={},this.__rich_providers=[],this.settings.add("chat.font-size",{default:12,ui:{path:"Chat > Appearance >> General",title:"Font Size",description:"How large should text in chat be, in pixels. This may be affected by your browser's zoom and font size settings.",component:"setting-text-box",process:e=>(e=parseInt(e,10),isNaN(e)||!isFinite(e)||e<=0?12:e)}}),this.settings.add("chat.font-family",{default:"",ui:{path:"Chat > Appearance >> General",title:"Font Family",description:"Set the font used for displaying chat messages.",component:"setting-text-box"}}),this.settings.add("chat.lines.emote-alignment",{default:0,ui:{path:"Chat > Appearance >> Chat Lines",title:"Emote Alignment",description:"Change how emotes are positioned in chat, potentially making messages taller in order to avoid having emotes overlap.",component:"setting-select-box",data:[{value:0,title:"Standard"},{value:1,title:"Padded"},{value:2,title:"Baseline (BTTV-Like)"}]}}),this.settings.add("chat.rich.enabled",{default:!0,ui:{path:"Chat > Appearance >> Rich Content",title:"Display rich content in chat.",description:"This displays rich content blocks for things like linked clips and videos.",component:"setting-check-box"}}),this.settings.add("chat.rich.hide-tokens",{default:!0,ui:{path:"Chat > Appearance >> Rich Content",title:"Hide matching links for rich content.",component:"setting-check-box"}}),this.settings.add("chat.rich.all-links",{default:!1,ui:{path:"Chat > Appearance >> Rich Content",title:"Display rich content embeds for all links.",description:"*Streamers: Please be aware that this is a potential vector for NSFW imagery via thumbnails, so be mindful when capturing chat with this enabled.*",component:"setting-check-box",extra:{component:"chat-rich-example",getChat:()=>this}}}),this.settings.add("chat.rich.minimum-level",{default:0,ui:{path:"Chat > Appearance >> Rich Content",title:"Required User Level",description:"Only display rich content embeds on messages posted by users with this level or higher.",component:"setting-select-box",data:[{value:4,title:"Broadcaster"},{value:3,title:"Moderator"},{value:2,title:"VIP"},{value:1,title:"Subscriber"},{value:0,title:"Everyone"}]}}),this.settings.add("chat.scrollback-length",{default:150,ui:{path:"Chat > Behavior >> General",title:"Scrollback Length",description:"Keep up to this many lines in chat. Setting this too high will create lag.",component:"setting-text-box",process:e=>(e=parseInt(e,10),(isNaN(e)||!isFinite(e)||e<1)&&(e=150),e)}}),this.settings.add("chat.filtering.click-to-reveal",{default:!1,ui:{path:"Chat > Filtering >> Behavior",title:"Click to reveal deleted terms.",component:"setting-check-box"}}),this.settings.add("chat.filtering.deleted-style",{default:1,ui:{path:"Chat > Behavior >> Deleted Messages",title:"Deleted Message Style",description:"This style will be applied to deleted messages showed in Detailed rendering mode to differentiate them from normal chat messages.",component:"setting-select-box",data:[{value:0,title:"Faded"},{value:1,title:"Faded, Line Through"},{value:2,title:"Line Through"},{value:3,title:"No Change"}]}}),this.settings.add("chat.filtering.display-deleted",{default:!1,ui:{path:"Chat > Behavior >> Deleted Messages",title:"Rendering Mode",description:"This, when set, overrides the mode selected in Twitch chat settings. We do this to allow non-moderators access to the setting.",component:"setting-select-box",data:[{value:!1,title:"Do Not Override"},{value:"BRIEF",title:"Brief"},{value:"DETAILED",title:"Detailed"},{value:"LEGACY",title:"Legacy"}]}}),this.settings.add("chat.filtering.display-mod-action",{default:1,ui:{path:"Chat > Behavior >> Deleted Messages",title:"Display Reason",component:"setting-select-box",data:[{value:0,title:"Never"},{value:1,title:"In Detailed Mode"},{value:2,title:"Always"}]}}),this.settings.add("chat.automod.delete-messages",{default:!0,ui:{path:'Chat > Filtering >> AutoMod Filters @{"description": "Extra configuration for Twitch\'s native `Chat Filters`."}',title:"Mark messages as deleted if they contain filtered phrases.",component:"setting-check-box"}}),this.settings.add("chat.automod.remove-messages",{default:!0,ui:{path:"Chat > Filtering >> AutoMod Filters",title:"Remove messages entirely if they contain filtered phrases.",component:"setting-check-box"}}),this.settings.add("chat.automod.run-as-mod",{default:!1,ui:{path:"Chat > Filtering >> AutoMod Filters",title:"Use Chat Filters as a moderator.",description:"By default, Twitch's Chat Filters feature does not function for moderators. This overrides that behavior.",component:"setting-check-box"}}),this.settings.add("chat.filtering.process-own",{default:!1,ui:{path:"Chat > Filtering >> Behavior",title:"Filter your own messages.",component:"setting-check-box"}}),this.settings.add("chat.filtering.ignore-clear",{default:!1,ui:{path:"Chat > Behavior >> Deleted Messages",title:"Do not Clear Chat when commanded to.",component:"setting-check-box"}}),this.settings.add("chat.filtering.remove-deleted",{default:1,ui:{path:"Chat > Behavior >> Deleted Messages",title:"Remove deleted messages from chat.",description:"Deleted messages will be removed from chat entirely. This setting is not recommended for moderators.",component:"setting-select-box",data:[{value:0,title:"Do Not Remove"},{value:1,title:"Remove Unseen (Default)"},{value:2,title:"Remove Unseen as Moderator"},{value:3,title:"Remove All"}]}}),this.settings.add("chat.delay",{default:-1,ui:{path:"Chat > Behavior >> General",title:"Artificial Chat Delay",description:"Delay the appearance of chat messages to allow for moderation before you see them.",component:"setting-select-box",data:[{value:-1,title:"Default Delay (Room Specific; Non-Mod Only)"},{value:0,title:"No Delay"},{value:300,title:"Minor (Bot Moderation; 0.3s)"},{value:1200,title:"Normal (Human Moderation; 1.2s)"},{value:5e3,title:"Large (Spoiler Removal / Slow Mods; 5s)"},{value:1e4,title:"Extra Large (10s)"},{value:15e3,title:"Extremely Large (15s)"},{value:2e4,title:"Mods Asleep; Delay Chat (20s)"},{value:3e4,title:"Half a Minute (30s)"},{value:6e4,title:"Why??? (1m)"},{value:7884e8,title:"The CBenni Option (Literally 25 Years)"}]}}),this.settings.add("chat.filtering.highlight-basic-users",{default:[],type:"array_merge",always_inherit:!0,ui:{path:"Chat > Filtering >> Highlight Users",component:"basic-terms",colored:!0,words:!1}}),this.settings.add("chat.filtering.highlight-basic-users--color-regex",{requires:["chat.filtering.highlight-basic-users"],equals:"requirements",process(e){const t=e.get("chat.filtering.highlight-basic-users");if(!t||!t.length)return null;const i=new Map;for(const e of t){const t=e.c||null,n=e.t;let s=e.v;if("glob"===n?s=Object(a.glob_to_regex)(s):"raw"!==n&&(s=Object(a.escape_regex)(s)),s&&s.length){try{new RegExp(s)}catch(e){continue}i.has(t)?i.get(t).push(s):i.set(t,[s])}}for(const[e,t]of i)i.set(e,new RegExp(`^(?:${t.join("|")})$`,"gi"));return i}}),this.settings.add("chat.filtering.highlight-basic-users-blocked",{default:[],type:"array_merge",always_inherit:!0,ui:{path:"Chat > Filtering >> Blocked Users",component:"basic-terms",removable:!0,words:!1}}),this.settings.add("chat.filtering.highlight-basic-users-blocked--regex",{requires:["chat.filtering.highlight-basic-users-blocked"],equals:"requirements",process(e){const t=e.get("chat.filtering.highlight-basic-users-blocked");if(!t||!t.length)return null;const i=[[],[]];for(const e of t){const t=e.t;let n=e.v;"glob"===t?n=Object(a.glob_to_regex)(n):"raw"!==t&&(n=Object(a.escape_regex)(n)),n&&n.length&&i[e.remove?1:0].push(n)}return i.map(e=>e.length?new RegExp(`^(?:${e.join("|")})$`,"gi"):null)}}),this.settings.add("chat.filtering.highlight-basic-badges",{default:[],type:"array_merge",always_inherit:!0,ui:{path:"Chat > Filtering >> Highlight Badges",component:"badge-highlighting",colored:!0,data:()=>this.badges.getSettingsBadges()}}),this.settings.add("chat.filtering.highlight-basic-badges--colors",{requires:["chat.filtering.highlight-basic-badges"],equals:"requirements",process(e){const t=e.get("chat.filtering.highlight-basic-badges");if(!t||!t.length)return null;const i=new Map;for(const e of t){const t=e.c||null,n=e.v;i.set(n,t)}return i}}),this.settings.add("chat.filtering.highlight-basic-badges-blocked",{default:[],type:"array_merge",always_inherit:!0,ui:{path:"Chat > Filtering >> Blocked Badges",component:"badge-highlighting",removable:!0,data:()=>this.badges.getSettingsBadges()}}),this.settings.add("chat.filtering.highlight-basic-badges-blocked--list",{requires:["chat.filtering.highlight-basic-badges-blocked"],equals:"requirements",process(e){const t=e.get("chat.filtering.highlight-basic-badges-blocked");if(!t||!t.length)return null;const i=[[],[]];for(const e of t)e.v&&i[e.remove?1:0].push(e.v);return i[0].length||i[1].length?i:null}}),this.settings.add("chat.filtering.highlight-basic-terms",{default:[],type:"array_merge",always_inherit:!0,ui:{path:"Chat > Filtering >> Highlight Terms",component:"basic-terms",colored:!0}}),this.settings.add("chat.filtering.highlight-basic-terms--color-regex",{requires:["chat.filtering.highlight-basic-terms"],equals:"requirements",process(e){const t=e.get("chat.filtering.highlight-basic-terms");if(!t||!t.length)return null;const i=new Map;for(const e of t){const t=e.c||null,n=e.t;let s=e.v,r=!0;if("glob"===n?s=Object(a.glob_to_regex)(s):"raw"===n?r=!1:"regex"!==n&&(s=Object(a.escape_regex)(s)),s&&s.length){try{new RegExp(s)}catch(e){continue}if(i.has(t))i.get(t)[r?0:1].push(s);else{const e=[[],[]];i.set(t,e),e[r?0:1].push(s)}}}for(const[e,t]of i)t[0].length&&t[1].push(`(^|.*?${_})(?:${t[0].join("|")})(?=$|${_})`),i.set(e,new RegExp(t[1].join("|"),"gi"));return i}}),this.settings.add("chat.filtering.highlight-basic-blocked",{default:[],type:"array_merge",always_inherit:!0,ui:{path:"Chat > Filtering >> Blocked Terms",component:"basic-terms",removable:!0}}),this.settings.add("chat.filtering.highlight-basic-blocked--regex",{requires:["chat.filtering.highlight-basic-blocked"],equals:"requirements",process(e){const t=e.get("chat.filtering.highlight-basic-blocked");if(!t||!t.length)return null;const i=[[[],[]],[[],[]]];for(const e of t){const t=e.t;let n=e.v,s=!0;"glob"===t?n=Object(a.glob_to_regex)(n):"raw"===t?s=!1:"regex"!==t&&(n=Object(a.escape_regex)(n)),n&&n.length&&i[e.remove?1:0][s?0:1].push(n)}return i.map(e=>(e[0].length&&e[1].push(`(^|.*?${_})(?:${e[0].join("|")})(?=$|${_})`),e[1].length?new RegExp(e[1].join("|"),"gi"):null))}}),this.settings.add("chat.filtering.clickable-mentions",{default:!1,ui:{component:"setting-check-box",path:"Chat > Viewer Cards >> Behavior",title:"Enable opening viewer cards by clicking mentions in chat."}}),this.settings.add("chat.filtering.mention-color",{default:"",ui:{path:"Chat > Filtering >> Appearance",title:"Custom Highlight Color",component:"setting-color-box",description:"If this is set, highlighted messages with no default color set will use this color rather than red."}}),this.settings.add("chat.filtering.highlight-mentions",{default:!1,ui:{path:"Chat > Filtering >> Appearance",title:"Highlight messages that mention you.",component:"setting-check-box"}}),this.settings.add("chat.filtering.highlight-tokens",{default:!1,ui:{path:"Chat > Filtering >> Appearance",title:"Highlight matched words in chat.",component:"setting-check-box"}}),this.settings.add("tooltip.images",{default:!0,ui:{path:'Chat > Tooltips >> General @{"sort": -1}',title:"Display images in tooltips.",component:"setting-check-box"}}),this.settings.add("tooltip.badge-images",{default:!0,requires:["tooltip.images"],process:(e,t)=>!!e.get("tooltip.images")&&t,ui:{path:"Chat > Tooltips >> Badges",title:"Display large images of badges.",component:"setting-check-box"}}),this.settings.add("tooltip.emote-sources",{default:!0,ui:{path:"Chat > Tooltips >> Emotes",title:"Display known sources.",component:"setting-check-box"}}),this.settings.add("tooltip.emote-images",{default:!0,requires:["tooltip.images"],process:(e,t)=>!!e.get("tooltip.images")&&t,ui:{path:"Chat > Tooltips >> Emotes",title:"Display large images of emotes.",component:"setting-check-box"}}),this.settings.add("tooltip.rich-links",{default:!0,ui:{sort:-1,path:"Chat > Tooltips >> Links",title:"Display rich tooltips for links.",component:"setting-check-box",extra:{component:"chat-tooltip-example"}}}),this.settings.add("tooltip.link-interaction",{default:!0,ui:{path:"Chat > Tooltips >> Links",title:"Allow interaction with supported link tooltips.",component:"setting-check-box"}}),this.settings.add("tooltip.link-images",{default:!0,requires:["tooltip.images"],process:(e,t)=>!!e.get("tooltip.images")&&t,ui:{path:"Chat > Tooltips >> Links",title:"Display images for links.",component:"setting-check-box"}}),this.settings.add("tooltip.link-nsfw-images",{default:!1,ui:{path:"Chat > Tooltips >> Links",title:"Display potentially NSFW images.",description:"When enabled, FrankerFaceZ will include images that are tagged as unsafe or that are not rated.",component:"setting-check-box"}}),this.settings.add("chat.adjustment-mode",{default:1,ui:{path:"Chat > Appearance >> Colors",title:"Adjustment",description:"Alter user colors to ensure that they remain readable.",component:"setting-select-box",data:[{value:-1,title:"No Color"},{value:0,title:"Unchanged"},{value:1,title:"HSL Luma"},{value:2,title:"Luv Luma"},{value:3,title:"HSL Loop (BTTV-Like)"},{value:4,title:"RGB Loop (Deprecated)"}]}}),this.settings.add("chat.adjustment-contrast",{default:4.5,ui:{path:"Chat > Appearance >> Colors",title:"Minimum Contrast",description:"Set the minimum contrast ratio used by Luma adjustments when determining readability.",component:"setting-text-box",process:e=>parseFloat(e)}}),this.settings.add("chat.bits.stack",{default:0,ui:{path:"Chat > Bits and Cheering >> Appearance",title:"Cheer Stacking",description:"Collect all the cheers in a message into a single cheer at the start of the message.",component:"setting-select-box",data:[{value:0,title:"Disabled"},{value:1,title:"Grouped by Type"},{value:2,title:"All in One"}]}}),this.settings.add("chat.bits.animated",{default:!0,ui:{path:"Chat > Bits and Cheering >> Appearance",title:"Display animated cheers.",component:"setting-check-box"}});const t=new Date(0).toLocaleTimeString().toUpperCase(),i=-1===t.lastIndexOf("PM")&&-1===t.lastIndexOf("AM");this.settings.add("chat.timestamp-format",{default:i?"H:mm":"h:mm",ui:{path:"Chat > Appearance >> Chat Lines",title:"Timestamp Format",component:"setting-combo-box",description:"Timestamps are formatted using the [Day.js](https://github.com/iamkun/dayjs#readme) library. More details about formatting strings [can be found here](https://github.com/iamkun/dayjs/blob/HEAD/docs/en/API-reference.md#list-of-all-available-formats)",data:[{value:"h:mm",title:"12 Hour"},{value:"h:mm:ss",title:"12 Hour with Seconds"},{value:"H:mm",title:"24 Hour"},{value:"H:mm:ss",title:"24 Hour with Seconds"},{value:"hh:mm",title:"Padded"},{value:"hh:mm:ss",title:"Padded with Seconds"},{value:"HH:mm",title:"Padded 24 Hour"},{value:"HH:mm:ss",title:"Padded 24 Hour with Seconds"}]}}),this.context.on("changed:theme.is-dark",()=>{for(const e of this.iterateRooms())e.buildBitsCSS()}),this.context.on("changed:chat.bits.animated",()=>{for(const e of this.iterateRooms())e.buildBitsCSS()})}generateLog(){const e=["chat settings","-------------------------------------------------------------------------------"];for(const[t,i]of this.context.__cache.entries())e.push(`${t}: ${JSON.stringify(i)}`);return e.join("\n")}onEnable(){for(const e in p)Object(a.has)(p,e)&&this.addTokenizer(p[e]);for(const e in g)Object(a.has)(g,e)&&this.addRichProvider(g[e])}getUser(e,t,i,n,s=!1){let r;if(e&&"number"==typeof e&&(e=`${e}`),e&&this.user_ids[e]?r=this.user_ids[e]:t&&this.users[t]&&!n&&(r=this.users[t]),r&&r.destroyed&&(r=null),!r){if(i)return null;r=new f.a(this,null,e,t)}if(e&&e!==r.id){if(r.id){if(this.log.warn(`Data mismatch for user #${e} -- Stored ID: ${r.id} -- Login: ${t} -- Stored Login: ${r.login}`),s)throw new Error("id mismatch");this.user_ids[r.id]===r&&(this.user_ids[r.id]=null)}r._id=e,this.user_ids[e]=r}if(t){const e=this.users[t];e?e===r||n||(e.id?this.users[t]=r:(r.merge(e),e.destroy(!0))):this.users[t]=r}return r}getRoom(e,t,i,n,s=!1){let r;if(e&&"number"==typeof e&&(e=`${e}`),e&&this.room_ids[e]?r=this.room_ids[e]:t&&this.rooms[t]&&!n&&(r=this.rooms[t]),r&&r.destroyed&&(r=null),!r){if(i)return null;r=new d.a(this,e,t)}if(e&&e!==r.id){if(r.id){if(this.log.warn(`Data mismatch for room #${e} -- Stored ID: ${r.id} -- Login: ${t} -- Stored Login: ${r.login}`),s)throw new Error("id mismatch");this.room_ids[r.id]===r&&(this.room_ids[r.id]=null)}r._id=e,this.room_ids[e]=r}if(t){const e=this.rooms[t];e?e===r||n||(e.id?this.rooms[t]=r:(r.merge(e),e.destroy(!0))):this.rooms[t]=r}return r}*iterateRooms(){const e=new Set;for(const t in this.room_ids)if(Object(a.has)(this.room_ids,t)){const i=this.room_ids[t];i&&!i.destroyed&&(e.add(i),yield i)}for(const t in this.rooms)if(Object(a.has)(this.rooms,t)){const i=this.rooms[t];!i||i.destroyed||e.has(i)||(yield i)}}handleMentionClick(e){if(!this.context.get("chat.filtering.clickable-mentions"))return;const t=e.target,i=t&&t.dataset;if(!i||!i.login)return;const n=this.resolve("site.fine");if(!n)return;const s=n.searchParent(e.target,e=>e.props&&e.props.onUsernameClick);s&&s.props.onUsernameClick(i.login,void 0,void 0,e.currentTarget.getBoundingClientRect().bottom)}clickToReveal(e){const t=e.target;if(t){if(t._ffz_visible)t.textContent="";else{if(!this.context.get("chat.filtering.click-to-reveal"))return;t.dataset&&(t.textContent=t.dataset.text)}t._ffz_visible=!t._ffz_visible}}standardizeWhisper(e){if(!e)return e;if(e._ffz_message)return e._ffz_message;const t={},i=e.content.startsWith("/me "),n=i?4:0,s=e._ffz_message={user:e.from,message:e.content.slice(n),is_action:i,ffz_emotes:t,timestamp:e.sentAt&&e.sentAt.getTime(),deleted:!1};if(s.user.color=s.user.chatColor,Array.isArray(e.emotes)&&e.emotes.length)for(const i of e.emotes){const e=i.emoteID;(t[e]=t[e]||[]).push({startIndex:i.from-n,endIndex:i.to-n})}return s}getUserLevel(e){return e&&e.user?e.user.login===e.roomLogin||e.badges&&e.badges.broadcaster?4:e.badges?e.badges.moderator?3:e.badges.vip?2:e.badges.subscriber?1:0:0:0}standardizeMessage(e){if(!e)return e;e.sender&&!e.user&&(e.user=e.sender),e.from&&!e.user&&(e.user=e.from);let t=e.user;t||(t=e.user={});const i=e.extension||{};if(t.color=t.color||t.chatColor||i.chatColor||null,t.type=t.type||t.userType||null,t.id=t.id||t.userID||null,t.login=t.login||t.userLogin||null,t.displayName=t.displayName||t.userDisplayName||t.login||i.displayName,t.isIntl=t.login&&t.displayName&&t.displayName.trim().toLowerCase()!==t.login,!e.message&&e.messageParts&&this.detokenizeMessage(e),e.content&&!e.message&&(e.content.fragments?this.detokenizeContent(e):e.message=e.content.text),e.ffz_emotes||this.standardizeEmotes(e),!e.badges&&t.displayBadges){const i=e.badges={};for(const e of t.displayBadges)i[e.setID]=e.version}if(!e.badges&&i.displayBadges){const t=e.badges={};for(const e of i.displayBadges)t[e.setID]=e.version}return!e.timestamp&&e.sentAt&&(e.timestamp=new Date(e.sentAt).getTime()),void 0!==e.deletedAt&&(e.deleted=!!e.deletedAt),e}standardizeEmotes(e){if(e.emotes&&e.message){const t={},i=Object(a.split_chars)(e.message);for(const n in e.emotes)if(Object(a.has)(e.emotes,n)){const s=e.emotes[n];if(Array.isArray(s))return e.ffz_emotes=e.emotes;const r=t[s.id]=t[s.id]||[],o=i.indexOf(" ",s.startIndex);r.push({startIndex:s.startIndex,endIndex:(-1===o?i.length:o)-1})}e.ffz_emotes=t}else e.messageParts?this.detokenizeMessage(e,!0):e.content&&e.content.fragments&&this.detokenizeContent(e,!0)}detokenizeContent(e,t=!1){const i=[],n=e.content.fragments,s=n.length,r={};let o,l=0,c=!0;for(let t=0;t<s;t++){const s=n[t],u=s.content,h=u&&u.__typename;if(o=s.text,"Emote"===h){const e=u.emoteID;(r[e]=r[e]||[]).push({startIndex:l,endIndex:l+o.length-1})}o&&o.length&&(c&&o.startsWith("/me ")&&(e.is_action=!0,o=o.slice(4)),l+=Object(a.split_chars)(o).length,i.push(o)),c=!1}return t||(e.message=i.join("")),e.ffz_emotes=r,e}detokenizeMessage(e,t=!1){const i=[],n=e.messageParts,s=n.length,r={};let o,l=0,c=null,u=0;for(let e=0;e<s;e++){const t=n[e],s=t.content;if(s){if("string"==typeof s)o=s;else if(s.recipient)o=`@${s.recipient}`;else if(s.url)o=s.url;else if(s.cheerAmount)u+=s.cheerAmount,o=`${s.alt}${s.cheerAmount}`;else{if(!s.images)continue;{const e=s.images.themed?s.images.dark:s.images.sources,t=e&&/\/emoticons\/v1\/(\d+)\/[\d.]+$/.exec(e["1x"]),i=t&&t[1];if(o=s.alt,i){const e=c>0?1:0;(r[i]=r[i]||[]).push({startIndex:l+e,endIndex:l+o.length-1})}c>0&&(o=` ${o}`)}}o&&(l+=Object(a.split_chars)(o).length,c=t.type,i.push(o))}}return t||(e.message=i.join("")),e.bits=u,e.ffz_emotes=r,e}formatTime(e){e instanceof Date||(e=new Date(e));const t=this.context.get("chat.timestamp-format"),i=s()(e);try{return i.locale(this.i18n.locale).format(t)}catch(e){return i.format(t)}}addTokenizer(e){const t=e.type;if(this.tokenizers[t]=e,null==e.priority&&(e.priority=0),e.tooltip){const i=e.tooltip,n=this.tooltips.types[t]=i.bind(this);for(const e of["interactive","delayShow","delayHide"])n[e]="function"==typeof i[e]?i[e].bind(this):i[e]}this.__tokenizers.push(e),this.__tokenizers.sort((e,t)=>e.priority>t.priority?-1:e.priority<t.priority?1:e.type<t.type)}addRichProvider(e){const t=e.type;this.rich_providers[t]=e,null==e.priority&&(e.priority=0),this.__rich_providers.push(e),this.__rich_providers.sort((e,t)=>e.priority>t.priority?-1:e.priority<t.priority?1:e.type<t.type)}tokenizeString(e,t){let i=[{type:"text",text:e}];for(const e of this.__tokenizers)i=e.process.call(this,i,t);return i}pluckRichContent(e,t){if(!this.context.get("chat.rich.enabled")||this.context.get("chat.rich.minimum-level")>this.getUserLevel(t))return;const i=this.__rich_providers;for(const n of e)for(const e of i)if(e.test.call(this,n,t))return n.hidden=this.context.get("chat.rich.hide-tokens")&&e.hide_token,e.process.call(this,n)}tokenizeMessage(e,t){if(e.content&&!e.message&&(e.message=e.content.text),e.sender&&!e.user&&(e.user=e.sender),!e.message)return[];let i=[{type:"text",text:e.message}];if(!i[0].text)return i;for(const n of this.__tokenizers)i=n.process.call(this,i,e,t);return i}renderTokens(e,t){t||(t=o.createElement);const i=[],n=this.tokenizers,s=e.length;for(let r=0;r<s;r++){const s=e[r],o=s.type,a=n[o];if(s.hidden)continue;let l;l="text"===o?t("span",{className:"text-fragment","data-a-target":"chat-message-text"},s.text):a?a.render.call(this,s,t):t("em",{className:"ffz-unknown-token ffz-tooltip","data-tooltip-type":"json","data-data":JSON.stringify(s,null,2)},`[unknown token: ${o}]`),l&&i.push(l)}return i}get_link_info(e,t){let i=this._link_info[e];const n=i&&i[1];return n&&Date.now()>n&&(i=this._link_info[e]=null),i&&i[0]?t?i[2]:Promise.resolve(i[2]):t?null:new Promise(i?(e,t)=>i[2].push([e,t]):(t,n)=>{i=this._link_info[e]=[!1,null,[[t,n]]];const handle=(e,t)=>{const n=!i[0]&&i[2];if(i[0]=!0,i[1]=Date.now()+12e4,i[2]=e?t:null,n)for(const i of n)i[e?0:1](t)};Object(a.timeout)(this.socket.call("get_link",e),15e3).then(e=>handle(!0,e)).catch(e=>handle(!1,e))})}}},function(e,t,i){"use strict";i.r(t),i.d(t,"default",(function(){return MainMenu}));var n=i(3),s=i(1),r=i(0),o=i(26),a=i(96),l=i(22);function format_term(e){return e.replace(/<[^>]*>/g,"").toLocaleLowerCase()}class MainMenu extends n.default{constructor(...e){super(...e),this.inject("settings"),this.inject("i18n"),this.inject("site"),this.inject("vue"),this.load_requires=["vue"],this.Mixin=a.a,this.new_seen=!1,this._settings_tree=null,this._settings_count=0,this.dialog=new o.default(()=>this.buildDialog()),this.has_update=!1,this.opened=!1,this.showing=!1,this.settings.addUI("profiles",{path:'Data Management @{"sort": 1000, "profile_warning": false} > Profiles @{"profile_warning": false}',component:"profile-manager"}),this.settings.addUI("backup",{path:'Data Management > Backup and Restore @{"profile_warning": false}',component:"backup-restore",getFFZ:()=>this.resolve("core")}),this.settings.addUI("home",{path:'Home @{"sort": -1000, "profile_warning": false}',component:"home-page"}),this.settings.addUI("faq",{path:'Home > FAQ @{"profile_warning": false}',component:"md-page",key:"faq"}),this.settings.addUI("feedback",{path:'Home > Feedback @{"profile_warning": false}',component:"md-page",key:"feedback"}),this.settings.addUI("feedback.log",{path:'Home > Feedback >> Log @{"sort": 1000}',component:"async-text",watch:["reports.error.include-user","reports.error.include-settings"],data:()=>this.resolve("core").generateLog()}),this.settings.addUI("changelog",{path:'Home > Changelog @{"profile_warning": false}',component:"changelog"}),this.settings.addUI("addon-changelog",{path:'Add-Ons > Changelog @{"sort": -1000, "profile_warning": false}',component:"changelog",force_seen:!0,addons:!0}),this.settings.addUI("legal",{path:'Home > Legal @{"sort": 1000}',component:"md-page",key:"legal",force_seen:!0}),this.on("settings:added-definition",(e,t)=>{this._addDefinitionToTree(e,t),this.scheduleUpdate()}),this.on("socket:command:new_version",e=>{if(e===window.FrankerFaceZ.version_info.commit)return;this.log.info("New Version:",e),this.has_update=!0;const t=this.resolve("site.menu_button");t&&(t.has_update=!0),this._vue&&(this._vue.$children[0].context.has_update=!0)}),this.scheduleUpdate()}openPopout(){const e=window.open("https://twitch.tv/popout/frankerfacez/chat?ffz-settings","_blank","resizable=yes,scrollbars=yes,width=850,height=600");return e?(e.focus(),!0):(this.log.warn("Unable to open popout settings window."),!1)}async onLoad(){this.vue.component((await i.e(134).then(i.bind(null,340))).default)}async onEnable(){await this.site.awaitElement(o.default.EXCLUSIVE),this.on("addons:added",this.scheduleUpdate,this),this.on("i18n:update",this.scheduleUpdate,this),this.dialog.on("show",()=>{this.showing=!0,this.opened=!0,this.updateButtonUnseen(),this.emit("show")}),this.dialog.on("hide",()=>{this.showing=!1,this.emit("hide"),this.destroyDialog()}),this.dialog.on("resize",()=>{this._vue&&(this._vue.$children[0].maximized=this.dialog.maximized)}),this.on("site.menu_button:clicked",this.dialog.toggleVisible,this.dialog),this.dialog.show()}onDisable(){this.dialog.hide(),this.off("site.menu_button:clicked",this.dialog.toggleVisible,this.dialog)}requestPage(e){const t=Object(r.get)("_vue.$children.0",this);t&&t.navigate?t.navigate(e):this._wanted_page=e}getUnseen(){const e=this.getSettingsTree();if(!Array.isArray(e))return 0;let t=0;for(const i of e)i&&(t+=i.unseen||0);return t}buildDialog(){return this._menu?this._menu:(this._vue=new this.vue.Vue({el:Object(s.createElement)("div"),render:e=>e("main-menu",this.getData())}),this._menu=this._vue.$el)}destroyDialog(){this._vue&&this._vue.$destroy(),this._menu=this._vue=null}scheduleUpdate(){this._update_timer||(this._update_timer=setTimeout(()=>this.updateLiveMenu(),250))}updateButtonUnseen(){const e=this.resolve("site.menu_button");e&&(e.new_settings=this.opened?0:this.getUnseen())}updateLiveMenu(){if(clearTimeout(this._update_timer),this._update_timer=null,this.updateButtonUnseen(),!this._vue||!this._vue.$children||!this._vue.$children[0])return;const e=this._vue.$children[0],t=e.currentItem,i=t&&t.full_key,n=this.getSettingsTree();e.nav=n,e.nav_keys=n.keys,e.currentItem=n.keys[i]||this._wanted_page&&n.keys[this._wanted_page]||(this.has_update?n.keys["home.changelog"]:n.keys.home),this._wanted_page=null}rebuildSettingsTree(){this._settings_tree={},this._settings_count=0;for(const[e,t]of this.settings.definitions)this._addDefinitionToTree(e,t);for(const[e,t]of this.settings.ui_structures)this._addDefinitionToTree(e,t)}_addDefinitionToTree(e,t){if(!t.ui||!this._settings_tree)return;if(!t.ui.path_tokens){if(!t.ui.path)return;t.ui.path_tokens=Object(l.b)(t.ui.path)}if(!t.ui||!t.ui.path_tokens||!this._settings_tree)return;const i=this._settings_tree,n=t.ui.path_tokens,s=n.length;let r,o=null;for(let e=0;e<s;e++){const t=n[e],s=o?`${o}.${t.key}`:t.key;r=i[s],r||(r=i[s]={full_key:s,sort:0,parent:o,expanded:null==o,i18n_key:`setting.${s}`,desc_i18n_key:`setting.${s}.description`}),Object.assign(r,t),o=s}r.settings=r.settings||[],r.settings.push([e,t]),this._settings_count++}getSettingsTree(){const e=performance.now();this._settings_tree||this.rebuildSettingsTree();const t=this._settings_tree,i=this.new_seen?null:this.settings.provider.get("cfg-seen"),n=i?null:[],s=this.settings.provider.get("cfg-collapsed"),o={},a={},l=new Set,c=new Set,u="en"!==this.i18n.locale;n&&(this.new_seen=!0);for(const e in t){if(!Object(r.has)(t,e))continue;const h=a[e]=a[e]||Object.assign({},t[e]),d=h.parent,f=d?a[d]=a[d]||Object.assign({},t[d]):o;if(h.parent=d?f:null,h.page=h.page||f.page,s&&(h.expanded=!s.includes(h.full_key)),h.page&&!h.component&&c.add(h),h.settings){const e=h.contents=h.contents||[];for(const[t,s]of h.settings)if(s.ui){const o=s.ui.i18n_key?s.ui.i18n_key:t?`setting.entry.${t}`:s.ui.key?`${h.i18n_key}.${s.ui.key}`:h.i18n_key,a=Object.assign({i18n_key:o,desc_i18n_key:`${o}.description`,sort:0},s.ui,{full_key:`setting:${t}`,setting:t,path_tokens:void 0,parent:h});if(Object(r.has)(s,"default")&&!Object(r.has)(a,"default")){const e=typeof s.default;a.default="object"===e?Object(r.deep_copy)(s.default):s.default}let l=[t];if(a.title&&(l.push(this.i18n.t(a.i18n_key,a.title,null,!0)),u&&this.i18n.has(a.i18n_key)&&l.push(this.i18n.t(a.i18n_key,a.title,null))),a.description&&(l.push(this.i18n.t(a.desc_i18n_key,a.description,null,!0)),u&&this.i18n.has(a.desc_i18n_key)&&l.push(this.i18n.t(a.desc_i18n_key,a.description,null))),a.getExtraTerms&&(l=l.concat(a.getExtraTerms())),a.search_terms=l.map(format_term).join("\n"),i){if(!i.includes(t)&&!a.force_seen){let e=a;for(;e;)e.unseen=(e.unseen||0)+1,e=e.parent}}else n&&n.push(t);e.push(a)}h.settings=void 0,e.length>1&&l.add(e)}if(!h.search_terms){const e=h.title&&this.i18n.t(h.i18n_key,h.title,null,!0);let t=[h.key];e&&e.localeCompare(h.key,void 0,{sensitivity:"base"})&&t.push(e),u&&this.i18n.has(h.i18n_key)&&t.push(this.i18n.t(h.i18n_key,h.title,null)),h.description&&(t.push(this.i18n.t(h.desc_i18n_key,h.description,null,!0)),u&&this.i18n.has(h.desc_i18n_key)&&t.push(this.i18n.t(h.desc_i18n_key,h.description,null))),t=t.map(format_term);for(const e of["tabs","contents","items"])if(h[e])for(const i of h[e])i.search_terms&&t.push(i.search_terms);t=h.search_terms=t.join("\n");let i=f;for(;i&&i.search_terms;)i.search_terms+=`\n${t}`,i=i.parent}const p=h.tab?"tabs":h.page?"contents":"items",g=f[p]=f[p]||[];g.push(h),g.length>1&&l.add(g)}for(const e of c)e.component=e.tabs?"tab-container":e.contents?"menu-container":"setting-check-box";for(const e of l)e.sort((e,t)=>e.sort<t.sort?-1:e.sort>t.sort?1:e.key&&e.key.localeCompare(t.key));const h=o.items||[];if(h.keys=a,n&&this.settings.provider.set("cfg-seen",n),!s){const e=[];for(const t of Object.keys(a)){const i=a[t];i&&i.items&&i.parent&&e.push(t)}this.settings.provider.set("cfg-collapsed",e)}return this.log.info(`Built Tree in ${(performance.now()-e).toFixed(5)}ms with ${Object.keys(t).length} structure nodes and ${this._settings_count} settings nodes.`),h}getProfiles(e){const t=[],i={};e=e||this.settings.main_context;for(const n of this.settings.__profiles)t.push(i[n.id]=this.getProfileProxy(n,e));return[t,i]}getProfileProxy(e,t){return{id:e.id,order:t.manager.__profiles.indexOf(e),live:t.__profiles.includes(e),toggled:e.toggled,title:e.name,i18n_key:e.i18n_key,description:e.description,desc_i18n_key:e.desc_i18n_key||e.i18n_key&&`${e.i18n_key}.description`,url:e.url,move:i=>t.manager.moveProfile(e.id,i),save:()=>e.save(),update:t=>{e.data=Object(r.deep_copy)(t),e.save()},toggle:()=>e.toggled=!e.toggled,getBackup:()=>Object(r.deep_copy)(e.getBackup()),context:Object(r.deep_copy)(e.context),get:t=>e.get(t),set:(t,i)=>e.set(t,i),delete:t=>e.delete(t),has:t=>e.has(t),on:(...t)=>e.on(...t),off:(...t)=>e.off(...t)}}getContext(){const e=this,t=this.vue.Vue,i=this.settings,n=i.main_context,[s,o]=this.getProfiles(),a={profiles:s,profile_keys:o,currentProfile:o[0],has_update:this.has_update,createProfile:t=>{const s=i.createProfile(t);return e.getProfileProxy(s,n)},deleteProfile:e=>i.deleteProfile(e),context:{_users:0,profiles:n.__profiles.map(e=>e.id),get:e=>n.get(e),uses:e=>n.uses(e),on:(...e)=>n.on(...e),off:(...e)=>n.off(...e),order:e=>n.order.indexOf(e),context:Object(r.deep_copy)(n._context),_update_profiles(e){const i=[],s=n.manager.__profiles;for(let e=0;e<s.length;e++){const t=o[s[e].id];t.order=e,i.push(t)}t.set(a,"profiles",i),e&&e.id===a.currentProfile.id&&(a.currentProfile=o[e.id])},_profile_created(i){t.set(o,i.id,e.getProfileProxy(i,n)),this._update_profiles()},_profile_changed(i){t.set(o,i.id,e.getProfileProxy(i,n)),this._update_profiles(i)},_profile_toggled(e,i){t.set(o[e.id],"toggled",i),this._update_profiles(e)},_profile_deleted(e){t.delete(o,e.id),this._update_profiles(),a.currentProfile.id===e.id&&(a.currentProfile=o[0])},_context_changed(){this.context=Object(r.deep_copy)(n._context);const e=n.manager.__profiles,t=this.profiles=n.__profiles.map(e=>e.id);for(let i=0;i<e.length;i++){const n=e[i].id;o[n].live=t.includes(n)}},_add_user(){this._users++,1===this._users&&(i.on(":profile-toggled",this._profile_toggled,this),i.on(":profile-created",this._profile_created,this),i.on(":profile-changed",this._profile_changed,this),i.on(":profile-deleted",this._profile_deleted,this),i.on(":profiles-reordered",this._update_profiles,this),n.on("context_changed",this._context_changed,this),n.on("profiles_changed",this._context_changed,this),this.profiles=n.__profiles.map(e=>e.id))},_remove_user(){this._users--,0===this._users&&(i.off(":profile-toggled",this._profile_toggled,this),i.off(":profile-created",this._profile_created,this),i.off(":profile-changed",this._profile_changed,this),i.off(":profile-deleted",this._profile_deleted,this),i.off(":profiles-reordered",this._update_profiles,this),n.off("context_changed",this._context_changed,this),n.off("profiles_changed",this._context_changed,this))}}};return a}markSeen(e,t){let i=!0;if(t||(i=!1,t=this.settings.provider.get("cfg-seen",[])),Array.isArray(e.contents))for(const i of e.contents)i&&this.markSeen(i,t);if(e.setting&&!t.includes(e.setting)){t.push(e.setting);let i=e.parent;for(;i;)i.unseen=(i.unseen||1)-1,i=i.parent}i||this.settings.provider.set("cfg-seen",t)}markAllSeen(e,t){let i=!0;if(t||(i=!1,t=this.settings.provider.get("cfg-seen",[])),Array.isArray(e))for(const i of e)i&&this.markAllSeen(i,t);if(Array.isArray(e.items))for(const i of e.items)this.markAllSeen(i,t);if(Array.isArray(e.contents))for(const i of e.contents)this.markAllSeen(i,t);if(Array.isArray(e.tabs))for(const i of e.tabs)this.markAllSeen(i,t);if(Array.isArray(e.settings))for(const i of e.settings)i&&this.markAllSeen(i[1],t);e.setting&&!t.includes(e.setting)&&t.push(e.setting),e.unseen&&(e.unseen=0),i||this.settings.provider.set("cfg-seen",t)}getData(){const e=this.getSettingsTree(),t=this.getContext(),i=this._wanted_page&&e.keys[this._wanted_page]||(this.has_update?e.keys["home.changelog"]:e.keys.home);this._wanted_page=null,this.markSeen(i);let n=!1;for(const t of e)if(t&&t.unseen){n=!0;break}return{context:t,query:"",faded:!1,nav:e,currentItem:i,nav_keys:e.keys,has_unseen:n,maximized:this.dialog.maximized,exclusive:this.dialog.exclusive,markAllSeen:e=>this.markAllSeen(e),markSeen:e=>this.markSeen(e),markExpanded:e=>{const t=this.settings.provider.get("cfg-collapsed",[]),i=t.indexOf(e.full_key);if(e.expanded&&-1!==i)t.splice(i,1);else{if(e.expanded||-1!==i)return;t.push(e.full_key)}this.settings.provider.set("cfg-collapsed",t)},resize:e=>{var t,i,n,s;this.dialog.exclusive||"squad"===(null===(t=this.site)||void 0===t?void 0:null===(i=t.router)||void 0===i?void 0:i.current_name)||"command-center"===(null===(n=this.site)||void 0===n?void 0:null===(s=n.router)||void 0===s?void 0:s.current_name)||this.settings.get("context.ui.theatreModeEnabled")||this.dialog.toggleSize(e)},close:e=>!this.dialog.exclusive&&this.dialog.toggleVisible(e),popout:e=>{this.dialog.exclusive||(this.dialog.toggleVisible(e),this.openPopout()||alert(this.i18n.t("popup.error","We tried opening a pop-up window and could not. Make sure to allow pop-ups from Twitch.")))},version:window.FrankerFaceZ.version_info}}}},function(e,t,i){"use strict";i.r(t),i.d(t,"default",(function(){return Metadata}));var n=i(1),s=i(0),r=i(6),o=i(12),a=i(3);class Metadata extends a.default{constructor(...e){super(...e),this.inject("settings"),this.inject("i18n"),this.should_enable=!0,this.definitions={},this.settings.add("metadata.player-stats",{default:!1,ui:{path:"Channel > Metadata >> Player",title:"Playback Statistics",description:"Show the current stream delay, with playback rate and dropped frames in the tooltip.",component:"setting-check-box"},changed:()=>this.updateMetadata("player-stats")}),this.settings.add("metadata.stream-delay-warning",{default:0,ui:{path:"Channel > Metadata >> Player",title:"Stream Delay Warning",description:"When the current stream delay exceeds this number of seconds, display the stream delay in a warning color to draw attention to the large delay. Set to zero to disable.",component:"setting-text-box",process:e=>(e=parseInt(e,10),isNaN(e)||!isFinite(e)||e<0?0:e)}}),this.settings.add("metadata.uptime",{default:1,ui:{path:"Channel > Metadata >> Player",title:"Stream Uptime",component:"setting-select-box",data:[{value:0,title:"Disabled"},{value:1,title:"Enabled"},{value:2,title:"Enabled (with Seconds)"}]},changed:()=>this.updateMetadata("uptime")}),this.definitions.uptime={inherit:!0,no_arrow:!0,refresh(){return this.settings.get("metadata.uptime")>0},setup(e){var t;const i=this.resolve("socket"),n=null==e?void 0:null===(t=e.meta)||void 0===t?void 0:t.createdAt;if(!n)return{};const s=new Date(n),r=Date.now()-i._time_drift;return{created:s,uptime:s?Math.floor((r-s.getTime())/1e3):-1,getBroadcastID:e.getBroadcastID}},order:2,icon:"ffz-i-clock",label(e){const t=this.settings.get("metadata.uptime");return t&&e.created?Object(r.duration_to_string)(e.uptime,!1,!1,!1,2!==t):null},subtitle:()=>this.i18n.t("metadata.uptime.subtitle","Uptime"),tooltip(e){return e.created?[this.i18n.t("metadata.uptime.tooltip","Stream Uptime"),Object(n.createElement)("div",{class:"tw-pd-t-05"},this.i18n.t("metadata.uptime.since","(since {since,datetime})",{since:e.created}))]:null},async popup(e,t){var i,s,o;const[a,l]=await Promise.all([null===(i=navigator)||void 0===i?void 0:null===(s=i.permissions)||void 0===s?void 0:null===(o=s.query)||void 0===o?void 0:o.call(s,{name:"clipboard-write"}).then(e=>null==e?void 0:e.state).catch(()=>null),e.getBroadcastID()]);if(!l)return Object(n.createElement)("div",null,this.i18n.t("metadata.uptime-no-id","Sorry, we couldn't find an archived video for the current broadcast."));const c=`https://www.twitch.tv/videos/${l}${e.uptime>0?`?t=${Object(r.durationForURL)(e.uptime)}`:""}`,u="granted"===a||"prompt"===a,h=u?e=>(navigator.clipboard.writeText(c),e.preventDefault(),!1):null;return t.element.classList.add("tw-balloon--lg"),Object(n.createElement)("div",null,Object(n.createElement)("div",{class:"tw-pd-b-1 tw-mg-b-1 tw-border-b tw-semibold"},this.i18n.t("metadata.uptime.link-to","Link to {time}",{time:Object(r.duration_to_string)(e.uptime,!1,!1,!1,!1)})),Object(n.createElement)("div",{class:"tw-flex tw-align-items-center"},Object(n.createElement)("input",{class:"tw-border-radius-medium tw-font-size-6 tw-pd-x-1 tw-pd-y-05 tw-input tw-full-width",type:"text",value:c,onFocus:e=>e.target.select()}),u&&Object(n.createElement)("div",{class:"tw-relative tw-tooltip-wrapper tw-mg-l-1"},Object(n.createElement)("button",{class:"tw-align-items-center tw-align-middle tw-border-bottom-left-radius-medium tw-border-bottom-right-radius-medium tw-border-top-left-radius-medium tw-border-top-right-radius-medium tw-button-icon tw-core-button tw-core-button--border tw-inline-flex tw-interactive tw-justify-content-center tw-overflow-hidden tw-relative","aria-label":this.i18n.t("metadata.uptime.copy","Copy to Clipboard"),onClick:h},Object(n.createElement)("div",{class:"tw-align-items-center tw-flex tw-flex-grow-0"},Object(n.createElement)("span",{class:"tw-button-icon__icon"},Object(n.createElement)("figure",{class:"ffz-i-docs"})))),Object(n.createElement)("div",{class:"tw-tooltip tw-tooltip--align-right tw-tooltip--up"},this.i18n.t("metadata.uptime.copy","Copy to Clipboard")))))}},this.definitions["player-stats"]={button:!0,inherit:!0,refresh(){return this.settings.get("metadata.player-stats")},setup(){const e=this.resolve("site.player"),t=this.resolve("socket"),i=e.current;let n;if(i){if("function"==typeof i.getPlaybackStats)n=i.getPlaybackStats();else if("function"==typeof i.getVideoInfo){const e=i.getVideoInfo();n={backendVersion:Object(s.maybe_call)(i.getVersion,i),bufferSize:e.video_buffer_size,displayResolution:`${e.vid_display_width}x${e.vid_display_height}`,fps:e.current_fps,hlsLatencyBroadcaster:e.hls_latency_broadcaster/1e3,hlsLatencyEncoder:e.hls_latency_encoder/1e3,memoryUsage:`${e.totalMemoryNumber} MB`,rate:Object(s.maybe_call)(i.getPlaybackRate,i)||1,playbackRate:e.current_bitrate,skippedFrames:e.dropped_frames,videoResolution:`${e.vid_width}x${e.vid_height}`}}else if(i.stats){var r,o;const e=Object(s.maybe_call)(i.getVideoHeight,i)||0,t=Object(s.maybe_call)(i.getVideoWidth,i)||0,a=Object(s.maybe_call)(i.getDisplayHeight,i)||0,l=Object(s.maybe_call)(i.getDisplayWidth,i)||0;n={backendVersion:Object(s.maybe_call)(i.getVersion,i),bufferSize:Object(s.maybe_call)(i.getBufferDuration,i),displayResolution:`${l}x${a}`,videoResolution:`${t}x${e}`,videoHeight:e,videoWidth:t,displayHeight:a,displayWidth:l,rate:Object(s.maybe_call)(i.getPlaybackRate,i),fps:Math.floor(Object(s.maybe_call)(i.getVideoFrameRate,i)||0),hlsLatencyBroadcaster:null===(r=i.stats)||void 0===r?void 0:r.broadcasterLatency,hlsLatencyEncoder:null===(o=i.stats)||void 0===o?void 0:o.transcoderLatency,playbackRate:Math.floor((Object(s.maybe_call)(i.getVideoBitRate,i)||0)/1e3),skippedFrames:Object(s.maybe_call)(i.getDroppedFrames,i)}}}else n=null;if(!n||n.hlsLatencyBroadcaster<-100)return{stats:n};let a=0;return t&&t.connected&&(a=t._time_drift),{stats:n,drift:a,rate:null==n.rate?1:n.rate,delay:n.hlsLatencyBroadcaster,old:n.hlsLatencyBroadcaster>180}},order:3,icon:e=>e.rate>1?"ffz-i-fast-fw":"ffz-i-gauge",subtitle:()=>this.i18n.t("metadata.player-stats.subtitle","Latency"),label(e){if(!this.settings.get("metadata.player-stats")||!e.delay)return null;const t=e.drift>5e3?"(!) ":"";return e.old?`${t}${e.delay.toFixed(2)}s old`:`${t}${e.delay.toFixed(2)}s`},click(){const e=this.resolve("site.player").playerUI;e&&e.setStatsOverlay(1===e.statsOverlay?0:1)},color(e){const t=this.settings.get("metadata.stream-delay-warning");if(0!==t&&e.delay&&!e.old)return e.delay>2*t?"#ec1313":e.delay>t?"#fc7835":void 0},tooltip(e){const t=e.drift>5e3&&Object(n.createElement)("div",{class:"tw-border-b tw-mg-b-05 tw-pd-b-05"},this.i18n.t("metadata.player-stats.delay-warning","Your local clock seems to be off by roughly {count,number} seconds, which could make this inaccurate.",Math.round(e.drift/10)/100)),i=e.rate>1&&Object(n.createElement)("div",{class:"tw-border-b tw-mg-b-05 tw-pd-b-05"},this.i18n.t("metadata.player-stats.rate-warning","Playing at {rate,number}x speed to reduce delay.",{rate:e.rate.toFixed(2)}));if(!e.stats||!e.delay)return[t,i,this.i18n.t("metadata.player-stats.latency-tip","Stream Latency")];const s=e.stats,r=this.i18n.t("metadata.player-stats.video-info","Video: {videoResolution}p{fps}\nPlayback Rate: {playbackRate,number} Kbps\nDropped Frames:{skippedFrames,number}",s);return e.old?[t,this.i18n.t("metadata.player-stats.video-tip","Video Information"),Object(n.createElement)("div",{class:"tw-pd-t-05"},this.i18n.t("metadata.player-stats.broadcast-ago","Broadcast {count,number}s Ago",e.delay)),Object(n.createElement)("div",{class:"tw-pd-t-05"},r)]:[t,i,this.i18n.t("metadata.player-stats.latency-tip","Stream Latency"),Object(n.createElement)("div",{class:"tw-pd-t-05"},r)]}}}get keys(){return Object.keys(this.definitions)}define(e,t){this.definitions[e]=t,this.updateMetadata(e)}updateMetadata(e){const t=this.resolve("site.channel_bar");if(t)for(const i of t.ChannelBar.instances)t.updateMetadata(i,e);const i=this.resolve("site.legacy_channel_bar");if(i)for(const t of i.ChannelBar.instances)i.updateMetadata(t,e)}async renderLegacy(e,t,i,r,a){r[e]&&clearTimeout(r[e]);let l=i.querySelector(`.ffz-stat[data-key="${e}"]`);const c=this.definitions[e],destroy=()=>{l&&(l.tooltip&&l.tooltip.destroy(),l.popper&&l.popper.destroy(),l._ffz_destroy&&l._ffz_destroy(),l._ffz_destroy=l.tooltip=l.popper=null,l.remove())};if(!c||(t._mt||"channel")!==(c.type||"channel"))return destroy();try{c.setup&&(t=await c.setup.call(this,t));const u=Object(s.maybe_call)(c.refresh,this,t);let h,d,f;u&&(r[e]=setTimeout(()=>a(e),"number"==typeof u?u:1e3)),l=i.querySelector(`.ffz-stat[data-key="${e}"]`);const p=Object(s.maybe_call)(c.label,this,t);if(!p)return destroy();const g=Object(s.maybe_call)(c.order,this,t),m=Object(s.maybe_call)(c.color,this,t)||"";if(l){if(h=l.querySelector(".ffz-stat-text"),!h)return destroy();if(f=l.dataset.icon||"",d=l.dataset.color||"",l._ffz_order!==g&&(l.style.order=l._ffz_order=g),l.tip){const e=Object(s.maybe_call)(c.tooltip,this,t);l.tip_content!==e&&(l.tip_content=e,Object(n.setChildren)(l.tip.element,e))}}else{let r=f=Object(s.maybe_call)(c.icon,this,t),u=!1;if(!1!==c.button&&(c.popup||c.click)){let i,d;u=!0;const f=Object(s.maybe_call)(c.border,this,t),p=Object(s.maybe_call)(c.inherit,this,t);"string"==typeof r&&(r=Object(n.createElement)("span",{class:"tw-mg-r-05"},Object(n.createElement)("figure",{class:r}))),c.popup&&c.click?l=Object(n.createElement)("div",{class:`tw-align-items-center tw-inline-flex tw-relative tw-tooltip-wrapper ffz-stat tw-stat ffz-stat--fix-padding ${f?"tw-mg-l-1":"tw-mg-l-05 ffz-mg-r--05"}`,"data-key":e,tip_content:null},i=Object(n.createElement)("button",{class:`tw-align-items-center tw-align-middle tw-border-bottom-left-radius-medium tw-border-top-left-radius-medium tw-core-button tw-core-button--padded tw-core-button--text ${p?"ffz-c-text-inherit":"tw-c-text-base"} tw-inline-flex tw-interactive tw-justify-content-center tw-overflow-hidden tw-relative ${f?"tw-border-l tw-border-t tw-border-b":"tw-font-size-5 tw-regular"}`},Object(n.createElement)("div",{class:"tw-align-items-center tw-flex tw-flex-grow-0 tw-justify-center tw-pd-x-1"},r,h=Object(n.createElement)("span",{class:"ffz-stat-text"}))),d=Object(n.createElement)("button",{class:`tw-align-items-center tw-align-middle tw-border-bottom-right-radius-medium tw-border-top-right-radius-medium tw-core-button tw-core-button--text ${p?"ffz-c-text-inherit":"tw-c-text-base"} tw-inline-flex tw-interactive tw-justify-content-center tw-overflow-hidden tw-relative ${f?"tw-border":"tw-font-size-5 tw-regular"}`},Object(n.createElement)("div",{class:"tw-align-items-center tw-flex tw-flex-grow-0 tw-justify-center"},Object(n.createElement)("span",null,Object(n.createElement)("figure",{class:"ffz-i-down-dir"}))))):i=d=l=Object(n.createElement)("button",{class:`ffz-stat tw-align-items-center tw-align-middle tw-border-bottom-left-radius-medium tw-border-top-left-radius-medium tw-border-bottom-right-radius-medium tw-border-top-right-radius-medium tw-core-button tw-core-button--text ${p?"ffz-c-text-inherit":"tw-c-text-base"} tw-inline-flex tw-interactive tw-justify-content-center tw-overflow-hidden tw-relative tw-pd-x-05 ffz-stat--fix-padding ${f?"tw-border tw-mg-l-1":"tw-font-size-5 tw-regular tw-mg-l-05 ffz-mg-r--05"}`,"data-key":e,tip_content:null},Object(n.createElement)("div",{class:"tw-align-items-center tw-flex tw-flex-grow-0 tw-justify-center"},r,h=Object(n.createElement)("span",{class:"ffz-stat-text"}),c.popup&&!c.no_arrow&&Object(n.createElement)("span",{class:"tw-mg-l-05"},Object(n.createElement)("figure",{class:"ffz-i-down-dir"})))),c.click&&i.addEventListener("click",t=>{if(l._ffz_fading||i.disabled||i.classList.contains("disabled")||l.disabled||l.classList.contains("disabled"))return!1;c.click.call(this,l._ffz_data,t,()=>a(e))}),c.popup&&d.addEventListener("click",()=>{if(d.disabled||d.classList.contains("disabled")||l.disabled||l.classList.contains("disabled"))return!1;if(l._ffz_popup)return l._ffz_destroy();const t=[],add_close_listener=e=>t.push(e),i=l._ffz_destroy=()=>{for(const i of t)try{i()}catch(t){this.log.capture(t,{tags:{metadata:e}}),this.log.error("Error when running a callback for pop-up destruction for metadata:",e,t)}if(l._ffz_outside&&l._ffz_outside.destroy(),l._ffz_popup){const e=l._ffz_popup;l._ffz_popup=null,e.destroy()}l._ffz_destroy=l._ffz_outside=null},s=document.body.querySelector("#root>div")||document.body;(l._ffz_popup=new o.default(s,l,{logger:this.log,i18n:this.i18n,manual:!0,live:!1,html:!0,tooltipClass:"ffz-metadata-balloon tw-balloon tw-block tw-border tw-elevation-1 tw-border-radius-small tw-c-background-base",arrowClass:"tw-balloon__tail tw-overflow-hidden tw-absolute",arrowInner:"tw-balloon__tail-symbol tw-border-t tw-border-r tw-border-b tw-border-l tw-border-radius-small tw-c-background-base tw-absolute",innerClass:"tw-pd-1",popper:{placement:"top-end",modifiers:{preventOverflow:{boundariesElement:s},flip:{behavior:["top","bottom","left","right"]}}},content:(t,i)=>c.popup.call(this,l._ffz_data,i,()=>a(e),add_close_listener),onShow:(e,t)=>setTimeout(()=>{l._ffz_outside=new n.ClickOutside(t.outer,i)}),onHide:i}))._enter(l)})}else"string"==typeof r&&(r=Object(n.createElement)("span",{class:"tw-stat__icon"},Object(n.createElement)("figure",{class:r}))),l=Object(n.createElement)("div",{class:"tw-align-items-center tw-inline-flex tw-relative tw-tooltip-wrapper ffz-stat tw-stat tw-mg-l-1","data-key":e,tip_content:null},r,h=Object(n.createElement)("span",{class:`${r?"tw-mg-l-05 ":""}ffz-stat-text tw-stat__value`})),c.click&&l.addEventListener("click",t=>{if(l._ffz_fading||l.disabled||l.classList.contains("disabled"))return!1;c.click.call(this,l._ffz_data,t,()=>a(e))});if(l._ffz_order=g,null!=g&&(l.style.order=g),i.appendChild(l),c.tooltip){const e=document.body.querySelector("#root>div")||document.body;l.tooltip=new o.default(e,l,{logger:this.log,live:!1,html:!0,content:()=>Object(s.maybe_call)(c.tooltip,this,l._ffz_data),onShow:(e,t)=>l.tip=t,onHide:()=>{l.tip=null,l.tip_content=null},popper:{placement:"bottom",modifiers:{flip:{behavior:["bottom","top"]},preventOverflow:{boundariesElement:e}}}})}}if("function"==typeof c.icon){const e=Object(s.maybe_call)(c.icon,this,t);if("string"==typeof e&&e!==f){l.dataset.icon=e;const t=l.querySelector("figure");t&&(t.className=e)}}d!==m&&(l.dataset.color=m,l.style.setProperty("color",m,"important")),l._ffz_data=t,h.innerHTML=p,void 0!==c.disabled&&(l.disabled=Object(s.maybe_call)(c.disabled,this,t))}catch(t){return this.log.capture(t,{tags:{metadata:e}}),this.log.error(`Error rendering metadata for ${e}`,t),destroy()}}}},function(e,t,i){"use strict";i.r(t),i.d(t,"default",(function(){return TooltipProvider}));var n=i(1),s=i(0),r=i(12),o=i(3);class TooltipProvider extends o.default{constructor(...e){super(...e),this.types={},this.inject("i18n"),this.should_enable=!0,this.types.json=e=>{const t=e.dataset.title;return[t&&Object(n.createElement)("strong",null,t),Object(n.createElement)("code",{className:`block${t?" pd-t-05 border-t mg-t-05":""}`,style:{fontFamily:"monospace",textAlign:"left"}},e.dataset.data)]},this.types.child=e=>{const t=e.querySelector(":scope > .ffz-tooltip-child");return t?(e._ffz_child=t,t.remove(),t.classList.remove("ffz-tooltip-child"),t):null},this.types.child.onHide=e=>{const t=e._ffz_child;t&&(e._ffz_child=null,t.remove(),e.querySelector(":scope > .ffz-tooltip-child")||(t.classList.add("ffz-tooltip-child"),e.appendChild(t)))},this.types.text=e=>Object(n.sanitize)(e.dataset.title),this.types.html=e=>e.dataset.title}onEnable(){const e=document.querySelector(".sunlight-root")||document.querySelector("#root>div")||document.querySelector("#root")||document.querySelector(".clips-root")||document.body;this.tips=new r.default(e,"ffz-tooltip",{html:!0,i18n:this.i18n,delayHide:this.checkDelayHide.bind(this),delayShow:this.checkDelayShow.bind(this),content:this.process.bind(this),interactive:this.checkInteractive.bind(this),hover_events:this.checkHoverEvents.bind(this),onShow:this.delegateOnShow.bind(this),onHide:this.delegateOnHide.bind(this),popper:{placement:"top",modifiers:{flip:{behavior:["top","bottom","left","right"]},preventOverflow:{boundariesElement:e}}},onHover:(e,t,i)=>{this.emit(":hover",e,t,i)},onLeave:(e,t,i)=>{this.emit(":leave",e,t,i)}}),this.on(":cleanup",this.cleanup)}cleanup(){this.tips.cleanup()}delegateOnShow(e,t){const i=e.dataset.tooltipType,n=this.types[i];n&&n.onShow&&n.onShow(e,t)}delegateOnHide(e,t){const i=e.dataset.tooltipType,n=this.types[i];n&&n.onHide&&n.onHide(e,t)}checkDelayShow(e,t){const i=e.dataset.tooltipType,n=this.types[i];return Object(s.has)(n,"delayShow")?Object(s.maybe_call)(n.delayShow,null,e,t):0}checkDelayHide(e,t){const i=e.dataset.tooltipType,n=this.types[i];return Object(s.has)(n,"delayHide")?Object(s.maybe_call)(n.delayHide,null,e,t):0}checkInteractive(e,t){const i=e.dataset.tooltipType,n=this.types[i];return!!Object(s.has)(n,"interactive")&&Object(s.maybe_call)(n.interactive,null,e,t)}checkHoverEvents(e,t){const i=e.dataset.tooltipType,n=this.types[i];return!!Object(s.has)(n,"hover_events")&&Object(s.maybe_call)(n.hover_events,null,e,t)}process(e,t){const i=e.dataset.tooltipType||"text",s=this.types[i];return s?s(e,t):[Object(n.createElement)("strong",null,"Unhandled Tooltip Type"),Object(n.createElement)("code",{className:"tw-block pd-t-05 border-t mg-t-05",style:{fontFamily:"monospace",textAlign:"left"}},JSON.stringify(e.dataset,null,4))]}}},function(e,t,i){"use strict";i.r(t),i.d(t,"default",(function(){return TranslationUI}));var n=i(3),s=i(26),r=i(1);class TranslationUI extends n.default{constructor(...e){super(...e),this.inject("settings"),this.inject("i18n"),this.inject("site"),this.inject("vue"),this.load_requires=["vue"],this.dialog=new s.default(()=>this.buildDialog())}openPopout(){const e=window.open("https://twitch.tv/popout/frankerfacez/chat?ffz-translate","_blank","resizable=yes,scrollbars=yes,width=850,height=600");return e?(e.focus(),!0):(this.log.warn("Unable to open popout translation window."),!1)}async onLoad(){this.vue.component((await i.e(141).then(i.bind(null,341))).default)}async onEnable(){await this.site.awaitElement(s.default.EXCLUSIVE),this.on("i18n:seen",e=>{if(!this._vue)return;this._vue.$children[0].phrases.push(e)}),this.dialog.on("hide",this.destroyDialog,this),this.dialog.on("resize",()=>{this._vue&&(this._vue.$children[0].maximized=this.dialog.maximized)}),this.dialog.show()}onDisable(){this.dialog.hide()}buildDialog(){return this._dialog?this._dialog:(this._vue=new this.vue.Vue({el:Object(r.createElement)("div"),render:e=>e("translation-ui",this.getData())}),this._dialog=this._vue.$el)}destroyDialog(){this._vue&&this._vue.$destroy(),this._dialog=this._vue=null}getData(){return this.i18n.loadStrings(),{phrases:[],query:"",faded:!1,maximized:this.dialog.maximized,exclusive:this.dialog.exclusive,getI18n:()=>this.i18n,getKeys:()=>this.i18n.getKeys(),requestKeys:()=>this.i18n.requestKeys(),updatePhrase:(e,t)=>this.i18n.updatePhrase(e,t),listen:(e,t,i)=>this.on(e,t,i),unlisten:(e,t,i)=>this.off(e,t,i),resize:e=>!this.dialog.exclusive&&this.dialog.toggleSize(e),close:e=>!this.dialog.exclusive&&this.dialog.toggleVisible(e),popout:e=>{this.dialog.exclusive||(this.dialog.toggleVisible(e),this.openPopout()||alert(this.i18n.t("popup.error","We tried opening a pop-up window and could not. Make sure to allow pop-ups from Twitch.")))}}}}},function(e,t,i){"use strict";i.r(t),i.d(t,"Addon",(function(){return Addon}));var n=i(3);class Addon extends n.default{constructor(...e){super(...e),this.inject("i18n"),this.inject("settings")}static register(e,t){if("object"==typeof e&&(e=(t=e).id||void 0),!e){if(!this.name)throw new Error("Unable to register module without ID.");e=this.name.toSnakeCase()}!t&&this.info&&(t=this.info);const i=FrankerFaceZ.get();t&&(t.id=e,i.addons.addAddon(t));try{i.register(`addon.${e}`,this)}catch(t){if(t.message&&t.message.includes("Name Collision for Module")){const t=i.resolve(`addon.${e}`);t&&(t.external=!0)}throw t}}}},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t){e.exports=ffzVue}]);
//# sourceMappingURL=avalon.ca872fd40c39efc7ab70.js.map